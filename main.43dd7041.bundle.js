"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[13617],{443224:(e,t,r)=>{r.r(t),r.d(t,{default:()=>rc});var n,o=r(887371),i=r(545754),a=r(411987),c=r(695058),u=r(441820),s=r(161049),d=r.n(s),p=r(634795),l=r(859375),f=r(968079),y=r(199578),h=r(609850),v=r.n(h),g=r(380845),k=r(438760),w=r(402814),b=r(292147),m=r(213208),A=r(291026),O=r(859071),I=r(613549);const P=(0,k.backgroundClass)()(n=function(){function e(e){var t=e.backgroundApi;this.backgroundApi=t}return e.prototype.handleMethods=function(){var e=(0,p.default)((function*(e){var t=e.data,r=t.method,n=t.params,o=[].concat(void 0===n?[]:n),i=`${k.PROVIDER_API_METHOD_PREFIX}${r}`,a=this[i];return this[r]&&!a?(0,w.throwMethodNotFound)("ProviderApi",e.scope||"",i):a?a.call.apply(a,[this,e].concat((0,f.default)(o))):this.rpcCall(t)}));return function(t){return e.apply(this,arguments)}}(),(0,o.default)(e)}())||n;var T,S,D,M,C,N,R,j;function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var x=(T=(0,k.backgroundClass)(),S=(0,k.providerApiMethod)(),D=(0,k.providerApiMethod)(),M=(0,k.providerApiMethod)(),C=(0,k.permissionRequired)(),N=(0,k.providerApiMethod)(),T((j=function(e){(0,i.default)(r,e);var t=E(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.algo,e}var n=r.prototype;return n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r=e.origin;return{method:"wallet_events_accountsChanged",params:yield t.accounts({origin:r})}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.notifyDappChainChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(){return{method:"wallet_events_chainChanged",params:yield t.getChainId()}}));return function(){return e.apply(this,arguments)}}();e.send(r)},n.rpcCall=function(){throw A.web3Errors.rpc.methodNotSupported()},n.getChainId=function(){var e=(0,p.default)((function*(){b.default.providerApi.info("algo getChainId");var e=(0,O.getActiveWalletAccount)(),t=e.networkId,r=e.networkImpl,n=e.accountId;if(r===I.IMPL_ALGO){var o=yield this.backgroundApi.engine.getVault({networkId:t,accountId:n}),i=yield o.getNetworkChainId();return Promise.resolve({chainId:i})}}));return function(){return e.apply(this,arguments)}}(),n.accounts=function(){var e=(0,p.default)((function*(e){var t,r=null==(t=this.backgroundApi.serviceDapp)?void 0:t.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_ALGO});if(!r)return Promise.resolve([]);var n=r.map((function(e){return e.address}));return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),n.connect=function(){var e=(0,p.default)((function*(e){b.default.providerApi.info("algo connect",e);var t=yield this.accounts(e);return t&&t.length>0?t:(yield this.backgroundApi.serviceDapp.openConnectionModal(e),this.accounts(e))}));return function(t){return e.apply(this,arguments)}}(),n.algo_signTxn=function(){var e=(0,p.default)((function*(e,t){for(var r=[],n=0;n<t.length;n+=1)Array.isArray(t[n].signers)||r.push(t[n].txn);var o=(yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:r,signOnly:!0})).split(",");return t.map((function(e){var t;return Array.isArray(e.signers)?null:null!=(t=o.shift())?t:null}))}));return function(t,r){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)(j.prototype,"getChainId",[S],Object.getOwnPropertyDescriptor(j.prototype,"getChainId"),j.prototype),(0,l.default)(j.prototype,"accounts",[D],Object.getOwnPropertyDescriptor(j.prototype,"accounts"),j.prototype),(0,l.default)(j.prototype,"connect",[M],Object.getOwnPropertyDescriptor(j.prototype,"connect"),j.prototype),(0,l.default)(j.prototype,"algo_signTxn",[C,N],Object.getOwnPropertyDescriptor(j.prototype,"algo_signTxn"),j.prototype),R=j))||R);const _=x;var B,F,W,L,U,H,V,q,K,$,G,z,J,Q,X,Y,Z,ee,te,re,ne,oe,ie,ae,ce,ue,se,de,pe,le,fe=r(256666),ye=r(986152),he=r.n(ye),ve=r(84658),ge=r(557228),ke=r(572801),we=r(598165),be=r(368652);function me(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ae(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?me(Object(r),!0).forEach((function(t){(0,fe.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):me(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Oe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var Ie=(B=(0,k.backgroundClass)(),F=(0,k.providerApiMethod)(),W=(0,k.providerApiMethod)(),L=(0,k.providerApiMethod)(),U=(0,k.providerApiMethod)(),H=(0,k.providerApiMethod)(),V=(0,k.permissionRequired)(),q=(0,k.providerApiMethod)(),K=(0,k.permissionRequired)(),$=(0,k.providerApiMethod)(),G=(0,k.permissionRequired)(),z=(0,k.providerApiMethod)(),J=(0,k.permissionRequired)(),Q=(0,k.providerApiMethod)(),X=(0,k.permissionRequired)(),Y=(0,k.providerApiMethod)(),Z=(0,k.providerApiMethod)(),ee=(0,k.providerApiMethod)(),te=(0,k.providerApiMethod)(),re=(0,k.providerApiMethod)(),ne=(0,k.providerApiMethod)(),oe=(0,k.providerApiMethod)(),ie=(0,k.providerApiMethod)(),ae=(0,k.providerApiMethod)(),ce=(0,k.providerApiMethod)(),ue=(0,k.providerApiMethod)(),se=(0,k.providerApiMethod)(),de=(0,k.providerApiMethod)(),B((le=function(e){(0,i.default)(r,e);var t=Oe(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.aptos,e}var n=r.prototype;return n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r=e.origin;return{method:"wallet_events_accountChanged",params:yield t.account({origin:r})}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.notifyDappChainChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(){return{method:"wallet_events_networkChange",params:yield t.network()}}));return function(){return e.apply(this,arguments)}}();e.send(r)},n.rpcCall=function(){throw A.web3Errors.rpc.methodNotSupported()},n.getNetworkURL=function(){var e=(0,p.default)((function*(){var e=(0,O.getActiveWalletAccount)().networkId;return(yield this.backgroundApi.engine.getNetwork(e)).rpcURL}));return function(){return e.apply(this,arguments)}}(),n.wrapperConnectAccount=function(e){var t=e?200:4001;return Ae(Ae({},e),{},{method:"connected",status:t})},n.connect=function(){var e=(0,p.default)((function*(e){b.default.providerApi.info("aptos connect",e);var t=yield this.account(e);return t?this.wrapperConnectAccount(t):(yield this.backgroundApi.serviceDapp.openConnectionModal(e),this.wrapperConnectAccount(yield this.account(e)))}));return function(t){return e.apply(this,arguments)}}(),n.disconnect=function(e){var t=e.origin;t&&(this.backgroundApi.serviceDapp.removeConnectedAccounts({origin:t,networkImpl:I.IMPL_APTOS,addresses:this.backgroundApi.serviceDapp.getActiveConnectedAccounts({origin:t,impl:I.IMPL_APTOS}).map((function(e){return e.address}))}),b.default.providerApi.info("aptos disconnect",t))},n.account=function(){var e=(0,p.default)((function*(e){var t;b.default.providerApi.info("aptos account");var r=(0,O.getActiveWalletAccount)(),n=r.networkId,o=r.networkImpl,i=r.accountId;if(o===I.IMPL_APTOS){var a=null==(t=this.backgroundApi.serviceDapp)?void 0:t.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_APTOS});if(a){var c=yield this.backgroundApi.engine.getVault({networkId:n,accountId:i}),u=yield c.getAccountAddress(),s=a.map((function(e){return e.address}));if(s.includes(u)){var d=yield c._getPublicKey();return Promise.resolve({publicKey:d,address:u})}}}}));return function(t){return e.apply(this,arguments)}}(),n.network=function(){var e=(0,p.default)((function*(){b.default.providerApi.info("aptos network");var e=(0,O.getActiveWalletAccount)().networkId,t=yield this.backgroundApi.engine.getNetwork(e);return Promise.resolve(t.isTestnet?"Testnet":"Mainnet")}));return function(){return e.apply(this,arguments)}}(),n.signAndSubmitTransaction=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("aptos signAndSubmitTransaction",t);var r=(0,O.getActiveWalletAccount)(),n=r.networkId,o=r.accountId,i=yield this.backgroundApi.engine.getVault({networkId:n,accountId:o}),a=t,c=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:a}),u=yield i.getTransactionByHash(c);return Promise.resolve(JSON.stringify(u))}));return function(t,r){return e.apply(this,arguments)}}(),n._decodeTnxToRawTransaction=function(e){var t;t=-1!==e.indexOf(",")?new Uint8Array(e.split(",").map((function(e){return parseInt(e,10)}))):(0,ve.hexToBytes)(e);var r=new ge.BCS.Deserializer(t);return{rawTxn:ge.TxnBuilderTypes.RawTransaction.deserialize(r),hexBcsTxn:(0,ve.bytesToHex)(t)}},n._convertRawTransactionToEncodeTx=function(){var e=(0,p.default)((function*(e,t,r){var n,o,i,a,c,u,s=yield(0,we.transactionPayloadToTxPayload)(yield r.getClient(),e.payload.value);return Ae({sender:(0,be.hexlify)(null==e||null==(n=e.sender)?void 0:n.address),sequence_number:null==e||null==(o=e.sequence_number)?void 0:o.toString(),max_gas_amount:null==e||null==(i=e.max_gas_amount)?void 0:i.toString(),gas_unit_price:null==e||null==(a=e.gas_unit_price)?void 0:a.toString(),expiration_timestamp_secs:null==e||null==(c=e.expiration_timestamp_secs)?void 0:c.toString(),chain_id:null==e||null==(u=e.chain_id)?void 0:u.value,bscTxn:t},s)}));return function(t,r,n){return e.apply(this,arguments)}}(),n.martianSignAndSubmitTransaction=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("aptos martianSignAndSubmitTransaction",t);var r=(0,O.getActiveWalletAccount)(),n=r.networkId,o=r.accountId,i=yield this.backgroundApi.engine.getVault({networkId:n,accountId:o}),a=this._decodeTnxToRawTransaction(t),c=a.rawTxn,u=a.hexBcsTxn,s=yield this._convertRawTransactionToEncodeTx(c,u,i),d=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:s});return Promise.resolve(d)}));return function(t,r){return e.apply(this,arguments)}}(),n.martianSignTransaction=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("aptos martianSignTransaction",t);var r=(0,O.getActiveWalletAccount)(),n=r.networkId,o=r.accountId,i=yield this.backgroundApi.engine.getVault({networkId:n,accountId:o}),a=this._decodeTnxToRawTransaction(t),c=a.rawTxn,u=a.hexBcsTxn,s=yield this._convertRawTransactionToEncodeTx(c,u,i),d=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:s,signOnly:!0});return Promise.resolve((0,ve.hexToBytes)((0,be.stripHexPrefix)(d)).toString())}));return function(t,r){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("aptos signTransaction",t);var r=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:t,signOnly:!0});return Promise.resolve(r)}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,p.default)((function*(e,t){var r,n,o;b.default.providerApi.info("aptos signMessage",t);var i="petra"===(null==(r=e.data)?void 0:r.aptosProviderType),a=yield this.account(e),c=(0,O.getActiveWalletAccount)(),u=c.networkId,s=c.accountId,d=yield this.backgroundApi.engine.getVault({networkId:u,accountId:s}),p=yield(yield d.getClient()).getChainId(),l=(0,we.formatSignMessageRequest)(t,null!=(n=null==a?void 0:a.address)?n:"",null!=(o=e.origin)?o:"",p),f=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{unsignedMessage:{type:ke.AptosMessageTypes.SIGN_MESSAGE,message:JSON.stringify(l)}});return Promise.resolve(Ae(Ae({},l),{},{prefix:we.APTOS_SIGN_MESSAGE_PREFIX,signature:i?(0,be.stripHexPrefix)(f):f}))}));return function(t,r){return e.apply(this,arguments)}}(),n.signGenericTransaction=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("aptos signGenericTransaction",t);var r={type:"entry_function_payload",function:t.func,arguments:t.args,type_arguments:t.type_args},n=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:r});return Promise.resolve(n)}));return function(t,r){return e.apply(this,arguments)}}(),n.createCollection=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("aptos createCollection",t);var r=(0,O.getActiveWalletAccount)(),n=r.networkId,o=r.networkImpl,i=r.accountId;if(o===I.IMPL_APTOS){var a=yield this.backgroundApi.engine.getVault({networkId:n,accountId:i}),c=yield a.getAccountAddress(),u=(0,we.generateTransferCreateCollection)(c,t.name,t.description,t.uri),s=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:u});return Promise.resolve(s)}}));return function(t,r){return e.apply(this,arguments)}}(),n.createToken=function(){var e=(0,p.default)((function*(e,t){var r;b.default.providerApi.info("aptos createToken",t);var n=(0,O.getActiveWalletAccount)(),o=n.networkId,i=n.networkImpl,a=n.accountId;if(i===I.IMPL_APTOS){var c=yield this.backgroundApi.engine.getVault({networkId:o,accountId:a}),u=yield c.getAccountAddress(),s=(0,we.generateTransferCreateNft)(u,t.collectionName,t.name,t.description,t.supply,t.uri,BigInt(null!=(r=t.max)?r:9007199254740991),t.royalty_payee_address,t.royalty_points_denominator,t.royalty_points_numerator,t.property_keys,t.property_values,t.property_types),d=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:s});return Promise.resolve(d)}}));return function(t,r){return e.apply(this,arguments)}}(),n.getAptosVault=function(){var e=(0,p.default)((function*(){var e=(0,O.getActiveWalletAccount)(),t=e.networkId,r=e.networkImpl,n=e.accountId;if(r!==I.IMPL_APTOS)throw A.web3Errors.provider.chainDisconnected();return yield this.backgroundApi.engine.getVault({networkId:t,accountId:n})}));return function(){return e.apply(this,arguments)}}(),n.getChainId=function(){var e=(0,p.default)((function*(){b.default.providerApi.info("aptos getChainId");var e=yield this.getAptosVault(),t=yield(yield e.getClient()).getChainId();return Promise.resolve({chainId:t})}));return function(){return e.apply(this,arguments)}}(),n.generateTransaction=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("aptos generateTransaction");var r=yield this.getAptosVault(),n=yield r.getClient(),o=yield n.generateTransaction(t.sender,t.payload,t.options),i=new ge.BCS.Serializer;return o.serialize(i),i.getBytes().toString()}));return function(t,r){return e.apply(this,arguments)}}(),n.submitTransaction=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("aptos generateTransaction");var r=function(e){var t;if(he()(e))t=Uint8Array.from(e);else if("object"===typeof e)t=new Uint8Array(Object.values(e));else{if("string"!==typeof e)throw new Error("invalidParams");t=-1!==e.indexOf(",")?new Uint8Array(e.split(",").map((function(e){return parseInt(e,10)}))):(0,ve.hexToBytes)(e)}return t}(t),n=yield this.getAptosVault(),o=yield n.getClient();return(yield o.submitTransaction(r)).hash}));return function(t,r){return e.apply(this,arguments)}}(),n.getTransactions=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("aptos getTransactions");var r=yield this.getAptosVault(),n=yield r.getClient(),o=(null!=t?t:{}).start;return n.getTransactions({start:o?BigInt(o):void 0,limit:t.limit})}));return function(t,r){return e.apply(this,arguments)}}(),n.getTransaction=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("aptos getTransaction");var r=yield this.getAptosVault();return(yield r.getClient()).getTransactionByHash(t)}));return function(t,r){return e.apply(this,arguments)}}(),n.getAccountTransactions=function(){var e=(0,p.default)((function*(e,t){var r,n;b.default.providerApi.info("aptos getAccountTransactions");var o=yield this.getAptosVault(),i=yield o.getClient(),a=(null!=(r=t.query)?r:{}).start;return i.getAccountTransactions(t.accountAddress,{start:a?BigInt(a):void 0,limit:null==(n=t.query)?void 0:n.limit})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAccountResources=function(){var e=(0,p.default)((function*(e,t){var r;b.default.providerApi.info("aptos getAccountResources");var n=yield this.getAptosVault(),o=yield n.getClient(),i=(null!=(r=t.query)?r:{}).ledgerVersion;return o.getAccountResources(t.accountAddress,{ledgerVersion:i?BigInt(i):void 0})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAccount=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("aptos getAccount");var r=yield this.getAptosVault();return(yield r.getClient()).getAccount(t)}));return function(t,r){return e.apply(this,arguments)}}(),n.getLedgerInfo=function(){var e=(0,p.default)((function*(){b.default.providerApi.info("aptos getLedgerInfo");var e=yield this.getAptosVault();return(yield e.getClient()).getLedgerInfo()}));return function(){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)(le.prototype,"getNetworkURL",[F],Object.getOwnPropertyDescriptor(le.prototype,"getNetworkURL"),le.prototype),(0,l.default)(le.prototype,"connect",[W],Object.getOwnPropertyDescriptor(le.prototype,"connect"),le.prototype),(0,l.default)(le.prototype,"disconnect",[L],Object.getOwnPropertyDescriptor(le.prototype,"disconnect"),le.prototype),(0,l.default)(le.prototype,"account",[U],Object.getOwnPropertyDescriptor(le.prototype,"account"),le.prototype),(0,l.default)(le.prototype,"network",[H],Object.getOwnPropertyDescriptor(le.prototype,"network"),le.prototype),(0,l.default)(le.prototype,"signAndSubmitTransaction",[V,q],Object.getOwnPropertyDescriptor(le.prototype,"signAndSubmitTransaction"),le.prototype),(0,l.default)(le.prototype,"martianSignAndSubmitTransaction",[K,$],Object.getOwnPropertyDescriptor(le.prototype,"martianSignAndSubmitTransaction"),le.prototype),(0,l.default)(le.prototype,"martianSignTransaction",[G,z],Object.getOwnPropertyDescriptor(le.prototype,"martianSignTransaction"),le.prototype),(0,l.default)(le.prototype,"signTransaction",[J,Q],Object.getOwnPropertyDescriptor(le.prototype,"signTransaction"),le.prototype),(0,l.default)(le.prototype,"signMessage",[X,Y],Object.getOwnPropertyDescriptor(le.prototype,"signMessage"),le.prototype),(0,l.default)(le.prototype,"signGenericTransaction",[Z],Object.getOwnPropertyDescriptor(le.prototype,"signGenericTransaction"),le.prototype),(0,l.default)(le.prototype,"createCollection",[ee],Object.getOwnPropertyDescriptor(le.prototype,"createCollection"),le.prototype),(0,l.default)(le.prototype,"createToken",[te],Object.getOwnPropertyDescriptor(le.prototype,"createToken"),le.prototype),(0,l.default)(le.prototype,"getChainId",[re],Object.getOwnPropertyDescriptor(le.prototype,"getChainId"),le.prototype),(0,l.default)(le.prototype,"generateTransaction",[ne],Object.getOwnPropertyDescriptor(le.prototype,"generateTransaction"),le.prototype),(0,l.default)(le.prototype,"submitTransaction",[oe],Object.getOwnPropertyDescriptor(le.prototype,"submitTransaction"),le.prototype),(0,l.default)(le.prototype,"getTransactions",[ie],Object.getOwnPropertyDescriptor(le.prototype,"getTransactions"),le.prototype),(0,l.default)(le.prototype,"getTransaction",[ae],Object.getOwnPropertyDescriptor(le.prototype,"getTransaction"),le.prototype),(0,l.default)(le.prototype,"getAccountTransactions",[ce],Object.getOwnPropertyDescriptor(le.prototype,"getAccountTransactions"),le.prototype),(0,l.default)(le.prototype,"getAccountResources",[ue],Object.getOwnPropertyDescriptor(le.prototype,"getAccountResources"),le.prototype),(0,l.default)(le.prototype,"getAccount",[se],Object.getOwnPropertyDescriptor(le.prototype,"getAccount"),le.prototype),(0,l.default)(le.prototype,"getLedgerInfo",[de],Object.getOwnPropertyDescriptor(le.prototype,"getLedgerInfo"),le.prototype),pe=le))||pe);const Pe=Ie;var Te,Se,De,Me,Ce,Ne,Re,je,Ee,xe,_e,Be,Fe,We,Le,Ue,He,Ve,qe,Ke,$e,Ge=r(196234),ze=r(301842),Je=r.n(ze),Qe=r(206391),Xe=r.n(Qe),Ye=r(376314),Ze=r(112889),et=r(942013),tt=r(471453),rt=r(725141),nt=r(348834).Buffer;function ot(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function it(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(r),!0).forEach((function(t){(0,fe.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ot(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function at(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}const ct=(Te=(0,k.backgroundClass)(),Se=(0,k.providerApiMethod)(),De=(0,k.providerApiMethod)(),Me=(0,k.providerApiMethod)(),Ce=(0,k.providerApiMethod)(),Ne=(0,k.providerApiMethod)(),Re=(0,k.providerApiMethod)(),je=(0,k.providerApiMethod)(),Ee=(0,k.providerApiMethod)(),xe=(0,k.providerApiMethod)(),_e=(0,k.providerApiMethod)(),Be=(0,k.providerApiMethod)(),Fe=(0,k.providerApiMethod)(),We=(0,k.providerApiMethod)(),Le=(0,k.providerApiMethod)(),Ue=(0,k.providerApiMethod)(),He=(0,k.providerApiMethod)(),Ve=(0,k.providerApiMethod)(),qe=(0,k.providerApiMethod)(),Te(($e=function(e){(0,i.default)(r,e);var t=at(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.btc,e}var n=r.prototype;return n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r=e.origin;return{method:"wallet_events_accountsChanged",params:yield t.getAccounts({origin:r})}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.notifyDappChainChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(){return{method:"wallet_events_networkChanged",params:yield t.getNetwork()}}));return function(){return e.apply(this,arguments)}}();e.send(r)},n.rpcCall=function(){throw A.web3Errors.rpc.methodNotSupported()},n.getProviderState=function(){var e=(0,p.default)((function*(){var e=yield this.backgroundApi.serviceApp.isUnlock(),t=[],r=(0,O.getActiveWalletAccount)(),n=r.accountAddress,o=r.network;return e&&n&&t.push(n),{network:o?(0,tt.getNetworkName)(o):"",isUnlocked:e,accounts:t}}));return function(){return e.apply(this,arguments)}}(),n.requestAccounts=function(){var e=(0,p.default)((function*(e){b.default.providerApi.info("ProviderApiBtc.requestAccounts",e);var t=yield this.getAccounts(e);return t&&t.length?t:(yield this.backgroundApi.serviceDapp.openConnectionModal(e),this.getAccounts(e))}));return function(t){return e.apply(this,arguments)}}(),n.getAccounts=function(){var e=(0,p.default)((function*(e){var t,r=(0,O.getActiveWalletAccount)().network,n=null==(t=this.backgroundApi.serviceDapp)?void 0:t.getActiveConnectedAccounts({origin:e.origin,impl:null!=r&&r.isTestnet?I.IMPL_TBTC:I.IMPL_BTC});if(!n)return Promise.resolve([]);var o=n.map((function(e){return e.address}));return Promise.resolve(o)}));return function(t){return e.apply(this,arguments)}}(),n.getNetwork=function(){var e=(0,p.default)((function*(){b.default.providerApi.info("ProviderApiBtc.getNetwork");var e=(0,O.getActiveWalletAccount)().network;return e?(0,tt.getNetworkName)(e):""}));return function(){return e.apply(this,arguments)}}(),n.switchNetwork=function(){var e=(0,p.default)((function*(e,t){var r;b.default.providerApi.info("ProviderApiBtc.switchNetwork");var n,o=t.network;if("livenet"===o?n=et.OnekeyNetwork.btc:"testnet"===o&&(n=et.OnekeyNetwork.tbtc),!n)throw A.web3Errors.provider.custom({code:4e3,message:`Unrecognized network ${o}.`});var i=(0,O.getActiveWalletAccount)().network;n!==(null==i?void 0:i.id)&&(yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSwitchNetworkModal(e,{networkId:n}))}));return function(t,r){return e.apply(this,arguments)}}(),n.getPublicKey=function(){var e=(0,p.default)((function*(){b.default.providerApi.info("ProviderApiBtc.getPublicKey");var e=(0,O.getActiveWalletAccount)().accountPubKey;return Promise.resolve(e)}));return function(){return e.apply(this,arguments)}}(),n.getBalance=function(){var e=(0,p.default)((function*(){b.default.providerApi.info("ProviderApiBtc.getBalance");var e=(0,O.getActiveWalletAccount)(),t=e.accountId,r=e.network;if(!t||!r)return null;var n,o,i=yield this.backgroundApi.serviceToken.fetchBalanceDetails({networkId:r.id,accountId:t});return i?{confirmed:new(Xe())(i.total).minus(null!=(n=i.unavailableOfUnconfirmed)?n:"0").shiftedBy(r.decimals).toFixed(),unconfirmed:new(Xe())(null!=(o=i.unavailableOfUnconfirmed)?o:"0").shiftedBy(r.decimals).toFixed(),total:new(Xe())(i.total).shiftedBy(r.decimals).toFixed()}:null}));return function(){return e.apply(this,arguments)}}(),n.getInscriptions=function(){var e=(0,p.default)((function*(){b.default.providerApi.info("ProviderApiBtc.getBalance");var e=(0,O.getActiveWalletAccount)(),t=e.networkId,r=e.accountAddress,n=new rt.RestfulRequest((0,Ze.getFiatEndpoint)(),{},6e4),o={chain:t,address:r};try{var i=yield n.get("/NFT/v2/list",o).then((function(e){return e.json()}));return{total:i.data.length,list:i.data}}catch(a){return null}}));return function(){return e.apply(this,arguments)}}(),n.sendBitcoin=function(){var e=(0,p.default)((function*(e,t){var r,n=t.toAddress,o=t.satoshis,i=t.feeRate,a=(0,O.getActiveWalletAccount)(),c=a.account,u=a.network;if(!u||!c)throw A.web3Errors.provider.custom({code:4002,message:"Can not get current account"});var s=new(Xe())(o);if(s.isNaN()||s.isNegative())throw A.web3Errors.rpc.invalidParams("Invalid satoshis");var d=yield this.backgroundApi.engine.getVault({networkId:u.id,accountId:c.id}),p=yield d.buildEncodedTxFromTransfer({from:c.address,to:n,amount:s.shiftedBy(-u.decimals).toFixed()},Je()(i)?void 0:new(Xe())(i).shiftedBy(-u.feeDecimals).toFixed());return yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSignAndSendModal(e,{encodedTx:p})}));return function(t,r){return e.apply(this,arguments)}}(),n.sendInscription=function(){var e=(0,p.default)((function*(e,t){var r,n,o=t.toAddress,i=t.inscriptionId,a=t.feeRate,c=(0,O.getActiveWalletAccount)(),u=c.account,s=c.accountAddress,d=c.network;if(!d||!u)throw A.web3Errors.provider.custom({code:4002,message:"Can not get current account"});var p=yield this.backgroundApi.serviceNFT.getAsset({networkId:d.id,accountId:u.id,tokenId:i,local:!0});if(!p)throw A.web3Errors.provider.custom({code:4001,message:`Can not get asset by inscriptionId ${i}`});var l=yield this.backgroundApi.engine.getVault({networkId:d.id,accountId:u.id}),f=yield l.buildEncodedTxFromTransfer({from:s,to:o,amount:"0",isNFT:!0,nftTokenId:p.inscription_id,nftInscription:{address:p.owner,inscriptionId:p.inscription_id,output:p.output,location:p.location}},Je()(a)?void 0:new(Xe())(a).shiftedBy(null!=(r=-d.feeDecimals)?r:"0").toFixed());return yield null==(n=this.backgroundApi.serviceDapp)?void 0:n.openSignAndSendModal(e,{encodedTx:f})}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,p.default)((function*(e,t){var r=t.message,n=t.type,o=(0,O.getActiveWalletAccount)(),i=o.network,a=o.account,c=o.wallet;if("hw"===(null==c?void 0:c.type))throw A.web3Errors.provider.custom({code:4003,message:"Sign message is not supported on hardware."});if(!i||!a)throw A.web3Errors.provider.custom({code:4002,message:"Can not get current account"});if("bip322-simple"!==n&&"ecdsa"!==n)throw A.web3Errors.rpc.invalidParams("Invalid type");var u=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{unsignedMessage:{type:n,message:r,sigOptions:{noScriptType:!0},payload:{isFromDApp:!0}},signOnly:!0});return nt.from(u,"hex").toString("base64")}));return function(t,r){return e.apply(this,arguments)}}(),n.pushTx=function(){var e=(0,p.default)((function*(e,t){var r=t.rawTx,n=(0,O.getActiveWalletAccount)(),o=n.networkId,i=n.accountId,a=yield this.backgroundApi.engine.getVault({networkId:o,accountId:i});return(yield a.broadcastTransaction({txid:"",rawTx:r})).txid}));return function(t,r){return e.apply(this,arguments)}}(),n.signPsbt=function(){var e=(0,p.default)((function*(e,t){var r=t.psbtHex,n=t.options,o=(0,tt.formatPsbtHex)(r),i=(0,O.getActiveWalletAccount)(),a=i.network,c=i.wallet;if("hw"===(null==c?void 0:c.type))throw A.web3Errors.provider.custom({code:4003,message:"Partially signed bitcoin transactions is not supported on hardware."});if(!a)return null;var u=(0,tt.toPsbtNetwork)(a),s=Ye.Psbt.fromHex(o,{network:u});return yield this._signPsbt(e,{psbt:s,psbtNetwork:u,options:n})}));return function(t,r){return e.apply(this,arguments)}}(),n.signPsbts=function(){var e=(0,p.default)((function*(e,t){var r=t.psbtHexs,n=t.options,o=(0,O.getActiveWalletAccount)(),i=o.network,a=o.wallet;if("hw"===(null==a?void 0:a.type))throw A.web3Errors.provider.custom({code:4003,message:"Partially signed bitcoin transactions is not supported on hardware."});if(!i)return null;for(var c=(0,tt.toPsbtNetwork)(i),u=[],s=0;s<r.length;s+=1){var d=(0,tt.formatPsbtHex)(r[s]),p=Ye.Psbt.fromHex(d,{network:c}),l=yield this._signPsbt(e,{psbt:p,psbtNetwork:c,options:n});u.push(l)}return u}));return function(t,r){return e.apply(this,arguments)}}(),n.pushPsbt=function(){var e=(0,p.default)((function*(e,t){var r=t.psbtHex,n=(0,tt.formatPsbtHex)(r),o=Ye.Psbt.fromHex(n).extractTransaction().toHex(),i=(0,O.getActiveWalletAccount)(),a=i.networkId,c=i.accountId,u=yield this.backgroundApi.engine.getVault({networkId:a,accountId:c});return(yield u.broadcastTransaction({txid:"",rawTx:o})).txid}));return function(t,r){return e.apply(this,arguments)}}(),n.inscribeTransfer=function(){var e=(0,p.default)((function*(e,t){var r=t.ticker,n=t.amount,o=new(Xe())(null!=n?n:0);if(o.isNaN()||o.isNegative())throw A.web3Errors.rpc.invalidParams("Invalid amount.");if(!r)throw A.web3Errors.rpc.invalidParams("Invalid ticker.");return this.backgroundApi.serviceDapp.openInscribeTransferModal(e,{ticker:r,amount:n})}));return function(t,r){return e.apply(this,arguments)}}(),n._signPsbt=function(){var e=(0,p.default)((function*(e,t){var r,n,o=t.psbt,i=t.psbtNetwork,a=t.options,c=(0,O.getActiveWalletAccount)(),u=c.account,s=c.network;if(!u||!u.xpub||!s)throw A.web3Errors.provider.custom({code:4002,message:"Can not get current account"});var d=(yield(0,tt.httpPost)({isTestnet:s.isTestnet,route:"/tx/decode",params:{psbtHex:o.toHex()}})).data,p=(0,tt.getInputsToSignFromPsbt)({psbt:o,psbtNetwork:i,account:u,isBtcWalletProvider:a.isBtcWalletProvider}),l=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:{inputs:(null!=(r=d.inputInfos)?r:[]).map((function(e){return it(it({},e),{},{path:"",value:e.value.toString(),inscriptions:e.inscriptions.map((function(e){return(0,tt.mapInscriptionToNFTBTCAssetModel)(d.inscriptions[e.inscriptionId])}))})})),outputs:(null!=(n=d.outputInfos)?n:[]).map((function(e){return it(it({},e),{},{value:e.value.toString(),inscriptions:e.inscriptions.map((function(e){return(0,tt.mapInscriptionToNFTBTCAssetModel)(d.inscriptions[e.inscriptionId])}))})})),totalFee:d.fee,totalFeeInNative:new(Xe())(d.fee).shiftedBy(-s.decimals).toFixed(),transferInfo:{from:"",to:"",amount:"0",coinControlDisabled:!0},inputsToSign:p,psbtHex:o.toHex()},signOnly:!0}),f=Ye.Psbt.fromHex(l.psbtHex,{network:i});return a&&!1===a.autoFinalized||p.forEach((function(e){f.finalizeInput(e.index)})),a.isBtcWalletProvider?f.extractTransaction().toHex():f.toHex()}));return function(t,r){return e.apply(this,arguments)}}(),n.getNetworkFees=function(){var e=(0,p.default)((function*(){var e=(0,O.getActiveWalletAccount)(),t=e.account,r=e.network;if(!t||!r)return null;var n=yield this.backgroundApi.engine.getVault({networkId:r.id,accountId:t.id}),o=yield n.getFeeRate();if(3!==o.length)throw new Error("Invalid fee rate");var i=(0,Ge.default)(o,3),a=i[0],c=i[1];return{fastestFee:i[2],halfHourFee:c,hourFee:a,economyFee:a,minimumFee:a}}));return function(){return e.apply(this,arguments)}}(),n.getUtxos=function(){var e=(0,p.default)((function*(e,t){var r=(0,O.getActiveWalletAccount)(),n=r.account,o=r.network;if(!n||!o)return null;var i=yield this.backgroundApi.engine.getVault({networkId:o.id,accountId:n.id}),a=(yield i.collectUTXOsInfo({checkInscription:!0})).utxos.filter((function(e){var r;return e.address===t.address&&Number(null!=(r=null==e?void 0:e.confirmations)?r:0)>0})),c=0,u=0;for(var s of a)if(u+=1,(c+=new(Xe())(s.value).toNumber())>t.amount)break;if(c<t.amount)return[];var d=a.slice(0,u),p=[];for(var l of d){var f,y,h=yield this.backgroundApi.serviceTransaction.getTransactionDetail({txId:l.txid,networkId:o.id});p.push({txid:l.txid,vout:l.vout,value:new(Xe())(l.value).toNumber(),scriptPubKey:null!=(f=null==h||null==(y=h.vout)?void 0:y[l.vout].hex)?f:""})}return p}));return function(t,r){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)($e.prototype,"getProviderState",[Se],Object.getOwnPropertyDescriptor($e.prototype,"getProviderState"),$e.prototype),(0,l.default)($e.prototype,"requestAccounts",[De],Object.getOwnPropertyDescriptor($e.prototype,"requestAccounts"),$e.prototype),(0,l.default)($e.prototype,"getAccounts",[Me],Object.getOwnPropertyDescriptor($e.prototype,"getAccounts"),$e.prototype),(0,l.default)($e.prototype,"getNetwork",[Ce],Object.getOwnPropertyDescriptor($e.prototype,"getNetwork"),$e.prototype),(0,l.default)($e.prototype,"switchNetwork",[Ne],Object.getOwnPropertyDescriptor($e.prototype,"switchNetwork"),$e.prototype),(0,l.default)($e.prototype,"getPublicKey",[Re],Object.getOwnPropertyDescriptor($e.prototype,"getPublicKey"),$e.prototype),(0,l.default)($e.prototype,"getBalance",[je],Object.getOwnPropertyDescriptor($e.prototype,"getBalance"),$e.prototype),(0,l.default)($e.prototype,"getInscriptions",[Ee],Object.getOwnPropertyDescriptor($e.prototype,"getInscriptions"),$e.prototype),(0,l.default)($e.prototype,"sendBitcoin",[xe],Object.getOwnPropertyDescriptor($e.prototype,"sendBitcoin"),$e.prototype),(0,l.default)($e.prototype,"sendInscription",[_e],Object.getOwnPropertyDescriptor($e.prototype,"sendInscription"),$e.prototype),(0,l.default)($e.prototype,"signMessage",[Be],Object.getOwnPropertyDescriptor($e.prototype,"signMessage"),$e.prototype),(0,l.default)($e.prototype,"pushTx",[Fe],Object.getOwnPropertyDescriptor($e.prototype,"pushTx"),$e.prototype),(0,l.default)($e.prototype,"signPsbt",[We],Object.getOwnPropertyDescriptor($e.prototype,"signPsbt"),$e.prototype),(0,l.default)($e.prototype,"signPsbts",[Le],Object.getOwnPropertyDescriptor($e.prototype,"signPsbts"),$e.prototype),(0,l.default)($e.prototype,"pushPsbt",[Ue],Object.getOwnPropertyDescriptor($e.prototype,"pushPsbt"),$e.prototype),(0,l.default)($e.prototype,"inscribeTransfer",[He],Object.getOwnPropertyDescriptor($e.prototype,"inscribeTransfer"),$e.prototype),(0,l.default)($e.prototype,"getNetworkFees",[Ve],Object.getOwnPropertyDescriptor($e.prototype,"getNetworkFees"),$e.prototype),(0,l.default)($e.prototype,"getUtxos",[qe],Object.getOwnPropertyDescriptor($e.prototype,"getUtxos"),$e.prototype),Ke=$e))||Ke);var ut,st,dt,pt,lt,ft,yt,ht,vt,gt,kt,wt,bt,mt,At,Ot=r(809965),It=r(348834).Buffer;function Pt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}const Tt=(ut=(0,k.backgroundClass)(),st=(0,k.providerApiMethod)(),dt=(0,k.providerApiMethod)(),pt=(0,k.providerApiMethod)(),lt=(0,k.providerApiMethod)(),ft=(0,k.providerApiMethod)(),yt=(0,k.providerApiMethod)(),ht=(0,k.providerApiMethod)(),vt=(0,k.providerApiMethod)(),gt=(0,k.providerApiMethod)(),kt=(0,k.providerApiMethod)(),wt=(0,k.providerApiMethod)(),bt=(0,k.providerApiMethod)(),ut((At=function(e){(0,i.default)(r,e);var t=Pt(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.cardano,e}var n=r.prototype;return n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r=e.origin;return{method:"wallet_events_accountChanged",params:{accounts:yield t.getConnectedAccount({origin:r})}}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.notifyDappChainChanged=function(e){b.default.providerApi.info(e)},n.rpcCall=function(){var e=(0,p.default)((function*(e){var t=(0,O.getActiveWalletAccount)(),r=t.networkId;if(t.networkImpl===I.IMPL_ADA){b.default.providerApi.info("cardano rpcCall:",e,{networkId:r});var n=yield this.backgroundApi.engine.proxyJsonRPCCall(r,e);return b.default.providerApi.info("cardano rpcCall RESULT:",e,{networkId:r,result:n}),n}}));return function(t){return e.apply(this,arguments)}}(),n.getAdaVault=function(){var e=(0,p.default)((function*(){var e=(0,O.getActiveWalletAccount)(),t=e.accountId,r=e.networkId;return yield this.backgroundApi.engine.getVault({networkId:r,accountId:t})}));return function(){return e.apply(this,arguments)}}(),n.getConnectedAccount=function(e){var t,r=this.backgroundApi.serviceDapp.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_ADA}),n=(0,Ge.default)(r,1)[0];return Promise.resolve({address:null!=(t=null==n?void 0:n.address)?t:null})},n.connect=function(){var e=(0,p.default)((function*(e){return yield this.backgroundApi.serviceDapp.openConnectionModal(e),{account:(yield this.getConnectedAccount(e)).address}}));return function(t){return e.apply(this,arguments)}}(),n.disconnect=function(e){var t=e.origin;t&&(this.backgroundApi.serviceDapp.removeConnectedAccounts({origin:t,networkImpl:I.IMPL_ADA,addresses:this.backgroundApi.serviceDapp.getActiveConnectedAccounts({origin:t,impl:I.IMPL_ADA}).map((function(e){return e.address}))}),b.default.providerApi.info("cardano disconnect",t))},n.getNetworkId=function(){var e=(0,p.default)((function*(){return Promise.resolve(Ot.NetworkId.MAINNET)}));return function(){return e.apply(this,arguments)}}(),n.getUtxos=function(){var e=(0,p.default)((function*(e,t){return(yield this.getAdaVault()).getUtxosForDapp(t.amount)}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalance=function(){var e=(0,p.default)((function*(e){var t=(yield this.getConnectedAccount(e)).address;return(yield this.getAdaVault()).getBalanceForDapp(t)}));return function(t){return e.apply(this,arguments)}}(),n.getUsedAddresses=function(){var e=(0,p.default)((function*(){return(yield this.getAdaVault()).getAccountAddressForDapp()}));return function(){return e.apply(this,arguments)}}(),n.getUnusedAddresses=function(){var e=(0,p.default)((function*(){return(yield this.getAdaVault()).getAccountAddressForDapp()}));return function(){return e.apply(this,arguments)}}(),n.getChangeAddress=function(){var e=(0,p.default)((function*(){var e=yield this.getAdaVault(),t=yield e.getAccountAddressForDapp();return(0,Ge.default)(t,1)[0]}));return function(){return e.apply(this,arguments)}}(),n.getRewardAddresses=function(){var e=(0,p.default)((function*(){return(yield this.getAdaVault()).getStakeAddressForDapp()}));return function(){return e.apply(this,arguments)}}(),n.signTx=function(){var e=(0,p.default)((function*(e,t){var r,n=yield this.getAdaVault(),o=yield n.buildTxCborToEncodeTx(t.tx),i=yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSignAndSendModal(e,{encodedTx:o,signOnly:!0});return b.default.providerApi.debug("cardano signTx witness: ",i),i}));return function(t,r){return e.apply(this,arguments)}}(),n.signData=function(){var e=(0,p.default)((function*(e,t){var r;if("string"!==typeof t.payload)throw A.web3Errors.rpc.invalidInput();var n=yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSignAndSendModal(e,{unsignedMessage:{type:ke.ETHMessageTypes.ETH_SIGN,message:It.from(t.payload,"hex").toString("utf8"),payload:t}});return JSON.parse(n)}));return function(t,r){return e.apply(this,arguments)}}(),n.submitTx=function(){var e=(0,p.default)((function*(e,t){var r=yield this.getAdaVault(),n=yield r.getClient();return yield n.submitTx(t)}));return function(t,r){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)(At.prototype,"connect",[st],Object.getOwnPropertyDescriptor(At.prototype,"connect"),At.prototype),(0,l.default)(At.prototype,"disconnect",[dt],Object.getOwnPropertyDescriptor(At.prototype,"disconnect"),At.prototype),(0,l.default)(At.prototype,"getNetworkId",[pt],Object.getOwnPropertyDescriptor(At.prototype,"getNetworkId"),At.prototype),(0,l.default)(At.prototype,"getUtxos",[lt],Object.getOwnPropertyDescriptor(At.prototype,"getUtxos"),At.prototype),(0,l.default)(At.prototype,"getBalance",[ft],Object.getOwnPropertyDescriptor(At.prototype,"getBalance"),At.prototype),(0,l.default)(At.prototype,"getUsedAddresses",[yt],Object.getOwnPropertyDescriptor(At.prototype,"getUsedAddresses"),At.prototype),(0,l.default)(At.prototype,"getUnusedAddresses",[ht],Object.getOwnPropertyDescriptor(At.prototype,"getUnusedAddresses"),At.prototype),(0,l.default)(At.prototype,"getChangeAddress",[vt],Object.getOwnPropertyDescriptor(At.prototype,"getChangeAddress"),At.prototype),(0,l.default)(At.prototype,"getRewardAddresses",[gt],Object.getOwnPropertyDescriptor(At.prototype,"getRewardAddresses"),At.prototype),(0,l.default)(At.prototype,"signTx",[kt],Object.getOwnPropertyDescriptor(At.prototype,"signTx"),At.prototype),(0,l.default)(At.prototype,"signData",[wt],Object.getOwnPropertyDescriptor(At.prototype,"signData"),At.prototype),(0,l.default)(At.prototype,"submitTx",[bt],Object.getOwnPropertyDescriptor(At.prototype,"submitTx"),At.prototype),mt=At))||mt);var St,Dt,Mt,Ct,Nt,Rt,jt,Et,xt,_t,Bt,Ft,Wt,Lt,Ut,Ht,Vt,qt,Kt,$t,Gt,zt,Jt,Qt,Xt,Yt,Zt,er,tr=r(396564),rr=r(665417);function nr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}const or=(St=(0,k.backgroundClass)(),Dt=(0,k.providerApiMethod)(),Mt=(0,k.providerApiMethod)(),Ct=(0,k.providerApiMethod)(),Nt=(0,k.providerApiMethod)(),Rt=(0,k.providerApiMethod)(),jt=(0,k.providerApiMethod)(),Et=(0,k.providerApiMethod)(),xt=(0,k.permissionRequired)(),_t=(0,k.providerApiMethod)(),Bt=(0,k.providerApiMethod)(),Ft=(0,k.providerApiMethod)(),Wt=(0,k.providerApiMethod)(),Lt=(0,k.providerApiMethod)(),Ut=(0,k.providerApiMethod)(),Ht=(0,k.providerApiMethod)(),Vt=(0,k.providerApiMethod)(),qt=(0,k.providerApiMethod)(),Kt=(0,k.providerApiMethod)(),$t=(0,k.providerApiMethod)(),Gt=(0,k.providerApiMethod)(),zt=(0,k.providerApiMethod)(),Jt=(0,k.providerApiMethod)(),Qt=(0,k.providerApiMethod)(),Xt=(0,k.permissionRequired)(),Yt=(0,k.providerApiMethod)(),St((er=function(e){(0,i.default)(r,e);var t=nr(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.conflux,e._getCurrentNetworkExtraInfoCache=(0,tr.memoizee)(function(){var t=(0,p.default)((function*(t,r,n){var o={chainId:"0x405",networkVersion:"1029"};if(n!==I.IMPL_CFX)return o;var i=yield e.backgroundApi.engine.getVault({networkId:r,accountId:t}),a=yield(yield i.getClient()).getStatus();return o={chainId:(0,rr.toBigIntHex)(new(Xe())(a.chainId)),networkVersion:new(Xe())(a.networkId).toFixed()}}));return function(e,r,n){return t.apply(this,arguments)}}(),{promise:!0,max:1}),e}var n=r.prototype;return n._getCurrentNetworkExtraInfo=function(){var e=(0,p.default)((function*(){var e=(0,O.getActiveWalletAccount)(),t=e.accountId,r=e.networkId,n=e.networkImpl;return this._getCurrentNetworkExtraInfoCache(t,r,n)}));return function(){return e.apply(this,arguments)}}(),n._showSignMessageModal=function(){var e=(0,p.default)((function*(e,t){var r;return yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSignAndSendModal(e,{unsignedMessage:t})}));return function(t,r){return e.apply(this,arguments)}}(),n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r=e.origin;return{method:"wallet_events_accountsChanged",params:yield t.cfx_accounts({origin:r})}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.notifyDappChainChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(){return{method:"wallet_events_chainChanged",params:{chainId:yield t.cfx_chainId(),networkId:yield t.cfx_netVersion()}}}));return function(){return e.apply(this,arguments)}}();e.send(r)},n.rpcCall=function(){var e=(0,p.default)((function*(e){var t=(0,O.getActiveWalletAccount)(),r=t.networkId;if(t.networkImpl===I.IMPL_CFX){b.default.providerApi.info("conflux rpcCall:",e,{networkId:r});var n=yield this.backgroundApi.engine.proxyJsonRPCCall(r,e);return b.default.providerApi.info("conflux rpcCall RESULT:",e,{networkId:r,result:n}),n}}));return function(t){return e.apply(this,arguments)}}(),n.cfx_getProviderState=function(){var e=(0,p.default)((function*(){var e=yield Promise.all([this.cfx_chainId(),this.cfx_netVersion()]),t=(0,Ge.default)(e,2);return{chainId:t[0],networkId:t[1]}}));return function(){return e.apply(this,arguments)}}(),n.cfx_accounts=function(){var e=(0,p.default)((function*(e){var t,r=null==(t=this.backgroundApi.serviceDapp)?void 0:t.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_CFX});if(!r)return Promise.resolve([]);var n=r.map((function(e){return e.address}));return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),n.cfx_chainId=function(){var e=(0,p.default)((function*(){return(yield this._getCurrentNetworkExtraInfo()).chainId}));return function(){return e.apply(this,arguments)}}(),n.cfx_getMaxGasLimit=function(){throw A.web3Errors.provider.unsupportedMethod()},n.cfx_getNextUsableNonce=function(){var e=(0,p.default)((function*(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this.rpcCall({method:"cfx_getNextNonce",params:r})}));return function(t){return e.apply(this,arguments)}}(),n.cfx_netVersion=function(){var e=(0,p.default)((function*(){return(yield this._getCurrentNetworkExtraInfo()).networkVersion}));return function(){return e.apply(this,arguments)}}(),n.cfx_requestAccounts=function(){var e=(0,p.default)((function*(e){b.default.providerApi.info("ProviderApiConflux.cfx_requestAccounts",e);var t=yield this.cfx_accounts(e);return t&&t.length?t:(yield this.backgroundApi.serviceDapp.openConnectionModal(e),this.cfx_accounts(e))}));return function(t){return e.apply(this,arguments)}}(),n.cfx_sendTransaction=function(){var e=(0,p.default)((function*(e,t){var r;b.default.providerApi.info("cfx_sendTransaction",e,t);var n=yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSignAndSendModal(e,{encodedTx:t});return b.default.providerApi.info("cfx_sendTransaction DONE",n,e,t),n}));return function(t,r){return e.apply(this,arguments)}}(),n.cfx_signTypedData_v4=function(){throw A.web3Errors.provider.unsupportedMethod()},n.net_version=function(){var e=(0,p.default)((function*(){return this.cfx_netVersion()}));return function(){return e.apply(this,arguments)}}(),n.personal_sign=function(){var e=(0,p.default)((function*(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o=r[0];return this._showSignMessageModal(e,{type:ke.ETHMessageTypes.PERSONAL_SIGN,message:o,payload:r})}));return function(t){return e.apply(this,arguments)}}(),n.cfx_sign=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this._showSignMessageModal(e,{type:ke.ETHMessageTypes.ETH_SIGN,message:r[1],payload:r})},n.wallet_addConfluxChain=function(){throw A.web3Errors.provider.unsupportedMethod()},n.wallet_getBalance=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this.rpcCall({method:"cfx_getBalance",params:r})},n.wallet_getBlockTime=function(){throw A.web3Errors.provider.unsupportedMethod()},n.wallet_getBlockchainExplorerUrl=function(){throw A.web3Errors.provider.unsupportedMethod()},n.wallet_requestPermissions=function(){var e=(0,p.default)((function*(e){return this.cfx_requestAccounts(e)}));return function(t){return e.apply(this,arguments)}}(),n.wallet_sendTransaction=function(){var e=(0,p.default)((function*(e,t){return this.cfx_sendTransaction(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.wallet_switchConfluxChain=function(){throw A.web3Errors.provider.unsupportedMethod()},n.wallet_switchEthereumChain=function(){throw A.web3Errors.provider.unsupportedMethod()},n.wallet_validateMnemonic=function(){throw A.web3Errors.provider.unsupportedMethod()},n.wallet_validatePrivateKey=function(){throw A.web3Errors.provider.unsupportedMethod()},n.wallet_watchAsset=function(){var e=(0,p.default)((function*(e,t){var r,n,o=null!=(r=t.type)?r:"";if("ERC20"!==o&&"CRC20"!==o)throw new Error(`Asset of type '${o}' not supported`);return yield null==(n=this.backgroundApi.serviceDapp)?void 0:n.openAddTokenModal(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)(er.prototype,"cfx_getProviderState",[Dt],Object.getOwnPropertyDescriptor(er.prototype,"cfx_getProviderState"),er.prototype),(0,l.default)(er.prototype,"cfx_accounts",[Mt],Object.getOwnPropertyDescriptor(er.prototype,"cfx_accounts"),er.prototype),(0,l.default)(er.prototype,"cfx_chainId",[Ct],Object.getOwnPropertyDescriptor(er.prototype,"cfx_chainId"),er.prototype),(0,l.default)(er.prototype,"cfx_getMaxGasLimit",[Nt],Object.getOwnPropertyDescriptor(er.prototype,"cfx_getMaxGasLimit"),er.prototype),(0,l.default)(er.prototype,"cfx_getNextUsableNonce",[Rt],Object.getOwnPropertyDescriptor(er.prototype,"cfx_getNextUsableNonce"),er.prototype),(0,l.default)(er.prototype,"cfx_netVersion",[jt],Object.getOwnPropertyDescriptor(er.prototype,"cfx_netVersion"),er.prototype),(0,l.default)(er.prototype,"cfx_requestAccounts",[Et],Object.getOwnPropertyDescriptor(er.prototype,"cfx_requestAccounts"),er.prototype),(0,l.default)(er.prototype,"cfx_sendTransaction",[xt,_t],Object.getOwnPropertyDescriptor(er.prototype,"cfx_sendTransaction"),er.prototype),(0,l.default)(er.prototype,"cfx_signTypedData_v4",[Bt],Object.getOwnPropertyDescriptor(er.prototype,"cfx_signTypedData_v4"),er.prototype),(0,l.default)(er.prototype,"net_version",[Ft],Object.getOwnPropertyDescriptor(er.prototype,"net_version"),er.prototype),(0,l.default)(er.prototype,"personal_sign",[Wt],Object.getOwnPropertyDescriptor(er.prototype,"personal_sign"),er.prototype),(0,l.default)(er.prototype,"cfx_sign",[Lt],Object.getOwnPropertyDescriptor(er.prototype,"cfx_sign"),er.prototype),(0,l.default)(er.prototype,"wallet_addConfluxChain",[Ut],Object.getOwnPropertyDescriptor(er.prototype,"wallet_addConfluxChain"),er.prototype),(0,l.default)(er.prototype,"wallet_getBalance",[Ht],Object.getOwnPropertyDescriptor(er.prototype,"wallet_getBalance"),er.prototype),(0,l.default)(er.prototype,"wallet_getBlockTime",[Vt],Object.getOwnPropertyDescriptor(er.prototype,"wallet_getBlockTime"),er.prototype),(0,l.default)(er.prototype,"wallet_getBlockchainExplorerUrl",[qt],Object.getOwnPropertyDescriptor(er.prototype,"wallet_getBlockchainExplorerUrl"),er.prototype),(0,l.default)(er.prototype,"wallet_requestPermissions",[Kt],Object.getOwnPropertyDescriptor(er.prototype,"wallet_requestPermissions"),er.prototype),(0,l.default)(er.prototype,"wallet_sendTransaction",[$t],Object.getOwnPropertyDescriptor(er.prototype,"wallet_sendTransaction"),er.prototype),(0,l.default)(er.prototype,"wallet_switchConfluxChain",[Gt],Object.getOwnPropertyDescriptor(er.prototype,"wallet_switchConfluxChain"),er.prototype),(0,l.default)(er.prototype,"wallet_switchEthereumChain",[zt],Object.getOwnPropertyDescriptor(er.prototype,"wallet_switchEthereumChain"),er.prototype),(0,l.default)(er.prototype,"wallet_validateMnemonic",[Jt],Object.getOwnPropertyDescriptor(er.prototype,"wallet_validateMnemonic"),er.prototype),(0,l.default)(er.prototype,"wallet_validatePrivateKey",[Qt],Object.getOwnPropertyDescriptor(er.prototype,"wallet_validatePrivateKey"),er.prototype),(0,l.default)(er.prototype,"wallet_watchAsset",[Xt,Yt],Object.getOwnPropertyDescriptor(er.prototype,"wallet_watchAsset"),er.prototype),Zt=er))||Zt);var ir,ar,cr,ur,sr,dr,pr,lr,fr,yr,hr,vr,gr,kr,wr,br,mr,Ar=r(892681),Or=r(63184),Ir=r(217428),Pr=r(522204),Tr=r(94857),Sr=new(function(){function e(){this.tasks=[]}var t=e.prototype;return t.enqueue=function(e){this.tasks.push(e),1===this.tasks.length&&this.dequeue()},t.dequeue=function(){var e=(0,p.default)((function*(){for(;this.tasks.length>0;){var e=this.tasks[0];yield e(),this.tasks.shift()}}));return function(){return e.apply(this,arguments)}}(),(0,o.default)(e)}()),Dr=r(348834).Buffer;function Mr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Cr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Mr(Object(r),!0).forEach((function(t){(0,fe.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mr(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Nr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}const Rr=(ir=(0,k.backgroundClass)(),ar=(0,k.providerApiMethod)(),cr=(0,k.providerApiMethod)(),ur=(0,k.providerApiMethod)(),sr=(0,k.providerApiMethod)(),dr=(0,k.permissionRequired)(),pr=(0,k.providerApiMethod)(),lr=(0,k.permissionRequired)(),fr=(0,k.providerApiMethod)(),yr=(0,k.permissionRequired)(),hr=(0,k.providerApiMethod)(),vr=(0,k.permissionRequired)(),gr=(0,k.providerApiMethod)(),kr=(0,k.permissionRequired)(),wr=(0,k.providerApiMethod)(),ir((mr=function(e){(0,i.default)(r,e);var t=Nr(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.cosmos,e._enable=function(){var t=(0,p.default)((function*(t,r){var n,o="string"===typeof r?r:r[0],i=e.convertCosmosChainId(o);if(!i)throw new Error("Invalid chainId");try{n=yield e.backgroundApi.engine.getNetwork(i)}catch(c){n=void 0}if(!n)return!1;var a=yield e._getKey(t,o);return!!a&&(e.hasPermissions(t,a.pubKey)||(yield e.backgroundApi.serviceDapp.openConnectionModal(t,{networkId:I.IMPL_COSMOS})),!0)}));return function(e,r){return t.apply(this,arguments)}}(),e._getKey=function(){var t=(0,p.default)((function*(t,r){var n,o=(0,O.getActiveWalletAccount)(),i=o.networkImpl,a=o.accountId,c=e.convertCosmosChainId(r);if(!c)throw new Error("Invalid chainId");if(i!==I.IMPL_COSMOS)return yield e.backgroundApi.serviceDapp.openConnectionModal(t,{networkId:I.IMPL_COSMOS}),Promise.reject(new Error("Invalid networkId"));try{n=yield e.backgroundApi.engine.getNetwork(c)}catch(d){n=void 0}if(!n)return Promise.resolve(void 0);var u=yield e.backgroundApi.engine.getVault({networkId:et.OnekeyNetwork.cosmoshub,accountId:a}),s=yield u.getKey(c,a);return Promise.resolve(s)}));return function(e,r){return t.apply(this,arguments)}}(),e}var n=r.prototype;return n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r,n=e.origin,o=(0,O.getActiveWalletAccount)().networkId;if(o){var i=o.split("--"),a=(0,Ge.default)(i,2),c=a[0],u=a[1];if(c!==I.IMPL_COSMOS)return;o=u}try{r=yield t._getKey({origin:n},o)}catch(s){}return{method:"wallet_events_accountChanged",params:r}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.notifyDappChainChanged=function(e){e.send((function(){return{method:"wallet_events_networkChange",params:(0,O.getActiveWalletAccount)().networkId}}))},n.rpcCall=function(){throw A.web3Errors.rpc.methodNotSupported()},n.enable=function(){var e=(0,p.default)((function*(e,t){var r=this;return b.default.providerApi.info("cosmos enable",e,t),new Promise((function(n,o){Sr.enqueue((0,p.default)((function*(){try{var i=yield r._enable(e,t);n(i)}catch(a){o(a)}})))}))}));return function(t,r){return e.apply(this,arguments)}}(),n.disconnect=function(e){var t=e.origin;t&&(this.backgroundApi.serviceDapp.removeConnectedAccounts({origin:t,networkImpl:I.IMPL_COSMOS,addresses:this.backgroundApi.serviceDapp.getActiveConnectedAccounts({origin:t,impl:I.IMPL_COSMOS}).map((function(e){return e.address}))}),b.default.providerApi.info("cosmos disconnect",t))},n.convertCosmosChainId=function(e){if(e)return`cosmos--${e.toLowerCase()}`},n.hasPermissions=function(e,t){var r,n=null==(r=this.backgroundApi.serviceDapp)?void 0:r.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_COSMOS});return!!n&&!!n.map((function(e){return e.address})).includes(t)},n.getKey=function(){var e=(0,p.default)((function*(e,t){var r=this;return b.default.providerApi.info("cosmos getKey account",e,t),new Promise((function(n,o){Sr.enqueue((0,p.default)((function*(){try{var i=yield r._getKey(e,t);i?(r.hasPermissions(e,i.pubKey)||(yield r.backgroundApi.serviceDapp.openConnectionModal(e,{networkId:I.IMPL_COSMOS})),n(i)):o(new Error("No account found"))}catch(a){o(a)}})))}))}));return function(t,r){return e.apply(this,arguments)}}(),n.experimentalSuggestChain=function(){var e=(0,p.default)((function*(e,t){return b.default.providerApi.info("cosmos experimentalSuggestChain",t),Promise.resolve(new Error("Not implemented"))}));return function(t,r){return e.apply(this,arguments)}}(),n.signAmino=function(){var e=(0,p.default)((function*(e,t){var r,n,o;b.default.providerApi.info("cosmos signAmino",t);var i=t.signDoc,a=this.convertCosmosChainId(i.chain_id),c=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:Pr.TransactionWrapper.fromAminoSignDoc(i,void 0),signOnly:!0,networkId:a}),u=(0,Ir.deserializeTx)((0,ve.hexToBytes)(Dr.from(c.rawTx,"base64").toString("hex"))),s=c.encodedTx,d=(0,Tr.getAminoSignDoc)(s),p=(0,Ge.default)(u.authInfo.signerInfos,1)[0],l=(0,Ge.default)(u.signatures,1)[0],f=Ar.PubKey.decode(null!=(r=null==p||null==(n=p.publicKey)?void 0:n.value)?r:new Uint8Array);return{signed:d,signature:{signature:Dr.from((0,ve.bytesToHex)(l),"hex").toString("base64"),pub_key:{type:null==p||null==(o=p.publicKey)?void 0:o.typeUrl,value:Dr.from(f.key).toString("base64")}}}}));return function(t,r){return e.apply(this,arguments)}}(),n.signDirect=function(){var e=(0,p.default)((function*(e,t){var r,n,o,i,a,c,u;b.default.providerApi.info("cosmos signDirect",t);var s=this.convertCosmosChainId(t.signDoc.chainId),d=t.signDoc,p=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:Pr.TransactionWrapper.fromDirectSignDocHex({bodyBytes:null!=(r=d.bodyBytes)?r:"",authInfoBytes:null!=(n=d.authInfoBytes)?n:"",chainId:null!=(o=d.chainId)?o:"",accountNumber:null!=(i=d.accountNumber)?i:""},void 0),signOnly:!0,networkId:s}),l=(0,Ir.deserializeTx)((0,ve.hexToBytes)(Dr.from(p.rawTx,"base64").toString("hex"))),f=(0,Ge.default)(l.authInfo.signerInfos,1)[0],y=(0,Ge.default)(l.signatures,1)[0],h=Ar.PubKey.decode(null!=(a=null==f||null==(c=f.publicKey)?void 0:c.value)?a:new Uint8Array);return{signed:{bodyBytes:(0,ve.bytesToHex)(Or.TxBody.encode(Or.TxBody.fromPartial(Cr({},l.txBody))).finish()),authInfoBytes:(0,ve.bytesToHex)(Or.AuthInfo.encode(Or.AuthInfo.fromPartial(Cr({},l.authInfo))).finish()),chainId:t.signDoc.chainId,accountNumber:t.signDoc.accountNumber},signature:{signature:Dr.from((0,ve.bytesToHex)(y),"hex").toString("base64"),pub_key:{type:null==f||null==(u=f.publicKey)?void 0:u.typeUrl,value:Dr.from(h.key).toString("base64")}}}}));return function(t,r){return e.apply(this,arguments)}}(),n.sendTx=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("cosmos sendTx",t);var r=(0,O.getActiveWalletAccount)().accountId,n=this.convertCosmosChainId(t.chainId);if(!n)throw new Error("Invalid chainId");var o=yield this.backgroundApi.engine.getVault({networkId:n,accountId:r}),i=yield o.broadcastTransaction({rawTx:Dr.from(t.tx,"hex").toString("base64"),txid:"",encodedTx:null});return Promise.resolve(i.txid)}));return function(t,r){return e.apply(this,arguments)}}(),n.signArbitraryMessage=function(){var e=(0,p.default)((function*(e,t){var r={data:t.data,signer:t.signer},n=this.convertCosmosChainId(t.chainId),o=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{unsignedMessage:{type:ke.CommonMessageTypes.SIGN_MESSAGE,message:JSON.stringify(r),secure:!0},signOnly:!0,networkId:n});return(0,Ir.deserializeTx)((0,ve.hexToBytes)(Dr.from(o,"base64").toString("hex")))}));return function(t,r){return e.apply(this,arguments)}}(),n.signArbitrary=function(){var e=(0,p.default)((function*(e,t){var r,n,o;b.default.providerApi.info("cosmos signArbitrary",t);var i=yield this.signArbitraryMessage(e,t),a=(0,Ge.default)(i.authInfo.signerInfos,1)[0],c=(0,Ge.default)(i.signatures,1)[0],u=Ar.PubKey.decode(null!=(r=null==a||null==(n=a.publicKey)?void 0:n.value)?r:new Uint8Array);return{signature:Dr.from((0,ve.bytesToHex)(c),"hex").toString("base64"),pub_key:{type:null==a||null==(o=a.publicKey)?void 0:o.typeUrl,value:Dr.from(u.key).toString("base64")}}}));return function(t,r){return e.apply(this,arguments)}}(),n.verifyArbitrary=function(){var e=(0,p.default)((function*(e,t){var r,n,o;b.default.providerApi.info("cosmos verifyArbitrary",t);var i=yield this.signArbitraryMessage(e,t),a=(0,Ge.default)(i.authInfo.signerInfos,1)[0],c=(0,Ge.default)(i.signatures,1)[0],u=Ar.PubKey.decode(null!=(r=null==a||null==(n=a.publicKey)?void 0:n.value)?r:new Uint8Array),s=Dr.from((0,ve.bytesToHex)(c),"hex").toString("base64"),d={type:null==a||null==(o=a.publicKey)?void 0:o.typeUrl,value:Dr.from(u.key).toString("base64")};return s===t.signature.signature&&d.value===t.signature.pub_key.value}));return function(t,r){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)(mr.prototype,"enable",[ar],Object.getOwnPropertyDescriptor(mr.prototype,"enable"),mr.prototype),(0,l.default)(mr.prototype,"disconnect",[cr],Object.getOwnPropertyDescriptor(mr.prototype,"disconnect"),mr.prototype),(0,l.default)(mr.prototype,"getKey",[ur],Object.getOwnPropertyDescriptor(mr.prototype,"getKey"),mr.prototype),(0,l.default)(mr.prototype,"experimentalSuggestChain",[sr],Object.getOwnPropertyDescriptor(mr.prototype,"experimentalSuggestChain"),mr.prototype),(0,l.default)(mr.prototype,"signAmino",[dr,pr],Object.getOwnPropertyDescriptor(mr.prototype,"signAmino"),mr.prototype),(0,l.default)(mr.prototype,"signDirect",[lr,fr],Object.getOwnPropertyDescriptor(mr.prototype,"signDirect"),mr.prototype),(0,l.default)(mr.prototype,"sendTx",[yr,hr],Object.getOwnPropertyDescriptor(mr.prototype,"sendTx"),mr.prototype),(0,l.default)(mr.prototype,"signArbitrary",[vr,gr],Object.getOwnPropertyDescriptor(mr.prototype,"signArbitrary"),mr.prototype),(0,l.default)(mr.prototype,"verifyArbitrary",[kr,wr],Object.getOwnPropertyDescriptor(mr.prototype,"verifyArbitrary"),mr.prototype),br=mr))||br);var jr,Er,xr,_r,Br,Fr,Wr,Lr,Ur,Hr,Vr,qr,Kr,$r,Gr,zr,Jr,Qr,Xr,Yr,Zr,en,tn,rn,nn,on,an,cn,un,sn,dn,pn=r(746840),ln=r(72579),fn=r.n(ln),yn=r(580753),hn=r(147144),vn=r(785695),gn=r.n(vn),kn=r(636393),wn=r(814817);function bn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function mn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?bn(Object(r),!0).forEach((function(t){(0,fe.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function An(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}function On(e){var t,r;return{id:null==e?void 0:e.id,impl:null==e?void 0:e.impl,symbol:null==e?void 0:e.symbol,decimals:null==e?void 0:e.decimals,logoURI:null==e?void 0:e.logoURI,shortName:null==e?void 0:e.shortName,shortCode:null==e?void 0:e.shortCode,chainId:null==e||null==(t=e.extraInfo)?void 0:t.chainId,networkVersion:null==e||null==(r=e.extraInfo)?void 0:r.networkVersion}}var In=(jr=(0,k.backgroundClass)(),Er=(0,k.permissionRequired)(),xr=(0,k.providerApiMethod)(),_r=(0,k.permissionRequired)(),Br=(0,k.providerApiMethod)(),Fr=(0,k.providerApiMethod)(),Wr=(0,k.providerApiMethod)(),Lr=(0,k.providerApiMethod)(),Ur=(0,k.providerApiMethod)(),Hr=(0,k.providerApiMethod)(),Vr=(0,k.providerApiMethod)(),qr=(0,k.providerApiMethod)(),Kr=(0,k.providerApiMethod)(),$r=(0,k.providerApiMethod)(),Gr=(0,k.providerApiMethod)(),zr=(0,k.providerApiMethod)(),Jr=(0,k.providerApiMethod)(),Qr=(0,k.providerApiMethod)(),Xr=(0,k.providerApiMethod)(),Yr=(0,k.providerApiMethod)(),Zr=(0,k.providerApiMethod)(),en=(0,k.providerApiMethod)(),tn=(0,k.providerApiMethod)(),rn=(0,k.providerApiMethod)(),nn=(0,k.providerApiMethod)(),on=(0,k.providerApiMethod)(),an=(0,k.providerApiMethod)(),cn=(0,k.providerApiMethod)(),un=(0,k.providerApiMethod)(),jr((dn=function(e){(0,i.default)(r,e);var t=An(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.ethereum,e.addEthereumChain=function(){var t=(0,p.default)((function*(t,r,n){var o,i=yield e.backgroundApi.serviceNetwork.fetchNetworks(),a=`evm--${parseInt(r.chainId)}`,c=i.find((function(e){return e.id===a}));if(c){var u,s,d=yield e.backgroundApi.getState();return fn()(d,"state.general.activeNetworkId",null)!==a?e.switchEthereumChain(t,{chainId:r.chainId}):e.switchRpc(t,{name:c.name,networkId:c.id,rpcURL:null!=(u=null==(s=r.rpcUrls)?void 0:s[0])?u:"",logoURI:c.logoURI})}return On(yield null==(o=e.backgroundApi.serviceDapp)?void 0:o.openAddNetworkModal(t,r))}));return function(e,r,n){return t.apply(this,arguments)}}(),e.addEthereumChainMemo=(0,tr.memoizee)(e.addEthereumChain.bind((0,yn.default)(e)),{max:1,maxAge:800,normalizer:function(e){var t,r=(0,pn.default)(e),n=r[0],o=r[1],i=r[2],a=r.slice(3),c=null!=(t=null==n?void 0:n.data)?t:[o,i].concat((0,f.default)(a));return gn()(c)}}),e.switchRpc=function(){var t=(0,p.default)((function*(t,r){var n;return On(yield null==(n=e.backgroundApi.serviceDapp)?void 0:n.openSwitchRpcModal(t,r))}));return function(e,r){return t.apply(this,arguments)}}(),e.switchEthereumChain=function(){var t=(0,p.default)((function*(t,r){var n,o,i=yield e.backgroundApi.serviceNetwork.fetchNetworks(),a=`evm--${parseInt(r.chainId)}`,c=i.some((function(e){return e.id===a}));if(!c)throw A.web3Errors.provider.custom({code:4902,message:`Unrecognized chain ID ${r.chainId}. Try adding the chain using wallet_addEthereumChain first.`});var u=(0,O.getActiveWalletAccount)().network;return r.chainId===(null==u||null==(n=u.extraInfo)?void 0:n.chainId)?On(u):On(yield null==(o=e.backgroundApi.serviceDapp)?void 0:o.openSwitchNetworkModal(t,r))}));return function(e,r){return t.apply(this,arguments)}}(),e.switchEthereumChainMemo=(0,tr.memoizee)(e.switchEthereumChain.bind((0,yn.default)(e)),{max:1,maxAge:800,normalizer:function(e){var t,r=(0,Ge.default)(e,2),n=r[0],o=r[1],i=null!=(t=null==n?void 0:n.data)?t:[o];return gn()(i)}}),e}var n=r.prototype;return n._getCurrentUnlockState=function(){var e=(0,p.default)((function*(){return Promise.resolve(!0)}));return function(){return e.apply(this,arguments)}}(),n._getCurrentNetworkExtraInfo=function(){var e=(0,O.getActiveWalletAccount)().network,t={chainId:"0x736d17dc",networkVersion:"1936529372"};return e&&e.impl===I.IMPL_EVM&&(t=e.extraInfo),t},n._showSignMessageModal=function(){var e=(0,p.default)((function*(e,t){var r;return yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSignAndSendModal(e,{unsignedMessage:t})}));return function(t,r){return e.apply(this,arguments)}}(),n.rpcCall=function(){var e=(0,p.default)((function*(e){var t=(0,O.getActiveWalletAccount)(),r=t.networkId;if(t.networkImpl===I.IMPL_EVM){b.default.providerApi.info("BgApi rpcCall:",e,{networkId:r});var n=yield this.backgroundApi.engine.proxyJsonRPCCall(r,e);return b.default.providerApi.info("BgApi rpcCall RESULT:",e,{networkId:r,result:n}),n}}));return function(t){return e.apply(this,arguments)}}(),n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r=e.origin;return{method:"metamask_accountsChanged",params:yield t.eth_accounts({origin:r})}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.notifyDappChainChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(){return{method:"metamask_chainChanged",params:{chainId:yield t.eth_chainId(),networkVersion:yield t.net_version()}}}));return function(){return e.apply(this,arguments)}}();e.send(r)},n.eth_sendTransaction=function(){var e=(0,p.default)((function*(e,t){var r,n;b.default.providerApi.info("eth_sendTransaction",e,t),Je()(t.value)||(t.value=function(e){var t,r;return null!=(t=e)&&null!=t.startsWith&&t.startsWith("0X")&&null!=(r=e)&&r.slice&&(e=e.slice(2)),e&&e.startsWith&&!e.startsWith("0x")&&!e.startsWith("0X")?`0x${e}`:e}(t.value));var o=new(Xe())(null!=(r=t.nonce)?r:0);(o.isNaN()||o.isLessThanOrEqualTo(0))&&delete t.nonce;var i=yield null==(n=this.backgroundApi.serviceDapp)?void 0:n.openSignAndSendModal(e,{encodedTx:t});return b.default.providerApi.info("eth_sendTransaction DONE",i,e,t),i}));return function(t,r){return e.apply(this,arguments)}}(),n.wallet_watchAsset=function(){var e=(0,p.default)((function*(e,t){var r,n,o=null!=(r=t.type)?r:"";if("ERC20"!==o)throw new Error(`Asset of type '${o}' not supported`);return yield null==(n=this.backgroundApi.serviceDapp)?void 0:n.openAddTokenModal(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.wallet_requestPermissions=function(){var e=(0,p.default)((function*(e,t){var r,n=yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openConnectionModal(e);return Object.keys(t).map((function(t){var r,o,i,a;return"eth_accounts"===t?{caveats:[{type:"restrictReturnedAccounts",value:n}],date:Date.now(),id:null!=(i=null==(a=e.id)?void 0:a.toString())?i:kn.default.v4(),invoker:e.origin,parentCapability:t}:{caveats:[],date:Date.now(),id:null!=(r=null==(o=e.id)?void 0:o.toString())?r:kn.default.v4(),invoker:e.origin,parentCapability:t}}))}));return function(t,r){return e.apply(this,arguments)}}(),n.wallet_getPermissions=function(){var e=(0,p.default)((function*(e){var t,r,n=[{caveats:[],date:Date.now(),id:null!=(t=null==(r=e.id)?void 0:r.toString())?t:kn.default.v4(),invoker:e.origin,parentCapability:"eth_accounts"}];return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),n.eth_requestAccounts=function(){var e=(0,p.default)((function*(e){b.default.providerApi.info("ProviderApiEthereum.eth_requestAccounts",e);var t=yield this.eth_accounts(e);return t&&t.length?t:(yield this.backgroundApi.serviceDapp.openConnectionModal(e),this.eth_accounts(e))}));return function(t){return e.apply(this,arguments)}}(),n.eth_coinbase=function(){var e=(0,p.default)((function*(e){var t=yield this.eth_accounts(e);return(null==t?void 0:t[0])||null}));return function(t){return e.apply(this,arguments)}}(),n.eth_accounts=function(){var e=(0,p.default)((function*(e){var t,r=null==(t=this.backgroundApi.serviceDapp)?void 0:t.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_EVM});if(!r)return Promise.resolve([]);var n=r.map((function(e){return e.address}));return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),n.eth_signTransaction=function(e){throw A.web3Errors.provider.unsupportedMethod()},n.eth_subscribe=function(){throw A.web3Errors.rpc.methodNotSupported()},n.eth_unsubscribe=function(){throw A.web3Errors.rpc.methodNotSupported()},n.eth_sign=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this._showSignMessageModal(e,{type:ke.ETHMessageTypes.ETH_SIGN,message:r[1],payload:r})},n.personal_sign=function(){var e=(0,p.default)((function*(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o=r[0],i=r[1],a=yield this.eth_accounts(e);if(a&&a.length){var c=(0,wn.fixAddressCase)({impl:I.IMPL_EVM,address:r[0]||""}),u=(0,wn.fixAddressCase)({impl:I.IMPL_EVM,address:a[0]||""});c&&c===u&&r[1]&&(o=r[1],i=r[0])}return o=this.autoFixPersonalSignMessage({message:o}),this._showSignMessageModal(e,{type:ke.ETHMessageTypes.PERSONAL_SIGN,message:o,payload:[o,i]})}));return function(t){return e.apply(this,arguments)}}(),n.autoFixPersonalSignMessage=function(e){var t=e.message,r=t;try{hn.toBuffer(t)}catch(o){var n=`0x${t}`;try{hn.toBuffer(n),r=n}catch(i){}}return r},n.personal_ecRecover=function(){var e=(0,p.default)((function*(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o=r[0],i=r[1];if("string"===typeof o&&"string"===typeof i&&132===i.length){var a=(0,O.getActiveWalletAccount)().networkId,c=yield this.backgroundApi.engine.vaultFactory.getChainOnlyVault(a);return yield c.personalECRecover(o,i)}throw A.web3Errors.rpc.invalidParams("personal_ecRecover requires a message and a 65 bytes signature.")}));return function(t){return e.apply(this,arguments)}}(),n.isEthAddress=function(){var e=(0,p.default)((function*(e){var t=yield this.backgroundApi.getState(),r=fn()(t,"state.general.activeNetworkId",null);if(!r||!e)return!1;try{return yield this.backgroundApi.validator.validateAddress(r,e),!0}catch(n){return!1}}));return function(t){return e.apply(this,arguments)}}(),n.eth_signTypedData=function(){var e=(0,p.default)((function*(e){for(var t,r,n,o,i=arguments.length,a=new Array(i>1?i-1:0),c=1;c<i;c++)a[c-1]=arguments[c];a.length&&a[0]&&(t=null!=(r=a[0])?r:null,(yield this.isEthAddress(null!=(n=a[0])?n:null))&&(t=null!=(o=a[1])?o:null));var u=t;try{u="string"===typeof t&&JSON.parse(t)}catch(h){}var s=u,d=s.types,p=s.primaryType,l=s.domain,f=ke.ETHMessageTypes.TYPED_DATA_V1;"object"===typeof u&&(d||p||l)&&(f=ke.ETHMessageTypes.TYPED_DATA_V4);var y=t;return"object"===typeof t&&(y=JSON.stringify(t)),this._showSignMessageModal(e,{type:f,message:y,payload:a})}));return function(t){return e.apply(this,arguments)}}(),n.eth_signTypedData_v1=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this.eth_signTypedData.apply(this,[e].concat(r))},n.eth_signTypedData_v3=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return console.log("eth_signTypedData_v3",r,e),this._showSignMessageModal(e,{type:ke.ETHMessageTypes.TYPED_DATA_V3,message:r[1],payload:r})},n.eth_signTypedData_v4=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return console.log("eth_signTypedData_v4",r,e),this._showSignMessageModal(e,{type:ke.ETHMessageTypes.TYPED_DATA_V4,message:r[1],payload:r})},n.eth_chainId=function(){var e=(0,p.default)((function*(){var e=this._getCurrentNetworkExtraInfo();return Promise.resolve(e.chainId)}));return function(){return e.apply(this,arguments)}}(),n.net_version=function(){var e=(0,p.default)((function*(){var e=this._getCurrentNetworkExtraInfo();return Promise.resolve(e.networkVersion)}));return function(){return e.apply(this,arguments)}}(),n.metamask_getProviderState=function(){var e=(0,p.default)((function*(e){var t=yield Promise.all([this.eth_accounts(e),this.eth_chainId(),this.net_version(),this._getCurrentUnlockState()]),r=(0,Ge.default)(t,4);return{accounts:r[0],chainId:r[1],networkVersion:r[2],isUnlocked:r[3]}}));return function(t){return e.apply(this,arguments)}}(),n.wallet_updateChain=function(){var e=(0,p.default)((function*(e,t){return b.default.walletConnect.info("wallet_updateChain by wallet-connect",e),this.wallet_addEthereumChain(e,mn(mn({},t),{},{chainId:(0,wn.toBigIntHex)(new(Xe())(t.chainId)),nativeCurrency:mn({decimals:18},t.nativeCurrency),rpcUrls:[t.rpcUrl].filter(Boolean)}))}));return function(t,r){return e.apply(this,arguments)}}(),n.metamask_sendDomainMetadata=function(){return{}},n.metamask_logWeb3ShimUsage=function(){return{}},n.eth_subscription=function(){return{}},n.wallet_addEthereumChain=function(){var e=(0,p.default)((function*(e,t,r){for(var n,o=arguments.length,i=new Array(o>3?o-3:0),a=3;a<o;a++)i[a-3]=arguments[a];if((n=this.addEthereumChainMemo)._has.apply(n,[e,t,r].concat(i)))throw A.web3Errors.rpc.resourceUnavailable({message:`Request of type 'wallet_addEthereumChain' already pending for origin ${(null==e?void 0:e.origin)||""}. Please wait.`});return yield this.addEthereumChainMemo.apply(this,[e,t,r].concat(i)),null}));return function(t,r,n){return e.apply(this,arguments)}}(),n.wallet_switchEthereumChain=function(){var e=(0,p.default)((function*(e,t){if(this.switchEthereumChainMemo._has(e,t))throw A.web3Errors.rpc.resourceUnavailable({message:`Request of type 'wallet_switchEthereumChain' already pending for origin ${(null==e?void 0:e.origin)||""}. Please wait.`});return yield this.switchEthereumChainMemo(e,t),null}));return function(t,r){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)(dn.prototype,"eth_sendTransaction",[Er,xr],Object.getOwnPropertyDescriptor(dn.prototype,"eth_sendTransaction"),dn.prototype),(0,l.default)(dn.prototype,"wallet_watchAsset",[_r,Br],Object.getOwnPropertyDescriptor(dn.prototype,"wallet_watchAsset"),dn.prototype),(0,l.default)(dn.prototype,"wallet_requestPermissions",[Fr],Object.getOwnPropertyDescriptor(dn.prototype,"wallet_requestPermissions"),dn.prototype),(0,l.default)(dn.prototype,"wallet_getPermissions",[Wr],Object.getOwnPropertyDescriptor(dn.prototype,"wallet_getPermissions"),dn.prototype),(0,l.default)(dn.prototype,"eth_requestAccounts",[Lr],Object.getOwnPropertyDescriptor(dn.prototype,"eth_requestAccounts"),dn.prototype),(0,l.default)(dn.prototype,"eth_coinbase",[Ur],Object.getOwnPropertyDescriptor(dn.prototype,"eth_coinbase"),dn.prototype),(0,l.default)(dn.prototype,"eth_accounts",[Hr],Object.getOwnPropertyDescriptor(dn.prototype,"eth_accounts"),dn.prototype),(0,l.default)(dn.prototype,"eth_signTransaction",[Vr],Object.getOwnPropertyDescriptor(dn.prototype,"eth_signTransaction"),dn.prototype),(0,l.default)(dn.prototype,"eth_subscribe",[qr],Object.getOwnPropertyDescriptor(dn.prototype,"eth_subscribe"),dn.prototype),(0,l.default)(dn.prototype,"eth_unsubscribe",[Kr],Object.getOwnPropertyDescriptor(dn.prototype,"eth_unsubscribe"),dn.prototype),(0,l.default)(dn.prototype,"eth_sign",[$r],Object.getOwnPropertyDescriptor(dn.prototype,"eth_sign"),dn.prototype),(0,l.default)(dn.prototype,"personal_sign",[Gr],Object.getOwnPropertyDescriptor(dn.prototype,"personal_sign"),dn.prototype),(0,l.default)(dn.prototype,"personal_ecRecover",[zr],Object.getOwnPropertyDescriptor(dn.prototype,"personal_ecRecover"),dn.prototype),(0,l.default)(dn.prototype,"eth_signTypedData",[Jr],Object.getOwnPropertyDescriptor(dn.prototype,"eth_signTypedData"),dn.prototype),(0,l.default)(dn.prototype,"eth_signTypedData_v1",[Qr],Object.getOwnPropertyDescriptor(dn.prototype,"eth_signTypedData_v1"),dn.prototype),(0,l.default)(dn.prototype,"eth_signTypedData_v3",[Xr],Object.getOwnPropertyDescriptor(dn.prototype,"eth_signTypedData_v3"),dn.prototype),(0,l.default)(dn.prototype,"eth_signTypedData_v4",[Yr],Object.getOwnPropertyDescriptor(dn.prototype,"eth_signTypedData_v4"),dn.prototype),(0,l.default)(dn.prototype,"eth_chainId",[Zr],Object.getOwnPropertyDescriptor(dn.prototype,"eth_chainId"),dn.prototype),(0,l.default)(dn.prototype,"net_version",[en],Object.getOwnPropertyDescriptor(dn.prototype,"net_version"),dn.prototype),(0,l.default)(dn.prototype,"metamask_getProviderState",[tn],Object.getOwnPropertyDescriptor(dn.prototype,"metamask_getProviderState"),dn.prototype),(0,l.default)(dn.prototype,"wallet_updateChain",[rn],Object.getOwnPropertyDescriptor(dn.prototype,"wallet_updateChain"),dn.prototype),(0,l.default)(dn.prototype,"metamask_sendDomainMetadata",[nn],Object.getOwnPropertyDescriptor(dn.prototype,"metamask_sendDomainMetadata"),dn.prototype),(0,l.default)(dn.prototype,"metamask_logWeb3ShimUsage",[on],Object.getOwnPropertyDescriptor(dn.prototype,"metamask_logWeb3ShimUsage"),dn.prototype),(0,l.default)(dn.prototype,"eth_subscription",[an],Object.getOwnPropertyDescriptor(dn.prototype,"eth_subscription"),dn.prototype),(0,l.default)(dn.prototype,"wallet_addEthereumChain",[cn],Object.getOwnPropertyDescriptor(dn.prototype,"wallet_addEthereumChain"),dn.prototype),(0,l.default)(dn.prototype,"wallet_switchEthereumChain",[un],Object.getOwnPropertyDescriptor(dn.prototype,"wallet_switchEthereumChain"),dn.prototype),sn=dn))||sn);const Pn=In;var Tn,Sn,Dn,Mn,Cn,Nn,Rn,jn,En,xn,_n,Bn,Fn,Wn,Ln,Un,Hn,Vn,qn,Kn,$n;function Gn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var zn=(Tn=(0,k.backgroundClass)(),Sn=(0,k.providerApiMethod)(),Dn=(0,k.providerApiMethod)(),Mn=(0,k.providerApiMethod)(),Cn=(0,k.providerApiMethod)(),Nn=(0,k.providerApiMethod)(),Rn=(0,k.providerApiMethod)(),jn=(0,k.permissionRequired)(),En=(0,k.providerApiMethod)(),xn=(0,k.permissionRequired)(),_n=(0,k.providerApiMethod)(),Bn=(0,k.permissionRequired)(),Fn=(0,k.providerApiMethod)(),Wn=(0,k.permissionRequired)(),Ln=(0,k.providerApiMethod)(),Un=(0,k.permissionRequired)(),Hn=(0,k.providerApiMethod)(),Vn=(0,k.providerApiMethod)(),qn=(0,k.providerApiMethod)(),Tn(($n=function(e){(0,i.default)(r,e);var t=Gn(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.near,e}var n=r.prototype;return n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r=e.origin;return{method:"wallet_events_accountsChanged",params:yield t.near_accounts({origin:r})}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.notifyDappChainChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(){return{method:"wallet_events_chainChanged",params:yield t.near_network()}}));return function(){return e.apply(this,arguments)}}();e.send(r)},n.rpcCall=function(){var e=(0,p.default)((function*(e){var t=(0,O.getActiveWalletAccount)(),r=t.networkId;if(t.networkImpl===I.IMPL_NEAR)return yield this.backgroundApi.engine.proxyJsonRPCCall(r,e)}));return function(t){return e.apply(this,arguments)}}(),n.near_accounts=function(){var e=(0,p.default)((function*(e){var t,r=(0,O.getActiveWalletAccount)(),n=r.networkId,o=r.networkImpl,i=r.accountId,a=null==(t=this.backgroundApi.serviceDapp)?void 0:t.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_NEAR});if(!a)return{accounts:[]};if(o!==I.IMPL_NEAR)return{accounts:[]};var c=yield this.backgroundApi.engine.getVault({networkId:n,accountId:i}),u=yield c.getAccountAddress();return a.map((function(e){return e.address})).includes(u)?{accounts:[{accountId:u,publicKey:yield c._getPublicKey(),allKeys:[]}]}:{accounts:[]}}));return function(t){return e.apply(this,arguments)}}(),n.near_network=function(){var e=(0,p.default)((function*(){var e=(0,O.getActiveWalletAccount)().networkId,t=yield this.backgroundApi.engine.getNetwork(e);return{networkId:t.isTestnet?"testnet":"mainnet",nodeUrls:[t.rpcURL]}}));return function(){return e.apply(this,arguments)}}(),n.near_networkInfo=function(){return this.near_network()},n.near_requestAccounts=function(){var e=(0,p.default)((function*(e){b.default.providerApi.info("ProviderApiNear.near_requestAccounts",e);var t=yield this.near_accounts(e);return t.accounts&&t.accounts.length?t:(yield this.backgroundApi.serviceDapp.openConnectionModal(e),this.near_accounts(e))}));return function(t){return e.apply(this,arguments)}}(),n.near_requestSignIn=function(e){return this.near_requestAccounts(e)},n.near_signOut=function(e,t){var r=e.origin;return!(!r||!t.accountId)&&(this.backgroundApi.serviceDapp.removeConnectedAccounts({origin:r,networkImpl:I.IMPL_NEAR,addresses:[t.accountId]}),!0)},n.near_requestSignTransactions=function(){var e=(0,p.default)((function*(e,t){for(var r=this,n=t.transactions,o=[],i=function*(t){yield r.backgroundApi.serviceDapp.processBatchTransactionOneByOne({run:function(){var i=(0,p.default)((function*(){var i=n[t],a=yield r.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:i});o.push(a)}));return function(){return i.apply(this,arguments)}}()})},a=0;a<n.length;a+=1)yield*i(a);return{transactionHashes:o}}));return function(t,r){return e.apply(this,arguments)}}(),n.near_signTransactions=function(){throw A.web3Errors.rpc.methodNotFound()},n.near_sendTransactions=function(){var e=(0,p.default)((function*(e,t){return this.near_requestSignTransactions(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.near_requestSignMessages=function(){throw A.web3Errors.rpc.methodNotFound()},n.near_signMessages=function(){throw A.web3Errors.rpc.methodNotFound()},n.wallet_getConnectWalletInfo=function(e){return this.backgroundApi.providers.$private.wallet_getConnectWalletInfo(e)},n.wallet_sendSiteMetadata=function(){return this.backgroundApi.providers.$private.wallet_sendSiteMetadata()},(0,o.default)(r)}(P),(0,l.default)($n.prototype,"near_accounts",[Sn],Object.getOwnPropertyDescriptor($n.prototype,"near_accounts"),$n.prototype),(0,l.default)($n.prototype,"near_network",[Dn],Object.getOwnPropertyDescriptor($n.prototype,"near_network"),$n.prototype),(0,l.default)($n.prototype,"near_networkInfo",[Mn],Object.getOwnPropertyDescriptor($n.prototype,"near_networkInfo"),$n.prototype),(0,l.default)($n.prototype,"near_requestAccounts",[Cn],Object.getOwnPropertyDescriptor($n.prototype,"near_requestAccounts"),$n.prototype),(0,l.default)($n.prototype,"near_requestSignIn",[Nn],Object.getOwnPropertyDescriptor($n.prototype,"near_requestSignIn"),$n.prototype),(0,l.default)($n.prototype,"near_signOut",[Rn],Object.getOwnPropertyDescriptor($n.prototype,"near_signOut"),$n.prototype),(0,l.default)($n.prototype,"near_requestSignTransactions",[jn,En],Object.getOwnPropertyDescriptor($n.prototype,"near_requestSignTransactions"),$n.prototype),(0,l.default)($n.prototype,"near_signTransactions",[xn,_n],Object.getOwnPropertyDescriptor($n.prototype,"near_signTransactions"),$n.prototype),(0,l.default)($n.prototype,"near_sendTransactions",[Bn,Fn],Object.getOwnPropertyDescriptor($n.prototype,"near_sendTransactions"),$n.prototype),(0,l.default)($n.prototype,"near_requestSignMessages",[Wn,Ln],Object.getOwnPropertyDescriptor($n.prototype,"near_requestSignMessages"),$n.prototype),(0,l.default)($n.prototype,"near_signMessages",[Un,Hn],Object.getOwnPropertyDescriptor($n.prototype,"near_signMessages"),$n.prototype),(0,l.default)($n.prototype,"wallet_getConnectWalletInfo",[Vn],Object.getOwnPropertyDescriptor($n.prototype,"wallet_getConnectWalletInfo"),$n.prototype),(0,l.default)($n.prototype,"wallet_sendSiteMetadata",[qn],Object.getOwnPropertyDescriptor($n.prototype,"wallet_sendSiteMetadata"),$n.prototype),Kn=$n))||Kn);const Jn=zn;var Qn,Xn,Yn,Zn,eo,to,ro,no,oo,io,ao=r(121801),co=r(481047),uo=r(776553);function so(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}const po=(Qn=(0,k.backgroundClass)(),Xn=(0,k.providerApiMethod)(),Yn=(0,k.providerApiMethod)(),Zn=(0,k.providerApiMethod)(),eo=(0,k.providerApiMethod)(),to=(0,k.providerApiMethod)(),ro=(0,k.providerApiMethod)(),no=(0,k.providerApiMethod)(),Qn((io=function(e){(0,i.default)(r,e);var t=so(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.nostr,e.hardwareDecryptionQueue=[],e.decryptionProcessing=!1,e.lastDecryptionProcessingTime=0,e.decryptionTimeout=(0,uo.getTimeDurationMs)({minute:1}),e}var n=r.prototype;return n.notifyDappAccountsChanged=function(e){e.send((function(){return{method:"wallet_events_accountChanged",params:{accounts:void 0}}}))},n.notifyDappChainChanged=function(e){b.default.providerApi.info(e)},n.rpcCall=function(){var e=(0,p.default)((function*(e){return b.default.providerApi.info("nostr rpcCall: ",e),Promise.resolve()}));return function(t){return e.apply(this,arguments)}}(),n.checkWalletSupport=function(e){if(!((0,wn.isHdWallet)({walletId:e})||(0,wn.isHardwareWallet)({walletId:e})))throw new Error("The current wallet does not support Nostr, switch to an app wallet")},n.getPublicKey=function(){var e=(0,p.default)((function*(e){var t=(0,O.getActiveWalletAccount)(),r=t.walletId,n=t.networkId,o=t.accountId;this.checkWalletSupport(r);var i=yield this.getNostrAccountPubKey(e);if(i)return i;var a=yield this.backgroundApi.serviceDapp.openModal({request:e,screens:[co.ModalRoutes.Nostr,co.NostrModalRoutes.GetPublicKey],params:{walletId:r,networkId:n,accountId:o}});return e.origin&&this.backgroundApi.serviceDapp.saveConnectedAccounts({site:{origin:e.origin},address:(0,ao.getNip19EncodedPubkey)(a),networkImpl:I.IMPL_NOSTR}),Promise.resolve(a)}));return function(t){return e.apply(this,arguments)}}(),n.getNostrAccountPubKey=function(){var e=(0,p.default)((function*(e){var t,r=(0,O.getActiveWalletAccount)(),n=r.walletId,o=r.networkId,i=r.accountId,a=null==(t=this.backgroundApi.serviceDapp)?void 0:t.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_NOSTR});if(!a)return null;var c=a.map((function(e){return e.address}));try{var u=yield this.backgroundApi.serviceNostr.getNostrAccount({walletId:n,currentNetworkId:o,currentAccountId:i});return c.includes(u.address)?u.pubKey:null}catch(s){return null}}));return function(t){return e.apply(this,arguments)}}(),n.getRelays=function(){var e=(0,p.default)((function*(){return yield this.backgroundApi.serviceNostr.getRelays()}));return function(){return e.apply(this,arguments)}}(),n.signEvent=function(){var e=(0,p.default)((function*(e){var t,r=(0,O.getActiveWalletAccount)(),n=r.walletId,o=r.networkId,i=r.accountId;this.checkWalletSupport(n);var a=null==(t=e.data)?void 0:t.params;if(!a.event)throw A.web3Errors.rpc.invalidInput();var c=yield this.getPasswordCache();if(c&&!(0,wn.isHardwareWallet)({walletId:n})&&e.origin){var u=new URL(e.origin);if(yield this.backgroundApi.serviceNostr.getAutoSignStatus(null!=i?i:"",u.hostname)){var s,d=yield this.backgroundApi.serviceNostr.signEvent({walletId:n,networkId:null!=o?o:"",accountId:null!=i?i:"",password:"string"===typeof c?c:"",event:a.event});return null!=(s=null==d?void 0:d.data)?s:{}}}try{return yield this.backgroundApi.serviceDapp.openModal({request:e,screens:[co.ModalRoutes.Nostr,co.NostrModalRoutes.SignEvent],params:{walletId:n,networkId:o,accountId:i,event:a.event}})}catch(p){throw b.default.providerApi.error("nostr.signEvent data: ",a.event),b.default.providerApi.error("nostr.signEvent error: ",p),p}}));return function(t){return e.apply(this,arguments)}}(),n.getPasswordCache=function(){var e=(0,p.default)((function*(){var e=yield this.backgroundApi.servicePassword.getPassword();return!!(e&&e.length>0)&&e}));return function(){return e.apply(this,arguments)}}(),n.encrypt=function(){var e=(0,p.default)((function*(e){var t,r=(0,O.getActiveWalletAccount)(),n=r.walletId,o=r.networkId,i=r.accountId;this.checkWalletSupport(n);var a=null==(t=e.data)?void 0:t.params;if(!a.pubkey||!a.plaintext)throw A.web3Errors.rpc.invalidInput();try{var c=yield this.getPasswordCache();if(c||(0,wn.isHardwareWallet)({walletId:n})){var u=yield this.backgroundApi.serviceNostr.encrypt({walletId:n,networkId:o,accountId:i,password:"string"===typeof c?c:"",pubkey:a.pubkey,plaintext:a.plaintext});return yield this.backgroundApi.serviceNostr.saveEncryptedData({pubkey:a.pubkey,plaintext:a.plaintext,encryptedData:u.data}),u.data}var s=yield this.backgroundApi.serviceDapp.openModal({request:e,screens:[co.ModalRoutes.Nostr,co.NostrModalRoutes.SignEvent],params:{walletId:n,networkId:o,accountId:i,pubkey:a.pubkey,plaintext:a.plaintext}});return yield this.backgroundApi.serviceNostr.saveEncryptedData({pubkey:a.pubkey,plaintext:a.plaintext,encryptedData:s}),s}catch(d){throw b.default.providerApi.error("nostr.encrypt data: ",a),b.default.providerApi.error("nostr.encrypt error: ",d),d}}));return function(t){return e.apply(this,arguments)}}(),n.decrypt=function(){var e=(0,p.default)((function*(e){var t=this,r=(0,O.getActiveWalletAccount)().walletId;return this.checkWalletSupport(r),(0,wn.isHdWallet)({walletId:r})?this.decryptRequest(e):new Promise((function(r,n){t.hardwareDecryptionQueue.push({request:e,resolve:r,reject:n}),t.processDecryptQueue()}))}));return function(t){return e.apply(this,arguments)}}(),n.processDecryptQueue=function(){var e=(0,p.default)((function*(){var e=Date.now();if(this.decryptionProcessing||0===this.hardwareDecryptionQueue.length){if(e-this.lastDecryptionProcessingTime<this.decryptionTimeout)return;b.default.providerApi.debug("Decrypt timeout, processing again")}for(this.decryptionProcessing=!0;this.hardwareDecryptionQueue.length>0;){var t,r=null!=(t=this.hardwareDecryptionQueue.shift())?t:{},n=r.request,o=r.resolve,i=r.reject;try{var a=yield this.decryptRequest(null!=n?n:{});null==o||o(a)}catch(c){null==i||i(c)}this.lastDecryptionProcessingTime=Date.now()}this.decryptionProcessing=!1}));return function(){return e.apply(this,arguments)}}(),n.decryptRequest=function(){var e=(0,p.default)((function*(e){var t,r=(0,O.getActiveWalletAccount)(),n=r.walletId,o=r.networkId,i=r.accountId,a=null==(t=e.data)?void 0:t.params;if(!a.pubkey||!a.ciphertext)throw A.web3Errors.rpc.invalidInput();try{var c=yield this.getPasswordCache();return c||(0,wn.isHardwareWallet)({walletId:n})?(yield this.backgroundApi.serviceNostr.decrypt({walletId:n,networkId:o,accountId:i,password:"string"===typeof c?c:"",pubkey:a.pubkey,ciphertext:a.ciphertext})).data:yield this.backgroundApi.serviceDapp.openModal({request:e,screens:[co.ModalRoutes.Nostr,co.NostrModalRoutes.SignEvent],params:{walletId:n,networkId:o,accountId:i,pubkey:a.pubkey,ciphertext:a.ciphertext}})}catch(u){throw b.default.providerApi.error("nostr.decrypt data: ",a),b.default.providerApi.error("nostr.decrypt error: ",u),u}}));return function(t){return e.apply(this,arguments)}}(),n.signSchnorr=function(){var e=(0,p.default)((function*(e){var t,r=(0,O.getActiveWalletAccount)(),n=r.walletId,o=r.networkId,i=r.accountId;this.checkWalletSupport(n);var a=null==(t=e.data)?void 0:t.params;try{return yield this.backgroundApi.serviceDapp.openModal({request:e,screens:[co.ModalRoutes.Nostr,co.NostrModalRoutes.SignEvent],params:{walletId:n,networkId:o,accountId:i,sigHash:a}})}catch(c){throw b.default.providerApi.error("nostr.signSchnorr data: ",a),b.default.providerApi.error("nostr.signSchnorr error: ",c),c}}));return function(t){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)(io.prototype,"getPublicKey",[Xn],Object.getOwnPropertyDescriptor(io.prototype,"getPublicKey"),io.prototype),(0,l.default)(io.prototype,"getRelays",[Yn],Object.getOwnPropertyDescriptor(io.prototype,"getRelays"),io.prototype),(0,l.default)(io.prototype,"signEvent",[Zn],Object.getOwnPropertyDescriptor(io.prototype,"signEvent"),io.prototype),(0,l.default)(io.prototype,"getPasswordCache",[eo],Object.getOwnPropertyDescriptor(io.prototype,"getPasswordCache"),io.prototype),(0,l.default)(io.prototype,"encrypt",[to],Object.getOwnPropertyDescriptor(io.prototype,"encrypt"),io.prototype),(0,l.default)(io.prototype,"decrypt",[ro],Object.getOwnPropertyDescriptor(io.prototype,"decrypt"),io.prototype),(0,l.default)(io.prototype,"signSchnorr",[no],Object.getOwnPropertyDescriptor(io.prototype,"signSchnorr"),io.prototype),oo=io))||oo);var lo,fo,yo,ho,vo,go,ko,wo,bo,mo,Ao,Oo,Io,Po,To,So,Do=r(970674);function Mo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Co(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Mo(Object(r),!0).forEach((function(t){(0,fe.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mo(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function No(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var Ro=Do.default.decodeAddress,jo=Do.default.encodeAddress;const Eo=(lo=(0,k.backgroundClass)(),fo=(0,k.providerApiMethod)(),yo=(0,k.permissionRequired)(),ho=(0,k.providerApiMethod)(),vo=(0,k.providerApiMethod)(),go=(0,k.permissionRequired)(),ko=(0,k.providerApiMethod)(),wo=(0,k.permissionRequired)(),bo=(0,k.providerApiMethod)(),mo=(0,k.providerApiMethod)(),Ao=(0,k.providerApiMethod)(),Oo=(0,k.providerApiMethod)(),Io=(0,k.providerApiMethod)(),Po=(0,k.providerApiMethod)(),lo((So=function(e){(0,i.default)(r,e);var t=No(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.polkadot,e}var n=r.prototype;return n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r=e.origin;return{method:"wallet_events_accountChanged",params:yield t.account({origin:r})}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.notifyDappChainChanged=function(e){e.send((function(){return{method:"wallet_events_networkChange",params:(0,O.getActiveWalletAccount)().networkId}}))},n.rpcCall=function(){throw A.web3Errors.rpc.methodNotSupported()},n.web3Enable=function(){var e=(0,p.default)((function*(e,t){if(b.default.providerApi.info("Polkadot web3Enable",e,t),yield this.account(e,t))return!0;var r=yield this.backgroundApi.serviceDapp.openConnectionModal(e);return!!(0,Ge.default)(r,1)[0]}));return function(t,r){return e.apply(this,arguments)}}(),n.web3Accounts=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("Polkadot getAccounts",e);var r=yield this.account(e);return r?[{address:r.address,genesisHash:null,name:r.name,type:"ed25519"}]:(r=yield this.account(e))?[r]:[]}));return function(t,r){return e.apply(this,arguments)}}(),n.disconnect=function(e){var t=e.origin;t&&(this.backgroundApi.serviceDapp.removeConnectedAccounts({origin:t,networkImpl:I.IMPL_DOT,addresses:this.backgroundApi.serviceDapp.getActiveConnectedAccounts({origin:t,impl:I.IMPL_DOT}).map((function(e){return e.address}))}),b.default.providerApi.info("Polkadot disconnect",t))},n.account=function(){var e=(0,p.default)((function*(e,t){var r,n,o;b.default.providerApi.info("Polkadot account");var i=(0,O.getActiveWalletAccount)(),a=i.networkId,c=i.networkImpl,u=i.accountId;if(c===I.IMPL_DOT){var s=null==(r=this.backgroundApi.serviceDapp)?void 0:r.getActiveConnectedAccounts({origin:null!=(n=null!=(o=e.origin)?o:t)?n:"",impl:I.IMPL_DOT});if(s&&s.length){var d=yield this.backgroundApi.engine.getVault({networkId:a,accountId:u}),p=yield d.getAccountAddress(),l=yield d.getDbAccount(),f=s.map((function(e){return e.address}));if(f.includes(p))return b.default.providerApi.info("Polkadot account:",{address:p,name:l.name}),Promise.resolve({address:p,name:l.name})}}}));return function(t,r){return e.apply(this,arguments)}}(),n.findAccount=function(){var e=(0,p.default)((function*(e,t,r){var n=yield this.backgroundApi.engine.getWalletSafe(e);if(!n)throw A.web3Errors.provider.custom({code:4001,message:"Wallet not found"});var o=(yield this.backgroundApi.engine.getAccounts(n.accounts,t)).find((function(e){return e.address===r||(42===e.address.length?e.address:jo(Ro(e.address)))===r?e:void 0}));if(!o)throw A.web3Errors.provider.custom({code:4002,message:"Account not found"});return o}));return function(t,r,n){return e.apply(this,arguments)}}(),n.web3SignPayload=function(){var e=(0,p.default)((function*(e,t){var r,n;b.default.providerApi.info("Polkadot signAndSubmitTransaction",t);var o=(0,O.getActiveWalletAccount)(),i=o.walletId,a=o.networkId,c=o.accountId;if((yield this.findAccount(i,a,t.address)).id!==c)throw A.web3Errors.provider.custom({code:4003,message:"Account not match"});var u=yield this.backgroundApi.engine.getChainOnlyVault(a),s=yield u.getMetadataRpcCache(),d=Co(Co({},t),{},{metadataRpc:s.toHex()}),p=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:d,signOnly:!0});return Promise.resolve({id:null!=(r=e.id)?r:0,signature:null!=(n=p.signature)?n:""})}));return function(t,r){return e.apply(this,arguments)}}(),n.web3SignRaw=function(){var e=(0,p.default)((function*(e,t){var r;b.default.providerApi.info("Polkadot executeMoveCall",t);var n=(0,O.getActiveWalletAccount)(),o=n.walletId,i=n.networkId,a=n.accountId;if((yield this.findAccount(o,i,t.address)).id!==a)throw A.web3Errors.provider.custom({code:4003,message:"Account not match"});var c={type:ke.CommonMessageTypes.SIGN_MESSAGE,message:t.data,secure:!0},u=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{unsignedMessage:c,signOnly:!0});return Promise.resolve({id:null!=(r=e.id)?r:0,signature:null!=u?u:""})}));return function(t,r){return e.apply(this,arguments)}}(),n.web3RpcSubscribe=function(){var e=(0,p.default)((function*(e,t){var r=this;b.default.providerApi.info("Polkadot web3RpcSubscribe",t);var n=(0,O.getActiveWalletAccount)(),o=n.networkId,i=n.accountId,a=yield this.backgroundApi.engine.getVault({networkId:o,accountId:i}),c=(yield this.backgroundApi.engine.getNetwork(o)).rpcURL;return a.getNodeProviderCache(c).subscribe(t.type,t.method,t.params,(function(e,t){var n={method:"wallet_events_accountChanged",result:JSON.stringify({error:e,result:t})};r.backgroundApi.sendForProvider(r.providerName).send(n)}))}));return function(t,r){return e.apply(this,arguments)}}(),n.web3RpcUnSubscribe=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("Polkadot web3RpcUnSubscribe",t);var r=(0,O.getActiveWalletAccount)(),n=r.networkId,o=r.accountId,i=yield this.backgroundApi.engine.getVault({networkId:n,accountId:o}),a=(yield this.backgroundApi.engine.getNetwork(n)).rpcURL;return i.getNodeProviderCache(a).unsubscribe(t.type,t.method,t.id)}));return function(t,r){return e.apply(this,arguments)}}(),n.web3RpcSend=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("Polkadot web3RpcSend",t);var r=(0,O.getActiveWalletAccount)(),n=r.networkId,o=r.accountId,i=yield this.backgroundApi.engine.getVault({networkId:n,accountId:o}),a=(yield this.backgroundApi.engine.getNetwork(n)).rpcURL;return i.getNodeProviderCache(a).send(t.method,t.params)}));return function(t,r){return e.apply(this,arguments)}}(),n.web3RpcListProviders=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("Polkadot web3RpcListProviders",t);var r=(0,O.getActiveWalletAccount)(),n=r.networkId,o=r.accountId,i=yield this.backgroundApi.engine.getVault({networkId:n,accountId:o}),a=(yield this.backgroundApi.engine.getNetwork(n)).rpcURL,c=i.getNodeProviderCache(a);return Promise.resolve({rpcURL:c.start().meta})}));return function(t,r){return e.apply(this,arguments)}}(),n.web3RpcStartProvider=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("Polkadot web3RpcStartProvider",t);var r=(0,O.getActiveWalletAccount)(),n=r.networkId,o=r.accountId,i=yield this.backgroundApi.engine.getVault({networkId:n,accountId:o}),a=(yield this.backgroundApi.engine.getNetwork(n)).rpcURL,c=i.getNodeProviderCache(a);return Promise.resolve(c.start().meta)}));return function(t,r){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)(So.prototype,"web3Enable",[fo],Object.getOwnPropertyDescriptor(So.prototype,"web3Enable"),So.prototype),(0,l.default)(So.prototype,"web3Accounts",[yo,ho],Object.getOwnPropertyDescriptor(So.prototype,"web3Accounts"),So.prototype),(0,l.default)(So.prototype,"disconnect",[vo],Object.getOwnPropertyDescriptor(So.prototype,"disconnect"),So.prototype),(0,l.default)(So.prototype,"web3SignPayload",[go,ko],Object.getOwnPropertyDescriptor(So.prototype,"web3SignPayload"),So.prototype),(0,l.default)(So.prototype,"web3SignRaw",[wo,bo],Object.getOwnPropertyDescriptor(So.prototype,"web3SignRaw"),So.prototype),(0,l.default)(So.prototype,"web3RpcSubscribe",[mo],Object.getOwnPropertyDescriptor(So.prototype,"web3RpcSubscribe"),So.prototype),(0,l.default)(So.prototype,"web3RpcUnSubscribe",[Ao],Object.getOwnPropertyDescriptor(So.prototype,"web3RpcUnSubscribe"),So.prototype),(0,l.default)(So.prototype,"web3RpcSend",[Oo],Object.getOwnPropertyDescriptor(So.prototype,"web3RpcSend"),So.prototype),(0,l.default)(So.prototype,"web3RpcListProviders",[Io],Object.getOwnPropertyDescriptor(So.prototype,"web3RpcListProviders"),So.prototype),(0,l.default)(So.prototype,"web3RpcStartProvider",[Po],Object.getOwnPropertyDescriptor(So.prototype,"web3RpcStartProvider"),So.prototype),To=So))||To);var xo,_o,Bo,Fo,Wo,Lo,Uo,Ho,Vo,qo,Ko=r(953150),$o=r(834298),Go=r(394171);function zo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Jo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?zo(Object(r),!0).forEach((function(t){(0,fe.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zo(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Qo(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}const Xo=(xo=(0,k.backgroundClass)(),_o=(0,k.providerApiMethod)(),Bo=(0,k.providerApiMethod)(),Fo=(0,k.providerApiMethod)(),Wo=(0,k.providerApiMethod)(),Lo=(0,k.providerApiMethod)(),Uo=(0,k.providerApiMethod)(),Ho=(0,k.providerApiMethod)(),xo((qo=function(e){(0,i.default)(r,e);var t=Qo(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.$private,e}var n=r.prototype;return n.notifyDappAccountsChanged=function(e){},n.notifyDappChainChanged=function(e){},n.notifyExtSwitchChanged=function(e){var t=this.getWalletInfo();e.send({method:"wallet_events_ext_switch_changed",params:t})},n.rpcCall=function(e){},n.wallet_scanQrcode=function(){var e=(0,p.default)((function*(e,t){var r=t.base64;try{return{result:(yield(0,uo.timeout)((0,Go.scanFromURLAsync)(r),3e3,"wallet_scanQrcode timeout"))||"",base64:r}}catch(n){return console.error(n),{result:"",base64:r,error:null==n?void 0:n.message}}}));return function(t,r){return e.apply(this,arguments)}}(),n.wallet_connectToWalletConnect=function(){var e=(0,p.default)((function*(e,t){var r=t.uri;return r&&Ko.default.openConnectToDappModal({uri:r}),Promise.resolve(`uri=${r}`)}));return function(t,r){return e.apply(this,arguments)}}(),n.wallet_openUrl=function(e,t){var r=t.url;console.log("wallet_openUrl",e,r),$o.default.openUrl(r)},n.wallet_sendSiteMetadata=function(){return{success:"wallet_sendSiteMetadata: save to DB"}},n.getWalletInfo=function(){var e=!!this.backgroundApi.appSelector((function(e){return e.settings.disableExt})),t=this.backgroundApi.appSelector((function(e){return e.settings.walletSwitchData})),r=this.backgroundApi.appSelector((function(e){var t,r;return null==(t=e.settings)||null==(r=t.devMode)?void 0:r.showContentScriptReloadButton})),n={enable:[],disable:[]};return t&&Object.values(t).length&&Object.values(t).forEach((function(e){e.enable?n.enable=[].concat((0,f.default)(n.enable),(0,f.default)(e.propertyKeys)):n.disable=[].concat((0,f.default)(n.disable),(0,f.default)(e.propertyKeys))})),{enableExtContentScriptReloadButton:r,platform:"web",version:"4.24.0",buildNumber:"2024051192",disableExt:e,walletSwitchConfig:n,isLegacy:!1,platformEnv:{isRuntimeBrowser:m.default.isRuntimeBrowser,isRuntimeChrome:m.default.isRuntimeChrome,isRuntimeFirefox:m.default.isRuntimeFirefox,isWeb:!0,isNative:!1,isNativeIOS:m.default.isNativeIOS,isNativeAndroid:m.default.isNativeAndroid,isExtension:!1,isExtChrome:!1,isExtFirefox:!1,isDesktop:!1,isDesktopWin:m.default.isDesktopWin,isDesktopLinux:m.default.isDesktopLinux,isDesktopMac:m.default.isDesktopMac}}},n.wallet_getConnectWalletInfo=function(){var e=(0,p.default)((function*(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).time,r=void 0===t?0:t,n=(yield(0,b.getDebugLoggerSettings)())||"",o=this.backgroundApi.providers.ethereum,i=yield o.metamask_getProviderState(e);return{pong:!0,time:Date.now(),delay:Date.now()-r,debugLoggerConfig:{config:n,enabledKeys:[]},walletInfo:this.getWalletInfo(),providerState:i}}));return function(t){return e.apply(this,arguments)}}(),n.callChainWebEmbedMethod=function(e){var t,r,n=null==(t=e.data)?void 0:t.method;b.default.providerApi.info("ProviderApiPrivate.callChainWebEmbedMethod",e);null==(r=e.data)||null==r.send||r.send((function(t){var r,o,i,a=t.origin,c={method:n,params:{event:null==(r=e.data)?void 0:r.event,promiseId:null==(o=e.data)?void 0:o.promiseId,params:Jo({},null==(i=e.data)?void 0:i.params)}};return b.default.providerApi.info("ProviderApiPrivate.callChainWebEmbedMethod",n,a,c),c}))},n.chainWebEmbedResponse=function(e){var t,r,n;b.default.providerApi.info("ProviderApiPrivate.chainWebEmbedResponse",e),this.backgroundApi.servicePromise.resolveCallback({id:null==e||null==(t=e.data)?void 0:t.promiseId,data:Jo({},null!=(r=null==e||null==(n=e.data)?void 0:n.data)?r:{})})},(0,o.default)(r)}(P),(0,l.default)(qo.prototype,"wallet_scanQrcode",[_o],Object.getOwnPropertyDescriptor(qo.prototype,"wallet_scanQrcode"),qo.prototype),(0,l.default)(qo.prototype,"wallet_connectToWalletConnect",[Bo],Object.getOwnPropertyDescriptor(qo.prototype,"wallet_connectToWalletConnect"),qo.prototype),(0,l.default)(qo.prototype,"wallet_openUrl",[Fo],Object.getOwnPropertyDescriptor(qo.prototype,"wallet_openUrl"),qo.prototype),(0,l.default)(qo.prototype,"wallet_sendSiteMetadata",[Wo],Object.getOwnPropertyDescriptor(qo.prototype,"wallet_sendSiteMetadata"),qo.prototype),(0,l.default)(qo.prototype,"wallet_getConnectWalletInfo",[Lo],Object.getOwnPropertyDescriptor(qo.prototype,"wallet_getConnectWalletInfo"),qo.prototype),(0,l.default)(qo.prototype,"callChainWebEmbedMethod",[Uo],Object.getOwnPropertyDescriptor(qo.prototype,"callChainWebEmbedMethod"),qo.prototype),(0,l.default)(qo.prototype,"chainWebEmbedResponse",[Ho],Object.getOwnPropertyDescriptor(qo.prototype,"chainWebEmbedResponse"),qo.prototype),Vo=qo))||Vo);var Yo,Zo,ei,ti,ri,ni,oi,ii,ai,ci=r(817022),ui=r.n(ci),si=r(785505),di=r.n(si),pi=r(348834).Buffer;function li(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var fi=(Yo=(0,k.backgroundClass)(),Zo=(0,k.providerApiMethod)(),ei=(0,k.providerApiMethod)(),ti=(0,k.providerApiMethod)(),ri=(0,k.providerApiMethod)(),ni=(0,k.providerApiMethod)(),oi=(0,k.providerApiMethod)(),Yo((ai=function(e){(0,i.default)(r,e);var t=li(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.solana,e}var n=r.prototype;return n.getConnectedAccountPublicKey=function(e){var t,r=this.backgroundApi.serviceDapp.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_SOL}),n=(0,Ge.default)(r,1)[0];return Promise.resolve(null!=(t=null==n?void 0:n.address)?t:"")},n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r=e.origin;return{method:"wallet_events_accountChanged",params:{accounts:[{publicKey:yield t.getConnectedAccountPublicKey({origin:r})}].filter((function(e){return!!e.publicKey}))}}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.notifyDappChainChanged=function(e){b.default.providerApi.info(e)},n.rpcCall=function(){var e=(0,p.default)((function*(e){var t=(0,O.getActiveWalletAccount)(),r=t.networkId;if(t.networkImpl===I.IMPL_SOL){b.default.providerApi.info("solana rpcCall:",e,{networkId:r});var n=yield this.backgroundApi.engine.proxyJsonRPCCall(r,e);return b.default.providerApi.info("solana rpcCall RESULT:",e,{networkId:r,result:n}),n}}));return function(t){return e.apply(this,arguments)}}(),n.disconnect=function(e){var t=e.origin;t&&(this.backgroundApi.serviceDapp.removeConnectedAccounts({origin:t,networkImpl:I.IMPL_SOL,addresses:this.backgroundApi.serviceDapp.getActiveConnectedAccounts({origin:t,impl:I.IMPL_SOL}).map((function(e){return e.address}))}),b.default.providerApi.info("solana disconnect",t))},n.signTransaction=function(){var e=(0,p.default)((function*(e,t){var r;if("string"!==typeof t.message)throw A.web3Errors.rpc.invalidInput();var n=yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSignAndSendModal(e,{encodedTx:t.message,signOnly:!0});return ui().encode(pi.from(n,"base64"))}));return function(t,r){return e.apply(this,arguments)}}(),n.signAllTransactions=function(){var e=(0,p.default)((function*(e,t){var r=this,n=t.message;if(!he()(n)||0===n.length||!n.every(di()))throw A.web3Errors.rpc.invalidInput();b.default.providerApi.info("solana signAllTransactions",e,t);var o=[],i=function*(t){yield r.backgroundApi.serviceDapp.processBatchTransactionOneByOne({run:function(){var n=(0,p.default)((function*(){o.push(yield r.signTransaction(e,{message:t}))}));return function(){return n.apply(this,arguments)}}()})};for(var a of n)yield*i(a);return o}));return function(t,r){return e.apply(this,arguments)}}(),n.signAndSendTransaction=function(){var e=(0,p.default)((function*(e,t){var r,n=t.message;if(!di()(n))throw A.web3Errors.rpc.invalidInput();var o=yield this.getConnectedAccountPublicKey(e),i=yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSignAndSendModal(e,{encodedTx:n});return b.default.providerApi.info("solana signTransaction",e,t),{signature:i,publicKey:o}}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,p.default)((function*(e,t){var r,n=t.message,o=t.display,i=void 0===o?"utf8":o;if(!di()(n)||!["utf8","hex"].includes(i))throw A.web3Errors.rpc.invalidInput();b.default.providerApi.info("solana signMessage",e,t);var a=yield this.getConnectedAccountPublicKey(e);return{signature:yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSignAndSendModal(e,{unsignedMessage:{type:ke.CommonMessageTypes.SIGN_MESSAGE,message:ui().decode(n).toString()}}),publicKey:a}}));return function(t,r){return e.apply(this,arguments)}}(),n.connect=function(){var e=(0,p.default)((function*(e,t){var r=(t||{}).onlyIfTrusted,n=void 0!==r&&r,o=yield this.getConnectedAccountPublicKey(e);if(o||n||(yield this.backgroundApi.serviceDapp.openConnectionModal(e),o=yield this.getConnectedAccountPublicKey(e)),!o)throw A.web3Errors.provider.userRejectedRequest();return{publicKey:o}}));return function(t,r){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)(ai.prototype,"disconnect",[Zo],Object.getOwnPropertyDescriptor(ai.prototype,"disconnect"),ai.prototype),(0,l.default)(ai.prototype,"signTransaction",[ei],Object.getOwnPropertyDescriptor(ai.prototype,"signTransaction"),ai.prototype),(0,l.default)(ai.prototype,"signAllTransactions",[ti],Object.getOwnPropertyDescriptor(ai.prototype,"signAllTransactions"),ai.prototype),(0,l.default)(ai.prototype,"signAndSendTransaction",[ri],Object.getOwnPropertyDescriptor(ai.prototype,"signAndSendTransaction"),ai.prototype),(0,l.default)(ai.prototype,"signMessage",[ni],Object.getOwnPropertyDescriptor(ai.prototype,"signMessage"),ai.prototype),(0,l.default)(ai.prototype,"connect",[oi],Object.getOwnPropertyDescriptor(ai.prototype,"connect"),ai.prototype),ii=ai))||ii);const yi=fi;var hi,vi,gi,ki,wi,bi,mi,Ai,Oi,Ii,Pi,Ti,Si,Di,Mi,Ci,Ni,Ri,ji,Ei,xi,_i,Bi,Fi,Wi,Li,Ui,Hi,Vi,qi;function Ki(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}function $i(e){var t,r;return{id:null==e?void 0:e.id,impl:null==e?void 0:e.impl,symbol:null==e?void 0:e.symbol,decimals:null==e?void 0:e.decimals,logoURI:null==e?void 0:e.logoURI,shortName:null==e?void 0:e.shortName,shortCode:null==e?void 0:e.shortCode,chainId:null==e||null==(t=e.extraInfo)?void 0:t.chainId,networkVersion:null==e||null==(r=e.extraInfo)?void 0:r.networkVersion}}const Gi=(hi=(0,k.backgroundClass)(),vi=(0,k.permissionRequired)(),gi=(0,k.providerApiMethod)(),ki=(0,k.permissionRequired)(),wi=(0,k.providerApiMethod)(),bi=(0,k.providerApiMethod)(),mi=(0,k.providerApiMethod)(),Ai=(0,k.providerApiMethod)(),Oi=(0,k.providerApiMethod)(),Ii=(0,k.providerApiMethod)(),Pi=(0,k.providerApiMethod)(),Ti=(0,k.providerApiMethod)(),Si=(0,k.providerApiMethod)(),Di=(0,k.providerApiMethod)(),Mi=(0,k.providerApiMethod)(),Ci=(0,k.providerApiMethod)(),Ni=(0,k.providerApiMethod)(),Ri=(0,k.providerApiMethod)(),ji=(0,k.providerApiMethod)(),Ei=(0,k.providerApiMethod)(),xi=(0,k.providerApiMethod)(),_i=(0,k.providerApiMethod)(),Bi=(0,k.providerApiMethod)(),Fi=(0,k.providerApiMethod)(),Wi=(0,k.providerApiMethod)(),Li=(0,k.providerApiMethod)(),Ui=(0,k.providerApiMethod)(),Hi=(0,k.providerApiMethod)(),hi((qi=function(e){(0,i.default)(r,e);var t=Ki(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.starcoin,e}var n=r.prototype;return n._getCurrentUnlockState=function(){var e=(0,p.default)((function*(){return Promise.resolve(!0)}));return function(){return e.apply(this,arguments)}}(),n._getCurrentNetworkExtraInfo=function(){var e=(0,p.default)((function*(){var e=(0,O.getActiveWalletAccount)().network,t={chainId:"0x1",networkVersion:"1"};if(e&&e.impl===I.IMPL_STC&&Object.keys(e.extraInfo).length)t=e.extraInfo;else{var r=yield this.rpcCall({id:1,jsonrpc:"2.0",method:"chain.id",params:[]}),n=null==r?void 0:r.id;n&&(t={chainId:`0x${n.toString(16)}`,networkVersion:n.toString()})}return Promise.resolve(t)}));return function(){return e.apply(this,arguments)}}(),n._showSignMessageModal=function(){var e=(0,p.default)((function*(e,t){var r;return yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSignAndSendModal(e,{unsignedMessage:t})}));return function(t,r){return e.apply(this,arguments)}}(),n.rpcCall=function(){var e=(0,p.default)((function*(e){var t=(0,O.getActiveWalletAccount)(),r=t.networkId;if(t.networkImpl===I.IMPL_STC){b.default.providerApi.info("BgApi rpcCall:",e,{networkId:r});var n=yield this.backgroundApi.engine.proxyJsonRPCCall(r,e);return b.default.providerApi.info("BgApi rpcCall RESULT:",e,{networkId:r,result:n}),n}}));return function(t){return e.apply(this,arguments)}}(),n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r=e.origin;return{method:"starmask_accountsChanged",params:yield t.stc_accounts({origin:r})}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.notifyDappChainChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(){return{method:"starmask_chainChanged",params:{chainId:yield t.eth_chainId(),networkVersion:yield t.net_version()}}}));return function(){return e.apply(this,arguments)}}();e.send(r)},n.stc_sendTransaction=function(){var e=(0,p.default)((function*(e,t){var r;b.default.providerApi.info("stc_sendTransaction",e,t);var n=yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSignAndSendModal(e,{encodedTx:t});return b.default.providerApi.info("stc_sendTransaction DONE",n,e,t),n}));return function(t,r){return e.apply(this,arguments)}}(),n.wallet_watchAsset=function(){var e=(0,p.default)((function*(e,t){var r,n,o=null!=(r=t.type)?r:"";if("ERC20"!==o)throw new Error(`Asset of type '${o}' not supported`);return yield null==(n=this.backgroundApi.serviceDapp)?void 0:n.openAddTokenModal(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.wallet_requestPermissions=function(){var e=(0,p.default)((function*(e,t){var r,n=yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openConnectionModal(e);return Object.keys(t).map((function(t){var r,o,i,a;return"stc_accounts"===t?{caveats:[{type:"restrictReturnedAccounts",value:n}],date:Date.now(),id:null!=(i=null==(a=e.id)?void 0:a.toString())?i:kn.default.v4(),invoker:e.origin,parentCapability:t}:{caveats:[],date:Date.now(),id:null!=(r=null==(o=e.id)?void 0:o.toString())?r:kn.default.v4(),invoker:e.origin,parentCapability:t}}))}));return function(t,r){return e.apply(this,arguments)}}(),n.wallet_getPermissions=function(){var e=(0,p.default)((function*(e){var t,r,n=[{caveats:[],date:Date.now(),id:null!=(t=null==(r=e.id)?void 0:r.toString())?t:kn.default.v4(),invoker:e.origin,parentCapability:"stc_accounts"}];return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),n.stc_requestAccounts=function(){var e=(0,p.default)((function*(e){b.default.providerApi.info("ProviderApiStarcoin.stc_requestAccounts",e);var t=yield this.stc_accounts(e);return t&&t.length?t:(yield this.backgroundApi.serviceDapp.openConnectionModal(e),this.stc_accounts(e))}));return function(t){return e.apply(this,arguments)}}(),n.stc_coinbase=function(){var e=(0,p.default)((function*(e){var t=yield this.stc_accounts(e);return(null==t?void 0:t[0])||null}));return function(t){return e.apply(this,arguments)}}(),n.stc_accounts=function(){var e=(0,p.default)((function*(e){var t,r=null==(t=this.backgroundApi.serviceDapp)?void 0:t.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_STC});if(!r)return Promise.resolve([]);var n=r.map((function(e){return e.address}));return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),n.stc_signTransaction=function(e){throw A.web3Errors.rpc.methodNotSupported()},n.stc_subscribe=function(){throw A.web3Errors.rpc.methodNotSupported()},n.stc_unsubscribe=function(){throw A.web3Errors.rpc.methodNotSupported()},n.stc_sign=function(e){throw A.web3Errors.rpc.methodNotSupported()},n.personal_sign=function(){var e=(0,p.default)((function*(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var o=r[0],i=yield this.stc_accounts(e);if(i&&i.length){var a=(0,wn.fixAddressCase)({impl:I.IMPL_STC,address:r[0]||""}),c=(0,wn.fixAddressCase)({impl:I.IMPL_STC,address:i[0]||""});a&&a===c&&r[1]&&(o=r[1])}return this._showSignMessageModal(e,{type:ke.ETHMessageTypes.PERSONAL_SIGN,message:o,payload:r})}));return function(t){return e.apply(this,arguments)}}(),n.personal_ecRecover=function(){var e=(0,p.default)((function*(e){throw A.web3Errors.rpc.methodNotSupported()}));return function(t){return e.apply(this,arguments)}}(),n.stc_signTypedData=function(e){throw A.web3Errors.rpc.methodNotSupported()},n.stc_signTypedData_v1=function(e){throw A.web3Errors.rpc.methodNotSupported()},n.stc_signTypedData_v3=function(e){throw A.web3Errors.rpc.methodNotSupported()},n.stc_signTypedData_v4=function(e){throw A.web3Errors.rpc.methodNotSupported()},n.eth_chainId=function(){var e=(0,p.default)((function*(){var e=yield this._getCurrentNetworkExtraInfo();return Promise.resolve(e.chainId)}));return function(){return e.apply(this,arguments)}}(),n.net_version=function(){var e=(0,p.default)((function*(){var e=yield this._getCurrentNetworkExtraInfo();return Promise.resolve(e.networkVersion)}));return function(){return e.apply(this,arguments)}}(),n.starmask_getProviderState=function(){var e=(0,p.default)((function*(e){var t=yield this._getCurrentNetworkExtraInfo();return{accounts:yield this.stc_accounts(e),chainId:t.chainId,networkVersion:t.networkVersion,isUnlocked:yield this._getCurrentUnlockState()}}));return function(t){return e.apply(this,arguments)}}(),n.starmask_sendDomainMetadata=function(){return{}},n.starmask_logWeb3ShimUsage=function(){return{}},n.stc_subscription=function(){return{}},n.wallet_addEthereumChain=function(){var e=(0,p.default)((function*(e,t){var r,n=yield this.backgroundApi.serviceNetwork.fetchNetworks(),o=`evm--${parseInt(t.chainId)}`;return n.some((function(e){return e.id===o}))?this.wallet_switchEthereumChain(e,{chainId:t.chainId}):$i(yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openAddNetworkModal(e,t))}));return function(t,r){return e.apply(this,arguments)}}(),n.wallet_switchEthereumChain=function(){var e=(0,p.default)((function*(e,t){var r,n=yield this.backgroundApi.serviceNetwork.fetchNetworks(),o=`evm--${parseInt(t.chainId)}`;return!!n.some((function(e){return e.id===o}))&&$i(yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSwitchNetworkModal(e,t))}));return function(t,r){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)(qi.prototype,"stc_sendTransaction",[vi,gi],Object.getOwnPropertyDescriptor(qi.prototype,"stc_sendTransaction"),qi.prototype),(0,l.default)(qi.prototype,"wallet_watchAsset",[ki,wi],Object.getOwnPropertyDescriptor(qi.prototype,"wallet_watchAsset"),qi.prototype),(0,l.default)(qi.prototype,"wallet_requestPermissions",[bi],Object.getOwnPropertyDescriptor(qi.prototype,"wallet_requestPermissions"),qi.prototype),(0,l.default)(qi.prototype,"wallet_getPermissions",[mi],Object.getOwnPropertyDescriptor(qi.prototype,"wallet_getPermissions"),qi.prototype),(0,l.default)(qi.prototype,"stc_requestAccounts",[Ai],Object.getOwnPropertyDescriptor(qi.prototype,"stc_requestAccounts"),qi.prototype),(0,l.default)(qi.prototype,"stc_coinbase",[Oi],Object.getOwnPropertyDescriptor(qi.prototype,"stc_coinbase"),qi.prototype),(0,l.default)(qi.prototype,"stc_accounts",[Ii],Object.getOwnPropertyDescriptor(qi.prototype,"stc_accounts"),qi.prototype),(0,l.default)(qi.prototype,"stc_signTransaction",[Pi],Object.getOwnPropertyDescriptor(qi.prototype,"stc_signTransaction"),qi.prototype),(0,l.default)(qi.prototype,"stc_subscribe",[Ti],Object.getOwnPropertyDescriptor(qi.prototype,"stc_subscribe"),qi.prototype),(0,l.default)(qi.prototype,"stc_unsubscribe",[Si],Object.getOwnPropertyDescriptor(qi.prototype,"stc_unsubscribe"),qi.prototype),(0,l.default)(qi.prototype,"stc_sign",[Di],Object.getOwnPropertyDescriptor(qi.prototype,"stc_sign"),qi.prototype),(0,l.default)(qi.prototype,"personal_sign",[Mi],Object.getOwnPropertyDescriptor(qi.prototype,"personal_sign"),qi.prototype),(0,l.default)(qi.prototype,"personal_ecRecover",[Ci],Object.getOwnPropertyDescriptor(qi.prototype,"personal_ecRecover"),qi.prototype),(0,l.default)(qi.prototype,"stc_signTypedData",[Ni],Object.getOwnPropertyDescriptor(qi.prototype,"stc_signTypedData"),qi.prototype),(0,l.default)(qi.prototype,"stc_signTypedData_v1",[Ri],Object.getOwnPropertyDescriptor(qi.prototype,"stc_signTypedData_v1"),qi.prototype),(0,l.default)(qi.prototype,"stc_signTypedData_v3",[ji],Object.getOwnPropertyDescriptor(qi.prototype,"stc_signTypedData_v3"),qi.prototype),(0,l.default)(qi.prototype,"stc_signTypedData_v4",[Ei],Object.getOwnPropertyDescriptor(qi.prototype,"stc_signTypedData_v4"),qi.prototype),(0,l.default)(qi.prototype,"eth_chainId",[xi],Object.getOwnPropertyDescriptor(qi.prototype,"eth_chainId"),qi.prototype),(0,l.default)(qi.prototype,"net_version",[_i],Object.getOwnPropertyDescriptor(qi.prototype,"net_version"),qi.prototype),(0,l.default)(qi.prototype,"starmask_getProviderState",[Bi],Object.getOwnPropertyDescriptor(qi.prototype,"starmask_getProviderState"),qi.prototype),(0,l.default)(qi.prototype,"starmask_sendDomainMetadata",[Fi],Object.getOwnPropertyDescriptor(qi.prototype,"starmask_sendDomainMetadata"),qi.prototype),(0,l.default)(qi.prototype,"starmask_logWeb3ShimUsage",[Wi],Object.getOwnPropertyDescriptor(qi.prototype,"starmask_logWeb3ShimUsage"),qi.prototype),(0,l.default)(qi.prototype,"stc_subscription",[Li],Object.getOwnPropertyDescriptor(qi.prototype,"stc_subscription"),qi.prototype),(0,l.default)(qi.prototype,"wallet_addEthereumChain",[Ui],Object.getOwnPropertyDescriptor(qi.prototype,"wallet_addEthereumChain"),qi.prototype),(0,l.default)(qi.prototype,"wallet_switchEthereumChain",[Hi],Object.getOwnPropertyDescriptor(qi.prototype,"wallet_switchEthereumChain"),qi.prototype),Vi=qi))||Vi);var zi,Ji,Qi,Xi,Yi,Zi,ea,ta,ra,na,oa,ia,aa,ca,ua,sa,da=r(609650),pa=r(849877);function la(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var fa=(zi=(0,k.backgroundClass)(),Ji=(0,k.providerApiMethod)(),Qi=(0,k.providerApiMethod)(),Xi=(0,k.permissionRequired)(),Yi=(0,k.providerApiMethod)(),Zi=(0,k.providerApiMethod)(),ea=(0,k.permissionRequired)(),ta=(0,k.providerApiMethod)(),ra=(0,k.permissionRequired)(),na=(0,k.providerApiMethod)(),oa=(0,k.permissionRequired)(),ia=(0,k.providerApiMethod)(),aa=(0,k.permissionRequired)(),ca=(0,k.providerApiMethod)(),zi((sa=function(e){(0,i.default)(r,e);var t=la(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.sui,e}var n=r.prototype;return n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r=e.origin;return{method:"wallet_events_accountChanged",params:yield t.account({origin:r})}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.notifyDappChainChanged=function(e){var t=this;e.send((function(){try{return{method:"wallet_events_networkChange",params:t.network()}}catch(e){return null}}))},n.rpcCall=function(){throw A.web3Errors.rpc.methodNotSupported()},n.hasPermissions=function(){var e=(0,p.default)((function*(e,t){return b.default.providerApi.info("SUI hasPermissions",e,t),!!(yield this.account(e))}));return function(t,r){return e.apply(this,arguments)}}(),n.requestPermissions=function(){var e=(0,p.default)((function*(e,t){return b.default.providerApi.info("SUI requestPermissions",e,t),!!(yield this.account(e))||(yield this.backgroundApi.serviceDapp.openConnectionModal(e),!!(yield this.account(e)))}));return function(t,r){return e.apply(this,arguments)}}(),n.getAccounts=function(){var e=(0,p.default)((function*(e){b.default.providerApi.info("SUI getAccounts",e);var t=yield this.account(e);return t?[t]:(yield this.backgroundApi.serviceDapp.openConnectionModal(e),(t=yield this.account(e))?[t]:[])}));return function(t){return e.apply(this,arguments)}}(),n.disconnect=function(e){var t=e.origin;t&&(this.backgroundApi.serviceDapp.removeConnectedAccounts({origin:t,networkImpl:I.IMPL_SUI,addresses:this.backgroundApi.serviceDapp.getActiveConnectedAccounts({origin:t,impl:I.IMPL_SUI}).map((function(e){return e.address}))}),b.default.providerApi.info("SUI disconnect",t))},n.account=function(){var e=(0,p.default)((function*(e){var t;b.default.providerApi.info("SUI account");var r=(0,O.getActiveWalletAccount)(),n=r.networkId,o=r.networkImpl,i=r.accountId;if(o===I.IMPL_SUI){var a=null==(t=this.backgroundApi.serviceDapp)?void 0:t.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_SUI});if(a){var c=yield this.backgroundApi.engine.getVault({networkId:n,accountId:i}),u=yield c.getAccountAddress(),s=yield c.getDbAccount();if(a.map((function(e){return e.address})).includes(u))return Promise.resolve({address:u,publicKey:s.pub})}}}));return function(t){return e.apply(this,arguments)}}(),n.getActiveChain=function(e){b.default.providerApi.info("SUI getActiveChain",e);try{return Promise.resolve(this.network())}catch(t){return Promise.resolve(void 0)}},n.network=function(){var e=(0,O.getActiveWalletAccount)().networkId,t=(0,pa.parseNetworkId)(e),r=t.impl,n=t.chainId;if(r!==I.IMPL_SUI)throw A.web3Errors.rpc.invalidRequest();if("mainnet"===n)return"sui:mainnet";if("8888883"===n)return"sui:testnet";if("8888884"===n)return"sui:devnet";throw A.web3Errors.rpc.invalidRequest()},n.signAndExecuteTransactionBlock=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("SUI signAndExecuteTransactionBlock",t);var r=(0,O.getActiveWalletAccount)(),n=r.networkId,o=r.accountId,i=r.accountAddress,a=fn()(JSON.parse(t.walletSerialize),"address");if(a&&a!==i)throw A.web3Errors.provider.unauthorized();var c=yield this.backgroundApi.engine.getVault({networkId:n,accountId:o}),u={rawTx:da.TransactionBlock.from(t.blockSerialize).serialize()},s=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:u}),d=yield c.waitPendingTransaction(s,t.options);if(!d)throw new Error("Transaction not found");return Promise.resolve(d)}));return function(t,r){return e.apply(this,arguments)}}(),n.signTransactionBlock=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("SUI signTransactionBlock",t);var r=(0,O.getActiveWalletAccount)().accountAddress,n=fn()(JSON.parse(t.walletSerialize),"address");if(n&&n!==r)throw A.web3Errors.provider.unauthorized();var o={rawTx:da.TransactionBlock.from(t.blockSerialize).serialize()},i=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{encodedTx:o,signOnly:!0});if(!i.signature)throw A.web3Errors.provider.unauthorized();return Promise.resolve({transactionBlockBytes:i.rawTx,signature:i.signature})}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,p.default)((function*(e,t){b.default.providerApi.info("SUI signMessage",t);var r=(0,O.getActiveWalletAccount)().accountAddress,n=fn()(JSON.parse(t.walletSerialize),"address");if(n&&n!==r)throw A.web3Errors.provider.unauthorized();var o=yield this.backgroundApi.serviceDapp.openSignAndSendModal(e,{unsignedMessage:{type:ke.CommonMessageTypes.SIGN_MESSAGE,message:t.messageSerialize,secure:!1}});return{messageBytes:t.messageSerialize,signature:o}}));return function(t,r){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)(sa.prototype,"hasPermissions",[Ji],Object.getOwnPropertyDescriptor(sa.prototype,"hasPermissions"),sa.prototype),(0,l.default)(sa.prototype,"requestPermissions",[Qi],Object.getOwnPropertyDescriptor(sa.prototype,"requestPermissions"),sa.prototype),(0,l.default)(sa.prototype,"getAccounts",[Xi,Yi],Object.getOwnPropertyDescriptor(sa.prototype,"getAccounts"),sa.prototype),(0,l.default)(sa.prototype,"disconnect",[Zi],Object.getOwnPropertyDescriptor(sa.prototype,"disconnect"),sa.prototype),(0,l.default)(sa.prototype,"getActiveChain",[ea,ta],Object.getOwnPropertyDescriptor(sa.prototype,"getActiveChain"),sa.prototype),(0,l.default)(sa.prototype,"signAndExecuteTransactionBlock",[ra,na],Object.getOwnPropertyDescriptor(sa.prototype,"signAndExecuteTransactionBlock"),sa.prototype),(0,l.default)(sa.prototype,"signTransactionBlock",[oa,ia],Object.getOwnPropertyDescriptor(sa.prototype,"signTransactionBlock"),sa.prototype),(0,l.default)(sa.prototype,"signMessage",[aa,ca],Object.getOwnPropertyDescriptor(sa.prototype,"signMessage"),sa.prototype),ua=sa))||ua);const ya=fa;var ha,va,ga,ka,wa,ba,ma,Aa,Oa,Ia,Pa,Ta;function Sa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var Da="https://api.trongrid.io",Ma="https://api.shasta.trongrid.io",Ca=["tronscan.org","tronscan.io","shasta.tronscan.org"];const Na=(ha=(0,k.backgroundClass)(),va=(0,k.providerApiMethod)(),ga=(0,k.providerApiMethod)(),ka=(0,k.providerApiMethod)(),wa=(0,k.providerApiMethod)(),ba=(0,k.permissionRequired)(),ma=(0,k.providerApiMethod)(),Aa=(0,k.providerApiMethod)(),Oa=(0,k.permissionRequired)(),Ia=(0,k.providerApiMethod)(),ha((Ta=function(e){(0,i.default)(r,e);var t=Sa(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.tron,e}var n=r.prototype;return n.tron_chainId=function(){var e=(0,p.default)((function*(){var e=(0,O.getActiveWalletAccount)(),t=e.accountId,r=e.networkId;if(e.networkImpl!==I.IMPL_TRON)return"0x0";var n=yield this.backgroundApi.engine.getVault({networkId:r,accountId:t});return yield n.getNetworkChainId()}));return function(){return e.apply(this,arguments)}}(),n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r=e.origin;return{method:"wallet_events_accountsChanged",params:yield t.tron_accounts({origin:r})}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.notifyDappChainChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(){return{method:"wallet_events_nodesChanged",params:{nodes:yield t.tron_nodes(),chainId:yield t.tron_chainId()}}}));return function(){return e.apply(this,arguments)}}();e.send(r)},n.rpcCall=function(){var e=(0,p.default)((function*(e){var t=(0,O.getActiveWalletAccount)(),r=t.networkId;if(t.networkImpl===I.IMPL_TRON){b.default.providerApi.info("tron rpcCall:",e,{networkId:r});var n=yield this.backgroundApi.engine.proxyJsonRPCCall(r,e);return b.default.providerApi.info("tron rpcCall RESULT:",e,{networkId:r,result:n}),n}}));return function(t){return e.apply(this,arguments)}}(),n.tron_getProviderState=function(){var e=(0,p.default)((function*(e){var t=yield Promise.all([this.tron_accounts(e),this.tron_nodes()]),r=(0,Ge.default)(t,2);return{accounts:r[0],nodes:r[1]}}));return function(t){return e.apply(this,arguments)}}(),n.tron_getNodeInfo=function(){var e=(0,p.default)((function*(){var e=(0,O.getActiveWalletAccount)(),t=e.accountId,r=e.networkId;if(e.networkImpl!==I.IMPL_TRON)return{};var n=yield this.backgroundApi.engine.getVault({networkId:r,accountId:t});return(yield n.getClient()).trx.getNodeInfo()}));return function(){return e.apply(this,arguments)}}(),n.tron_accounts=function(){var e=(0,p.default)((function*(e){var t,r=null==(t=this.backgroundApi.serviceDapp)?void 0:t.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_TRON});if(r&&r.length>0){var n=r.map((function(e){return e.address}));return Promise.resolve(n)}if(e.origin&&Ca.includes(new URL(e.origin).host)){var o=(0,O.getActiveWalletAccount)().accountAddress;return this.backgroundApi.serviceDapp.saveConnectedAccounts({site:{origin:e.origin},address:o,networkImpl:I.IMPL_TRON}),Promise.resolve([o])}return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.tron_nodes=function(){var e=(0,p.default)((function*(){var e=(0,O.getActiveWalletAccount)(),t=e.accountId,r=e.networkId;if(e.networkImpl!==I.IMPL_TRON)return{};var n=yield this.backgroundApi.engine.getVault({networkId:r,accountId:t}),o=(yield n.getNetwork()).isTestnet?Ma:Da;return Promise.resolve({fullHost:o,fullNode:o,solidityNode:o,eventServer:o})}));return function(){return e.apply(this,arguments)}}(),n.tron_requestAccounts=function(){var e=(0,p.default)((function*(e){b.default.providerApi.info("ProviderTron.tron_requestAccounts",e);var t=yield this.tron_accounts(e);return t&&t.length?t:(yield this.backgroundApi.serviceDapp.openConnectionModal(e),this.tron_accounts(e))}));return function(t){return e.apply(this,arguments)}}(),n.tron_signTransaction=function(){var e=(0,p.default)((function*(e,t){var r;b.default.providerApi.info("tron_signTransaction",e,t);var n=yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSignAndSendModal(e,{encodedTx:t,signOnly:!0});return b.default.providerApi.info("tron_signTransaction DONE",n,e,t),JSON.parse(n)}));return function(t,r){return e.apply(this,arguments)}}(),n.wallet_requestPermissions=function(){var e=(0,p.default)((function*(e){return this.tron_requestAccounts(e)}));return function(t){return e.apply(this,arguments)}}(),n.wallet_watchAsset=function(){var e=(0,p.default)((function*(e,t){var r,n,o=(null!=(r=t.type)?r:"").toUpperCase();if("TRC20"!==o)throw new Error(`Asset of type '${o}' not supported`);return yield null==(n=this.backgroundApi.serviceDapp)?void 0:n.openAddTokenModal(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)(Ta.prototype,"tron_getProviderState",[va],Object.getOwnPropertyDescriptor(Ta.prototype,"tron_getProviderState"),Ta.prototype),(0,l.default)(Ta.prototype,"tron_getNodeInfo",[ga],Object.getOwnPropertyDescriptor(Ta.prototype,"tron_getNodeInfo"),Ta.prototype),(0,l.default)(Ta.prototype,"tron_accounts",[ka],Object.getOwnPropertyDescriptor(Ta.prototype,"tron_accounts"),Ta.prototype),(0,l.default)(Ta.prototype,"tron_requestAccounts",[wa],Object.getOwnPropertyDescriptor(Ta.prototype,"tron_requestAccounts"),Ta.prototype),(0,l.default)(Ta.prototype,"tron_signTransaction",[ba,ma],Object.getOwnPropertyDescriptor(Ta.prototype,"tron_signTransaction"),Ta.prototype),(0,l.default)(Ta.prototype,"wallet_requestPermissions",[Aa],Object.getOwnPropertyDescriptor(Ta.prototype,"wallet_requestPermissions"),Ta.prototype),(0,l.default)(Ta.prototype,"wallet_watchAsset",[Oa,Ia],Object.getOwnPropertyDescriptor(Ta.prototype,"wallet_watchAsset"),Ta.prototype),Pa=Ta))||Pa);var Ra,ja,Ea,xa,_a,Ba,Fa,Wa,La,Ua,Ha,Va=r(254595);function qa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}const Ka=(Ra=(0,k.backgroundClass)(),ja=(0,k.providerApiMethod)(),Ea=(0,k.providerApiMethod)(),xa=(0,k.providerApiMethod)(),_a=(0,k.providerApiMethod)(),Ba=(0,k.providerApiMethod)(),Fa=(0,k.providerApiMethod)(),Wa=(0,k.providerApiMethod)(),La=(0,k.providerApiMethod)(),Ra((Ha=function(e){(0,i.default)(r,e);var t=qa(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=y.IInjectedProviderNames.webln,e}var n=r.prototype;return n.notifyDappAccountsChanged=function(e){var t=this,r=function(){var e=(0,p.default)((function*(e){var r=e.origin;return{method:"wallet_events_accountChanged",params:{accounts:yield t.getConnectedAccount({origin:r})}}}));return function(t){return e.apply(this,arguments)}}();e.send(r)},n.getConnectedAccount=function(e){var t=this.backgroundApi.serviceDapp.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_LIGHTNING}),r=(0,Ge.default)(t,1)[0];return Promise.resolve({address:null==r?void 0:r.address})},n.notifyDappChainChanged=function(e){b.default.providerApi.info(e)},n.rpcCall=function(){var e=(0,p.default)((function*(e){return b.default.providerApi.info("webln rpcCall: ",e),Promise.resolve()}));return function(t){return e.apply(this,arguments)}}(),n.enable=function(){var e=(0,p.default)((function*(e){try{return(yield this.getEnabledAccount(e))||(yield this.backgroundApi.serviceDapp.openConnectionModal(e)),{enabled:!0}}catch(t){throw b.default.providerApi.error("webln.enable error: ",t),t}}));return function(t){return e.apply(this,arguments)}}(),n.getEnabledAccount=function(){var e=(0,p.default)((function*(e){var t=(0,O.getActiveWalletAccount)(),r=t.networkId,n=t.accountId;try{var o,i=null==(o=this.backgroundApi.serviceDapp)?void 0:o.getActiveConnectedAccounts({origin:e.origin,impl:I.IMPL_LIGHTNING});if(!i)return!1;var a=i.map((function(e){return e.address})),c=yield this.backgroundApi.engine.getAccount(n,r);if(c.addresses){var u=JSON.parse(c.addresses);if(u.hashAddress)return a.includes(u.hashAddress)}return!1}catch(s){return!1}}));return function(t){return e.apply(this,arguments)}}(),n.getInfo=function(){var e=(0,p.default)((function*(){return Promise.resolve({node:{alias:"OneKey"},methods:["getInfo","makeInvoice","sendPayment","signMessage","verifyMessage","lnurl","on","off","getBalance"],supports:["lightning"]})}));return function(){return e.apply(this,arguments)}}(),n.makeInvoice=function(){var e=(0,p.default)((function*(e){try{var t,r=null==(t=e.data)?void 0:t.params,n=yield this.backgroundApi.serviceDapp.openModal({request:e,screens:[co.ModalRoutes.Webln,co.WeblnModalRoutes.MakeInvoice],params:r}),o=n.paymentRequest,i=n.paymentHash;return b.default.providerApi.info("webln.makeInvoice: ",o),{paymentRequest:o,paymentHash:i,rHash:i}}catch(a){throw b.default.providerApi.error("webln.makeInvoice error: ",a),a}}));return function(t){return e.apply(this,arguments)}}(),n.sendPayment=function(){var e=(0,p.default)((function*(e){try{var t,r=null==(t=e.data)?void 0:t.params,n=(0,O.getActiveWalletAccount)(),o=n.networkId,i=n.accountId,a=yield this.backgroundApi.serviceDapp.openModal({request:e,screens:[co.ModalRoutes.Send,co.SendModalRoutes.WeblnSendPayment],params:{paymentRequest:r,networkId:o,accountId:i}}),c=yield this.backgroundApi.serviceLightningNetwork.fetchSpecialInvoice({paymentHash:a,networkId:o,accountId:i});return b.default.providerApi.info("webln.sendPayment: ",a,c),{preimage:c.payment_preimage}}catch(u){throw b.default.providerApi.error("webln.sendPayment error: ",u),u}}));return function(t){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,p.default)((function*(e){try{var t,r,n=null==(t=e.data)?void 0:t.params;if("string"!==typeof n)throw A.web3Errors.rpc.invalidInput();var o=yield null==(r=this.backgroundApi.serviceDapp)?void 0:r.openSignAndSendModal(e,{unsignedMessage:{type:ke.CommonMessageTypes.SIMPLE_SIGN,message:n}});return b.default.providerApi.info("webln.signMessage: ",n,o),JSON.parse(o)}catch(i){throw b.default.providerApi.error("webln.signMessage error: ",i),i}}));return function(t){return e.apply(this,arguments)}}(),n.verifyMessage=function(){var e=(0,p.default)((function*(e){try{var t,r=null==(t=e.data)?void 0:t.params,n=r.message,o=r.signature;if("string"!==typeof n||"string"!==typeof o)throw A.web3Errors.rpc.invalidInput();var i=(0,O.getActiveWalletAccount)(),a=i.networkId,c=i.accountId;yield this.backgroundApi.serviceDapp.openModal({request:e,screens:[co.ModalRoutes.Webln,co.WeblnModalRoutes.VerifyMessage],params:{message:n,signature:o,networkId:a,accountId:c}}),b.default.providerApi.info("webln.verifyMessage: ",n,o)}catch(u){throw b.default.providerApi.error("webln.verifyMessage error: ",u),u}}));return function(t){return e.apply(this,arguments)}}(),n.lnurl=function(){var e=(0,p.default)((function*(e){var t,r=null==(t=e.data)?void 0:t.params;if("string"!==typeof r)throw A.web3Errors.rpc.invalidInput();var n,o=(0,Va.findLnurl)(r);if(!o)return{error:"Invalid LNURL"};try{if(n=yield(0,Va.getLnurlDetails)(o),(0,Va.isLNURLRequestError)(n))return{error:n.reason};b.default.providerApi.info("webln.lnurl: ",n)}catch(s){return b.default.providerApi.error("webln.lnurl error: ",s),{error:"Failed to parse LNURL"}}var i=(0,O.getActiveWalletAccount)(),a=i.networkId,c=i.accountId,u=i.walletId;switch(n.tag){case"login":return this.backgroundApi.serviceDapp.openModal({request:e,screens:[co.ModalRoutes.Send,co.SendModalRoutes.LNURLAuth],params:{walletId:u,networkId:a,accountId:c,lnurlDetails:n}});case"payRequest":return this.backgroundApi.serviceDapp.openModal({request:e,screens:[co.ModalRoutes.Send,co.SendModalRoutes.LNURLPayRequest],params:{networkId:a,accountId:c,walletId:u,lnurlDetails:n,transferInfo:{accountId:c,networkId:a,to:o}}});case"withdrawRequest":return this.backgroundApi.serviceDapp.openModal({request:e,screens:[co.ModalRoutes.Send,co.SendModalRoutes.LNURLWithdraw],params:{networkId:a,accountId:c,walletId:u,lnurlDetails:n}});default:return{error:"not implemented"}}}));return function(t){return e.apply(this,arguments)}}(),n.getBalance=function(){var e=(0,p.default)((function*(){var e=(0,O.getActiveWalletAccount)(),t=e.networkId,r=e.accountId,n=yield this.backgroundApi.serviceLightningNetwork.weblnGetBalance({accountId:r,networkId:t});return b.default.providerApi.info("webln.getBalance: ",n,r),n}));return function(){return e.apply(this,arguments)}}(),(0,o.default)(r)}(P),(0,l.default)(Ha.prototype,"enable",[ja],Object.getOwnPropertyDescriptor(Ha.prototype,"enable"),Ha.prototype),(0,l.default)(Ha.prototype,"getInfo",[Ea],Object.getOwnPropertyDescriptor(Ha.prototype,"getInfo"),Ha.prototype),(0,l.default)(Ha.prototype,"makeInvoice",[xa],Object.getOwnPropertyDescriptor(Ha.prototype,"makeInvoice"),Ha.prototype),(0,l.default)(Ha.prototype,"sendPayment",[_a],Object.getOwnPropertyDescriptor(Ha.prototype,"sendPayment"),Ha.prototype),(0,l.default)(Ha.prototype,"signMessage",[Ba],Object.getOwnPropertyDescriptor(Ha.prototype,"signMessage"),Ha.prototype),(0,l.default)(Ha.prototype,"verifyMessage",[Fa],Object.getOwnPropertyDescriptor(Ha.prototype,"verifyMessage"),Ha.prototype),(0,l.default)(Ha.prototype,"lnurl",[Wa],Object.getOwnPropertyDescriptor(Ha.prototype,"lnurl"),Ha.prototype),(0,l.default)(Ha.prototype,"getBalance",[La],Object.getOwnPropertyDescriptor(Ha.prototype,"getBalance"),Ha.prototype),Ua=Ha))||Ua);var $a,Ga,za,Ja,Qa,Xa,Ya,Za=["https://onekey.so","http://localhost:3008","http://localhost:8081","null"].concat((0,f.default)([])).filter(Boolean);function ec(e){return e&&((null==e?void 0:e.endsWith(".onekey.so"))||Za.includes(e))}function tc(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}const rc=function(e){(0,i.default)(n,e);var t=tc(n);function n(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).engine=new u.Engine,e.validator=e.engine.validator,e.vaultFactory=e.engine.vaultFactory,e}return(0,o.default)(n,[{key:"walletConnect",get:function(){var e=new(r(372805).default)({backgroundApi:this});return Object.defineProperty(this,"walletConnect",{value:e}),e}},{key:"servicePromise",get:function(){var e=new(r(421002).default)({backgroundApi:this});return Object.defineProperty(this,"servicePromise",{value:e}),e}},{key:"serviceDapp",get:function(){var e=new(r(471235).default)({backgroundApi:this});return Object.defineProperty(this,"serviceDapp",{value:e}),e}},{key:"serviceAccount",get:function(){var e=new(r(715760).default)({backgroundApi:this});return Object.defineProperty(this,"serviceAccount",{value:e}),e}},{key:"serviceExternalAccount",get:function(){var e=new(r(606492).default)({backgroundApi:this});return Object.defineProperty(this,"serviceExternalAccount",{value:e}),e}},{key:"serviceNetwork",get:function(){var e=new(r(707040).default)({backgroundApi:this});return Object.defineProperty(this,"serviceNetwork",{value:e}),e}},{key:"serviceApp",get:function(){var e=new(r(951375).default)({backgroundApi:this});return Object.defineProperty(this,"serviceApp",{value:e}),e}},{key:"serviceAccountSelector",get:function(){var e=new(r(183827).default)({backgroundApi:this});return Object.defineProperty(this,"serviceAccountSelector",{value:e}),e}},{key:"serviceCronJob",get:function(){var e=new(r(958019).default)({backgroundApi:this});return Object.defineProperty(this,"serviceCronJob",{value:e}),e}},{key:"serviceOnboarding",get:function(){var e=new(r(656079).default)({backgroundApi:this});return Object.defineProperty(this,"serviceOnboarding",{value:e}),e}},{key:"serviceToken",get:function(){var e=new(r(281668).default)({backgroundApi:this});return Object.defineProperty(this,"serviceToken",{value:e}),e}},{key:"serviceWalletConnect",get:function(){var e=new(r(387833).default)({backgroundApi:this});return Object.defineProperty(this,"serviceWalletConnect",{value:e}),e}},{key:"serviceHistory",get:function(){var e=new(r(417470).default)({backgroundApi:this});return Object.defineProperty(this,"serviceHistory",{value:e}),e}},{key:"serviceHardware",get:function(){var e=new(r(141409).default)({backgroundApi:this});return Object.defineProperty(this,"serviceHardware",{value:e}),e}},{key:"servicePassword",get:function(){var e=new(r(544711).default)({backgroundApi:this});return Object.defineProperty(this,"servicePassword",{value:e}),e}},{key:"serviceSwap",get:function(){var e=new(r(594822).default)({backgroundApi:this});return Object.defineProperty(this,"serviceSwap",{value:e}),e}},{key:"serviceCloudBackup",get:function(){var e=new(r(420590).default)({backgroundApi:this});return Object.defineProperty(this,"serviceCloudBackup",{value:e}),e}},{key:"serviceStaking",get:function(){var e=new(r(882798).default)({backgroundApi:this});return Object.defineProperty(this,"serviceStaking",{value:e}),e}},{key:"serviceNameResolver",get:function(){var e=new(r(25962).default)({backgroundApi:this});return Object.defineProperty(this,"serviceNameResolver",{value:e}),e}},{key:"serviceNFT",get:function(){var e=new(r(538975).default)({backgroundApi:this});return Object.defineProperty(this,"serviceNFT",{value:e}),e}},{key:"serviceNotification",get:function(){var e=new(r(545453).default)({backgroundApi:this});return Object.defineProperty(this,"serviceNotification",{value:e}),e}},{key:"serviceSocket",get:function(){var e=new(r(676070).default)({backgroundApi:this});return Object.defineProperty(this,"serviceSocket",{value:e}),e}},{key:"serviceBootstrap",get:function(){var e=new(r(13577).default)({backgroundApi:this});return Object.defineProperty(this,"serviceBootstrap",{value:e}),e}},{key:"serviceDiscover",get:function(){var e=new(r(661242).default)({backgroundApi:this});return Object.defineProperty(this,"serviceDiscover",{value:e}),e}},{key:"serviceMarket",get:function(){var e=new(r(976542).default)({backgroundApi:this});return Object.defineProperty(this,"serviceMarket",{value:e}),e}},{key:"serviceRevoke",get:function(){var e=new(r(473755).default)({backgroundApi:this});return Object.defineProperty(this,"serviceRevoke",{value:e}),e}},{key:"serviceSetting",get:function(){var e=new(r(781821).default)({backgroundApi:this});return Object.defineProperty(this,"serviceSetting",{value:e}),e}},{key:"serviceBatchTransfer",get:function(){var e=new(r(840536).default)({backgroundApi:this});return Object.defineProperty(this,"serviceBatchTransfer",{value:e}),e}},{key:"servicePrice",get:function(){var e=new(r(296558).default)({backgroundApi:this});return Object.defineProperty(this,"servicePrice",{value:e}),e}},{key:"serviceTransaction",get:function(){var e=new(r(43277).default)({backgroundApi:this});return Object.defineProperty(this,"serviceTransaction",{value:e}),e}},{key:"serviceOverview",get:function(){var e=new(r(288348).default)({backgroundApi:this});return Object.defineProperty(this,"serviceOverview",{value:e}),e}},{key:"serviceMigrate",get:function(){var e=new(r(7075).default)({backgroundApi:this});return Object.defineProperty(this,"serviceMigrate",{value:e}),e}},{key:"serviceHTTP",get:function(){var e=new(r(812530).default)({backgroundApi:this});return Object.defineProperty(this,"serviceHTTP",{value:e}),e}},{key:"serviceDerivationPath",get:function(){var e=new(r(93200).default)({backgroundApi:this});return Object.defineProperty(this,"serviceDerivationPath",{value:e}),e}},{key:"serviceFiatPay",get:function(){var e=new(r(416030).default)({backgroundApi:this});return Object.defineProperty(this,"serviceFiatPay",{value:e}),e}},{key:"serviceAddressbook",get:function(){var e=new(r(844900).default)({backgroundApi:this});return Object.defineProperty(this,"serviceAddressbook",{value:e}),e}},{key:"serviceLimitOrder",get:function(){var e=new(r(37600).default)({backgroundApi:this});return Object.defineProperty(this,"serviceLimitOrder",{value:e}),e}},{key:"serviceUtxos",get:function(){var e=new(r(573693).default)({backgroundApi:this});return Object.defineProperty(this,"serviceUtxos",{value:e}),e}},{key:"serviceContract",get:function(){var e=new(r(153377).default)({backgroundApi:this});return Object.defineProperty(this,"serviceContract",{value:e}),e}},{key:"serviceLightningNetwork",get:function(){var e=new(r(216556).default)({backgroundApi:this});return Object.defineProperty(this,"serviceLightningNetwork",{value:e}),e}},{key:"serviceGas",get:function(){var e=new(r(306810).default)({backgroundApi:this});return Object.defineProperty(this,"serviceGas",{value:e}),e}},{key:"serviceInscribe",get:function(){var e=new(r(266075).default)({backgroundApi:this});return Object.defineProperty(this,"serviceInscribe",{value:e}),e}},{key:"serviceAllNetwork",get:function(){var e=new(r(409325).default)({backgroundApi:this});return Object.defineProperty(this,"serviceAllNetwork",{value:e}),e}},{key:"serviceDappMetaData",get:function(){var e=new(r(239565).default)({backgroundApi:this});return Object.defineProperty(this,"serviceDappMetaData",{value:e}),e}},{key:"serviceBRC20",get:function(){var e=new(r(976753).default)({backgroundApi:this});return Object.defineProperty(this,"serviceBRC20",{value:e}),e}},{key:"serviceNostr",get:function(){var e=new(r(773989).default)({backgroundApi:this});return Object.defineProperty(this,"serviceNostr",{value:e}),e}}]),n}(($a=(0,k.backgroundClass)(),Ga=(0,k.bindThis)(),za=(0,k.backgroundMethod)(),Ja=(0,k.bindThis)(),Qa=(0,k.backgroundMethod)(),$a((Ya=function(){function e(){var e=this;this.persistor=g.persistor,this.store=g.default,this.appSelector=g.appSelector,this.bridge=null,this.webEmbedBridge=null,this.bridgeExtBg=null,this.providers=function(e){var t,r=e.backgroundApi;return(t={})[y.IInjectedProviderNames.$private]=new Xo({backgroundApi:r}),t[y.IInjectedProviderNames.ethereum]=new Pn({backgroundApi:r}),t[y.IInjectedProviderNames.solana]=new yi({backgroundApi:r}),t[y.IInjectedProviderNames.starcoin]=new Gi({backgroundApi:r}),t[y.IInjectedProviderNames.near]=new Jn({backgroundApi:r}),t[y.IInjectedProviderNames.aptos]=new Pe({backgroundApi:r}),t[y.IInjectedProviderNames.conflux]=new or({backgroundApi:r}),t[y.IInjectedProviderNames.tron]=new Na({backgroundApi:r}),t[y.IInjectedProviderNames.algo]=new _({backgroundApi:r}),t[y.IInjectedProviderNames.sui]=new ya({backgroundApi:r}),t[y.IInjectedProviderNames.cardano]=new Tt({backgroundApi:r}),t[y.IInjectedProviderNames.cosmos]=new Rr({backgroundApi:r}),t[y.IInjectedProviderNames.polkadot]=new Eo({backgroundApi:r}),t[y.IInjectedProviderNames.webln]=new Ka({backgroundApi:r}),t[y.IInjectedProviderNames.nostr]=new po({backgroundApi:r}),t[y.IInjectedProviderNames.btc]=new ct({backgroundApi:r}),t}({backgroundApi:this}),this._handlePersistorState=function(){e.persistor.getState().bootstrapped&&e._persistorUnsubscribe&&e._persistorUnsubscribe()},this.bridgeReceiveHandler=function(){var t=(0,p.default)((function*(t){return yield e._bridgeReceiveHandler(t)}));return function(e){return t.apply(this,arguments)}}(),this.sendForProviderMaps={},this.sendMessagesToInjectedBridge=function(){var t=(0,p.default)((function*(t,r){(e.bridge||e.webEmbedBridge)&&(e.bridge&&(d()(r)&&(r=yield r({origin:e.bridge.remoteInfo.origin})),(0,w.ensureSerializable)(r),e.bridge.globalOnMessageEnabled&&e.bridge.requestSync({scope:t,data:r})),e.webEmbedBridge&&(d()(r)&&(r=yield r({origin:e.webEmbedBridge.remoteInfo.origin})),(0,w.ensureSerializable)(r),e.webEmbedBridge.globalOnMessageEnabled&&e.webEmbedBridge.requestSync({scope:t,data:r})))}));return function(e,r){return t.apply(this,arguments)}}(),this.cycleDepsCheck(),this._initBackgroundPersistor()}var t=e.prototype;return t.cycleDepsCheck=function(){if(!this.persistor||!this.store||!this.appSelector){var e="background cycle deps ERROR: redux store failed, some reducer may reference backgroundApiProxy";throw alert(e),new Error(e)}},t._initBackgroundPersistor=function(){this._persistorUnsubscribe=this.persistor.subscribe(this._handlePersistorState)},t.dispatch=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(t&&t.length){t=t.filter(Boolean);var n=w.buildReduxBatchAction.apply(void 0,(0,f.default)(t));if(n){var o;this.store.dispatch(n);var i={actions:t,$isDispatchFromBackground:!0};null==(o=this.bridgeExtBg)||o.requestToAllUi({method:w.DISPATCH_ACTION_BROADCAST_METHOD_NAME,params:i})}}},t.getState=function(){var e=v()(this.store.getState()),t=this.persistor.getState().bootstrapped;return Promise.resolve({state:e,bootstrapped:t})},t.connectBridge=function(e){this.bridge=e},t.connectWebEmbedBridge=function(e){this.webEmbedBridge=e},t.rpcResult=function(e,t){var r,n;return{id:null!=(r=null==t?void 0:t.id)?r:void 0,jsonrpc:null!=(n=null==t?void 0:t.jsonrpc)?n:"2.0",result:e}},t.handleProviderMethods=function(){var e=(0,p.default)((function*(e){var t,r=e.scope,n=e.origin,o=null==e?void 0:e.data,i=this.providers[r];if(!i)throw new Error(`[${r}] ProviderApi instance is not found.`);if(r===y.IInjectedProviderNames.$private&&!ec(n)&&(!(t=null==o?void 0:o.method)||!["wallet_connectToWalletConnect","wallet_getConnectWalletInfo","wallet_sendSiteMetadata","wallet_scanQrcode"].includes(t||""))){var a=new Error(`[${n}] is not allowed to call $private methods: ${null==o?void 0:o.method}`);throw b.default.providerApi.error(a),a}b.default.providerApi.info("provider.handleMethods ====> ",o.method,e);var c=yield i.handleMethods(e);(0,w.ensureSerializable)(c);var u=this.rpcResult(c,o);return b.default.providerApi.info("provider.handleMethods RESULT:",o,"\r\n ----\x3e \r\n",u,e),u}));return function(t){return e.apply(this,arguments)}}(),t._bridgeReceiveHandler=function(){var e=(0,p.default)((function*(e){var t,r=e.scope,n=e.origin,o=e.internal,i=null!=(t=e.data)?t:{},a=i.method;i.params;if(!n)throw new Error("BackgroundApi [payload.origin] is required.");if(!o&&!r)throw new Error("BackgroundApi [payload.scope] is required for non-internal method call.");return r?(b.default.backgroundApi.info("_bridgeReceiveHandler",{scope:r,origin:n,method:a}),this.handleProviderMethods(e)):function(e){return e.internal,e.origin,e.data,chrome.runtime.getURL(""),!1}(e)?this.handleInternalMethods(e):ec(n)?this.handleSelfOriginMethods(e):void(0,w.throwMethodNotFound)(a)}));return function(t){return e.apply(this,arguments)}}(),t.handleSelfOriginMethods=function(e){console.log(e)},t.handleInternalMethods=function(){var e=(0,p.default)((function*(e){var t,r=null!=(t=e.data)?t:{},n=r.method,o=r.params,i=r.service||"",a=[].concat(o),c=i?this[i]:this,u=c[n];if(u){var s=u.call.apply(u,[c].concat((0,f.default)(a)));(0,w.ensurePromiseObject)(s,{serviceName:i,methodName:n});var d=yield s;return(0,w.ensureSerializable)(d),d}(0,w.throwMethodNotFound)(i,n)}));return function(t){return e.apply(this,arguments)}}(),t.sendForProvider=function(e){if(!e)throw new Error("sendForProvider: providerName is required.");return this.sendForProviderMaps[e]||(this.sendForProviderMaps[e]=this.sendMessagesToInjectedBridge.bind(this,e)),this.sendForProviderMaps[e]},(0,o.default)(e)}(),(0,l.default)(Ya.prototype,"dispatch",[Ga,za],Object.getOwnPropertyDescriptor(Ya.prototype,"dispatch"),Ya.prototype),(0,l.default)(Ya.prototype,"getState",[Ja,Qa],Object.getOwnPropertyDescriptor(Ya.prototype,"getState"),Ya.prototype),Xa=Ya))||Xa))},64715:(e,t,r)=>{r.r(t),r.d(t,{default:()=>f});var n=r(887371),o=r(545754),i=r(411987),a=r(695058),c=r(292147),u=r(196234),s=r(634795),d=r(438760),p=r(402814);r(213208);function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,a.default)(e);if(t){var o=(0,a.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,i.default)(this,r)}}const f=function(e){(0,o.default)(r,e);var t=l(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n)))._serviceCreatedNames={},e._proxyServiceCache={},e.engine=e._createProxyService("engine"),e.validator=e._createProxyService("validator"),e.vaultFactory={},e.walletConnect=e._createProxyService("walletConnect"),e.servicePromise=e._createProxyService("servicePromise"),e.serviceDapp=e._createProxyService("serviceDapp"),e.serviceAccountSelector=e._createProxyService("serviceAccountSelector"),e.serviceAccount=e._createProxyService("serviceAccount"),e.serviceExternalAccount=e._createProxyService("serviceExternalAccount"),e.serviceNetwork=e._createProxyService("serviceNetwork"),e.serviceApp=e._createProxyService("serviceApp"),e.serviceCronJob=e._createProxyService("serviceCronJob"),e.serviceOnboarding=e._createProxyService("serviceOnboarding"),e.serviceToken=e._createProxyService("serviceToken"),e.serviceWalletConnect=e._createProxyService("serviceWalletConnect"),e.serviceHistory=e._createProxyService("serviceHistory"),e.serviceHardware=e._createProxyService("serviceHardware"),e.servicePassword=e._createProxyService("servicePassword"),e.serviceSwap=e._createProxyService("serviceSwap"),e.serviceCloudBackup=e._createProxyService("serviceCloudBackup"),e.serviceStaking=e._createProxyService("serviceStaking"),e.serviceNameResolver=e._createProxyService("serviceNameResolver"),e.serviceNFT=e._createProxyService("serviceNFT"),e.serviceNotification=e._createProxyService("serviceNotification"),e.serviceSocket=e._createProxyService("serviceSocket"),e.serviceBootstrap=e._createProxyService("serviceBootstrap"),e.serviceDiscover=e._createProxyService("serviceDiscover"),e.serviceMarket=e._createProxyService("serviceMarket"),e.serviceRevoke=e._createProxyService("serviceRevoke"),e.serviceSetting=e._createProxyService("serviceSetting"),e.serviceBatchTransfer=e._createProxyService("serviceBatchTransfer"),e.serviceTransaction=e._createProxyService("serviceTransaction"),e.servicePrice=e._createProxyService("servicePrice"),e.serviceOverview=e._createProxyService("serviceOverview"),e.serviceMigrate=e._createProxyService("serviceMigrate"),e.serviceHTTP=e._createProxyService("serviceHTTP"),e.serviceDerivationPath=e._createProxyService("serviceDerivationPath"),e.serviceFiatPay=e._createProxyService("serviceFiatPay"),e.serviceAddressbook=e._createProxyService("serviceAddressbook"),e.serviceLimitOrder=e._createProxyService("serviceLimitOrder"),e.serviceUtxos=e._createProxyService("serviceUtxos"),e.serviceInscribe=e._createProxyService("serviceInscribe"),e.serviceContract=e._createProxyService("serviceContract"),e.serviceLightningNetwork=e._createProxyService("serviceLightningNetwork"),e.serviceGas=e._createProxyService("serviceGas"),e.serviceAllNetwork=e._createProxyService("serviceAllNetwork"),e.serviceDappMetaData=e._createProxyService("serviceDappMetaData"),e.serviceBRC20=e._createProxyService("serviceBRC20"),e.serviceNostr=e._createProxyService("serviceNostr"),e}return r.prototype._createProxyService=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ROOT";if(this._serviceCreatedNames[t])throw new Error(`_createProxyService name duplicated. name=${t}`);this._serviceCreatedNames[t]=!0;var r=new Proxy({},{get:function(r,n){if("string"===typeof n){var o=`${t}.${n}`;return e._proxyServiceCache[o]||(e._proxyServiceCache[o]=function(){["serviceApp.addLogger"].includes(o)||c.default.backgroundApi.info("Proxy method call",o);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.callBackground.apply(e,[o].concat(r))}),e._proxyServiceCache[o]}return r[n]}});return r},(0,n.default)(r)}(function(){var e=t.prototype;function t(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).backgroundApi;this.appSelector=function(){throw new Error("please use `useAppSelector()` instead.")},this.persistor={},this.store={},this.bridge={},this.bridgeExtBg={},this.providers={},this.dispatch=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];e.callBackgroundSync.apply(e,["dispatch"].concat(r))},this.getState=function(){return e.callBackground("getState")},this.bridgeReceiveHandler=function(t){var r;return null==(r=e.backgroundApi)?void 0:r.bridgeReceiveHandler(t)},this.backgroundApi=null,t&&(this.backgroundApi=t)}return e.sendForProvider=function(e){var t;return null==(t=this.backgroundApi)?void 0:t.sendForProvider(e)},e.connectBridge=function(e){var t;null==(t=this.backgroundApi)||t.connectBridge(e)},e.connectWebEmbedBridge=function(e){var t;null==(t=this.backgroundApi)||t.connectWebEmbedBridge(e)},e.callBackgroundMethod=function(){var e=(0,s.default)((function*(){for(var e=arguments.length>1?arguments[1]:void 0,t=arguments.length,r=new Array(t>2?t-2:0),n=2;n<t;n++)r[n-2]=arguments[n];(0,p.ensureSerializable)(r);var o=e.split("."),i=(0,u.default)(o,2),a=i[0],c=i[1];c||(c=a,a=""),"ROOT"===a&&(a="");var s=`${d.INTERNAL_METHOD_PREFIX}${c}`;if(!this.backgroundApi)throw new Error("backgroundApi not found in non-ext env");var l=a?this.backgroundApi[a]:this.backgroundApi;if(l[s]){var f,y=(f=l[s]).call.apply(f,[l].concat(r));(0,p.ensurePromiseObject)(y,{serviceName:a,methodName:c});var h=yield y;return h=(0,p.ensureSerializable)(h,!0)}["hasOwnProperty","toJSON"].includes(s)||(0,p.throwMethodNotFound)(a,s)}));return function(){return e.apply(this,arguments)}}(),e.callBackgroundSync=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.callBackgroundMethod.apply(this,[!0,e].concat(r))},e.callBackground=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return this.callBackgroundMethod.apply(this,[!1,e].concat(r))},e.handleProviderMethods=function(e){throw new Error("handleProviderMethods in Proxy is mocked")},(0,n.default)(t)}())},372805:(e,t,r)=>{r.r(t),r.d(t,{default:()=>H});var n=r(459740),o=r(301842),i=r.n(o),a=r(634795),c=r(254073),u=r.n(c),s=r(887371),d=r(580753),p=r(545754),l=r(411987),f=r(695058),y=r(859375),h=r(702139),v=r(270225),g=r(953150),k=r(908137),w=r(480601),b=r(776553),m=r(438760),A=r(613549),O=r(292147),I=r(213208),P=r(199578),T=function(){function e(e){var t=e.client;this.client=t}return e.prototype.request=function(){var e=(0,a.default)((function*(e,t){var r=yield this.client.backgroundApi.handleProviderMethods({scope:this.providerName,origin:this.client.getConnectorOrigin(e),data:t});return Promise.resolve(r.result)}));return function(t,r){return e.apply(this,arguments)}}(),(0,s.default)(e)}();function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var o=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}var D=function(e){(0,p.default)(r,e);var t=S(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=P.IInjectedProviderNames.algo,e}var n=r.prototype;return n.connect=function(){var e=(0,a.default)((function*(e){return(yield this.request(e,{method:"connect"}))||[]}));return function(t){return e.apply(this,arguments)}}(),n.getAccounts=function(){var e=(0,a.default)((function*(e){return(yield this.request(e,{method:"accounts"}))||[]}));return function(t){return e.apply(this,arguments)}}(),n.getChainId=function(){var e=(0,a.default)((function*(e){var t=yield this.request(e,{method:"getChainId"});return null==t?void 0:t.chainId}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(r)}(T);function M(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var o=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}var C=function(e){(0,p.default)(r,e);var t=M(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=P.IInjectedProviderNames.aptos,e}var n=r.prototype;return n.connect=function(){var e=(0,a.default)((function*(e){var t=yield this.request(e,{method:"connect"});return[null==t?void 0:t.address].filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),n.getAccounts=function(){var e=(0,a.default)((function*(e){var t=yield this.request(e,{method:"account"});return[null==t?void 0:t.address].filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),n.getChainId=function(){var e=(0,a.default)((function*(e){var t=yield this.request(e,{method:"getChainId"});return null==t?void 0:t.chainId}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(r)}(T);function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var o=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}var R,j,E,x,_,B,F,W=function(e){(0,p.default)(r,e);var t=N(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).providerName=P.IInjectedProviderNames.ethereum,e}var n=r.prototype;return n.connect=function(){var e=(0,a.default)((function*(e){return(yield this.request(e,{method:"eth_requestAccounts"}))||[]}));return function(t){return e.apply(this,arguments)}}(),n.getAccounts=function(){var e=(0,a.default)((function*(e){return(yield this.request(e,{method:"eth_accounts"}))||[]}));return function(t){return e.apply(this,arguments)}}(),n.getChainId=function(){var e=(0,a.default)((function*(e){var t=yield this.request(e,{method:"net_version"});return parseInt(null!=t?t:"0",10)}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(r)}(T),L=["id","topic"];function U(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var o=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}const H=(R=(0,m.backgroundClass)(),j=(0,m.backgroundMethod)(),E=(0,m.backgroundMethod)(),x=(0,m.backgroundMethod)(),_=(0,m.backgroundMethod)(),R((F=function(e){(0,p.default)(r,e);var t=U(r);function r(e){var r,o,c=e.backgroundApi;return(o=t.call(this)).requestProxyMap=((r={})[A.IMPL_EVM]=new W({client:(0,d.default)(o)}),r[A.IMPL_APTOS]=new C({client:(0,d.default)(o)}),r[A.IMPL_ALGO]=new D({client:(0,d.default)(o)}),r),o.notifySessionChanged=u()((0,a.default)((function*(){var e=(0,d.default)(o).connector;if(e&&e.connected){var t=e.accounts||[],r=yield o.getChainIdInteger({connector:e}),n=e.session.networkImpl,a=[],c=o.getRequestProxy({networkImpl:n});(a=yield c.getAccounts({connector:e}))&&a.length||(a=t),a&&a.length?e.updateSession({chainId:r,accounts:a}):yield o.disconnect()}if(o.web3walletV2){var u=(yield o.getActiveSessionsV2()).sessions;for(var s of u){var p,l,f=null==s||null==(p=s.peer)||null==(l=p.metadata)?void 0:l.url,y=A.IMPL_EVM,h=o.getRequestProxy({networkImpl:y}),v=yield h.getAccounts({sessionV2:s});if(v&&v.length){var k=yield o.getChainIdIntegerV2({sessionV2:s,networkImpl:y});if(!i()(k)){var w,m=g.default.convertToSessionNamespacesV2({sessionStatus:{networkImpl:y,chainId:k,accounts:v},requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces}).namespaces;null==(w=o.web3walletV2.updateSession({topic:s.topic,namespaces:m}))||w.catch((function(e){console.error("web3walletV2.updateSession catch ERROR: ",e)}));var O=`eip155:${k}`;yield o.web3walletV2.emitSessionEvent({topic:s.topic,event:{name:"accountsChanged",data:v},chainId:O}),yield o.web3walletV2.emitSessionEvent({topic:s.topic,event:{name:"chainChanged",data:k},chainId:O}),console.log("WalletConnect: notify session changed, updateSession done",{eip155ChainId:O,accounts:v})}}else yield o.disconnectV2({sessionV2:s});console.log(`WalletConnect: notify session changed, peerUrl=${f}`)}}yield(0,b.wait)(800),o.refreshConnectedSites()})),800,{leading:!1,trailing:!0}),o.handleSessionProposalV2=function(){var e=(0,a.default)((function*(e){try{var t,r=yield o.getSessionStatusToApprove({proposal:e}),n=g.default.convertToSessionNamespacesV2({sessionStatus:r,requiredNamespaces:e.params.requiredNamespaces,optionalNamespaces:e.params.optionalNamespaces,onError:function(e){o.backgroundApi.dispatch((0,w.backgroundShowToast)({title:null==e?void 0:e.message,type:"error"}))}}).namespaces,i=yield null==(t=o.web3walletV2)?void 0:t.approveSession({id:e.id,namespaces:n});console.log("WalletConnectV2 session_proposal APPROVE: ",i)}catch(u){var a,c=yield null==(a=o.web3walletV2)?void 0:a.rejectSession({id:e.id,reason:(0,h.getSdkError)("USER_REJECTED_METHODS",null==u?void 0:u.message)});console.error("WalletConnectV2 session_proposal REJECT: ",u,c),yield o.removeConnectedAccounts({proposal:e})}finally{o.refreshConnectedSites()}}));return function(t){return e.apply(this,arguments)}}(),o.handleSessionRequestV2=function(){var e=(0,a.default)((function*(e){var t=e.context,r=e.topic,n=e.params;e.id;try{console.log("WalletConnectV2 session_request: ",e);var a=A.IMPL_EVM,c=yield o.getSessionV2ByTopic({topic:r});if(!c)throw new Error(`WalletConnect Session not found. topic=${r}`);var u=yield o.getChainIdIntegerV2({sessionV2:c,networkImpl:a});if(i()(u))throw new Error(`WalletConnect current chainId not found. networkImpl=${a}`);var s,d,p=g.default.getChainIdFromNamespaceChainV2({chain:null==n?void 0:n.chainId}),l=p.namespace,f=p.chainId;if(!g.default.isEvmNamespaceV2(l))throw new Error("OneKey WalletConnect peer namespace support EVM chain only");if(!f)throw new Error(`WalletConnect peer chainId not found. origin=${null==t||null==(s=t.verified)?void 0:s.origin}`);if(String(u)!==f)throw new Error(`Calling [${null==n||null==(d=n.request)?void 0:d.method}] ERROR:  Mismatched networks. Please switch OneKey Wallet current network to chainId=${f}`);var y=yield o.handleSessionRequest({networkImpl:a,payload:n.request,sessionRequest:e});o.resolveSessionRequestV2({request:e,result:y})}catch(h){throw o.rejectSessionRequestV2({request:e,error:h}),O.default.walletConnect.error("walletConnectV2.responseCallRequest ERROR",h),h}}));return function(t){return e.apply(this,arguments)}}(),o.handleSessionDeleteV2=function(){var e=(0,a.default)((function*(e){var t=e.id,r=e.topic,i=(0,n.default)(e,L);console.log("WalletConnectV2 session_delete: ",{id:t,topic:r,others:i});try{yield o.disconnectV2({topic:r})}finally{o.refreshConnectedSites()}}));return function(t){return e.apply(this,arguments)}}(),o.backgroundApi=c,o.setupEventHandlers(),o}var o=r.prototype;return o.getRequestProxy=function(e){var t=e.networkImpl;return this.requestProxyMap[t]||this.requestProxyMap[A.IMPL_EVM]},o.setupEventHandlers=function(){var e=this;this.on(this.EVENT_NAMES.destroy,(function(t){var r=t.connector;r&&e.removeConnectedAccounts({connector:r})})),this.on(this.EVENT_NAMES.call_request,(function(t){var r=t.connector,n=t.error,o=t.payload;if(!n&&o&&r){var i=r.session.networkImpl,a=o.id;return e.handleSessionRequest({networkImpl:i,payload:o,connector:r}).then((function(e){return null==r?void 0:r.approveRequest({id:a,result:e})})).catch((function(e){throw null==r||r.rejectRequest({id:a,error:e}),O.default.walletConnect.error("walletConnect.responseCallRequest ERROR",e),e}))}}))},o.removeConnectedAccounts=function(){var e=(0,a.default)((function*(e){var t,r,n,o,i,a=this.isRequestOptionsV2(e),c=this.getConnectorOrigin(e),u=null!=(t=null==e||null==(r=e.connector)?void 0:r.accounts)?t:[],s=(null==e||null==(n=e.connector)||null==(o=n.session)?void 0:o.networkImpl)||(null==e||null==(i=e.connector)?void 0:i.networkImpl)||A.IMPL_EVM;return(u.length||a)&&c&&this.backgroundApi.serviceDapp.removeConnectedAccounts({origin:c,networkImpl:s,addresses:u}),Promise.resolve()}));return function(t){return e.apply(this,arguments)}}(),o.refreshConnectedSites=function(){this.backgroundApi.dispatch((0,w.refreshConnectedSites)())},o.getChainIdInteger=function(){var e=(0,a.default)((function*(e){var t,r,n,o,a,c=(null==e||null==(t=e.connector)||null==(r=t.session)?void 0:r.networkImpl)||A.IMPL_EVM,u=null!=(n=null==e||null==(o=e.connector)?void 0:o.chainId)?n:0,s=this.getRequestProxy({networkImpl:c});return a=yield s.getChainId(e),i()(a)&&(a=u),a}));return function(t){return e.apply(this,arguments)}}(),o.handleSessionRequest=function(e){var t=this,r=e.networkImpl,n=e.payload,o=e.connector,i=e.sessionRequest;return new Promise((function(e,a){var c=t.isInteractiveMethod({payload:n}),u=function(){var u=t.getRequestProxy({networkImpl:r});return u.request({connector:o,sessionRequest:i},n).then(e).catch(a).finally((function(){c&&t.redirectToDapp({connector:o,sessionRequest:i})}))};return c?v.default.runAfterUnlock(u):u()}))},o.getSessionStatusToApprove=function(){var e=(0,a.default)((function*(e){var t=e.connector,r=e.proposal;if(!t&&!r)throw new Error("getSessionStatusToApprove Error: connector(v1) or proposal(v2) not initialized");var n=A.IMPL_EVM;null!=t&&t.session&&(n=t.session.networkImpl);var o=this.backgroundApi.dispatch;I.default.isExtensionUi&&o((0,w.closeDappConnectionPreloading)());var i,a=this.getRequestProxy({networkImpl:n});i=yield a.connect(e);var c=yield this.getChainIdInteger(e);if(!i||!i.length)throw new Error("WalletConnect Session error: accounts is empty");return setTimeout((function(){o((0,w.closeDappConnectionPreloading)())}),1e3),{chainId:c,accounts:i,networkImpl:n}}));return function(t){return e.apply(this,arguments)}}(),o.isInteractiveMethod=function(e){var t=e.payload;return Boolean(t.method&&["eth_sendTransaction","eth_signTransaction","eth_sign","personal_sign","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v3","eth_signTypedData_v4"].includes(t.method))},o.getChainIdIntegerV2=function(){var e=(0,a.default)((function*(e){var t=e.sessionV2,r=e.networkImpl,n=this.getRequestProxy({networkImpl:r});if(r===A.IMPL_EVM)return yield n.getChainId({sessionV2:t});throw new Error("getChainIdIntegerV2 ERROR: non-EVM not supported yet")}));return function(t){return e.apply(this,arguments)}}(),o.disconnectV2=function(){var e=(0,a.default)((function*(e){var t=e.sessionV2,r=e.topic,n=e.clearWalletIfEmptySessions,o=void 0===n||n,i=t,a=r||(null==t?void 0:t.topic);if(a){try{var c;yield this.clearRequestsCacheV2((function(e){return e.topic===a})),yield null==(c=this.web3walletV2)?void 0:c.disconnectSession({topic:a,reason:(0,h.getSdkError)("USER_DISCONNECTED")})}catch(p){console.error(p)}yield this.clearHistoryCacheV2((function(e){return e.topic===a}))}if(a&&!i&&(i=yield this.getSessionV2ByTopic({topic:a})),i){var u=i.pairingTopic,s=(yield this.getActiveSessionsV2()).sessions.filter((function(e){return e.pairingTopic===u}));if(null==s||!s.length){try{yield this.disconnectPairingV2({topic:u})}catch(p){console.error(p)}yield this.clearHistoryCacheV2((function(e){return e.topic===u}))}yield this.removeConnectedAccounts({sessionV2:i})}yield(0,b.wait)(300);var d=(yield this.getActiveSessionsV2()).sessions;return null!=d&&d.length||!o||(yield this.clearAllWalletCacheV2()),Promise.resolve()}));return function(t){return e.apply(this,arguments)}}(),o.resolveSessionRequestV2=function(e){var t,r=e.request,n=e.result,o=r.topic,i={id:r.id,jsonrpc:"2.0",result:n};return null==(t=this.web3walletV2)?void 0:t.respondSessionRequest({topic:o,response:i})},o.rejectSessionRequestV2=function(e){var t,r=e.request,n=e.error,o=r.topic,i={id:r.id,jsonrpc:"2.0",error:(0,h.getSdkError)("USER_REJECTED",null==n?void 0:n.message)};return null==(t=this.web3walletV2)?void 0:t.respondSessionRequest({topic:o,response:i})},o.unregisterEventsV2=function(e){e.off("session_proposal",this.handleSessionProposalV2),e.off("session_request",this.handleSessionRequestV2),e.off("session_delete",this.handleSessionDeleteV2)},o.registerEventsV2=function(e){var t=this;e.on("session_proposal",this.handleSessionProposalV2),e.on("session_request",this.handleSessionRequestV2),e.on("session_delete",this.handleSessionDeleteV2),setTimeout((function(){t.refreshConnectedSites()}),3e3)},o.checkWssConnectionStatusV2=function(){var e=(0,a.default)((function*(){var e,t,r,n=null==(e=this.web3walletV2)||null==(t=e.core)||null==(r=t.relayer)?void 0:r.connected;return Promise.resolve({connected:n})}));return function(){return e.apply(this,arguments)}}(),(0,s.default)(r)}(k.WalletConnectClientForWallet),(0,y.default)(F.prototype,"removeConnectedAccounts",[j],Object.getOwnPropertyDescriptor(F.prototype,"removeConnectedAccounts"),F.prototype),(0,y.default)(F.prototype,"refreshConnectedSites",[E],Object.getOwnPropertyDescriptor(F.prototype,"refreshConnectedSites"),F.prototype),(0,y.default)(F.prototype,"disconnectV2",[x],Object.getOwnPropertyDescriptor(F.prototype,"disconnectV2"),F.prototype),(0,y.default)(F.prototype,"checkWssConnectionStatusV2",[_],Object.getOwnPropertyDescriptor(F.prototype,"checkWssConnectionStatusV2"),F.prototype),B=F))||B)},715760:(e,t,r)=>{r.r(t),r.d(t,{default:()=>je});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A,O,I,P,T,S,D,M,C,N,R,j,E,x,_,B,F,W=r(413888),L=r.n(W),U=r(256666),H=r(35676),V=r.n(H),q=r(301842),K=r.n(q),$=r(196234),G=r(968079),z=r(634795),J=r(887371),Q=r(545754),X=r(411987),Y=r(695058),Z=r(859375),ee=r(992431),te=r(940915),re=r(851240),ne=r(534756),oe=r(849877),ie=r(480513),ae=r(398145),ce=r(859071),ue=r(97856),se=r(195212),de=r(62893),pe=r(920458),le=r(932330),fe=r(821919),ye=r(830631),he=r(302478),ve=r(776553),ge=r(415008),ke=r(438760),we=r(942013),be=r(613549),me=r(814817),Ae=r(35116),Oe=r(292147),Ie=r(221899),Pe=r(345584),Te=r(624491),Se=r(961500),De=r(201882);function Me(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ce(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(r),!0).forEach((function(t){(0,U.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Me(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ne(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,Y.default)(e);if(t){var o=(0,Y.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,X.default)(this,r)}}var Re=[be.IMPL_COSMOS,be.IMPL_FIL,be.IMPL_CFX,be.IMPL_DOT,be.IMPL_XMR,be.IMPL_NEXA];const je=(n=(0,ke.backgroundClass)(),o=(0,ke.bindThis)(),i=(0,ke.backgroundMethod)(),a=(0,ke.backgroundMethod)(),c=(0,ke.backgroundMethod)(),u=(0,ke.backgroundMethod)(),s=(0,ke.backgroundMethod)(),d=(0,ke.backgroundMethod)(),p=(0,ke.backgroundMethod)(),l=(0,ke.backgroundMethod)(),f=(0,ke.backgroundMethod)(),y=(0,ke.backgroundMethod)(),h=(0,ke.backgroundMethod)(),v=(0,ke.backgroundMethod)(),g=(0,ke.backgroundMethod)(),k=(0,ke.backgroundMethod)(),w=(0,ke.backgroundMethod)(),b=(0,ke.backgroundMethod)(),m=(0,ke.backgroundMethod)(),A=(0,ke.backgroundMethod)(),O=(0,ke.backgroundMethod)(),I=(0,ke.backgroundMethod)(),P=(0,ke.backgroundMethod)(),T=(0,ke.backgroundMethod)(),S=(0,ke.backgroundMethod)(),D=(0,ke.backgroundMethod)(),M=(0,ke.backgroundMethod)(),C=(0,ke.backgroundMethod)(),N=(0,ke.backgroundMethod)(),R=(0,ke.backgroundMethod)(),j=(0,ke.backgroundMethod)(),E=(0,ke.backgroundMethod)(),x=(0,ke.backgroundMethod)(),_=(0,ke.backgroundMethod)(),n((F=function(e){(0,Q.default)(r,e);var t=Ne(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).addressLabelCache={},e}var n=r.prototype;return n.registerEvents=function(){var e=this;Ae.appEventBus.on(Ae.AppEventBusNames.AccountNameChanged,(function(){e.addressLabelCache={}}))},n.shouldForceRefreshAccount=function(e){var t;return!!e&&Re.includes(null!=(t=(0,oe.parseNetworkId)(e).impl)?t:"")},n.changeCurrrentAccount=function(){var e=(0,z.default)((function*(e){for(var t=e.accountId,r=e.networkId,n=this.backgroundApi,o=n.appSelector,i=n.serviceNetwork,a=n.serviceAccount,c=n.serviceAccountSelector,u=o((function(e){return e.runtime.wallets})),s=0;s<u.length;s+=1){var d=u[s];if(d.accounts.includes(t)){var p;if(r&&(yield i.changeActiveNetwork(r)),t)yield a.changeActiveAccount({accountId:t||"",walletId:null!=(p=d.id)?p:""});yield c.setSelectedWalletToActive();break}}}));return function(t){return e.apply(this,arguments)}}(),n.changeActiveAccount=function(){var e=(0,z.default)((function*(e){var t=e.accountId,r=e.walletId,n=e.extraActions,o=e.shouldReloadAccountsWhenWalletChanged,i=void 0===o||o,a=this.backgroundApi,c=a.dispatch,u=(0,a.appSelector)((function(e){return e.general})),s=u.activeNetworkId,d=u.activeWalletId;i&&d!==r&&(yield this.reloadAccountsByWalletIdNetworkId(r,s)),c.apply(void 0,[(0,de.changeActiveAccount)({activeAccountId:t,activeWalletId:r})].concat((0,G.default)(n||[]))),this.changeActiveExternalWalletName(t),this.notifyAccountsChanged()}));return function(t){return e.apply(this,arguments)}}(),n.getDisplayPassphraseWalletIdList=function(){var e=this.backgroundApi.appSelector,t=e((function(e){return e.runtime.displayPassphraseWalletIdList})),r=e((function(e){var t;return null==(t=e.settings.hardware)?void 0:t.rememberPassphraseWallets}));return(0,G.default)(new Set([].concat((0,G.default)(r||[]),(0,G.default)(t||[]))))},n.initWallets=function(){var e=(0,z.default)((function*(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{noDispatch:!1}).noDispatch,t=this.backgroundApi,r=t.engine,n=t.dispatch,o=this.getDisplayPassphraseWalletIdList(),i=yield r.getWallets({displayPassphraseWalletIds:o});return e||n((0,le.updateWallets)(i)),i}));return function(){return e.apply(this,arguments)}}(),n.setAccountName=function(){var e=(0,z.default)((function*(e,t){var r=this.backgroundApi,n=r.engine,o=r.dispatch,i=r.serviceCloudBackup,a=yield n.setAccountName(e,t);return o((0,le.updateAccountDetail)({name:t,id:e})),e.startsWith("hw")||i.requestBackup(),Ae.appEventBus.emit(Ae.AppEventBusNames.AccountNameChanged),a}));return function(t,r){return e.apply(this,arguments)}}(),n.reloadAccountsByWalletIdNetworkId=function(){var e=(0,z.default)((function*(e,t){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{noDispatch:!1}).noDispatch;if(e&&t){var n=this.backgroundApi.serviceAllNetwork;if((0,oe.isAllNetworks)(t))return n.getAllNetworksFakeAccounts({walletId:e});var o=this.backgroundApi,i=o.engine,a=o.dispatch,c=(yield i.getWallet(e)).accounts,u=yield i.getAccounts(c,t);return r||a((0,le.updateAccounts)(u)),u}}));return function(t,r){return e.apply(this,arguments)}}(),n.autoChangeAccount=function(){var e=(0,z.default)((function*(e){var t=e.walletId,r=e.shouldUpdateWallets,n=e.skipIfSameWallet,o=this.backgroundApi,i=o.dispatch,a=o.engine,c=o.serviceAccount,u=o.appSelector,s=o.serviceNetwork;if(t){var d=yield a.getWallet(t);r&&i((0,le.updateWallet)(d));var p=u((function(e){return e.general.activeNetworkId})),l=u((function(e){return e.general.activeAccountId})),f=u((function(e){return e.runtime.networks}));if(null!=f&&f.length){var y=null;if(d&&p&&d.accounts.length>0)if((0,oe.isAllNetworks)(p)&&(0,ie.isWalletCompatibleAllNetworks)(d.id)){if(!y){var h=Object.keys(u((function(e){var t;return null!=(t=e.overview.allNetworksAccountsMap)?t:{}}))).filter((function(e){return e.startsWith(t)}));y=null==h?void 0:h[0]}}else{var v,g,k,w,b=p;if((0,oe.isAllNetworks)(b))(b=null!=(k=null==(w=f.find((function(e){return e.enabled})))?void 0:w.id)?k:p)&&(yield s.changeActiveNetwork(b));var m=yield a.getAccounts(d.accounts,b);if(y=null!=(v=null==m||null==(g=m[0])?void 0:g.id)?v:null,n&&m.find((function(e){return e.id===l})))return}yield c.changeActiveAccount({accountId:y,walletId:t})}}}));return function(t){return e.apply(this,arguments)}}(),n.notifyAccountsChanged=function(){var e=(0,z.default)((function*(){var e=this;yield this.backgroundApi.walletConnect.notifySessionChanged(),yield(0,ve.wait)(600),Object.values(this.backgroundApi.providers).forEach((function(t){t.notifyDappAccountsChanged({send:e.backgroundApi.sendForProvider(t.providerName)})})),yield(0,ve.wait)(100),Ae.appEventBus.emit(Ae.AppEventBusNames.AccountChanged)}));return function(){return e.apply(this,arguments)}}(),n.initCheckingWallet=function(e){var t=(0,this.backgroundApi.appSelector)((function(e){return e.general.activeWalletId})),r=e.some((function(e){return e.id===t}));if(!t||!r){var n,o,i,a,c=null!=(n=e.find((function(e){return e.accounts.length>0})))?n:null,u=null!=(o=e.find((function(e){return["hw","hd"].includes(e.type)})))?o:null;return null!=(i=null!=(a=null==c?void 0:c.id)?a:null==u?void 0:u.id)?i:null}return t},n.autoChangeWallet=function(){var e=(0,z.default)((function*(){var e,t,r,n=this,o=this.backgroundApi,i=o.engine,a=o.appSelector,c=o.serviceNetwork,u=yield this.initWallets(),s=a((function(e){return e.runtime})).networks,d=a((function(e){return e.general})).activeNetworkId;if(d&&s.length){var p=function*(e){var t,r;if((0,oe.isAllNetworks)(d)&&(0,ie.isWalletCompatibleAllNetworks)(e.id))t=Object.keys(null!=(r=a((function(e){return e.overview.allNetworksAccountsMap})))?r:{}).find((function(t){return e.id&&t.startsWith(e.id)}));else if(e.accounts.length>0){var o,u,p=d;if((0,oe.isAllNetworks)(p))p=null!=(o=null==(u=s.find((function(e){return e.enabled})))?void 0:u.id)?o:d,yield c.changeActiveNetwork(p);var l=yield i.getAccounts(e.accounts,p),f=(0,$.default)(l,1)[0];f&&(t=f.id)}if(t)return n.changeActiveAccount({walletId:e.id,accountId:t}),{v:void 0}};for(var l of u){var f=yield*p(l);if("object"===typeof f)return f.v}var y=null!=(e=null!=(t=null!=(r=u.find((function(e){return e.accounts.length>0})))?r:u.find((function(e){return["hw","hd"].includes(e.type)})))?t:u.find((function(e){return["imported","watching"].includes(e.type)})))?e:{id:null,accounts:[]},h=y.id,v=y.accounts;h&&v&&v.length?this.changeActiveAccount({accountId:null,walletId:h}):this.changeActiveAccount({accountId:null,walletId:null})}}));return function(){return e.apply(this,arguments)}}(),n.createHDWallet=function(){var e=(0,z.default)((function*(e){var t=this,r=e.password,n=e.mnemonic,o=e.avatar,i=e.dispatchActionDelay,a=e.postCreatedDelay,c=e.isAutoAddAllNetworkAccounts,u=this.backgroundApi,s=u.dispatch,d=u.engine,p=u.appSelector,l=u.serviceAccount;Pe.default.mark({name:Pe.ETimelinePerfNames.createHDWallet,title:"serviceAccount.createHDWallet >> start"});var f=(0,ce.getActiveWalletAccount)().networkId;(0,Ie.startTrace)("engine.createHDWallet");var y=yield d.createHDWallet({password:r,mnemonic:n,avatar:null!=o?o:(0,Te.randomAvatar)(),autoAddAccountNetworkId:f,isAutoAddAllNetworkAccounts:c});(0,Ie.stopTrace)("engine.createHDWallet"),Pe.default.mark({name:Pe.ETimelinePerfNames.createHDWallet,title:"serviceAccount.createHDWallet >> engine done"});var h=p((function(e){return e.data})),v=p((function(e){return e.status})),g=[];v.boardingCompleted||g.push((0,ye.setBoardingCompleted)()),h.isPasswordSet||(g.push((0,se.passwordSet)()),g.push((0,fe.setEnableAppLock)(!0))),g.push((0,ye.unlock)()),g.push((0,se.release)());var k=yield l.initWallets({noDispatch:!0});return g.push((0,le.updateWallets)(k)),Pe.default.mark({name:Pe.ETimelinePerfNames.createHDWallet,title:"serviceAccount.createHDWallet >> initWallets DONE"}),i?setTimeout((function(){return s.apply(void 0,g)}),i):s.apply(void 0,g),a?setTimeout((function(){t.postHDWalletCreated({wallet:y,password:r})}),a):this.postHDWalletCreated({wallet:y,password:r}),Pe.default.mark({name:Pe.ETimelinePerfNames.createHDWallet,title:"serviceAccount.createHDWallet >> end"}),y}));return function(t){return e.apply(this,arguments)}}(),n.postHDWalletCreated=function(e){var t=e.wallet,r=e.password,n=this.backgroundApi,o=n.serviceAccount,i=n.serviceApp,a=n.servicePassword,c=n.serviceCloudBackup;o.autoChangeAccount({walletId:t.id}),(0,z.default)((function*(){(yield i.verifyPassword(r))&&a.savePassword(r)}))(),c.requestBackup()},n.addHDAccounts=function(){var e=(0,z.default)((function*(e,t,r,n,o,i){var a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7?arguments[7]:void 0,u=arguments.length>8?arguments[8]:void 0,s=this.backgroundApi.engine,d=yield s.addHdOrHwAccounts({password:e,walletId:t,networkId:r,indexes:n,names:o,purpose:i,skipRepeat:a,template:c,skipCheckAccountExist:u});if(d.length){var p=d[0],l="hd";return(0,me.isHardwareWallet)({walletId:t})&&(l="hw"),yield this.postAccountAdded({networkId:r,account:p,walletType:l,walletId:t,checkOnBoarding:!1,checkPasswordSet:!1,shouldBackup:!0,password:e}),d}}));return function(t,r,n,o,i,a){return e.apply(this,arguments)}}(),n.addImportedAccount=function(){var e=(0,z.default)((function*(e,t,r,n,o){var i=this.backgroundApi.engine,a=yield i.addImportedAccount(e,t,r,n,o);return yield this.postAccountAdded({networkId:t,account:a,walletType:"imported",checkOnBoarding:!0,checkPasswordSet:!0,shouldBackup:!0,password:e}),a}));return function(t,r,n,o,i){return e.apply(this,arguments)}}(),n.changeActiveAccountByAddress=function(){var e=(0,z.default)((function*(e){var t=e.address,r=e.networkId;try{var n=this.backgroundApi,o=n.appSelector,i=n.serviceNetwork,a=yield this.getDBAccountByAddress({address:t,networkId:r});if(a){var c=o((function(e){return e.runtime})),u=c.wallets,s=c.networks,d=u.find((function(e){return e.accounts.includes(a.id)})),p=s.find((function(e){return(0,ne.isAccountCompatibleWithNetwork)(a.id,e.id)}));if(d&&a&&p)return yield i.changeActiveNetwork(p.id),yield this.changeActiveAccount({accountId:a.id,walletId:d.id}),{wallet:d,account:a,network:p}}}catch(l){return}}));return function(t){return e.apply(this,arguments)}}(),n.getDBAccountByAddress=function(){var e=(0,z.default)((function*(e){var t=e.address,r=e.networkId,n=r?(0,oe.getCoinTypeFromNetworkId)(r):"",o=this.backgroundApi.engine;return yield o.dbApi.getAccountByAddress({address:t,coinType:Array.isArray(n)?"":n})}));return function(t){return e.apply(this,arguments)}}(),n.autoAddFirstHdOrHwAccount=function(){var e=(0,z.default)((function*(e){var t=e.wallet,r=e.networkId,n=this.backgroundApi,o=n.engine,i=n.servicePassword,a=yield i.getPassword();if(a&&r&&t.id&&"hd"===t.type)try{var c=yield o.getWalletOnlyVault(r,t.id);if(!(yield c.canAutoCreateNextAccount(a)))return;if((yield o.getAccounts(t.accounts,r)).length)return;var u=(yield o.addHdOrHwAccounts({password:a,walletId:t.id,networkId:r,indexes:[0],isAddInitFirstAccountOnly:!0}))[0];yield this.postAccountAdded({networkId:r,account:u,walletType:t.type,walletId:t.id,checkOnBoarding:!1,checkPasswordSet:!1,shouldBackup:!1,password:a})}catch(s){console.error(s)}}));return function(t){return e.apply(this,arguments)}}(),n.addTemporaryWatchAccount=function(){var e=(0,z.default)((function*(e){var t,r=e.address,n=this.backgroundApi.engine,o=(0,ce.getActiveWalletAccount)().watchingWallet,i=null==o||null==(t=o.nextAccountIds)?void 0:t.global,a=i?`Account #${i}`:"",c=we.OnekeyNetwork.eth,u=yield n.addWatchingOrExternalAccount({networkId:c,address:r,name:a,walletType:"watching",checkExists:!0});return yield this.postAccountAdded({networkId:c,account:u,walletType:"watching",checkOnBoarding:!1,checkPasswordSet:!1,shouldBackup:!1}),u}));return function(t){return e.apply(this,arguments)}}(),n.addWatchAccount=function(){var e=(0,z.default)((function*(e,t,r,n){var o=this.backgroundApi.engine,i=yield o.addWatchingOrExternalAccount({networkId:e,address:t,name:r,walletType:"watching",template:n});return yield this.postAccountAdded({networkId:e,account:i,walletType:"watching",checkOnBoarding:!0,checkPasswordSet:!1,shouldBackup:!0}),i}));return function(t,r,n,o){return e.apply(this,arguments)}}(),n.addExternalAccount=function(){var e=(0,z.default)((function*(e){var t=e.impl,r=e.chainId,n=e.address,o=e.name,i=(0,oe.generateNetworkIdByChainId)({impl:t,chainId:r}),a=(0,ue.getManageNetworks)(void 0).enabledNetworks;Boolean(a.find((function(e){return e.id===i})))||(i=we.OnekeyNetwork.eth);var c=this.backgroundApi.engine;if(!o){var u,s=yield c.getExternalWallet(),d=null==s||null==(u=s.nextAccountIds)?void 0:u.global;o=d?`External #${d}`:""}var p=yield c.addWatchingOrExternalAccount({networkId:i,address:n,name:o,walletType:"external",checkExists:!0});return yield this.postAccountAdded({networkId:i,account:p,walletType:"external",checkOnBoarding:!0,checkPasswordSet:!1,shouldBackup:!1}),{account:p,networkId:i}}));return function(t){return e.apply(this,arguments)}}(),n.postAccountAdded=function(){var e=(0,z.default)((function*(e){var t,r=e.networkId,n=e.account,o=e.walletType,i=e.walletId,a=e.checkOnBoarding,c=e.checkPasswordSet,u=e.shouldBackup,s=e.password,d=this.backgroundApi,p=d.dispatch,l=d.serviceApp,f=d.servicePassword,y=d.serviceAccount,h=d.appSelector,v=d.serviceCloudBackup,g=d.serviceAllNetwork,k=[];a&&(h((function(e){return e.status})).boardingCompleted||k.push((0,ye.setBoardingCompleted)()));c&&(h((function(e){return e.data})).isPasswordSet||(k.push((0,se.passwordSet)()),k.push((0,fe.setEnableAppLock)(!0))));(a||c)&&(k.push((0,ye.unlock)()),k.push((0,se.release)()));var w,b=yield y.initWallets({noDispatch:!0});if(k.push((0,le.updateWallets)(b)),w=i?b.find((function(e){return e.id===i})):b.find((function(e){return e.type===o}))){var m=yield y.reloadAccountsByWalletIdNetworkId(null==(t=w)?void 0:t.id,r,{noDispatch:!0});if(m&&k.push((0,le.updateAccounts)(m)),u&&v.requestBackup(),s)(yield l.verifyPassword(s))&&(yield f.savePassword(s));p.apply(void 0,k.concat([(0,de.setActiveIds)({activeAccountId:n.id,activeWalletId:w.id,activeNetworkId:r})])),yield g.onAccountChanged({account:n,networkId:r}),this.backgroundApi.serviceNetwork.notifyChainChanged(),this.backgroundApi.serviceAccount.notifyAccountsChanged()}else p.apply(void 0,k)}));return function(t){return e.apply(this,arguments)}}(),n.createHwSingleWallet=function(){var e=(0,z.default)((function*(e){var t,r=e.existDeviceId,n=e.networkId,o=e.wallets,i=e.features,a=e.avatar,c=e.connectId,u=e.passphraseState,s=this.backgroundApi,d=s.engine,p=s.serviceAccount,l=null,f=null,y=null;if(r&&(y=o.find((function(e){return!(e.associatedDevice!==r||e.passphraseState!==u)&&!e.accounts.length}))),u)if(r){var h=(yield d.getWallets({includeAllPassphraseWallet:!0})).filter((function(e){return e.associatedDevice===r&&e.passphraseState})).length;if(h>=re.HW_PASSPHRASE_WALLET_MAX_NUM)throw new te.TooManyHWPassphraseWallets(re.HW_PASSPHRASE_WALLET_MAX_NUM);t=`Hidden Wallet #${h+1}`}else t="Hidden Wallet #1";if(y)l=y;else try{l=yield d.createHWWallet({name:t,avatar:null!=a?a:(0,Te.randomAvatar)(),features:i,connectId:c,passphraseState:u})}catch(O){var v=O||{},g=v.className,k=v.data;if(g===te.OneKeyErrorClassNames.OneKeyAlreadyExistWalletError){var w=(k||{}).walletId;p.initWallets(),p.autoChangeAccount({walletId:null!=w?w:null})}throw O}var b=yield d.getAccounts(l.accounts,n);if("undefined"===typeof(f=(0,$.default)(b,1)[0])&&n)try{var m=yield d.addHdOrHwAccounts({password:"Undefined",walletId:l.id,networkId:n});if(m.length>0)f=m[0]}catch(I){var A=yield d.getAccounts(l.accounts);f=(0,$.default)(A,1)[0]}return{wallet:l,accountId:f.id}}));return function(t){return e.apply(this,arguments)}}(),n.createHWWallet=function(){var e=(0,z.default)((function*(e){var t,r,n,o,i,a,c,u,s,d=e.features,p=e.avatar,l=e.connectId,f=e.onlyPassphrase,y=this.backgroundApi,h=y.dispatch,v=y.engine,g=y.serviceAccount,k=y.serviceHardware,w=y.appSelector,b=yield v.getHWDevices(),m=w((function(e){return e.general.activeNetworkId}))||"",A=yield v.dbApi.getWallets({includeAllPassphraseWallet:!0}),O=(0,ge.getNetworkIdImpl)(m),I=null==(t=b.find((function(e){return(0,Se.equalsIgnoreCase)(e.mac,l)&&(0,Se.equalsIgnoreCase)(e.deviceId,d.device_id)})))?void 0:t.id,P=O===be.IMPL_ADA,T=yield k.getPassphraseState(l,void 0,P);if(f&&!T)throw new he.DeviceNotOpenedPassphrase({connectId:l,deviceId:null!=(u=d.device_id)?u:void 0});I&&(s=A.find((function(e){return!(e.associatedDevice!==I||(0,me.isPassphraseWallet)(e))})));var S=null;s||(S=yield this.createHwSingleWallet({existDeviceId:I,networkId:m,wallets:A,features:d,avatar:p,connectId:l,passphraseState:void 0}));var D=[];if(T){var M,C=!1,N=!1;try{var R,j;S=yield this.createHwSingleWallet({existDeviceId:I,networkId:m,wallets:A,features:d,avatar:p,connectId:l,passphraseState:T}),C=!0,M=null==(R=S)||null==(j=R.wallet)?void 0:j.id}catch(W){var E=W||{},x=E.className,_=E.data;if(x===te.OneKeyErrorClassNames.OneKeyAlreadyExistWalletError)C=!0,M=(_||{}).walletId;throw N=!0,W}finally{if(C){var B=w((function(e){return e.hardware.pendingRememberWalletConnectId}));(0,Se.equalsIgnoreCase)(B,l)&&(M&&D.push((0,fe.rememberPassphraseWallet)(M)),D.push((0,pe.setPendingRememberWalletConnectId)(void 0))),D.length>2?Oe.default.common.warn("+++ Need to review the code, there may be an error here +++"):N&&h.apply(void 0,D)}}}else if(!T&&s){var F;throw g.autoChangeAccount({walletId:null!=(F=s.id)?F:null}),new te.OneKeyAlreadyExistWalletError(s.id,s.name)}return w((function(e){return e.status})).boardingCompleted||D.push((0,ye.setBoardingCompleted)()),h.apply(void 0,D.concat([(0,ye.unlock)(),(0,se.release)()])),yield this.initWallets(),g.changeActiveAccount({walletId:null!=(r=null==(n=S)||null==(o=n.wallet)?void 0:o.id)?r:null,accountId:null!=(i=null==(a=S)?void 0:a.accountId)?i:null}),null==(c=S)?void 0:c.wallet}));return function(t){return e.apply(this,arguments)}}(),n.initCheckingAccount=function(e){if(!e)return null;var t,r,n=(0,this.backgroundApi.appSelector)((function(e){return e.general.activeAccountId})),o=e.some((function(e){return e.id===n}));return n&&o?n:null!=(t=null==(r=e[0])?void 0:r.id)?t:null},n.removeWalletAndDevice=function(){var e=(0,z.default)((function*(e,t){var r=this;Pe.default.mark({name:Pe.ETimelinePerfNames.removeWallet,title:"ServiceAccount.removeWalletAndDevice >> start"});var n=this.backgroundApi,o=n.engine,i=(0,n.appSelector)((function(e){return e.general.activeWalletId})),a=new Set,c=new Set,u=yield o.getWalletByDeviceId(t);if(u)for(var s of u){(yield o.getAccounts(s.accounts)).forEach((function(e){return a.add(e)})),c.add(s.id),yield o.removeWallet(s.id,""),Pe.default.mark({name:Pe.ETimelinePerfNames.removeWallet,title:`ServiceAccount.removeWalletAndDevice >> engine.removeWallet  ${s.id}`})}Pe.default.mark({name:Pe.ETimelinePerfNames.removeWallet,title:"ServiceAccount.removeWalletAndDevice >> engine.removeWallet  DONE"}),setTimeout((function(){return r.postWalletRemoved({accounts:(0,G.default)(a),activeWalletId:i,removedWalletId:(0,G.default)(c)})}),600),Pe.default.mark({name:Pe.ETimelinePerfNames.removeWallet,title:"ServiceAccount.removeWalletAndDevice >> end"})}));return function(t,r){return e.apply(this,arguments)}}(),n.removeWallet=function(){var e=(0,z.default)((function*(e,t){var r=this;Pe.default.mark({name:Pe.ETimelinePerfNames.removeWallet,title:"ServiceAccount.removeWallet >> start"});var n=this.backgroundApi,o=n.appSelector,i=n.engine,a=o((function(e){return e.general.activeWalletId})),c=yield i.getWallet(e),u=yield i.getAccounts(c.accounts);Pe.default.mark({name:Pe.ETimelinePerfNames.removeWallet,title:"ServiceAccount.removeWallet >> engine.getAccounts  DONE"}),yield i.removeWallet(e,null!=t?t:""),yield i.dbApi.removeAccountDerivationByWalletId({walletId:e}),Pe.default.mark({name:Pe.ETimelinePerfNames.removeWallet,title:"ServiceAccount.removeWallet >> engine.removeWallet  DONE"}),setTimeout((function(){return r.postWalletRemoved({accounts:u,activeWalletId:a,removedWalletId:[e]})}),600),Pe.default.mark({name:Pe.ETimelinePerfNames.removeWallet,title:"ServiceAccount.removeWallet >> end"})}));return function(t,r){return e.apply(this,arguments)}}(),n.postWalletRemoved=function(){var e=(0,z.default)((function*(e){var t=e.accounts,r=e.activeWalletId,n=e.removedWalletId,o=this.backgroundApi,i=o.serviceNotification,a=o.dispatch,c=o.serviceCloudBackup,u=o.serviceAllNetwork;Pe.default.mark({name:Pe.ETimelinePerfNames.postWalletRemoved,title:"ServiceAccount.postWalletRemoved >> start =================== "}),r&&n.includes(r)?(yield this.autoChangeWallet(),Pe.default.mark({name:Pe.ETimelinePerfNames.postWalletRemoved,title:"ServiceAccount.postWalletRemoved >> autoChangeWallet DONE"})):(yield this.initWallets(),Pe.default.mark({name:Pe.ETimelinePerfNames.postWalletRemoved,title:"ServiceAccount.postWalletRemoved >> initWallets DONE"})),u.onWalletRemoved({walletIds:n}),i.removeAccountDynamicBatch({addressList:t.filter((function(e){return e.coinType===be.COINTYPE_ETH})).map((function(e){return e.address}))}),Pe.default.mark({name:Pe.ETimelinePerfNames.postWalletRemoved,title:"ServiceAccount.postWalletRemoved >> removeAccountDynamicBatch DONE"});var s=!1;return n.forEach((function(e){if(!e.startsWith("hw"))return s=!0,!1})),s&&c.requestBackup(),Pe.default.mark({name:Pe.ETimelinePerfNames.postWalletRemoved,title:"ServiceAccount.postWalletRemoved >> requestBackup DONE"}),a((0,fe.setRefreshTS)(),(0,fe.forgetPassphraseWallet)(n)),yield(0,ve.wait)(10),Pe.default.mark({name:Pe.ETimelinePerfNames.postWalletRemoved,title:"ServiceAccount.postWalletRemoved >> end"}),null}));return function(t){return e.apply(this,arguments)}}(),n.removeAccount=function(){var e=(0,z.default)((function*(e,t,r,n){var o=this.backgroundApi,i=o.appSelector,a=o.engine,c=o.dispatch,u=o.serviceCloudBackup,s=o.serviceNotification,d=o.serviceAllNetwork,p=yield a.getAccount(t,n);p&&s.removeAccountDynamicBatch({addressList:[p.address]});var l=i((function(e){return e.general})).activeAccountId;yield a.removeAccount(t,null!=r?r:"",n),yield ee.default.walletConnect.removeAccount({accountId:t}),yield a.dbApi.removeAccountDerivationByAccountId({walletId:e,accountId:t});var f=[];if(l===t)yield this.autoChangeAccount({walletId:e,shouldUpdateWallets:!0});else{var y=yield a.getWallet(e);f.push((0,le.updateWallet)(y))}c.apply(void 0,f.concat([(0,fe.setRefreshTS)()])),e.startsWith("hw")||u.requestBackup(),p&&(yield d.onAccountChanged({account:p,networkId:n}))}));return function(t,r,n,o){return e.apply(this,arguments)}}(),n.getAddressLabel=function(){var e=(0,z.default)((function*(e){var t=this,r=e.address,n=e.networkId,o=this.backgroundApi.engine,i=(0,ce.getActiveWalletAccount)(),a=i.wallet,c=i.walletId,u=i.networkId,s=yield o.getWalletOnlyVault(null!=n?n:u,c),d=`${r}@${c||""}`;if(this.addressLabelCache[d])return Promise.resolve({label:this.addressLabelCache[d].label,accountId:this.addressLabelCache[d].accountId,walletId:this.addressLabelCache[d].walletId,address:r});var p=function(){var e=(0,z.default)((function*(e,i){for(var a,c,u,p,l,f,y,h=yield t.backgroundApi.engine.getAccounts(e,n),v=0;v<h.length&&K()(y);v+=1){var g=h[v];if((0,be.isLightningNetwork)(g.coinType)){var k=g.addresses&&g.addresses.length?JSON.parse(g.addresses):{};((null==k?void 0:k.hashAddress)||"").toLowerCase()===r.toLowerCase()&&(y=g)}if(g.type===ae.AccountType.VARIANT){var w=yield o.dbApi.getAccount(g.id);try{var b=yield s.addressFromBase(w);null!=b&&b.length&&(null==b?void 0:b.toLowerCase())===r.toLowerCase()&&(y=g)}catch(I){}}g.address.length&&g.address.toLowerCase()===r.toLowerCase()&&(y=g)}var m=null!=(a=null==(c=y)?void 0:c.name)?a:"",A=null!=(u=null==(p=y)?void 0:p.id)?u:"",O=null!=(l=null==(f=i.find((function(e){return e.accounts.includes(A)})))?void 0:f.id)?l:"";return m&&r&&O&&(t.addressLabelCache[d]={label:m,accountId:A,walletId:O}),{label:m,address:r,accountId:A,walletId:O}}));return function(t,r){return e.apply(this,arguments)}}();if(a&&a.accounts&&a.accounts.length){var l=yield p(a.accounts,[a]),f=l.label,y=l.accountId,h=l.walletId;if(f)return{label:f,address:r,accountId:y,walletId:h}}var v=yield this.backgroundApi.engine.getWallets({includeAllPassphraseWallet:!0}),g=V()(v.map((function(e){return e.accounts}))),k=yield p(g,v),w=k.label,b=k.accountId,m=k.walletId;return{label:w,address:r,accountId:b,walletId:m}}));return function(t){return e.apply(this,arguments)}}(),n.getAccountByAddress=function(){var e=(0,z.default)((function*(e){var t,r,n=e.address,o=e.networkId,i=this.backgroundApi,a=i.engine,c=i.appSelector,u=c((function(e){return e.general})),s=u.activeWalletId,d=u.activeNetworkId,p=u.activeAccountId,l=c((function(e){return e.runtime})),f=l.wallets,y=l.accounts,h=c((function(e){return e.overview.allNetworksAccountsMap})),v=function(e){var t=e.find((function(e){return e.address.toLowerCase()===n.toLowerCase()}));if(t)return o?(0,ne.isAccountCompatibleWithNetwork)(null==t?void 0:t.id,o)?t:void 0:t};if((0,oe.isAllNetworks)(d))return v(null!=(t=null==h||null==(r=h[null!=p?p:""])?void 0:r[null!=o?o:""])?t:[]);var g=v(y);if(g)return g;for(var k of f.filter((function(e){return e.id!==s}))){var w=v(yield a.getAccounts(k.accounts));if(w)return w}}));return function(t){return e.apply(this,arguments)}}(),n.getAccount=function(){var e=(0,z.default)((function*(e){var t=e.walletId,r=e.accountId,n=this.backgroundApi.engine,o=yield n.getWallet(t);return(yield n.getAccounts(o.accounts)).find((function(e){return e.id===r}))}));return function(t){return e.apply(this,arguments)}}(),n.changeActiveAccountByAccountId=function(){var e=(0,z.default)((function*(e){var t=(0,this.backgroundApi.appSelector)((function(e){return e.runtime})).wallets.find((function(t){return t.accounts.includes(e)}));if(t)return this.changeActiveAccount({accountId:e,walletId:t.id})}));return function(t){return e.apply(this,arguments)}}(),n.changeActiveExternalWalletName=function(){var e=(0,z.default)((function*(e){var t,r,n=this.backgroundApi,o=n.dispatch,i=n.appSelector,a=i((function(e){return e.general.activeWalletId})),c=i((function(e){return e.general.activeAccountId})),u=null;"external"===a&&e&&e===c&&(u=null==(r=(yield this.backgroundApi.serviceWalletConnect.getWalletConnectSessionOfAccount({accountId:e})).accountInfo)?void 0:r.walletName);o((0,de.changeActiveExternalWalletName)(null!=(t=u)?t:""))}));return function(t){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,z.default)((function*(e){var t=e.previousNetwork,r=e.newNetwork,n=e.activeAccountId;if(!t)return{shouldReloadAccountList:!1,shouldChangeActiveAccount:!1};var o=this.backgroundApi.engine;return(yield o.getChainOnlyVault(null==t?void 0:t.id)).shouldChangeAccountWhenNetworkChanged({previousNetwork:t,newNetwork:r,activeAccountId:n})}));return function(t){return e.apply(this,arguments)}}(),n.getAcccountAddressWithXpub=function(){var e=(0,z.default)((function*(e,t){var r=this.backgroundApi.engine,n=yield r.dbApi.getAccount(e),o=yield r.getVault({networkId:t,accountId:e});return n.type===ae.AccountType.UTXO?{xpub:yield o.getFetchBalanceAddress(n),address:n.address}:n.type===ae.AccountType.VARIANT?[we.OnekeyNetwork.lightning,we.OnekeyNetwork.tlightning].includes(t)?{address:yield o.getFetchBalanceAddress(n)}:{address:yield o.addressFromBase(n)}:{address:n.address}}));return function(t,r){return e.apply(this,arguments)}}(),n.getUserAccounts=function(){var e=(0,z.default)((function*(){var e=this.backgroundApi,t=e.engine,r=(0,e.appSelector)((function(e){return e.runtime.wallets}));return(yield t.getAccounts(r.map((function(e){return e.accounts})).flat())).map((function(e){return Ce(Ce({},L()(e,"address","coinType","id","name","path","type")),{},{walletType:(0,ne.getWalletTypeFromAccountId)(e.id)})})).filter((function(e){return!!e.address}))}));return function(){return e.apply(this,arguments)}}(),(0,J.default)(r)}(De.default),(0,Z.default)(F.prototype,"registerEvents",[o],Object.getOwnPropertyDescriptor(F.prototype,"registerEvents"),F.prototype),(0,Z.default)(F.prototype,"changeCurrrentAccount",[i],Object.getOwnPropertyDescriptor(F.prototype,"changeCurrrentAccount"),F.prototype),(0,Z.default)(F.prototype,"changeActiveAccount",[a],Object.getOwnPropertyDescriptor(F.prototype,"changeActiveAccount"),F.prototype),(0,Z.default)(F.prototype,"initWallets",[c],Object.getOwnPropertyDescriptor(F.prototype,"initWallets"),F.prototype),(0,Z.default)(F.prototype,"setAccountName",[u],Object.getOwnPropertyDescriptor(F.prototype,"setAccountName"),F.prototype),(0,Z.default)(F.prototype,"reloadAccountsByWalletIdNetworkId",[s],Object.getOwnPropertyDescriptor(F.prototype,"reloadAccountsByWalletIdNetworkId"),F.prototype),(0,Z.default)(F.prototype,"autoChangeAccount",[d],Object.getOwnPropertyDescriptor(F.prototype,"autoChangeAccount"),F.prototype),(0,Z.default)(F.prototype,"notifyAccountsChanged",[p],Object.getOwnPropertyDescriptor(F.prototype,"notifyAccountsChanged"),F.prototype),(0,Z.default)(F.prototype,"initCheckingWallet",[l],Object.getOwnPropertyDescriptor(F.prototype,"initCheckingWallet"),F.prototype),(0,Z.default)(F.prototype,"autoChangeWallet",[f],Object.getOwnPropertyDescriptor(F.prototype,"autoChangeWallet"),F.prototype),(0,Z.default)(F.prototype,"createHDWallet",[y],Object.getOwnPropertyDescriptor(F.prototype,"createHDWallet"),F.prototype),(0,Z.default)(F.prototype,"addHDAccounts",[h],Object.getOwnPropertyDescriptor(F.prototype,"addHDAccounts"),F.prototype),(0,Z.default)(F.prototype,"addImportedAccount",[v],Object.getOwnPropertyDescriptor(F.prototype,"addImportedAccount"),F.prototype),(0,Z.default)(F.prototype,"changeActiveAccountByAddress",[g],Object.getOwnPropertyDescriptor(F.prototype,"changeActiveAccountByAddress"),F.prototype),(0,Z.default)(F.prototype,"getDBAccountByAddress",[k],Object.getOwnPropertyDescriptor(F.prototype,"getDBAccountByAddress"),F.prototype),(0,Z.default)(F.prototype,"autoAddFirstHdOrHwAccount",[w],Object.getOwnPropertyDescriptor(F.prototype,"autoAddFirstHdOrHwAccount"),F.prototype),(0,Z.default)(F.prototype,"addTemporaryWatchAccount",[b],Object.getOwnPropertyDescriptor(F.prototype,"addTemporaryWatchAccount"),F.prototype),(0,Z.default)(F.prototype,"addWatchAccount",[m],Object.getOwnPropertyDescriptor(F.prototype,"addWatchAccount"),F.prototype),(0,Z.default)(F.prototype,"addExternalAccount",[A],Object.getOwnPropertyDescriptor(F.prototype,"addExternalAccount"),F.prototype),(0,Z.default)(F.prototype,"postAccountAdded",[O],Object.getOwnPropertyDescriptor(F.prototype,"postAccountAdded"),F.prototype),(0,Z.default)(F.prototype,"createHWWallet",[I],Object.getOwnPropertyDescriptor(F.prototype,"createHWWallet"),F.prototype),(0,Z.default)(F.prototype,"initCheckingAccount",[P],Object.getOwnPropertyDescriptor(F.prototype,"initCheckingAccount"),F.prototype),(0,Z.default)(F.prototype,"removeWalletAndDevice",[T],Object.getOwnPropertyDescriptor(F.prototype,"removeWalletAndDevice"),F.prototype),(0,Z.default)(F.prototype,"removeWallet",[S],Object.getOwnPropertyDescriptor(F.prototype,"removeWallet"),F.prototype),(0,Z.default)(F.prototype,"removeAccount",[D],Object.getOwnPropertyDescriptor(F.prototype,"removeAccount"),F.prototype),(0,Z.default)(F.prototype,"getAddressLabel",[M],Object.getOwnPropertyDescriptor(F.prototype,"getAddressLabel"),F.prototype),(0,Z.default)(F.prototype,"getAccountByAddress",[C],Object.getOwnPropertyDescriptor(F.prototype,"getAccountByAddress"),F.prototype),(0,Z.default)(F.prototype,"getAccount",[N],Object.getOwnPropertyDescriptor(F.prototype,"getAccount"),F.prototype),(0,Z.default)(F.prototype,"changeActiveAccountByAccountId",[R],Object.getOwnPropertyDescriptor(F.prototype,"changeActiveAccountByAccountId"),F.prototype),(0,Z.default)(F.prototype,"changeActiveExternalWalletName",[j],Object.getOwnPropertyDescriptor(F.prototype,"changeActiveExternalWalletName"),F.prototype),(0,Z.default)(F.prototype,"shouldChangeAccountWhenNetworkChanged",[E],Object.getOwnPropertyDescriptor(F.prototype,"shouldChangeAccountWhenNetworkChanged"),F.prototype),(0,Z.default)(F.prototype,"getAcccountAddressWithXpub",[x],Object.getOwnPropertyDescriptor(F.prototype,"getAcccountAddressWithXpub"),F.prototype),(0,Z.default)(F.prototype,"getUserAccounts",[_],Object.getOwnPropertyDescriptor(F.prototype,"getUserAccounts"),F.prototype),B=F))||B)},183827:(e,t,r)=>{r.r(t),r.d(t,{default:()=>U});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b=r(634795),m=r(254073),A=r.n(m),O=r(887371),I=r(545754),P=r(411987),T=r(695058),S=r(859375),D=r(534756),M=r(381815),C=r(97856),N=r(379573),R=r(776553),j=r(438760),E=r(292147),x=r(201882);function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,T.default)(e);if(t){var o=(0,T.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,P.default)(this,r)}}var B=N.default.actions,F=B.updateSelectedWalletId,W=B.updateSelectedNetworkId,L=B.updatePreloadingCreateAccount,U=(n=(0,j.backgroundClass)(),o=(0,j.bindThis)(),i=(0,j.backgroundMethod)(),a=(0,j.bindThis)(),c=(0,j.backgroundMethod)(),u=(0,j.bindThis)(),s=(0,j.backgroundMethod)(),d=(0,j.bindThis)(),p=(0,j.backgroundMethod)(),l=(0,j.bindThis)(),f=(0,j.backgroundMethod)(),y=(0,j.bindThis)(),h=(0,j.backgroundMethod)(),v=(0,j.bindThis)(),g=(0,j.backgroundMethod)(),n((w=function(e){(0,I.default)(r,e);var t=_(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n)))._refreshAccountsGroup=A()((0,b.default)((function*(){})),M.ACCOUNT_SELECTOR_REFRESH_DEBOUNCE,{leading:!1,trailing:!0}),e}var n=r.prototype;return n.setSelectedWalletToActive=function(){var e=(0,b.default)((function*(){var e=(0,C.getActiveWalletAccount)(),t=e.network,r=e.wallet;return E.default.accountSelector.info("ServiceAccountSelector.setSelectedWalletToActive >>>> ",null==r?void 0:r.id),this.updateSelectedWalletAndNetwork({walletId:null==r?void 0:r.id,networkId:null==t?void 0:t.id})}));return function(){return e.apply(this,arguments)}}(),n.updateSelectedWalletAndNetwork=function(){var e=(0,b.default)((function*(e){var t=e.walletId,r=e.networkId,n=this.backgroundApi.dispatch,o=[];t&&o.push(F(t||void 0)),r&&o.push(W(r||void 0)),o.length&&n.apply(void 0,o)}));return function(t){return e.apply(this,arguments)}}(),n.updateSelectedWallet=function(){var e=(0,b.default)((function*(e){return E.default.accountSelector.info("ServiceAccountSelector.updateSelectedWallet >>>> ",e),this.updateSelectedWalletAndNetwork({walletId:e})}));return function(t){return e.apply(this,arguments)}}(),n.updateSelectedNetwork=function(){var e=(0,b.default)((function*(e){return this.updateSelectedWalletAndNetwork({networkId:e})}));return function(t){return e.apply(this,arguments)}}(),n.getAccountsByGroup=function(){var e=(0,b.default)((function*(){var e,t=this.backgroundApi,r=t.appSelector,n=t.engine;E.default.accountSelector.info("calling getAccountsByGroup");var o=[],i=r((function(e){return e.accountSelector})),a=i.networkId,c=i.walletId;if(!c)return o;var u=a,s=c,d=null,p=null;u&&(d=yield n.getNetwork(u)),s&&(p=yield n.getWallet(s));var l=((null==(e=p)?void 0:e.accounts)||[]).filter((function(e){return!u||(0,D.isAccountCompatibleWithNetwork)(e,u)})),f=yield n.getAccounts(l);d?f&&f.length&&(o=[{title:d,data:f}]):(0,C.getManageNetworks)(void 0).enabledNetworks.forEach((function(e){var t=f.filter((function(t){return(0,D.isAccountCompatibleWithNetwork)(t.id,e.id)}));t&&t.length&&o.push({title:e,data:t})}));return o}));return function(){return e.apply(this,arguments)}}(),n.refreshAccountsGroup=function(){var e=(0,b.default)((function*(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).delay}));return function(){return e.apply(this,arguments)}}(),n.preloadingCreateAccount=function(){var e=(0,b.default)((function*(e){var t=this.backgroundApi.dispatch,r=e.networkId,n=e.walletId;yield this.updateSelectedWallet(n),yield this.updateSelectedNetwork(r),t(L(e))}));return function(t){return e.apply(this,arguments)}}(),n.preloadingCreateAccountDone=function(){var e=(0,b.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.networkId,r=e.walletId,n=e.accountId,o=e.template,i=e.delay,a=void 0===i?600:i,c=this.backgroundApi.dispatch;r&&(yield this.updateSelectedWallet(r)),t&&(yield this.updateSelectedNetwork(t)),a>0&&c(L({networkId:t,walletId:r,accountId:n,template:o})),yield(0,R.wait)(a),c(L(void 0))}));return function(){return e.apply(this,arguments)}}(),(0,O.default)(r)}(x.default),(0,S.default)(w.prototype,"setSelectedWalletToActive",[o,i],Object.getOwnPropertyDescriptor(w.prototype,"setSelectedWalletToActive"),w.prototype),(0,S.default)(w.prototype,"updateSelectedWalletAndNetwork",[a,c],Object.getOwnPropertyDescriptor(w.prototype,"updateSelectedWalletAndNetwork"),w.prototype),(0,S.default)(w.prototype,"updateSelectedWallet",[u,s],Object.getOwnPropertyDescriptor(w.prototype,"updateSelectedWallet"),w.prototype),(0,S.default)(w.prototype,"updateSelectedNetwork",[d,p],Object.getOwnPropertyDescriptor(w.prototype,"updateSelectedNetwork"),w.prototype),(0,S.default)(w.prototype,"refreshAccountsGroup",[l,f],Object.getOwnPropertyDescriptor(w.prototype,"refreshAccountsGroup"),w.prototype),(0,S.default)(w.prototype,"preloadingCreateAccount",[y,h],Object.getOwnPropertyDescriptor(w.prototype,"preloadingCreateAccount"),w.prototype),(0,S.default)(w.prototype,"preloadingCreateAccountDone",[v,g],Object.getOwnPropertyDescriptor(w.prototype,"preloadingCreateAccountDone"),w.prototype),k=w))||k)},844900:(e,t,r)=>{r.r(t),r.d(t,{default:()=>v});var n,o,i,a,c=r(634795),u=r(887371),s=r(545754),d=r(411987),p=r(695058),l=r(859375),f=r(438760),y=r(201882);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var o=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}const v=(n=(0,f.backgroundClass)(),o=(0,f.backgroundMethod)(),n((a=function(e){(0,s.default)(r,e);var t=h(r);function r(){return t.apply(this,arguments)}return r.prototype.getItem=function(){var e=(0,c.default)((function*(e){var t=(0,this.backgroundApi.appSelector)((function(e){return e.contacts.contacts}));return Object.values(t).find((function(t){return t.address.toLowerCase()===e.address.toLowerCase()}))}));return function(t){return e.apply(this,arguments)}}(),(0,u.default)(r)}(y.default),(0,l.default)(a.prototype,"getItem",[o],Object.getOwnPropertyDescriptor(a.prototype,"getItem"),a.prototype),i=a))||i)},409325:(e,t,r)=>{r.r(t),r.d(t,{AllNetworksMaxAccounts:()=>z,default:()=>J});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w=r(256666),b=r(196234),m=r(634795),A=r(887371),O=r(545754),I=r(411987),P=r(695058),T=r(859375),S=r(992431),D=r(940915),M=r(534756),C=r(997293),N=r(849877),R=r(480513),j=r(645824),E=r(398145),x=r(266985),_=r(480601),B=r(490415),F=r(438760),W=r(771340),L=r(942013),U=r(613549),H=r(35116),V=r(292147),q=r(201882);function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(Object(r),!0).forEach((function(t){(0,w.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function G(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,P.default)(e);if(t){var o=(0,P.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,I.default)(this,r)}}var z=3,J=(n=(0,F.backgroundClass)(),o=(0,F.bindThis)(),i=(0,F.backgroundMethod)(),a=(0,F.backgroundMethod)(),c=(0,F.backgroundMethod)(),u=(0,F.backgroundMethod)(),s=(0,F.backgroundMethod)(),d=(0,F.backgroundMethod)(),p=(0,F.backgroundMethod)(),l=(0,F.backgroundMethod)(),f=(0,F.backgroundMethod)(),y=(0,F.backgroundMethod)(),h=(0,F.backgroundMethod)(),v=(0,F.backgroundMethod)(),n((k=function(e){(0,O.default)(r,e);var t=G(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.registerEvents=function(){var e=this;H.appEventBus.on(H.AppEventBusNames.NetworkChanged,(function(){e.reloadCurrentAccount()})),H.appEventBus.on(H.AppEventBusNames.AccountChanged,(function(){e.reloadCurrentAccount()})),this.reloadCurrentAccount()},n.switchWalletToCompatibleAllNetworks=function(){var e=(0,m.default)((function*(){var e=this.backgroundApi,t=e.appSelector,r=e.serviceAccountSelector,n=t((function(e){return e.accountSelector.walletId})),o=t((function(e){return e.runtime.wallets}));if(!(0,R.isWalletCompatibleAllNetworks)(n)){var i,a=null==(i=o.find((function(e){return(0,R.isWalletCompatibleAllNetworks)(e.id)})))?void 0:i.id;a&&(yield r.updateSelectedWallet(a),n=a)}return n}));return function(){return e.apply(this,arguments)}}(),n.getAccountIndex=function(e,t){var r,n=e.type===E.AccountType.UTXO&&!![L.OnekeyNetwork.btc,L.OnekeyNetwork.ltc,L.OnekeyNetwork.bch,L.OnekeyNetwork.doge,L.OnekeyNetwork.ada,L.OnekeyNetwork.nexa].find((function(t){return(0,M.isAccountCompatibleWithNetwork)(e.id,t)}))||(0,U.isLightningNetwork)(e.coinType)?new RegExp(`${U.INDEX_PLACEHOLDER.replace(/\$/g,"\\$")}.*$`):U.INDEX_PLACEHOLDER,o=(0,M.getWalletIdFromAccountId)(e.id),i=e.id.match(new RegExp(`${o}--${t}`.replace(n,"(\\d+)")));return Number.parseInt(null!=(r=null==i?void 0:i[1])?r:"")},n.getAllNetworkAccountIndex=function(){var e=(0,m.default)((function*(e){var t=e.walletId,r=this.backgroundApi.engine,n=-1,o=yield r.dbApi.getAccountDerivationByWalletId({walletId:t});for(var i of Object.entries(o)){var a,c=(0,b.default)(i,2),u=c[0],s=c[1];if(null!=s&&null!=(a=s.accounts)&&a.length){var d=yield r.getAccounts(s.accounts);for(var p of d){var l=this.getAccountIndex(p,u);Number.isNaN(l)||(n=Math.max(l,n))}}}return n}));return function(t){return e.apply(this,arguments)}}(),n.getAllNetworksFakeAccounts=function(){var e=(0,m.default)((function*(e){var t=e.walletId,r=(0,this.backgroundApi.appSelector)((function(e){return e.overview.allNetworksAccountsMap})),n=Object.keys(null!=r?r:{}).filter((function(e){return e.startsWith(t)})).map((function(e){return(0,M.generateFakeAllnetworksAccount)({accountId:e})})).sort((function(e,t){return e.index-t.index})).slice(0,z);return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),n.compareAccountPath=function(e){var t,r=e.path,n=e.template,o=e.impl,i=e.accountIndex;if(!n||"number"!==typeof i)return!1;if([U.IMPL_EVM,U.IMPL_SOL].includes(o))t=n.replace(U.INDEX_PLACEHOLDER,i.toString());else{var a=n.split("/").slice(1).map((function(e){return e.replace("'","")})),c=(0,b.default)(a,2),u=c[0],s=c[1];t=(0,C.getPath)(u,s,i)}return t===r},n.generateAllNetworksWalletAccounts=function(){var e=(0,m.default)((function*(e){var t,r=this,n=e.accountIndex,o=e.walletId,i=this.backgroundApi,a=i.engine,c=i.appSelector,u=i.dispatch,s=n;if("number"!==typeof s||Number.isNaN(s))return{};var d=`${o}--${s}`,p=null!=(t=c((function(e){var t;return null==(t=e.overview.allNetworksAccountsMap)?void 0:t[d]})))?t:{},l={};if(!(0,R.isWalletCompatibleAllNetworks)(o))return{};var f=yield a.getWallet(o);if(!f)return{};var y=c((function(e){var t;return null!=(t=e.runtime.networks)?t:[]})).filter((function(e){var t;return e.enabled&&!e.isTestnet&&!(null!=(t=e.settings)&&t.validationRequired)&&!e.settings.hideInAllNetworksMode&&(0,j.networkIsPreset)(e.id)&&p[e.id]&&![L.OnekeyNetwork.fevm,L.OnekeyNetwork.cfxespace].includes(e.id)})),h=function*(e){var t=(yield a.getAccounts(f.accounts,e.id)).filter((function(t){return!!t.template&&r.compareAccountPath({path:t.path,template:t.template,impl:e.impl,accountIndex:s})}));l[e.id]=t,null!=t&&t.length||delete l[e.id]};for(var v of y)yield*h(v);return u((0,x.setAllNetworksAccountsMap)({accountId:d,data:l})),l}));return function(t){return e.apply(this,arguments)}}(),n.createAllNetworksFakeAccount=function(){var e=(0,m.default)((function*(e){var t=e.walletId,r=this.backgroundApi,n=r.appSelector,o=r.serviceAccount,i=r.dispatch,a=yield this.getAllNetworkAccountIndex({walletId:t});if(-1===a)throw new D.AllNetworksMinAccountsError("",{0:1});var c=n((function(e){return e.overview.allNetworksAccountsMap}));if(Object.keys(null!=c?c:{}).filter((function(e){return e.startsWith(t)})).length>=z)throw new D.AllNetworksUpto3LimitsError("",{0:z});for(var u=0;u<Math.min(a,2)&&"undefined"!==typeof(null==c?void 0:c[`${t}--${u}`]);u+=1);var s=`${t}--${u}`;if(null!=c&&c[s])throw new D.AllNetworksMinAccountsError("",{0:u+2});i((0,x.setAllNetworksAccountsMap)({accountId:s,data:null})),V.default.allNetworks.info("[createAllNetworksFakeAccount] ",s),yield o.autoChangeAccount({walletId:t})}));return function(t){return e.apply(this,arguments)}}(),n.deleteAllNetworksFakeAccount=function(){var e=(0,m.default)((function*(e){var t=e.accountId,r=this.backgroundApi,n=r.dispatch,o=r.serviceAccount;return V.default.allNetworks.info("[deleteAllNetworksFakeAccount] ",t),n((0,x.removeAllNetworksAccountsMapByAccountId)({accountId:t})),yield o.autoChangeAccount({walletId:(0,M.getWalletIdFromAccountId)(t)}),Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),n.getSelectableNetworkAccounts=function(){var e=(0,m.default)((function*(e){var t,r=this,n=e.accountId,o=this.backgroundApi,i=o.appSelector,a=o.engine,c=o.dispatch;if(n){var u,s=n.match(M.allNetworksAccountRegex);if(s&&(u=Number.parseInt(s[1])),"number"===typeof u&&!Number.isNaN(u)){var d=(0,M.getWalletIdFromAccountId)(n),p=yield a.getWallet(d);if(p){var l=null!=(t=i((function(e){var t;return null!=(t=e.overview.allNetworksAccountsMap)?t:{}}))[n])?t:{},f=i((function(e){var t;return null!=(t=e.runtime.networks)?t:[]})).filter((function(e){var t;return e.enabled&&!e.isTestnet&&!(null!=(t=e.settings)&&t.validationRequired)&&!e.settings.hideInAllNetworksMode&&(0,j.networkIsPreset)(e.id)&&!(0,N.isAllNetworks)(e.id)&&![L.OnekeyNetwork.fevm,L.OnekeyNetwork.cfxespace].includes(e.id)})),y=[],h=function*(e){var t,n=null==l?void 0:l[e.id];if(null!=(t=n)&&t.length)return y.push($($({},e),{},{selected:!0,accounts:n})),"continue";var o=(n=yield a.getAccounts(p.accounts,e.id)).filter((function(t){return!!t.template&&r.compareAccountPath({path:t.path,template:t.template,impl:e.impl,accountIndex:u})}));null!=o&&o.length&&y.push($($({},e),{},{selected:!1,accounts:o}))};for(var v of f)yield*h(v);var g=Object.keys(l).filter((function(e){return!f.find((function(t){return t.id===e}))}));return g.length&&(V.default.allNetworks.warn("[getSelectableNetworkAccounts] ",g.join(",")),c((0,x.removeMapNetworks)({accountId:n,networkIds:g}))),y}}}}));return function(t){return e.apply(this,arguments)}}(),n.reloadCurrentAccount=function(){var e=(0,m.default)((function*(){var e,t=this.backgroundApi,r=t.appSelector,n=t.serviceOverview,o=t.dispatch,i=r((function(e){return e.general})),a=i.activeNetworkId,c=i.activeAccountId;if(c&&a&&(0,N.isAllNetworks)(a)){var u=null!=(e=r((function(e){var t;return null==(t=e.overview.allNetworksAccountsMap)?void 0:t[c]})))?e:{},s=[(0,_.setOverviewAccountIsUpdating)({accountId:c,data:!0}),(0,x.clearOverviewPendingTasks)()];if(0===Object.keys(u).length){var d=`${W.FAKE_ALL_NETWORK.id}___${c}`,p=[B.EOverviewScanTaskType.token,B.EOverviewScanTaskType.nfts,B.EOverviewScanTaskType.defi];yield S.default.accountPortfolios.setAllNetworksPortfolio({key:d,scanTypes:p,data:{token:[],nfts:[],defi:[]}}),s.push((0,_.updateRefreshHomeOverviewTs)(p))}return o.apply(void 0,s),n.refreshCurrentAccount()}}));return function(){return e.apply(this,arguments)}}(),n.onNetworksDisabled=function(){var e=(0,m.default)((function*(e){var t=e.networkIds,r=this.backgroundApi.dispatch;return V.default.allNetworks.info("[onNetworksDisabled] ",t.join(",")),r((0,x.removeMapNetworks)({networkIds:t})),this.reloadCurrentAccount()}));return function(t){return e.apply(this,arguments)}}(),n.onAccountChanged=function(){var e=(0,m.default)((function*(e){var t,r=e.account,n=e.networkId,o=this.backgroundApi,i=o.dispatch,a=o.appSelector;if(a((function(e){return e.runtime.networks})).find((function(e){return e.id===n}))){var c=this.getAccountIndex(r,null!=(t=null==r?void 0:r.template)?t:"");if(c>=z||c<0||Number.isNaN(c))V.default.allNetworks.warn(`[onAccountChanged] invalid index networkId=${n}`,r);else{var u=(0,M.getWalletIdFromAccountId)(null==r?void 0:r.id);if(a((function(e){var t;return null==(t=e.overview.allNetworksAccountsMap)?void 0:t[`${u}--${c}`]}))){var s=`${u}--${c}`,d=yield this.generateAllNetworksWalletAccounts({accountIndex:c,walletId:u});if(V.default.allNetworks.info("[onAccountChanged] generated map",d),i((0,x.setAllNetworksAccountsMap)({accountId:s,data:d})),s===a((function(e){return e.general.activeAccountId})))return this.reloadCurrentAccount()}}}else V.default.allNetworks.warn(`[onAccountChanged] network ${n} not found`)}));return function(t){return e.apply(this,arguments)}}(),n.onWalletRemoved=function(){var e=(0,m.default)((function*(e){var t=e.walletIds,r=this.backgroundApi.dispatch;V.default.allNetworks.info("[onWalletRemoved] ",t.join(",")),yield S.default.accountPortfolios.removeWalletData(t),r((0,x.removeWalletAccountsMap)({walletIds:t}))}));return function(t){return e.apply(this,arguments)}}(),n.updateAllNetworksAccountsMap=function(){var e=(0,m.default)((function*(e){var t=e.accountId,r=e.selectedNetworkAccounts;if(r)return(0,this.backgroundApi.dispatch)((0,x.setAllNetworksAccountsMap)({accountId:t,data:r.reduce((function(e,t){return e[t.id]=t.accounts,e}),{})})),this.reloadCurrentAccount()}));return function(t){return e.apply(this,arguments)}}(),(0,A.default)(r)}(q.default),(0,T.default)(k.prototype,"registerEvents",[o],Object.getOwnPropertyDescriptor(k.prototype,"registerEvents"),k.prototype),(0,T.default)(k.prototype,"switchWalletToCompatibleAllNetworks",[i],Object.getOwnPropertyDescriptor(k.prototype,"switchWalletToCompatibleAllNetworks"),k.prototype),(0,T.default)(k.prototype,"getAllNetworkAccountIndex",[a],Object.getOwnPropertyDescriptor(k.prototype,"getAllNetworkAccountIndex"),k.prototype),(0,T.default)(k.prototype,"getAllNetworksFakeAccounts",[c],Object.getOwnPropertyDescriptor(k.prototype,"getAllNetworksFakeAccounts"),k.prototype),(0,T.default)(k.prototype,"generateAllNetworksWalletAccounts",[u],Object.getOwnPropertyDescriptor(k.prototype,"generateAllNetworksWalletAccounts"),k.prototype),(0,T.default)(k.prototype,"createAllNetworksFakeAccount",[s],Object.getOwnPropertyDescriptor(k.prototype,"createAllNetworksFakeAccount"),k.prototype),(0,T.default)(k.prototype,"deleteAllNetworksFakeAccount",[d],Object.getOwnPropertyDescriptor(k.prototype,"deleteAllNetworksFakeAccount"),k.prototype),(0,T.default)(k.prototype,"getSelectableNetworkAccounts",[p],Object.getOwnPropertyDescriptor(k.prototype,"getSelectableNetworkAccounts"),k.prototype),(0,T.default)(k.prototype,"reloadCurrentAccount",[l],Object.getOwnPropertyDescriptor(k.prototype,"reloadCurrentAccount"),k.prototype),(0,T.default)(k.prototype,"onNetworksDisabled",[f],Object.getOwnPropertyDescriptor(k.prototype,"onNetworksDisabled"),k.prototype),(0,T.default)(k.prototype,"onAccountChanged",[y],Object.getOwnPropertyDescriptor(k.prototype,"onAccountChanged"),k.prototype),(0,T.default)(k.prototype,"onWalletRemoved",[h],Object.getOwnPropertyDescriptor(k.prototype,"onWalletRemoved"),k.prototype),(0,T.default)(k.prototype,"updateAllNetworksAccountsMap",[v],Object.getOwnPropertyDescriptor(k.prototype,"updateAllNetworksAccountsMap"),k.prototype),g=k))||g)},951375:(e,t,r)=>{r.r(t),r.d(t,{default:()=>re});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A,O,I,P,T,S,D=r(634795),M=r(887371),C=r(545754),N=r(411987),R=r(695058),j=r(859375),E=r(341290),x=(r(935255),r(992431)),_=r(112889),B=(r(481047),r(633416)),F=r(195212),W=r(62893),L=r(821919),U=r(830631),H=r(834298),V=r(776553),q=r(854341),K=r(358499),$=r(438760),G=r(402814),z=r(220033),J=r(35116),Q=(r(292147),r(213208)),X=r(465146),Y=r(892012),Z=r(201882);function ee(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,R.default)(e);if(t){var o=(0,R.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,N.default)(this,r)}}var te=E.default.NativeAppRestart;const re=(n=(0,$.backgroundClass)(),o=(0,$.backgroundMethod)(),i=(0,$.backgroundMethod)(),a=(0,$.backgroundMethod)(),c=(0,$.backgroundMethod)(),u=(0,$.backgroundMethod)(),s=(0,$.backgroundMethod)(),d=(0,$.backgroundMethod)(),p=(0,$.backgroundMethod)(),l=(0,$.backgroundMethod)(),f=(0,$.backgroundMethod)(),y=(0,$.backgroundMethod)(),h=(0,$.backgroundMethod)(),v=(0,$.backgroundMethod)(),g=(0,$.backgroundMethod)(),k=(0,$.backgroundMethod)(),w=(0,$.backgroundMethod)(),b=(0,$.backgroundMethod)(),m=(0,$.backgroundMethod)(),A=(0,$.backgroundMethod)(),O=(0,$.backgroundMethod)(),I=(0,$.backgroundMethod)(),P=(0,$.backgroundMethod)(),n((S=function(e){(0,C.default)(r,e);var t=ee(r);function r(e){var r;return(r=t.call(this,e))._appInited=!1,r.logger=[],r.resetAppAtTime=0,r.initAppAfterStoreReady(),Q.default.isExtensionBackground&&(r.autoOpenOnboardingIfExtensionInstalled(),r.interval=setInterval((function(){return r.checkLockStatus(1)}),6e4)),r}var n=r.prototype;return n.waitForAppInited=function(){var e=(0,D.default)((function*(e){var t=this,r=e.logName;yield(0,G.waitForDataLoaded)({logName:`waitForAppInited @ ${r}`,data:function(){return t.isAppInited},wait:300,timeout:(0,V.getTimeDurationMs)({minute:1})})}));return function(t){return e.apply(this,arguments)}}(),n.getLoggerInstance=function(){var e=(0,D.default)((function*(){return Promise.resolve(this.logger)}));return function(){return e.apply(this,arguments)}}(),n.addLogger=function(){var e=(0,D.default)((function*(e){return this.logger.length>=G.MAX_LOG_LENGTH&&this.logger.shift(),this.logger.push(e),Promise.resolve(!0)}));return function(t){return e.apply(this,arguments)}}(),n.checkLockStatus=function(){var e=(0,D.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.backgroundApi,r=t.appSelector,n=t.engine,o=r((function(e){return e.settings.enableAppLock})),i=r((function(e){return e.settings.appLockDuration})),a=yield x.default.lastActivity.getValue();(yield n.isMasterPasswordSet())&&o&&(Math.floor((Date.now()-a)/6e4)>=Math.min(240,i+e)&&(yield this.lock()))}));return function(){return e.apply(this,arguments)}}(),n.refreshLastActivity=function(){var e=(0,D.default)((function*(){return x.default.lastActivity.setValue(Date.now())}));return function(){return e.apply(this,arguments)}}(),n.isUnlock=function(){var e=this.backgroundApi.appSelector,t=e((function(e){return e.data.isUnlock})),r=e((function(e){return e.status.isUnlock}));return Promise.resolve(Boolean(t&&r))},n.isLock=function(){var e=(0,D.default)((function*(){return!(yield this.isUnlock())}));return function(){return e.apply(this,arguments)}}(),n.restartApp=function(){var e,t;return Q.default.isNativeAndroid&&te.restart(),Q.default.isExtensionBackground?chrome.runtime.reload():Q.default.isRuntimeBrowser?null==(e=window)||null==(t=e.location)||null==t.reload?void 0:t.reload():void 0},n.exitApp=function(){0},n.stopAllServiceInterval=function(){var e=(0,D.default)((function*(){var e=this.backgroundApi,t=e.serviceNotification,r=e.serviceOverview,n=e.serviceSocket,o=e.serviceToken;this.interval&&clearInterval(this.interval),t.clear(),yield r.stopQueryPendingTasks(),n.clear(),yield o.stopRefreshAccountTokens()}));return function(){return e.apply(this,arguments)}}(),n.resetApp=function(){var e=(0,D.default)((function*(){var e=this.backgroundApi,t=e.engine,r=e.dispatch,n=e.persistor,o=e.serviceNetwork,i=e.serviceAccount,a=e.serviceNotification,c=e.appSelector;this.resetAppAtTime=Date.now(),yield this.stopAllServiceInterval(),Y.default.disableSetInterval(),n.pause(),c((function(e){var t,r;return null==(t=e.settings)||null==(r=t.pushNotification)?void 0:r.pushEnable}))&&a.syncPushNotificationConfig("reset"),yield n.purge(),B.webTabsActions.closeAllWebTabs(),yield t.resetApp(),Q.default.isRuntimeBrowser&&window.localStorage.clear(),yield X.default.clear(),X.default.clearSetting(),r({type:"LOGOUT",payload:void 0}),o.notifyChainChanged(),i.notifyAccountsChanged();try{Q.default.isNativeAndroid&&(yield(0,z.isAvailable)())&&((0,z.logoutFromGoogleDrive)(!0),yield(0,V.wait)(1e3))}catch(u){}yield(0,V.wait)(1500),this.restartApp(),yield(0,V.wait)(1500),this.resetAppAtTime=0,Y.default.enableSetInterval()}));return function(){return e.apply(this,arguments)}}(),n.isResettingApp=function(){var e=(0,D.default)((function*(){return Promise.resolve(Date.now()-this.resetAppAtTime<5e3)}));return function(){return e.apply(this,arguments)}}(),n.openExtensionExpandTab=function(e){H.default.openExpandTab(e)},n.autoOpenOnboardingIfExtensionInstalled=function(){},n.initAppAfterStoreReady=function(){var e=this;this.backgroundApi.persistor.getState().bootstrapped?this.initApp():J.appEventBus.once(J.AppEventBusNames.StoreInitedFromPersistor,(function(){e.initApp()}))},n.initApp=function(){var e=(0,D.default)((function*(){var e,t=this.backgroundApi,r=t.engine,n=t.appSelector,o=t.serviceBootstrap,i=t.serviceSetting,a=t.serviceSwap,c=t.serviceDiscover,u=t.serviceCloudBackup,s=null!=(e=n((function(e){var t,r,n;return null!=(t=null==e||null==(r=e.settings)||null==(n=r.devMode)?void 0:n.enableTestFiatEndpoint)&&t})))&&e;(0,_.switchTestEndpoint)(s),Q.default.isExtensionBackground&&i.checkBrowserActionIcon(),yield r.cleanupDBOnStart(),yield this.initPassword(),yield this.initLocalAuthentication(),yield this.checkLockStatus(),c.init(),yield o.preBootstrap();var d=yield this.initActiveIds();a.initSwap(),u.loginIfNeeded(!1),d.activeNetworkId&&r.updateOnlineTokens(d.activeNetworkId,!1),o.bootstrap(),this._appInited=!0}));return function(){return e.apply(this,arguments)}}(),n.initActiveIds=function(){var e=(0,D.default)((function*(){var e=this.backgroundApi,t=e.engine,r=e.dispatch,n=e.serviceAccount,o=e.serviceNetwork,i=yield o.initNetworks(),a=yield n.initWallets(),c=o.initCheckingNetwork(i),u=n.initCheckingWallet(a),s=yield n.reloadAccountsByWalletIdNetworkId(u,c),d=n.initCheckingAccount(s);c&&t.updateOnlineTokens(c,!1);var p={activeAccountId:d,activeWalletId:u,activeNetworkId:c};return r((0,W.setActiveIds)(p)),p}));return function(){return e.apply(this,arguments)}}(),n.initLocalAuthentication=function(){var e=(0,D.default)((function*(){var e=this.backgroundApi,t=e.engine,r=e.dispatch;if((0,e.appSelector)((function(e){return e.settings})).enableLocalAuthentication&&(yield(0,q.hasHardwareSupported)())){var n=yield(0,q.getPassword)();if(n)(yield t.verifyMasterPassword(n))||r((0,L.setEnableLocalAuthentication)(!1));else r((0,L.setEnableLocalAuthentication)(!1))}}));return function(){return e.apply(this,arguments)}}(),n.initPassword=function(){var e=(0,D.default)((function*(){var e=this.backgroundApi,t=e.engine,r=e.dispatch;(yield t.isMasterPasswordSet())&&r((0,F.passwordSet)(),(0,U.setBoardingCompleted)())}));return function(){return e.apply(this,arguments)}}(),n.updatePassword=function(){var e=(0,D.default)((function*(e,t){var r=this.backgroundApi,n=r.dispatch,o=r.engine,i=r.appSelector,a=r.servicePassword,c=r.serviceCloudBackup;yield o.updatePassword(e,t);var u=i((function(e){return e.data})),s=i((function(e){return e.status})),d=[];u.isPasswordSet||(d.push((0,F.passwordSet)()),d.push((0,L.setEnableAppLock)(!0))),s.boardingCompleted||d.push((0,U.setBoardingCompleted)()),n.apply(void 0,d.concat([(0,U.unlock)(),(0,F.release)()])),yield a.savePassword(t),c.requestBackup()}));return function(t,r){return e.apply(this,arguments)}}(),n.verifyPassword=function(){var e=(0,D.default)((function*(e){var t=this.backgroundApi.engine;return yield t.verifyMasterPassword(e)}));return function(t){return e.apply(this,arguments)}}(),n.lock=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.backgroundApi,r=t.dispatch,n=t.servicePassword,o=t.appSelector;return n.clearData(),r((0,F.setHandOperatedLock)(e),(0,U.lock)()),(0,V.sleepUntil)({conditionFn:function(){return o((function(e){return!1===e.data.isUnlock}))},until:1e3})},n.unlock=function(){var e=(0,D.default)((function*(e){var t=this.backgroundApi,r=t.dispatch,n=t.servicePassword,o=yield n.verifyPassword(e);return o&&(yield n.savePassword(e),r((0,F.setHandOperatedLock)(!1),(0,U.unlock)(),(0,F.release)()),J.appEventBus.emit(J.AppEventBusNames.Unlocked)),o}));return function(t){return e.apply(this,arguments)}}(),n.webPureUnlock=function(){(0,this.backgroundApi.dispatch)((0,F.setHandOperatedLock)(!1),(0,U.unlock)(),(0,F.release)()),J.appEventBus.emit(J.AppEventBusNames.Unlocked)},n.checkUpdateStatus=function(){var e=this.backgroundApi.store.getState().autoUpdate.lastCheckTimestamp,t=(0,V.getTimeDurationMs)({hour:1});if((0,V.getTimeStamp)()-(null!=e?e:0)>t)return K.default.checkUpdate().then()},(0,M.default)(r,[{key:"isAppInited",get:function(){return this._appInited}}]),r}(Z.default),(0,j.default)(S.prototype,"waitForAppInited",[o],Object.getOwnPropertyDescriptor(S.prototype,"waitForAppInited"),S.prototype),(0,j.default)(S.prototype,"getLoggerInstance",[i],Object.getOwnPropertyDescriptor(S.prototype,"getLoggerInstance"),S.prototype),(0,j.default)(S.prototype,"addLogger",[a],Object.getOwnPropertyDescriptor(S.prototype,"addLogger"),S.prototype),(0,j.default)(S.prototype,"checkLockStatus",[c],Object.getOwnPropertyDescriptor(S.prototype,"checkLockStatus"),S.prototype),(0,j.default)(S.prototype,"refreshLastActivity",[u],Object.getOwnPropertyDescriptor(S.prototype,"refreshLastActivity"),S.prototype),(0,j.default)(S.prototype,"isUnlock",[s],Object.getOwnPropertyDescriptor(S.prototype,"isUnlock"),S.prototype),(0,j.default)(S.prototype,"isLock",[d],Object.getOwnPropertyDescriptor(S.prototype,"isLock"),S.prototype),(0,j.default)(S.prototype,"restartApp",[p],Object.getOwnPropertyDescriptor(S.prototype,"restartApp"),S.prototype),(0,j.default)(S.prototype,"exitApp",[l],Object.getOwnPropertyDescriptor(S.prototype,"exitApp"),S.prototype),(0,j.default)(S.prototype,"resetApp",[f],Object.getOwnPropertyDescriptor(S.prototype,"resetApp"),S.prototype),(0,j.default)(S.prototype,"isResettingApp",[y],Object.getOwnPropertyDescriptor(S.prototype,"isResettingApp"),S.prototype),(0,j.default)(S.prototype,"openExtensionExpandTab",[h],Object.getOwnPropertyDescriptor(S.prototype,"openExtensionExpandTab"),S.prototype),(0,j.default)(S.prototype,"initApp",[v],Object.getOwnPropertyDescriptor(S.prototype,"initApp"),S.prototype),(0,j.default)(S.prototype,"initActiveIds",[g],Object.getOwnPropertyDescriptor(S.prototype,"initActiveIds"),S.prototype),(0,j.default)(S.prototype,"initLocalAuthentication",[k],Object.getOwnPropertyDescriptor(S.prototype,"initLocalAuthentication"),S.prototype),(0,j.default)(S.prototype,"initPassword",[w],Object.getOwnPropertyDescriptor(S.prototype,"initPassword"),S.prototype),(0,j.default)(S.prototype,"updatePassword",[b],Object.getOwnPropertyDescriptor(S.prototype,"updatePassword"),S.prototype),(0,j.default)(S.prototype,"verifyPassword",[m],Object.getOwnPropertyDescriptor(S.prototype,"verifyPassword"),S.prototype),(0,j.default)(S.prototype,"lock",[A],Object.getOwnPropertyDescriptor(S.prototype,"lock"),S.prototype),(0,j.default)(S.prototype,"unlock",[O],Object.getOwnPropertyDescriptor(S.prototype,"unlock"),S.prototype),(0,j.default)(S.prototype,"webPureUnlock",[I],Object.getOwnPropertyDescriptor(S.prototype,"webPureUnlock"),S.prototype),(0,j.default)(S.prototype,"checkUpdateStatus",[P],Object.getOwnPropertyDescriptor(S.prototype,"checkUpdateStatus"),S.prototype),T=S))||T)},976753:(e,t,r)=>{r.r(t),r.d(t,{default:()=>M});var n,o,i,a,c,u,s=r(196234),d=r(301842),p=r.n(d),l=r(634795),f=r(887371),y=r(545754),h=r(411987),v=r(695058),g=r(859375),k=r(206391),w=r.n(k),b=r(992431),m=r(112889),A=r(16280),O=r(776553),I=r(438760),P=r(725141),T=r(396564),S=r(201882);function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,v.default)(e);if(t){var o=(0,v.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var M=(n=(0,I.backgroundClass)(),o=(0,I.backgroundMethod)(),i=(0,I.backgroundMethod)(),a=(0,I.backgroundMethod)(),n((u=function(e){(0,y.default)(r,e);var t=D(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).getBRC20AmountListCache=(0,T.memoizee)(function(){var e=(0,l.default)((function*(e){var t=e.networkId,r=e.address,n=e.tokenAddress,o=e.xpub,i=new P.RestfulRequest((0,m.getFiatEndpoint)(),{},6e4),a={network:t,address:r,tokenAddress:n,xpub:o};try{return yield i.get("/token/balances/brc20Detail",a).then((function(e){return e.json()}))}catch(c){return console.log("fetchBRC20AmountList error",c),{balance:"0",availableBalance:"0",transferBalance:"0",transferBalanceList:[]}}}));return function(t){return e.apply(this,arguments)}}(),{primitive:!0,promise:!0,max:100,maxAge:(0,O.getTimeDurationMs)({minute:1})}),e}var n=r.prototype;return n.getBRC20RecycleBalance=function(){var e=(0,l.default)((function*(e){var t,r=e.networkId,n=e.xpub,o=e.address,i=e.tokenAddress,a=(yield b.default.utxoAccounts.getCoinControlList(r,(0,A.isTaprootXpubSegwit)(n)?(0,A.getTaprootXpub)(n):n)).filter((function(e){return e.recycle})),c=e.transferBalanceList;p()(c)&&(c=null!=(t=(yield this.getBRC20AmountList({networkId:r,address:o,tokenAddress:i,xpub:n})).transferBalanceList)?t:[]);return c.filter((function(e){return a.find((function(t){var r=t.key.split("_"),n=(0,s.default)(r,2),o=n[0],i=n[1],a=e.inscriptionId.slice(0,-2),c=e.inscriptionId.slice(-1);return o===a&&i===c}))})).reduce((function(e,t){return new(w())(e).plus(t.amount).toFixed()}),"0")}));return function(t){return e.apply(this,arguments)}}(),n.getBRC20Inscriptions=function(){var e=(0,l.default)((function*(e){var t=e.networkId,r=e.address,n=e.tokenAddress,o=e.xpub,i=new P.RestfulRequest((0,m.getFiatEndpoint)(),{},6e4),a={chain:t,address:r,tokenAddress:n};try{var c=yield i.get("/NFT/v2/list",a).then((function(e){return e.json()})),u=(yield b.default.utxoAccounts.getCoinControlList(null!=t?t:"",(0,A.isTaprootXpubSegwit)(null!=o?o:"")?(0,A.getTaprootXpub)(null!=o?o:""):null!=o?o:"")).filter((function(e){return e.recycle}));return{inscriptions:c.data,availableInscriptions:c.data.filter((function(e){var t=e.output.split(":"),r=(0,s.default)(t,2),n=r[0],o=r[1];return!u.find((function(e){var t=e.key.split("_"),r=(0,s.default)(t,2),i=r[0],a=r[1];return n===i&&o===a}))}))}}catch(d){return console.log("fetchBRC20Inscriptions error",d),{inscriptions:[],availableInscriptions:[]}}}));return function(t){return e.apply(this,arguments)}}(),n.getBRC20AmountList=function(){var e=(0,l.default)((function*(e){return yield this.getBRC20AmountListCache(e)}));return function(t){return e.apply(this,arguments)}}(),(0,f.default)(r)}(S.default),(0,g.default)(u.prototype,"getBRC20RecycleBalance",[o],Object.getOwnPropertyDescriptor(u.prototype,"getBRC20RecycleBalance"),u.prototype),(0,g.default)(u.prototype,"getBRC20Inscriptions",[i],Object.getOwnPropertyDescriptor(u.prototype,"getBRC20Inscriptions"),u.prototype),(0,g.default)(u.prototype,"getBRC20AmountList",[a],Object.getOwnPropertyDescriptor(u.prototype,"getBRC20AmountList"),u.prototype),c=u))||c)},201882:(e,t,r)=>{r.r(t),r.d(t,{default:()=>y});var n,o,i,a,c=r(634795),u=r(887371),s=r(859375),d=r(789644),p=r.n(d),l=r(859071),f=r(438760),y=(n=(0,f.backgroundClass)(),o=(0,f.backgroundMethod)(),n((a=function(){function e(e){var t=e.backgroundApi;this.backgroundApi=t}var t=e.prototype;return t.getActiveWalletAccount=function(){var e=(0,c.default)((function*(){var e=yield(0,l.getActiveWalletAccount)();return Promise.resolve(e)}));return function(){return e.apply(this,arguments)}}(),t.getActiveVault=function(){var e=(0,c.default)((function*(){var e=yield this.getActiveWalletAccount(),t=e.networkId,r=e.accountId;return this.backgroundApi.engine.getVault({networkId:t,accountId:r})}));return function(){return e.apply(this,arguments)}}(),(0,u.default)(e,[{key:"client",get:function(){return this._client||(this._client=p().create({timeout:6e4})),this._client}}]),e}(),(0,s.default)(a.prototype,"getActiveWalletAccount",[o],Object.getOwnPropertyDescriptor(a.prototype,"getActiveWalletAccount"),a.prototype),i=a))||i)},840536:(e,t,r)=>{r.r(t),r.d(t,{default:()=>B});var n,o,i,a,c,u,s,d,p,l,f,y=r(196234),h=r(703440),v=r.n(h),g=r(690249),k=r.n(g),w=r(634795),b=r(887371),m=r(545754),A=r(411987),O=r(695058),I=r(859375),P=r(206391),T=r.n(P),S=r(940915),D=r(683094),M=r(966852),C=r(740727),N=r(258387),R=r(438760),j=r(799075),E=r(613549),x=r(201882);function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,O.default)(e);if(t){var o=(0,O.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,A.default)(this,r)}}var B=(n=(0,R.backgroundClass)(),o=(0,R.backgroundMethod)(),i=(0,R.backgroundMethod)(),a=(0,R.backgroundMethod)(),c=(0,R.backgroundMethod)(),u=(0,R.backgroundMethod)(),s=(0,R.backgroundMethod)(),d=(0,R.backgroundMethod)(),p=(0,R.backgroundMethod)(),n((f=function(e){(0,m.default)(r,e);var t=_(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.buildEncodedTxsFromBatchApprove=function(){var e=(0,w.default)((function*(e){var t=this,r=e.accountId,n=e.networkId,o=e.transferInfos,i=e.isUnlimited,a=this.backgroundApi.engine,c=yield a.getNetwork(n);if(!(yield a.getVaultSettings(n)).batchTransferApprovalRequired)return Promise.resolve([]);var u=(yield a.getAccount(r,n)).address,s=D.batchTransferContractAddress[n],d=[];if(!s)throw new Error(`${c.name} has not deployed a batch transfer contract`);var p=o[0],l=p.nftTokenId,f=p.isNFT,y=p.nftType;if(Boolean(p.token))if(f&&l&&y){var h=k()(v()(o,"token")).map((function(e){return{from:u,to:e,spender:s,approved:!0}})),g=yield Promise.all(h.map((function(e){return t.checkIsApprovedForAll({networkId:n,owner:e.from,spender:e.spender,token:e.to,type:e.type})})));h=h.filter((function(e,t){return!g[t]})),d=yield a.buildEncodedTxsFromSetApproveForAll({networkId:n,accountId:r,approveInfos:h})}else{var w,b=yield a.ensureTokenInDB(n,null!=(w=p.token)?w:"");if(!b)throw new Error(`Token not found: ${p.token}`);var m=yield this.checkIsUnlimitedAllowance({networkId:n,owner:p.from,spender:s,token:p.token}),A=m.isUnlimited,O=m.allowance;if(A){if(!i){var I=o.reduce((function(e,t){return e.plus(t.amount)}),new(T())(0));d=[yield a.buildEncodedTxFromApprove({networkId:n,accountId:r,token:p.token,amount:I.toFixed(),spender:s})]}}else{var P=o.reduce((function(e,t){return e.plus(t.amount)}),new(T())(0));(i||P.shiftedBy(b.decimals).isGreaterThan(O))&&(d=[yield a.buildEncodedTxFromApprove({networkId:n,accountId:r,token:p.token,amount:i?N.InfiniteAmountText:P.toFixed(),spender:s})])}}return Promise.resolve(d)}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,w.default)((function*(e){return this.backgroundApi.engine.buildEncodedTxFromBatchTransfer(e)}));return function(t){return e.apply(this,arguments)}}(),n.signAndSendEncodedTx=function(){var e=(0,w.default)((function*(e){var t=this,r=this.backgroundApi.engine,n=e.accountId,o=e.networkId,i=e.pendingTxs,a=e.encodedTx,c=yield r.getNetwork(o),u=yield r.getVaultSettings(o),s=(yield(0,j.CoreSDKLoader)()).wait,d=0,p=0;if(i&&i.length>0&&u.batchTransferApprovalConfirmRequired&&(yield this.checkIsBatchTransfer({networkId:o,encodedTx:a}))){var l=null,f=function(){var e=(0,w.default)((function*(){var e=yield t.refreshPendingTxs({networkId:o,pendingTxs:i});Object.keys(e).length!==i.length&&p<10&&(p+=1,yield s(1e3),yield f())}));return function(){return e.apply(this,arguments)}}(),y=function(){var t=(0,w.default)((function*(){try{l=yield r.signAndSendEncodedTx(e)}catch(t){if(t instanceof S.OneKeyError)throw t;if(d>10)throw t;d+=1,yield s(1e3),yield y()}}));return function(){return t.apply(this,arguments)}}();return yield f(),yield y(),l}if(c.impl===E.IMPL_SOL){var h=yield r.solanaRefreshRecentBlockBash({accountId:n,networkId:o,transaction:e.encodedTx});e.encodedTx=h}return r.signAndSendEncodedTx(e)}));return function(t){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=(0,w.default)((function*(e){var t=e.networkId,r=e.owner,n=e.spender,o=e.token,i=this.backgroundApi.engine;return(yield i.getChainOnlyVault(t)).checkIsUnlimitedAllowance({owner:r,spender:n,token:o})}));return function(t){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=(0,w.default)((function*(e){var t=e.networkId,r=e.owner,n=e.spender,o=e.token,i=e.type,a=this.backgroundApi.engine;return(yield a.getChainOnlyVault(t)).checkIsApprovedForAll({owner:r,spender:n,token:o,type:i})}));return function(t){return e.apply(this,arguments)}}(),n.confirmTransaction=function(){var e=(0,w.default)((function*(e){var t=e.networkId,r=e.txid,n=this.backgroundApi.engine,o=yield n.getChainOnlyVault(t),i=yield o.getTransactionStatuses([r]);return(0,y.default)(i,1)[0]}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=(0,w.default)((function*(e){var t=e.networkId,r=e.encodedTx,n=this.backgroundApi.engine;return(yield n.getChainOnlyVault(t)).checkIsBatchTransfer(r)}));return function(t){return e.apply(this,arguments)}}(),n.refreshPendingTxs=function(){var e=(0,w.default)((function*(e){var t=e.networkId,r=e.pendingTxs;if(0===r.length)return{};var n=this.backgroundApi.engine,o=yield n.getChainOnlyVault(t),i={},a=new RegExp(`^${t}${E.SEPERATOR}`);return(yield o.getTransactionStatuses(r.map((function(e){return e.id.replace(a,"")})))).forEach((function(e,t){var n=r[t].id;e===C.TransactionStatus.CONFIRM_AND_SUCCESS?i[n]=M.HistoryEntryStatus.SUCCESS:e===C.TransactionStatus.CONFIRM_BUT_FAILED&&(i[n]=M.HistoryEntryStatus.FAILED)})),i}));return function(t){return e.apply(this,arguments)}}(),(0,b.default)(r)}(x.default),(0,I.default)(f.prototype,"buildEncodedTxsFromBatchApprove",[o],Object.getOwnPropertyDescriptor(f.prototype,"buildEncodedTxsFromBatchApprove"),f.prototype),(0,I.default)(f.prototype,"buildEncodedTxFromBatchTransfer",[i],Object.getOwnPropertyDescriptor(f.prototype,"buildEncodedTxFromBatchTransfer"),f.prototype),(0,I.default)(f.prototype,"signAndSendEncodedTx",[a],Object.getOwnPropertyDescriptor(f.prototype,"signAndSendEncodedTx"),f.prototype),(0,I.default)(f.prototype,"checkIsUnlimitedAllowance",[c],Object.getOwnPropertyDescriptor(f.prototype,"checkIsUnlimitedAllowance"),f.prototype),(0,I.default)(f.prototype,"checkIsApprovedForAll",[u],Object.getOwnPropertyDescriptor(f.prototype,"checkIsApprovedForAll"),f.prototype),(0,I.default)(f.prototype,"confirmTransaction",[s],Object.getOwnPropertyDescriptor(f.prototype,"confirmTransaction"),f.prototype),(0,I.default)(f.prototype,"checkIsBatchTransfer",[d],Object.getOwnPropertyDescriptor(f.prototype,"checkIsBatchTransfer"),f.prototype),(0,I.default)(f.prototype,"refreshPendingTxs",[p],Object.getOwnPropertyDescriptor(f.prototype,"refreshPendingTxs"),f.prototype),l=f))||l)},13577:(e,t,r)=>{r.r(t),r.d(t,{default:()=>U});var n,o,i,a,c,u,s,d,p,l,f,y,h=r(256666),v=r(634795),g=r(887371),k=r(545754),w=r(411987),b=r(695058),m=r(859375),A=r(197699),O=r.n(A),I=r(992431),P=r(278489),T=r(645824),S=r(16280),D=r(821919),M=r(830631),C=r(438760),N=r(402814),R=r(613549),j=r(814817),E=r(292147),x=r(947100),_=r(201882);function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){(0,h.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function W(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,b.default)(e);if(t){var o=(0,b.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,w.default)(this,r)}}var L={"aptos--1":"https://fullnode.mainnet.aptoslabs.com","bch--0":"https://fiat.onekeycn.com/book/bch","btc--0":"https://rpc.onekey.so/btc/","evm--1":"https://mainnet.infura.io/v3/9aa3d95b3bc440fa88ea12eaa4456161","evm--10":"https://mainnet.optimism.io","evm--100":"https://rpc.gnosischain.com","evm--10001":"https://mainnet.ethereumpow.org","evm--128":"https://http-mainnet.hecochain.com","evm--1313161554":"https://mainnet.aurora.dev","evm--137":"https://polygon-rpc.com","evm--25":"https://mmf-rpc.xstaking.sg","evm--250":"https://rpc.ftm.tools","evm--288":"https://mainnet.boba.network","evm--42161":"https://arb1.arbitrum.io/rpc","evm--42220":"https://rpc.ankr.com/celo","evm--43114":"https://api.avax.network/ext/bc/C/rpc","evm--513100":"https://rpc.etherfair.org","evm--56":"https://bsc-dataseed1.ninicoin.io","evm--61":"https://www.ethercluster.com/etc","evm--66":"https://exchainrpc.okex.org","near--0":"https://rpc.mainnet.near.org","sol--101":"https://solana-mainnet.phantom.tech/","stc--1":"https://main-seed.starcoin.org","tron--0x2b6653dc":"https://tron-mainnet.token.im","ltc--0":"https://fiat.onekeycn.com/book/ltc","doge--0":"https://fiat.onekeycn.com/book/doge","cfx--1029":"https://main.confluxrpc.com","algo--4160":"https://algosigner.api.purestake.io/mainnet/algod","evm--73927":"https://geth.mvm.dev","cosmos--cosmoshub-4":"https://lcd-cosmoshub.keplr.app","cosmos--juno-1":"https://lcd-juno.keplr.app","cosmos--crypto-org-chain-mainnet-1":"https://api-cryptoorgchain-ia.cosmosia.notional.ventures","cosmos--secret-4":"https://lcd-secret.keplr.app/","cosmos--akashnet-2":"https://lcd-akash.keplr.app/","cosmos--osmosis-1":"https://lcd-osmosis.keplr.app/","cosmos--fetchhub-4":"https://lcd-fetchhub.keplr.app"},U=(n=(0,C.backgroundClass)(),o=(0,C.bindThis)(),i=(0,C.bindThis)(),a=(0,C.backgroundMethod)(),c=(0,C.backgroundMethod)(),u=(0,C.backgroundMethod)(),s=(0,C.backgroundMethod)(),d=(0,C.backgroundMethod)(),p=(0,C.backgroundMethod)(),l=(0,C.backgroundMethod)(),n((y=function(e){(0,k.default)(r,e);var t=W(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).fetchFiatTimer=null,e}var n=r.prototype;return n.preBootstrap=function(){var e=(0,v.default)((function*(){yield this.removeDeprecatedNetworks()}));return function(){return e.apply(this,arguments)}}(),n.bootstrap=function(){var e=this.backgroundApi,t=e.serviceAccount,r=e.serviceToken,n=e.serviceNetwork,o=e.serviceSwap,i=e.serviceOnboarding,a=e.serviceCloudBackup,c=e.servicePrice,u=e.serviceAllNetwork;this.migrateAccountDerivationTable(),this.migrateCosmosTemplateInDB(),this.migrateBtcPubInDB(),r.registerEvents(),n.registerEvents(),o.registerEvents(),t.registerEvents(),u.registerEvents(),c.registerEvents(),this.initFetchFiatMoneyRateSchedule(),i.checkOnboardingStatus(),a.initCloudBackup(),this.fetchAppConfig(),this.syncUserConfig(),this.backgroundApi.walletConnect.initWeb3WalletV2(1e3)},n.fetchAppConfig=function(){var e=(0,v.default)((function*(){var e=this,t=yield I.default.serverNetworks.getTimestamp(),r=yield(0,N.fetchData)("/config/app",{version:null!="4.24.0"?"4.24.0":"",networkUpdateTimestamp:t},{}),n=r.swapConfig,o=r.remoteSettings,i=r.vsCurrencies,a=r.networks,c=this.backgroundApi,u=c.servicePrice,s=c.serviceSwap,d=c.serviceSetting,p=c.serviceNetwork;n&&s.initSwapConfig(n),o&&d.updateRemoteSettingWithData(o),i&&u.updateFiatMoneyMap(i),a&&p.migrateServerNetworks(a).then((function(){e.switchDefaultRpcToOnekeyRpcNode()}))}));return function(){return e.apply(this,arguments)}}(),n.syncUserConfig=function(){var e=(0,v.default)((function*(){var e=this.backgroundApi,t=e.serviceAccount,r=e.serviceNotification,n=e.appSelector,o=yield t.getUserAccounts(),i=yield r.getNotificationConfig(),a=n((function(e){return e.settings.instanceId}));return(0,N.fetchData)("/config/sync",{accounts:o,notificationConfig:i,instanceId:a},{},"put")}));return function(){return e.apply(this,arguments)}}(),n.checkShouldShowNotificationGuide=function(){var e=(0,v.default)((function*(){var e=(0,this.backgroundApi.appSelector)((function(e){return{accountId:e.general.activeAccountId,networkId:e.general.activeNetworkId,pushNotification:e.settings.pushNotification,guideToPushFirstTime:e.status.guideToPushFirstTime}})),t=e.accountId,r=e.pushNotification,n=e.guideToPushFirstTime,o=e.networkId;return!!t&&(!!r&&(!r.pushEnable&&(!n&&!!R.enabledAccountDynamicNetworkIds.includes(o||""))))}));return function(){return e.apply(this,arguments)}}(),n.switchDefaultRpcToOnekeyRpcNode=function(){var e=(0,v.default)((function*(){var e=this.backgroundApi,t=e.appSelector,r=e.dispatch,n=e.serviceNetwork,o=t((function(e){return e.runtime})).networks,i=t((function(e){return e.status})),a=i.autoSwitchDefaultRpcAtVersion,c=i.userSwitchedNetworkRpcFlag;if(!(a&&O().valid(a)&&O().gte(a,R.AUTO_SWITCH_DEFAULT_RPC_AT_VERSION))){var u=function*(e){var t,r,o,i,a=L[e.id],u=null==(t=Object.values((0,T.getPresetNetworks)()).find((function(t){return t.id===e.id})))||null==(r=t.rpcURLs)||null==(o=r.find((function(e){var t;return null==(t=e.url)?void 0:t.startsWith("https://node.onekey.so/")})))?void 0:o.url,s=null!=(i=null==c?void 0:c[e.id])&&i;a&&a===e.rpcURL&&u&&!s&&(yield n.updateNetwork(e.id,{rpcURL:u},!1))};for(var s of o)yield*u(s);r((0,M.updateAutoSwitchDefaultRpcAtVersion)(R.AUTO_SWITCH_DEFAULT_RPC_AT_VERSION))}}));return function(){return e.apply(this,arguments)}}(),n.initFetchFiatMoneyRateSchedule=function(){var e=this;this.fetchFiatTimer||(this.fetchFiatTimer=setInterval((function(){e.backgroundApi.serviceCronJob.getFiatMoney()}),3e5))},n.migrateAccountDerivationTable=function(){var e=(0,v.default)((function*(){var e=this;E.default.common.info("start migrate account derivation process ===>");try{var t=this.backgroundApi.appSelector,r=t((function(e){return e.settings.accountDerivationDbMigrationVersion})),n=t((function(e){return e.settings.version})),o=yield(0,x.processMigration)({dbMigrationVersion:r,checkVersion:R.ACCOUNT_DERIVATION_DB_MIGRATION_VERSION,doMigration:function(){var t=(0,v.default)((function*(){E.default.common.info("will migrate ===>");var t=e.backgroundApi.engine.dbApi,r=(yield t.getWallets()).filter((function(e){return e.id.startsWith("hd")||e.id.startsWith("hw")}));for(var n of r){E.default.common.info(`migrate wallet: ${JSON.stringify(n)}`);var o=yield t.getAccounts(n.accounts);for(var i of o)if(!i.template){var a=(0,P.getDBAccountTemplate)(i),c=(0,P.getImplByCoinType)(i.coinType);yield t.addAccountDerivation({walletId:n.id,accountId:i.id,impl:c,template:a}),E.default.common.info(`added account derivation: accountId: ${i.id}, template: ${a}`),yield t.setAccountTemplate({accountId:i.id,template:a}),E.default.common.info(`insert account: ${i.id} to AccountDerivation table, template: ${a}`)}E.default.common.info(`migrate accounts finish, will update nextAccountId, walletId:  ${n.id}`);var u=(0,P.migrateNextAccountIds)(n.nextAccountIds);yield t.updateWalletNextAccountIds({walletId:n.id,nextAccountIds:u}),E.default.common.info(`update wallet nextAccountIds, wallet: ${n.id}, nextAccountIds: ${JSON.stringify(u)}`)}}));return function(){return t.apply(this,arguments)}}()});if(o.skip)return void E.default.common.info("Skip AccountDerivation DB migration");this.backgroundApi.dispatch((0,D.setAccountDerivationDbMigrationVersion)(n))}catch(i){throw E.default.common.error("migrate error: ",i),i}}));return function(){return e.apply(this,arguments)}}(),n.migrateCosmosTemplateInDB=function(){var e=(0,v.default)((function*(){var e=this;E.default.common.info("start migrate cosmos template process");try{var t=this.backgroundApi.appSelector,r=t((function(e){return e.settings.accountDerivationDbMigrationVersion})),n=t((function(e){return e.settings.version})),o=yield(0,x.processMigration)({dbMigrationVersion:r,checkVersion:R.FIX_COSMOS_TEMPLATE_DB_MIGRATION_VERSION,doMigration:function(){var t=(0,v.default)((function*(){var t=e.backgroundApi.engine.dbApi,r=(yield t.getWallets()).filter((function(e){return e.id.startsWith("hd")||e.id.startsWith("hw")})),n=`m/44'/${R.COINTYPE_COSMOS}'/${R.INDEX_PLACEHOLDER}'/0/0`;for(var o of r){var i;E.default.common.info(`migrate wallet: ${JSON.stringify(o)}`);var a=o.accounts.filter((function(e){return e.indexOf(`m/44'/${R.COINTYPE_COSMOS}'/0'/0`)>-1})),c=(0,P.getImplByCoinType)(R.COINTYPE_COSMOS),u=(0,P.getDefaultAccountNameInfoByImpl)(c).template,s=yield t.getAccounts(a);for(var d of s)d.template&&d.template===n&&(yield t.addAccountDerivation({walletId:o.id,accountId:d.id,impl:c,template:u}),E.default.common.info(`added account derivation: accountId: ${d.id}, template: ${u}`),yield t.setAccountTemplate({accountId:d.id,template:u}),E.default.common.info(`insert account: ${d.id} to AccountDerivation table, template: ${u}`));if(yield t.removeAccountDerivation({walletId:o.id,impl:R.IMPL_COSMOS,template:n}),null!=(i=o.nextAccountIds)&&i[n]){var p,l=F(F({},o.nextAccountIds),{},((p={})[u]=o.nextAccountIds[n],p));yield t.updateWalletNextAccountIds({walletId:o.id,nextAccountIds:l}),E.default.common.info(`update wallet nextAccountIds, wallet: ${o.id}, nextAccountIds: ${JSON.stringify(l)}`)}}}));return function(){return t.apply(this,arguments)}}()});if(o.skip)return void E.default.common.info("Skip Cosmos Template migration");this.backgroundApi.dispatch((0,D.setAccountDerivationDbMigrationVersion)(n))}catch(i){throw E.default.common.error("cosmos template migrate error: ",i),i}}));return function(){return e.apply(this,arguments)}}(),n.migrateBtcPubInDB=function(){var e=(0,v.default)((function*(){var e=this;E.default.common.info("start migrate btc pub process");try{var t=this.backgroundApi.appSelector((function(e){return e.settings.version})),r=this.backgroundApi.appSelector((function(e){var t;return null==(t=e.settings.migrationVersions)?void 0:t.fixBtcPubKey})),n=yield(0,x.processMigration)({dbMigrationVersion:r,checkVersion:R.FIX_BTC_PUB_DB_MIGRATION_VERSION,doMigration:function(){var t=(0,v.default)((function*(){var t=e.backgroundApi.engine.dbApi,r=(yield t.getAllAccounts()).filter((function(e){return[R.COINTYPE_BTC,R.COINTYPE_TBTC].includes(e.coinType)&&!(0,j.isWatchingAccount)({accountId:e.id})}));for(var n of r){E.default.common.info(`migrate account: ${JSON.stringify(n)}`);var o=(0,S.getBip32FromBase58)({coinType:n.coinType,key:n.xpub}).derivePath("0/0").publicKey.toString("hex");(n.pub!==o||n.pubKey)&&(yield t.setAccountPub(n.id,o,!0),E.default.common.info(`insert account: ${n.id} to Account table, pub: ${o}`))}}));return function(){return t.apply(this,arguments)}}()});if(n.skip)return void E.default.common.info("skip btc pub migration");this.backgroundApi.dispatch((0,D.setMigrationVersions)({fixBtcPubKey:t}))}catch(o){throw E.default.common.error("btc pub migrate error: ",o),o}}));return function(){return e.apply(this,arguments)}}(),n.removeDeprecatedNetworks=function(){var e=(0,v.default)((function*(){var e=["sui--8888881","sui--8888882","sui--8888884"],t=this.backgroundApi.engine,r=(yield t.listNetworks(!1)).filter((function(t){return e.includes(t.id)}));if(r.length){var n=(yield t.dbApi.getAllAccounts()).filter((function(e){return e.coinType===R.COINTYPE_SUI}));for(var o of r){for(var i of n)yield t.removeAccount(i.id,"",o.id,!0);yield t.deleteNetwork(o.id)}}}));return function(){return e.apply(this,arguments)}}(),(0,g.default)(r)}(_.default),(0,m.default)(y.prototype,"preBootstrap",[o],Object.getOwnPropertyDescriptor(y.prototype,"preBootstrap"),y.prototype),(0,m.default)(y.prototype,"bootstrap",[i],Object.getOwnPropertyDescriptor(y.prototype,"bootstrap"),y.prototype),(0,m.default)(y.prototype,"checkShouldShowNotificationGuide",[a],Object.getOwnPropertyDescriptor(y.prototype,"checkShouldShowNotificationGuide"),y.prototype),(0,m.default)(y.prototype,"switchDefaultRpcToOnekeyRpcNode",[c],Object.getOwnPropertyDescriptor(y.prototype,"switchDefaultRpcToOnekeyRpcNode"),y.prototype),(0,m.default)(y.prototype,"initFetchFiatMoneyRateSchedule",[u],Object.getOwnPropertyDescriptor(y.prototype,"initFetchFiatMoneyRateSchedule"),y.prototype),(0,m.default)(y.prototype,"migrateAccountDerivationTable",[s],Object.getOwnPropertyDescriptor(y.prototype,"migrateAccountDerivationTable"),y.prototype),(0,m.default)(y.prototype,"migrateCosmosTemplateInDB",[d],Object.getOwnPropertyDescriptor(y.prototype,"migrateCosmosTemplateInDB"),y.prototype),(0,m.default)(y.prototype,"migrateBtcPubInDB",[p],Object.getOwnPropertyDescriptor(y.prototype,"migrateBtcPubInDB"),y.prototype),(0,m.default)(y.prototype,"removeDeprecatedNetworks",[l],Object.getOwnPropertyDescriptor(y.prototype,"removeDeprecatedNetworks"),y.prototype),f=y))||f)},420590:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ne});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b=r(968079),m=r(256666),A=r(196234),O=r(634795),I=r(254073),P=r.n(I),T=r(887371),S=r(545754),D=r(411987),M=r(695058),C=r(859375),N=r(653124),R=r(636393),j=r(626015),E=r(992431),x=r(901187),_=r(625316),B=r(984495),F=r(195212),W=r(520192),L=r(821919),U=r(830631),H=r(854341),V=r(574393),q=r(438760),K=r(220033),$=r(35116),G=r(292147),z=r(988955),J=r(213208),Q=r(677346),X=r(396564),Y=r(201882),Z=r(348834).Buffer;function ee(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function te(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(r),!0).forEach((function(t){(0,m.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ee(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function re(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,M.default)(e);if(t){var o=(0,M.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,D.default)(this,r)}}const ne=(n=(0,q.backgroundClass)(),o=(0,q.backgroundMethod)(),i=(0,q.backgroundMethod)(),a=(0,q.backgroundMethod)(),c=(0,q.backgroundMethod)(),u=(0,q.backgroundMethod)(),s=(0,q.backgroundMethod)(),d=(0,q.backgroundMethod)(),p=(0,q.backgroundMethod)(),l=(0,q.backgroundMethod)(),f=(0,q.backgroundMethod)(),y=(0,q.backgroundMethod)(),h=(0,q.backgroundMethod)(),v=(0,q.backgroundMethod)(),g=(0,q.backgroundMethod)(),n((w=function(e){(0,S.default)(r,e);var t=re(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).backupUUID="",e.deviceInfo={osName:null!=N.osName?N.osName:"unknown",deviceName:null!=N.deviceName?N.deviceName:"unknown"},e.onBackupRequired=P()((0,O.default)((function*(){return e.backupNow()})),3e4,{leading:!1,trailing:!0}),e.syncCloud=(0,X.memoizee)((0,O.default)((function*(){return K.sync()})),{promise:!0,maxAge:3e4}),e.listBackups=(0,X.memoizee)((0,O.default)((function*(){return(yield K.listFiles("onekey/")).map((function(e){return e.replace(/^\./,"").replace(/\.backup.*$/,"")}))})),{promise:!0,maxAge:3e4}),e.getDataFromCloud=(0,X.memoizee)((function(t){return K.downloadFromCloud(J.default.isNativeIOS?e.getBackupFilename(t):e.getBackupPath(t))}),{promise:!0,maxAge:3e4,max:50}),e}var n=r.prototype;return n.getBackupFilename=function(e){return`${e}.backup`},n.getBackupPath=function(e){return`onekey/${this.getBackupFilename(e)}`},n.getTempFilePath=function(e){var t;if(z.default)return`${null!=(t=z.default.DocumentDirectoryPath)?t:""}/${this.getBackupFilename(e)}`},n.ensureUUID=function(){var e=(0,O.default)((function*(){return this.backupUUID=this.backupUUID||(yield this.backgroundApi.engine.getBackupUUID()),this.backupUUID}));return function(){return e.apply(this,arguments)}}(),n.getDataForBackup=function(){var e=(0,O.default)((function*(e){var t,r,n={contacts:{},importedAccounts:{},watchingAccounts:{},HDWallets:{},simpleDb:{market:{favorites:[]},utxoAccounts:{utxos:[]}},discoverBookmarks:[]},o={},i=this.backgroundApi.appSelector((function(e){return e.settings})).version,a=this.backgroundApi.appSelector((function(e){return e.contacts})).contacts;Object.values(a).forEach((function(e){var t=function(e){var t=e.address,r=e.networkId;return R.default.v5(`${r},${t}`,"63363334-3563-5463-a336-666666353665")}(e);n.contacts[t]={name:e.name,address:(0,j.shortenAddress)(e.address)},o[t]={name:e.name,address:e.address,networkId:e.networkId}}));var c=E.default.utxoAccounts,u=E.default.market,s=yield c.getRawData(),d=yield u.getRawData(),p={utxoAccounts:{utxos:null!=(t=null==s?void 0:s.utxos)?t:[]},market:{favorites:null!=(r=null==d?void 0:d.favorites)?r:[]}};n.simpleDb=p;var l=this.backgroundApi.appSelector((function(e){return e.discover})).bookmarks;n.discoverBookmarks=l;var f=yield this.backgroundApi.engine.dumpDataForBackup(e);for(var y of Object.entries(f.importedAccounts)){var h,v=(0,A.default)(y,2),g=v[0],k=v[1],w=k.name,b=k.id,m=k.address,O=null!=(h=b.split("--")[2])?h:m;n.importedAccounts[g]={name:w,address:(0,j.shortenAddress)(O)}}for(var I of Object.entries(f.watchingAccounts)){var P,T=(0,A.default)(I,2),S=T[0],D=T[1],M=D.name,C=D.id,N=D.address,_=null!=(P=C.split("--")[2])?P:N;n.watchingAccounts[S]={name:M,address:(0,j.shortenAddress)(_)}}for(var B of Object.entries(f.wallets)){var F=(0,A.default)(B,2),W=F[0],L=F[1],U=L.name,H=L.avatar,V=L.accountIds;n.HDWallets[W]={name:U,avatar:H,accountUUIDs:V}}return{private:"{}",public:"{}",privateData:e?(0,x.encrypt)(e,Z.from(JSON.stringify(te(te({},f),{},{contacts:o,discoverBookmarks:l,simpleDb:p})),"utf8")).toString("base64"):"",publicData:JSON.stringify(n),appVersion:i}}));return function(t){return e.apply(this,arguments)}}(),n.backupNow=function(){var e=(0,O.default)((function*(){var e=this.backgroundApi,t=e.appSelector,r=e.dispatch,n=e.servicePassword,o=t((function(e){return e.cloudBackup})),i=o.enabled,a=o.backupRequests,c=o.isAvailable,u=yield K.isAvailable();if(u!==c&&r((0,_.setIsAvailable)(u)),i&&0!==a&&u){var s=yield n.getPassword();if(s){r((0,_.setInProgress)());var d=JSON.stringify(te({uuid:yield this.ensureUUID(),backupTime:Date.now(),deviceInfo:this.deviceInfo},yield this.getDataForBackup(s))),p=[];try{yield this.saveDataToCloud(d)}catch(l){G.default.cloudBackup.error(l.message),p.push((0,_.incrBackupRequests)())}p.push((0,_.setNotInProgress)()),r.apply(void 0,p)}}}));return function(){return e.apply(this,arguments)}}(),n.initCloudBackup=function(){$.appEventBus.on($.AppEventBusNames.BackupRequired,this.onBackupRequired),$.appEventBus.emit($.AppEventBusNames.BackupRequired)},n.getBackupStatus=function(){var e=(0,O.default)((function*(){var e=this.backgroundApi,t=e.appSelector,r=e.dispatch,n=t((function(e){return e.cloudBackup})).isAvailable;if(!(yield K.isAvailable()))return n&&r((0,_.setIsAvailable)(!1)),{hasPreviousBackups:!1};n||r((0,_.setIsAvailable)(!0)),yield this.syncCloud();var o=yield this.ensureUUID();return{hasPreviousBackups:(yield this.listBackups()).filter((function(e){return e!==o})).length>0}}));return function(){return e.apply(this,arguments)}}(),n.getPreviousBackups=function(){var e=(0,O.default)((function*(){yield this.syncCloud();var e=yield this.ensureUUID(),t=yield this.listBackups(),r={};for(var n of t.filter((function(t){return t!==e})))try{var o=(0,V.parseCloudData)(JSON.parse(yield this.getDataFromCloud(n))),i=o.backupTime,a=o.deviceInfo,c=o.public,u=JSON.parse(c),s=u.HDWallets,d=void 0===s?{}:s,p=u.importedAccounts,l=void 0===p?{}:p,f=u.watchingAccounts,y=void 0===f?{}:f,h=R.default.v5(`${a.osName},${a.deviceName}`,"38366232-6538-5532-b461-393837633133");"undefined"===typeof r[h]&&(r[h]=[]);var v=Object.values(d).reduce((function(e,t){return e+t.accountUUIDs.length}),0)+Object.keys(l).length+Object.keys(y).length;r[h].push({backupUUID:n,backupTime:i,deviceInfo:a,numOfHDWallets:Object.keys(d).length,numOfAccounts:v})}catch(g){G.default.cloudBackup.error(g.message)}return Object.values(r).map((function(e){return e.sort((function(e,t){return t.backupTime-e.backupTime}))})).sort((function(e,t){return t[0].backupTime-e[0].backupTime}))}));return function(){return e.apply(this,arguments)}}(),n.getBackupDetailsWithRemoteData=function(){var e=(0,O.default)((function*(e){var t={contacts:{},importedAccounts:{},watchingAccounts:{},HDWallets:{},simpleDb:{},discoverBookmarks:[]},r={contacts:{},importedAccounts:{},watchingAccounts:{},HDWallets:{},simpleDb:{},discoverBookmarks:[]};t.simpleDb={utxoAccounts:{utxos:[]},market:{favorites:[]}},r.simpleDb={utxoAccounts:{utxos:[]},market:{favorites:[]}};try{var n,o,i,a,c,u,s,d,p,l,f,y=JSON.parse((yield this.getDataForBackup("")).publicData);for(var h of(null==e||null==(n=e.discoverBookmarks)||n.forEach((function(e){var n,o,i;null!=y&&y.discoverBookmarks&&(null==y||null==(n=y.discoverBookmarks)?void 0:n.findIndex((function(t){return t.id===e.id})))>-1?null==(o=t.discoverBookmarks)||o.push(e):null==(i=r.discoverBookmarks)||i.push(e)})),Object.entries(e.contacts))){var v=(0,A.default)(h,2),g=v[0],k=v[1];"undefined"!==typeof y.contacts[g]?t.contacts[g]=k:r.contacts[g]=k}for(var w of Object.entries(e.importedAccounts)){var m=(0,A.default)(w,2),O=m[0],I=m[1];"undefined"!==typeof y.importedAccounts[O]?t.importedAccounts[O]=I:r.importedAccounts[O]=I}for(var P of Object.entries(e.watchingAccounts)){var T=(0,A.default)(P,2),S=T[0],D=T[1];"undefined"!==typeof y.watchingAccounts[S]?t.watchingAccounts[S]=D:r.watchingAccounts[S]=D}var M=(o=[]).concat.apply(o,(0,b.default)(Object.values(y.HDWallets).map((function(e){return e.accountUUIDs}))));for(var C of Object.entries(e.HDWallets)){var N=(0,A.default)(C,2),R=N[0],j=N[1];j.accountUUIDs.every((function(e){return M.includes(e)}))?t.HDWallets[R]=j:r.HDWallets[R]=j}r.simpleDb.utxoAccounts.utxos=(null!=(i=null==(a=e.simpleDb)||null==(c=a.utxoAccounts)?void 0:c.utxos)?i:[]).filter((function(e){var t,r,n;return(null!=(t=null==(r=y.simpleDb)||null==(n=r.utxoAccounts)?void 0:n.utxos)?t:[]).findIndex((function(t){return t.id===e.id}))<0})),t.simpleDb.utxoAccounts.utxos=(null!=(u=null==(s=e.simpleDb)||null==(d=s.utxoAccounts)?void 0:d.utxos)?u:[]).filter((function(e){var t,r,n;return(null!=(t=null==(r=y.simpleDb)||null==(n=r.utxoAccounts)?void 0:n.utxos)?t:[]).findIndex((function(t){return t.id===e.id}))>-1})),null==e||null==(p=e.simpleDb)||null==(l=p.market)||null==(f=l.favorites)||f.forEach((function(e){var n,o,i,a;null!=(n=y.simpleDb)&&n.market.favorites&&null!=(o=y.simpleDb)&&o.market.favorites.includes(e)?null==(i=t.simpleDb)||i.market.favorites.push(e):null==(a=r.simpleDb)||a.market.favorites.push(e)}))}catch(E){G.default.cloudBackup.error(E.message)}return{alreadyOnDevice:t,notOnDevice:r}}));return function(t){return e.apply(this,arguments)}}(),n.getBackupDetails=function(){var e=(0,O.default)((function*(e){var t=(0,V.parseCloudData)(JSON.parse(yield this.getDataFromCloud(e))),r=t.public,n=t.appVersion,o=JSON.parse(r);return{backupDetails:yield this.getBackupDetailsWithRemoteData(o),appVersion:n}}));return function(t){return e.apply(this,arguments)}}(),n.restoreFromPrivateBackup=function(){var e=(0,O.default)((function*(e){var t=e.privateBackupData,r=e.notOnDevice,n=e.localPassword,o=e.remotePassword,i=this.backgroundApi,a=i.dispatch,c=i.engine,u=i.appSelector,s=i.serviceAccount,d=i.serviceApp,p=i.servicePassword,l=u((function(e){return e.data})).isPasswordSet,f=u((function(e){return e.general.activeAccountId})),y="";try{y=(0,x.decrypt)(null!=o?o:n,Z.from(t,"base64")).toString("utf8")}catch(T){return Q.RestoreResult.WRONG_PASSWORD}try{var h;yield c.restoreDataFromBackup({data:y,localPassword:n,remotePassword:null!=o?o:n,uuidsToRestore:{importedAccounts:Object.keys(r.importedAccounts),watchingAccounts:Object.keys(r.watchingAccounts),HDWallets:Object.keys(r.HDWallets)}});var v=JSON.parse(y).contacts;if(r.discoverBookmarks)for(var g of r.discoverBookmarks)a((0,W.addBookmark)(g));if(null!=(h=r.simpleDb)&&h.market.favorites){var k,w=yield this.backgroundApi.serviceMarket.getTokensDetail(null==(k=r.simpleDb)?void 0:k.market.favorites),b=r.simpleDb.market.favorites.map((function(e){var t=w.find((function(t){return t.coingeckoId===e}));return{coingeckoId:e,symbol:null==t?void 0:t.symbol}}));yield this.backgroundApi.serviceMarket.saveMarketFavoriteTokens(b)}for(var m of Object.keys(r.contacts)){var A=v[m],O=A.name,I=A.address,P=A.networkId;O&&I&&P?a((0,B.create)({name:O,address:I,networkId:P,badge:P.split("--")[0]})):G.default.cloudBackup.error(`Contact ${m} not found in backup data.`)}}catch(S){return G.default.cloudBackup.error(S.message),Q.RestoreResult.UNKNOWN_ERROR}if(f)yield s.initWallets();else try{yield s.autoChangeWallet()}catch(D){G.default.cloudBackup.error("autoChangeWallet error")}return l||(yield d.initPassword(),a((0,U.unlock)(),(0,F.release)()),yield p.savePassword(n),(yield(0,H.hasHardwareSupported)())&&(a((0,L.setEnableLocalAuthentication)(!0)),yield(0,H.savePassword)(n))),Q.RestoreResult.SUCCESS}));return function(t){return e.apply(this,arguments)}}(),n.restoreFromBackup=function(){var e=(0,O.default)((function*(e){var t=e.backupUUID,r=e.notOnDevice,n=e.localPassword,o=e.remotePassword,i=(0,V.parseCloudData)(JSON.parse(yield this.getDataFromCloud(t))).private;return this.restoreFromPrivateBackup({privateBackupData:i,notOnDevice:r,localPassword:n,remotePassword:o})}));return function(t){return e.apply(this,arguments)}}(),n.enableService=function(){(0,this.backgroundApi.dispatch)((0,_.setEnabled)(),(0,_.incrBackupRequests)()),this.backupNow()},n.disableService=function(){var e=(0,O.default)((function*(){var e=this.backgroundApi.dispatch;yield this.removeBackup(yield this.ensureUUID()),e((0,_.setDisabled)())}));return function(){return e.apply(this,arguments)}}(),n.requestBackup=function(){var e=this.backgroundApi,t=e.appSelector,r=e.dispatch;t((function(e){return e.cloudBackup})).enabled&&(r((0,_.incrBackupRequests)()),$.appEventBus.emit($.AppEventBusNames.BackupRequired))},n.removeBackup=function(){var e=(0,O.default)((function*(e){try{(yield K.deleteFile(this.getBackupPath(e)))&&this.listBackups.clear()}catch(t){G.default.cloudBackup.error(t.message)}}));return function(t){return e.apply(this,arguments)}}(),n.loginIfNeeded=function(){var e=(0,O.default)((function*(e){return K.loginIfNeeded(e)}));return function(t){return e.apply(this,arguments)}}(),n.saveDataToCloud=function(){var e=(0,O.default)((function*(e){if(z.default){var t=yield this.ensureUUID();if(!t)throw Error("Invalid backup uuid.");var r=this.getTempFilePath(t);if(!r)throw new Error("Invalid local temp file path.");yield z.default.writeFile(r,e,"utf8"),G.default.cloudBackup.debug(`Backup file ${r} written.`),yield K.uploadToCloud(r,this.getBackupPath(t)),yield z.default.unlink(r),G.default.cloudBackup.debug(`Backup file ${r} deleted.`)}}));return function(t){return e.apply(this,arguments)}}(),(0,T.default)(r)}(Y.default),(0,C.default)(w.prototype,"getDataForBackup",[o],Object.getOwnPropertyDescriptor(w.prototype,"getDataForBackup"),w.prototype),(0,C.default)(w.prototype,"backupNow",[i],Object.getOwnPropertyDescriptor(w.prototype,"backupNow"),w.prototype),(0,C.default)(w.prototype,"initCloudBackup",[a],Object.getOwnPropertyDescriptor(w.prototype,"initCloudBackup"),w.prototype),(0,C.default)(w.prototype,"getBackupStatus",[c],Object.getOwnPropertyDescriptor(w.prototype,"getBackupStatus"),w.prototype),(0,C.default)(w.prototype,"getPreviousBackups",[u],Object.getOwnPropertyDescriptor(w.prototype,"getPreviousBackups"),w.prototype),(0,C.default)(w.prototype,"getBackupDetailsWithRemoteData",[s],Object.getOwnPropertyDescriptor(w.prototype,"getBackupDetailsWithRemoteData"),w.prototype),(0,C.default)(w.prototype,"getBackupDetails",[d],Object.getOwnPropertyDescriptor(w.prototype,"getBackupDetails"),w.prototype),(0,C.default)(w.prototype,"restoreFromPrivateBackup",[p],Object.getOwnPropertyDescriptor(w.prototype,"restoreFromPrivateBackup"),w.prototype),(0,C.default)(w.prototype,"restoreFromBackup",[l],Object.getOwnPropertyDescriptor(w.prototype,"restoreFromBackup"),w.prototype),(0,C.default)(w.prototype,"enableService",[f],Object.getOwnPropertyDescriptor(w.prototype,"enableService"),w.prototype),(0,C.default)(w.prototype,"disableService",[y],Object.getOwnPropertyDescriptor(w.prototype,"disableService"),w.prototype),(0,C.default)(w.prototype,"requestBackup",[h],Object.getOwnPropertyDescriptor(w.prototype,"requestBackup"),w.prototype),(0,C.default)(w.prototype,"removeBackup",[v],Object.getOwnPropertyDescriptor(w.prototype,"removeBackup"),w.prototype),(0,C.default)(w.prototype,"loginIfNeeded",[g],Object.getOwnPropertyDescriptor(w.prototype,"loginIfNeeded"),w.prototype),k=w))||k)},153377:(e,t,r)=>{r.r(t),r.d(t,{default:()=>O});var n,o,i,a,c,u,s,d,p=r(634795),l=r(887371),f=r(545754),y=r(411987),h=r(695058),v=r(859375),g=r(99268),k=r(438760),w=r(922073),b=r(986903),m=r(201882);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,h.default)(e);if(t){var o=(0,h.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,y.default)(this,r)}}const O=(n=(0,k.backgroundClass)(),o=(0,k.backgroundMethod)(),i=(0,k.backgroundMethod)(),a=(0,k.backgroundMethod)(),c=(0,k.backgroundMethod)(),u=(0,k.backgroundMethod)(),n((d=function(e){(0,f.default)(r,e);var t=A(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.buildEvmCalldata=function(e){var t=e.abi,r=e.method,n=e.params,o=new g.Interface(t);return o.encodeFunctionData(o.getFunction(r),n)},n.parseJsonResponse=function(e){var t=e.abi,r=e.method,n=e.data,o=new g.Interface(t);return o.decodeFunctionResult(o.getFunction(r),n)},n.buildWrapTransaction=function(){var e=(0,p.default)((function*(){return this.buildEvmCalldata({abi:b.WETH9_ABI,method:"deposit",params:[]})}));return function(){return e.apply(this,arguments)}}(),n.buildUnwrapTransaction=function(){var e=(0,p.default)((function*(e){return this.buildEvmCalldata({abi:b.WETH9_ABI,method:"withdraw",params:[e]})}));return function(t){return e.apply(this,arguments)}}(),n.buildLidoStakeTransaction=function(){var e=(0,p.default)((function*(){return this.buildEvmCalldata({abi:w.stETHABI,method:"submit",params:["0xc1e92BD5d1aa6e5f5F299D0490BefD9D8E5a887a"]})}));return function(){return e.apply(this,arguments)}}(),n.buildERC20PermitData=function(){var e=(0,p.default)((function*(e){var t=e.eip712Domain,r=e.eip712Message,n={name:t.name,version:t.version,chainId:t.chainId,verifyingContract:t.verifyingContract},o={owner:r.owner,spender:r.spender,value:r.value,nonce:r.nonce,deadline:r.deadline};return JSON.stringify({types:{EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],Permit:[{name:"owner",type:"address"},{name:"spender",type:"address"},{name:"value",type:"uint256"},{name:"nonce",type:"uint256"},{name:"deadline",type:"uint256"}]},domain:n,primaryType:"Permit",message:o})}));return function(t){return e.apply(this,arguments)}}(),n.ethCallWithABI=function(){var e=(0,p.default)((function*(e){var t=e.abi,r=e.method,n=e.params,o=e.networkId,i=e.to,a=this.buildEvmCalldata({abi:t,method:r,params:n}),c=this.backgroundApi.engine,u=yield c.proxyJsonRPCCall(o,{method:"eth_call",params:[{to:i,data:a},"latest"]});return this.parseJsonResponse({abi:t,method:r,data:u})}));return function(t){return e.apply(this,arguments)}}(),(0,l.default)(r)}(m.default),(0,v.default)(d.prototype,"buildWrapTransaction",[o],Object.getOwnPropertyDescriptor(d.prototype,"buildWrapTransaction"),d.prototype),(0,v.default)(d.prototype,"buildUnwrapTransaction",[i],Object.getOwnPropertyDescriptor(d.prototype,"buildUnwrapTransaction"),d.prototype),(0,v.default)(d.prototype,"buildLidoStakeTransaction",[a],Object.getOwnPropertyDescriptor(d.prototype,"buildLidoStakeTransaction"),d.prototype),(0,v.default)(d.prototype,"buildERC20PermitData",[c],Object.getOwnPropertyDescriptor(d.prototype,"buildERC20PermitData"),d.prototype),(0,v.default)(d.prototype,"ethCallWithABI",[u],Object.getOwnPropertyDescriptor(d.prototype,"ethCallWithABI"),d.prototype),s=d))||s)},958019:(e,t,r)=>{r.r(t),r.d(t,{default:()=>v});var n,o,i,a,c=r(634795),u=r(887371),s=r(545754),d=r(411987),p=r(695058),l=r(859375),f=r(438760),y=r(201882);function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var o=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var v=(n=(0,f.backgroundClass)(),o=(0,f.backgroundMethod)(),n((a=function(e){(0,s.default)(r,e);var t=h(r);function r(){return t.apply(this,arguments)}return r.prototype.getFiatMoney=function(){var e=(0,c.default)((function*(){var e=this.backgroundApi,t=e.engine,r=e.servicePrice,n=yield t.listFiats();return r.updateFiatMoneyMap(n)}));return function(){return e.apply(this,arguments)}}(),(0,u.default)(r)}(y.default),(0,l.default)(a.prototype,"getFiatMoney",[o],Object.getOwnPropertyDescriptor(a.prototype,"getFiatMoney"),a.prototype),i=a))||i)},471235:(e,t,r)=>{r.r(t),r.d(t,{default:()=>V});var n,o,i,a,c,u,s,d,p,l,f,y,h=r(256666),v=r(968079),g=r(609850),k=r.n(g),w=r(634795),b=r(254073),m=r.n(b),A=r(887371),O=r(545754),I=r(411987),P=r(695058),T=r(859375),S=r(291026),D=r(534756),M=r(859071),C=r(318207),N=r(481047),R=r(906651),j=(r(834298),r(776553)),E=r(593104),x=r(438760),_=r(402814),B=r(613549),F=(r(213208),r(257958)),W=r(201882);function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){(0,h.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function H(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,P.default)(e);if(t){var o=(0,P.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,I.default)(this,r)}}const V=(n=(0,x.backgroundClass)(),o=(0,x.backgroundMethod)(),i=(0,x.backgroundMethod)(),a=(0,x.backgroundMethod)(),c=(0,x.backgroundMethod)(),u=(0,x.backgroundMethod)(),s=(0,x.backgroundMethod)(),d=(0,x.backgroundMethod)(),p=(0,x.backgroundMethod)(),l=(0,x.backgroundMethod)(),n((y=function(e){(0,O.default)(n,e);var t=H(n);function n(){for(var e,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).isSendConfirmModalVisible=!1,e._openModalByRouteParams=function(t){var n=t.modalParams;t.routeParams,t.routeNames;setTimeout((function(){return function(){var e;return null==(e=r.g.$navigationRef.current)?void 0:e.navigate(n.screen,n.params)}()}),e.isSendModalExisting()?1e3:0)},e._openModalByRouteParamsDebounced=m()(e._openModalByRouteParams,800,{leading:!1,trailing:!0}),e}var o=n.prototype;return o.setSendConfirmModalVisible=function(e){var t=e.visible;this.isSendConfirmModalVisible=t},o.processBatchTransactionOneByOne=function(){var e=(0,w.default)((function*(e){var t=this,r=e.run;this.isSendConfirmModalVisible=!0,yield r(),yield(0,_.waitForDataLoaded)({data:function(){return!t.isSendConfirmModalVisible},timeout:(0,j.getTimeDurationMs)({minute:1}),logName:"processBatchTransactionOneByOne wait isSendConfirmModalVisible"}),yield(0,j.wait)(1e3)}));return function(t){return e.apply(this,arguments)}}(),o.getActiveConnectedAccountsAsync=function(){var e=(0,w.default)((function*(e){var t=e.origin,r=e.impl;return this.getActiveConnectedAccounts({origin:t,impl:r})}));return function(t){return e.apply(this,arguments)}}(),o.getActiveConnectedAccounts=function(e){var t=this,r=e.origin,n=e.impl,o=this.backgroundApi.appSelector,i=(0,M.getActiveWalletAccount)(),a=i.accountAddress,c=i.accountId,u=i.account,s=this.getAccountAddress({accountAddress:a,account:u}),d=o((function(e){return e.dapp.connections}));o((function(e){return e.status})).isUnlock;if(!r)return[];var p=d.filter((function(e){try{return new URL(e.site.origin).hostname===new URL(r).hostname&&e.networkImpl===n}catch(t){return!1}})).filter((function(e){return e.address&&e.networkImpl}));if(p.length){var l=k()(p),f=[];return l.forEach((function(e){(0,D.isAccountCompatibleWithNetwork)(c,`${e.networkImpl}${B.SEPERATOR}1`)&&n!==B.IMPL_COSMOS&&e.address!==s&&(e.address=s,f.push((0,R.dappUpdateSiteConnectionAddress)(e)))})),f.length&&setTimeout((function(){var e;(e=t.backgroundApi).dispatch.apply(e,f)}),800),l}return p},o.getAccountAddress=function(e){var t=e.accountAddress,r=e.account;if(!r)return"";if((0,B.isLightningNetwork)(r.coinType)){var n=r.addresses&&r.addresses.length?JSON.parse(r.addresses):{};return(null==n?void 0:n.hashAddress)||""}return t},o.saveConnectedAccounts=function(){var e=(0,w.default)((function*(e){var t;if(null==e||null==(t=e.site)||!t.origin)throw new Error("saveConnectedAccounts ERROR: origin is empty");return this.backgroundApi.dispatch((0,R.dappSaveSiteConnection)(e)),Promise.resolve()}));return function(t){return e.apply(this,arguments)}}(),o.removeConnectedAccounts=function(e){var t=this;this.backgroundApi.dispatch((0,R.dappRemoveSiteConnections)(e)),setTimeout((function(){t.backgroundApi.serviceAccount.notifyAccountsChanged()}),1500)},o.cancelConnectedSite=function(){var e=(0,w.default)((function*(e){var t;this.backgroundApi.walletConnect.connector&&(null==(t=this.backgroundApi.walletConnect.connector.peerMeta)?void 0:t.url)===e.site.origin&&this.backgroundApi.walletConnect.disconnect(),this.removeConnectedAccounts({origin:e.site.origin,networkImpl:e.networkImpl,addresses:[e.address]}),yield this.backgroundApi.serviceAccount.notifyAccountsChanged()}));return function(t){return e.apply(this,arguments)}}(),o.getWalletConnectSession=function(){var e=(0,w.default)((function*(){if(this.backgroundApi.walletConnect.connector){var e=this.backgroundApi.walletConnect.connector.session;return Promise.resolve(this.backgroundApi.walletConnect.connector.connected?e:null)}}));return function(){return e.apply(this,arguments)}}(),o.getWalletConnectSessionV2=function(){var e=(0,w.default)((function*(){var e,t,r,n=[];null!=this&&null!=(e=this.backgroundApi)&&null!=(t=e.walletConnect)&&t.web3walletV2&&(n=null!=(r=(yield this.backgroundApi.walletConnect.getActiveSessionsV2()).sessions)?r:[]);return Promise.resolve({sessions:n})}));return function(){return e.apply(this,arguments)}}(),o.authorizedRequired=function(e){if(!this.isDappAuthorized(e))throw S.web3Errors.provider.unauthorized()},o.isDappAuthorized=function(e){var t;if(!e.scope)return!1;if(!e.origin)return!1;var r=(0,_.getNetworkImplFromDappScope)(e.scope);if(!r)return!1;var n=null==(t=this.backgroundApi.serviceDapp)?void 0:t.getActiveConnectedAccounts({origin:e.origin,impl:r});return Boolean(n&&n.length)},o.openConnectionModal=function(){var e=(0,w.default)((function*(e,t){var r=yield this.openModal({request:e,screens:[N.ModalRoutes.DappConnectionModal,N.DappConnectionModalRoutes.ConnectionModal],params:t});return yield(0,j.wait)(200),this.backgroundApi.serviceAccount.notifyAccountsChanged(),yield(0,j.wait)(200),r}));return function(t,r){return e.apply(this,arguments)}}(),o.openSignAndSendModal=function(e,t){return this.openModal({request:e,screens:[N.ModalRoutes.Send,N.SendModalRoutes.SendConfirmFromDapp],params:t,isAuthorizedRequired:!0})},o.openAddTokenModal=function(e,t){return this.openModal({request:e,screens:[N.ModalRoutes.ManageToken,N.ManageTokenModalRoutes.AddToken],params:t})},o.openAddNetworkModal=function(e,t){return this.openModal({request:e,screens:[N.ModalRoutes.ManageNetwork,N.ManageNetworkModalRoutes.AddNetworkConfirm],params:t})},o.openSwitchNetworkModal=function(e,t){return this.openModal({request:e,screens:[N.ModalRoutes.ManageNetwork,N.ManageNetworkModalRoutes.SwitchNetwork],params:t})},o.openInscribeTransferModal=function(e,t){return this.openModal({request:e,screens:[N.ModalRoutes.Inscribe,N.InscribeModalRoutes.InscribeTransferFromDapp],params:t,isAuthorizedRequired:!0})},o.openSwitchRpcModal=function(e,t){return this.openModal({request:e,screens:[N.ModalRoutes.ManageNetwork,N.ManageNetworkModalRoutes.SwitchRpc],params:t})},o.isSendModalExisting=function(){return(0,E.isSendModalRouteExisting)()},o.openModal=function(){var e=(0,w.default)((function*(e){var t,r=this,n=e.request,o=e.screens,i=void 0===o?[]:o,a=e.params,c=void 0===a?{}:a,u=e.isAuthorizedRequired,s=(0,M.getActiveWalletAccount)().network,d=!this.isDappAuthorized(n),p=!(0,_.isDappScopeMatchNetwork)(n.scope,(null==s?void 0:s.impl)===B.IMPL_TBTC?B.IMPL_BTC:null==s?void 0:s.impl),l=!0,f=(null==(t=n.data)?void 0:t.method)||"",y=`OneKey Wallet chain/network not matched. method=${f} scope=${n.scope||""} origin=${n.origin||""}`;return u&&d&&(p=!0),p&&"https://opensea.io"===n.origin&&"solana"===n.scope&&(null==s?void 0:s.impl)!==B.IMPL_SOL&&(l=!1),p&&"nostr"===n.scope&&(p=!1),new Promise((function(e,t){var o=r.backgroundApi.servicePromise.createCallback({resolve:e,reject:t}),a=i;p&&(a=[N.ModalRoutes.DappConnectionModal,N.DappConnectionModalRoutes.NetworkNotMatchModal]);var s=[N.RootRoutes.Modal].concat((0,v.default)(a)),h={id:o,origin:n.origin||"",hostname:F.default.getHostNameFromUrl({url:n.origin||""}),scope:n.scope,data:n.data},g={query:JSON.stringify(U(U({sourceInfo:h},c),{},{_$t:Date.now()}),(function(e,t){return"bigint"===typeof t?t.toString():t}))},k=(0,C.buildModalRouteParams)({screens:s,routeParams:g});if((0,_.ensureSerializable)(k),p)if(l&&r._openModalByRouteParamsDebounced({routeNames:s,routeParams:g,modalParams:k}),"eth_requestAccounts"===f)e([]);else{var w=new Error(y);u&&d&&(w=S.web3Errors.provider.unauthorized()),t(w)}else r._openModalByRouteParamsDebounced({routeNames:s,routeParams:g,modalParams:k})}))}));return function(t){return e.apply(this,arguments)}}(),o.sendWebEmbedMessage=function(e){var t=this;return new Promise((function(r,n){var o=t.backgroundApi.servicePromise.createCallback({resolve:r,reject:n});t.backgroundApi.providers.$private.handleMethods({data:{method:e.method,event:e.event,send:t.backgroundApi.sendForProvider("$private"),promiseId:o,params:e.params}})}))},(0,A.default)(n)}(W.default),(0,T.default)(y.prototype,"setSendConfirmModalVisible",[o],Object.getOwnPropertyDescriptor(y.prototype,"setSendConfirmModalVisible"),y.prototype),(0,T.default)(y.prototype,"getActiveConnectedAccountsAsync",[i],Object.getOwnPropertyDescriptor(y.prototype,"getActiveConnectedAccountsAsync"),y.prototype),(0,T.default)(y.prototype,"saveConnectedAccounts",[a],Object.getOwnPropertyDescriptor(y.prototype,"saveConnectedAccounts"),y.prototype),(0,T.default)(y.prototype,"removeConnectedAccounts",[c],Object.getOwnPropertyDescriptor(y.prototype,"removeConnectedAccounts"),y.prototype),(0,T.default)(y.prototype,"cancelConnectedSite",[u],Object.getOwnPropertyDescriptor(y.prototype,"cancelConnectedSite"),y.prototype),(0,T.default)(y.prototype,"getWalletConnectSession",[s],Object.getOwnPropertyDescriptor(y.prototype,"getWalletConnectSession"),y.prototype),(0,T.default)(y.prototype,"getWalletConnectSessionV2",[d],Object.getOwnPropertyDescriptor(y.prototype,"getWalletConnectSessionV2"),y.prototype),(0,T.default)(y.prototype,"openConnectionModal",[p],Object.getOwnPropertyDescriptor(y.prototype,"openConnectionModal"),y.prototype),(0,T.default)(y.prototype,"sendWebEmbedMessage",[l],Object.getOwnPropertyDescriptor(y.prototype,"sendWebEmbedMessage"),y.prototype),f=y))||f)},239565:(e,t,r)=>{r.r(t),r.d(t,{default:()=>w});var n,o,i,a,c=r(634795),u=r(887371),s=r(545754),d=r(411987),p=r(695058),l=r(859375),f=r(992431),y=r(112889),h=r(438760),v=r(292147),g=r(201882);function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var o=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}const w=(n=(0,h.backgroundClass)(),o=(0,h.backgroundMethod)(),n((a=function(e){(0,s.default)(r,e);var t=k(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getUrlKey=function(e){var t=e;try{var r=new URL(e);t=`${r.origin}${r.pathname}${r.search}`}catch(n){v.default.common.error(`failed to get url key: ${e}`)}return t},n.fetchUrlInfo=function(){var e=(0,c.default)((function*(e){var t=`${this.baseUrl}/url_info`;return(yield this.client.post(t,{url:e})).data}));return function(t){return e.apply(this,arguments)}}(),n.getUrlMeta=function(){var e=(0,c.default)((function*(e){var t=e.url,r=this.getUrlKey(t),n=yield f.default.urlInfo.getItem(r);if(n)return n;try{var o=yield this.fetchUrlInfo(t);if(o){var i={title:o.title,icon:o.icon};return yield f.default.urlInfo.setItem(r,i),i}}catch(a){return v.default.common.error(`failed to fetch dapp url info with reason ${a.message}`),{title:"",icon:""}}}));return function(t){return e.apply(this,arguments)}}(),(0,u.default)(r,[{key:"baseUrl",get:function(){return`${(0,y.getFiatEndpoint)()}/discover`}}]),r}(g.default),(0,l.default)(a.prototype,"getUrlMeta",[o],Object.getOwnPropertyDescriptor(a.prototype,"getUrlMeta"),a.prototype),i=a))||i)},93200:(e,t,r)=>{r.r(t),r.d(t,{default:()=>x});var n,o,i,a,c,u,s,d,p,l,f,y,h,v=r(256666),g=r(196234),k=r(634795),w=r(887371),b=r(545754),m=r(411987),A=r(695058),O=r(859375),I=r(206391),P=r.n(I),T=r(940915),S=r(997293),D=r(438760),M=r(613549),C=r(292147),N=r(201882);function R(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?R(Object(r),!0).forEach((function(t){(0,v.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,A.default)(e);if(t){var o=(0,A.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,m.default)(this,r)}}var x=(n=(0,D.backgroundClass)(),o=(0,D.backgroundMethod)(),i=(0,D.backgroundMethod)(),a=(0,D.backgroundMethod)(),c=(0,D.backgroundMethod)(),u=(0,D.backgroundMethod)(),s=(0,D.backgroundMethod)(),d=(0,D.backgroundMethod)(),p=(0,D.backgroundMethod)(),l=(0,D.backgroundMethod)(),f=(0,D.backgroundMethod)(),n((h=function(e){(0,b.default)(r,e);var t=E(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getDerivationSelectOptions=function(){var e=(0,k.default)((function*(e,t){if(!t||!e)return[];var r=yield this.backgroundApi.engine.getWalletOnlyVault(t,e),n=yield r.getAccountNameInfoMap();return Object.entries(n).map((function(e){var t=(0,g.default)(e,2),r=t[0];return j(j({},t[1]),{},{key:r})}))}));return function(t,r){return e.apply(this,arguments)}}(),n.getNetworkDerivations=function(){var e=(0,k.default)((function*(e,t){var r=yield this.backgroundApi.engine.dbApi.getAccountDerivationByWalletId({walletId:e}),n=yield this.backgroundApi.engine.getWalletOnlyVault(t,e),o=yield n.getAccountNameInfoMap(),i=Object.entries(r).filter((function(e){var t=(0,g.default)(e,2),r=(t[0],t[1]);return Object.values(o).find((function(e){return e.template===r.template}))})).map((function(e){var t=(0,g.default)(e,2),r=t[0];return j(j({},t[1]),{},{key:r})})),a=i.length<=1&&!n.settings.isUTXOModel,c=i.length>0?i[0]:o.default;return{shouldQuickCreate:a,quickCreateAccountInfo:a?c:null,networkDerivations:i,accountNameInfo:o}}));return function(t,r){return e.apply(this,arguments)}}(),n.createNewAccount=function(){var e=(0,k.default)((function*(e,t,r,n){var o=this.backgroundApi,i=o.serviceAccountSelector,a=o.serviceAccount,c=o.engine,u=yield Promise.all([c.getWallet(t),this.getNetworkDerivations(t,r)]),s=(0,g.default)(u,2),d=s[0],p=s[1],l=p.shouldQuickCreate,f=p.quickCreateAccountInfo,y=p.accountNameInfo,h=n||l&&(null==f?void 0:f.template);if(!h)throw new T.OneKeyInternalError("create account should pass template param.");var v=Object.values(y).find((function(e){return e.template===h}));if(!v)throw new T.OneKeyInternalError("can not find accountInfo.");var k,w=v.prefix,b=v.category,m=`${w} #${(0,S.getNextAccountId)(d.nextAccountIds,h)+1}`,A=parseInt(b.split("'/")[0]);i.preloadingCreateAccount({walletId:t,networkId:r,template:n});try{var O=yield a.addHDAccounts(e,t,r,void 0,[m],A,!1,h);k=null==O?void 0:O[0]}finally{var I;i.preloadingCreateAccountDone({walletId:t,networkId:r,accountId:null==(I=k)?void 0:I.id,template:h})}}));return function(t,r,n,o){return e.apply(this,arguments)}}(),n.getHWAddressByTemplate=function(){var e=(0,k.default)((function*(e){var t=e.networkId,r=e.walletId,n=e.index,o=e.template,i=e.fullPath||o.replace(M.INDEX_PLACEHOLDER,n.toString()),a=yield this.backgroundApi.engine.getWalletOnlyVault(t,r);if(!(yield this.backgroundApi.engine.getHWDeviceByWalletId(r)))throw new T.OneKeyInternalError("Device not found.");try{var c=yield a.keyring.getAddress({path:i,showOnOneKey:!0,isTemplatePath:!0});if(!c)throw new T.OneKeyInternalError("Address not found.");var u=!0;return a.settings.isUTXOModel&&(u=yield a.checkAccountExistence(c,!0)),{index:n,path:i,address:c,displayAddress:yield this.backgroundApi.engine.getDisplayAddress(t,c),accountExist:u}}catch(s){throw(s||{}).className===T.OneKeyErrorClassNames.OneKeyHardwareError?s:new T.OneKeyHardwareError({message:"Failed to get address"})}}));return function(t){return e.apply(this,arguments)}}(),n.getAllUsedAddress=function(){var e=(0,k.default)((function*(e){var t=e.accountId,r=e.networkId;return t&&r?(yield this.backgroundApi.engine.getVault({networkId:r,accountId:t})).getAllUsedAddress():[]}));return function(t){return e.apply(this,arguments)}}(),n.batchGetHWAddress=function(){var e=(0,k.default)((function*(e){var t=this,r=e.networkId,n=e.walletId,o=e.indexes,i=e.confirmOnDevice,a=e.template,c=e.fullPaths,u=yield this.backgroundApi.engine.getWalletOnlyVault(r,n);if(!(yield this.backgroundApi.engine.getHWDeviceByWalletId(n)))throw new T.OneKeyInternalError("Device not found.");var s=c?c.map((function(e){return{path:e,showOnOneKey:i}})):o.map((function(e){return{path:a.replace(M.INDEX_PLACEHOLDER,e.toString()),showOnOneKey:i}})),d=yield u.keyring.batchGetAddress(s);return Promise.all(d.map(function(){var e=(0,k.default)((function*(e,n){var i=yield t.convertPlainAddressItemToImportableHDAccount(j({networkId:r},e));return j(j(j({},i),e),{},{index:null==o?void 0:o[n]})}));return function(t,r){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),n.convertPlainAddressItemToImportableHDAccount=function(){var e=(0,k.default)((function*(e){var t=e.networkId,r=e.address,n=e.path;return{displayAddress:yield this.backgroundApi.engine.getDisplayAddress(t,r),path:n,index:-1,defaultName:"",mainBalance:"0"}}));return function(t){return e.apply(this,arguments)}}(),n.createAccountByCustomAddressIndex=function(){var e=(0,k.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.password,o=e.template,i=e.addressIndex,a=e.account;if(!a)throw new Error("no account");var c=yield this.backgroundApi.engine.getVault({networkId:t,accountId:r}),u=a.path.split("/")[3].slice(0,-1);try{var s,d=yield c.keyring.prepareAccountByAddressIndex({password:n,template:o,accountIndex:Number(u),addressIndex:Number(i)});if(d.length)yield this.backgroundApi.engine.dbApi.updateUTXOAccountAddresses({accountId:r,addresses:null!=(s=d[0].customAddresses)?s:{},isCustomPath:!0})}catch(p){throw C.default.common.error("createAccountByCustomAddressIndex error: ",p),p}}));return function(t){return e.apply(this,arguments)}}(),n.removeCustomAddress=function(){var e=(0,k.default)((function*(e){var t=e.accountId,r=e.addresses;Object.keys(r).length&&(yield this.backgroundApi.engine.dbApi.removeUTXOAccountAddresses({accountId:t,addresses:r,isCustomPath:!0}))}));return function(t){return e.apply(this,arguments)}}(),n.fetchCustomAddressBalance=function(){var e=(0,k.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.addresses,o=e.decimals,i=yield this.backgroundApi.engine.getVault({networkId:t,accountId:r}),a=yield i.getBalancesByAddress(n.map((function(e){return{address:e}})));return n.map((function(e,t){var r;return{address:e,balance:new(P())(null!=(r=a[t])?r:0).shiftedBy(-o).toFixed()}}))}));return function(t){return e.apply(this,arguments)}}(),(0,w.default)(r)}(N.default),(0,O.default)(h.prototype,"getDerivationSelectOptions",[o],Object.getOwnPropertyDescriptor(h.prototype,"getDerivationSelectOptions"),h.prototype),(0,O.default)(h.prototype,"getNetworkDerivations",[i],Object.getOwnPropertyDescriptor(h.prototype,"getNetworkDerivations"),h.prototype),(0,O.default)(h.prototype,"createNewAccount",[a],Object.getOwnPropertyDescriptor(h.prototype,"createNewAccount"),h.prototype),(0,O.default)(h.prototype,"getHWAddressByTemplate",[c],Object.getOwnPropertyDescriptor(h.prototype,"getHWAddressByTemplate"),h.prototype),(0,O.default)(h.prototype,"getAllUsedAddress",[u],Object.getOwnPropertyDescriptor(h.prototype,"getAllUsedAddress"),h.prototype),(0,O.default)(h.prototype,"batchGetHWAddress",[s],Object.getOwnPropertyDescriptor(h.prototype,"batchGetHWAddress"),h.prototype),(0,O.default)(h.prototype,"convertPlainAddressItemToImportableHDAccount",[d],Object.getOwnPropertyDescriptor(h.prototype,"convertPlainAddressItemToImportableHDAccount"),h.prototype),(0,O.default)(h.prototype,"createAccountByCustomAddressIndex",[p],Object.getOwnPropertyDescriptor(h.prototype,"createAccountByCustomAddressIndex"),h.prototype),(0,O.default)(h.prototype,"removeCustomAddress",[l],Object.getOwnPropertyDescriptor(h.prototype,"removeCustomAddress"),h.prototype),(0,O.default)(h.prototype,"fetchCustomAddressBalance",[f],Object.getOwnPropertyDescriptor(h.prototype,"fetchCustomAddressBalance"),h.prototype),y=h))||y)},661242:(e,t,r)=>{r.r(t),r.d(t,{default:()=>q});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A=r(256666),O=r(968079),I=r(634795),P=r(887371),T=r(545754),S=r(411987),D=r(695058),M=r(859375),C=r(608733),N=r(636393),R=r(112889),j=r(633416),E=r(195212),x=r(520192),_=r(929377),B=r(59984),F=r(438760),W=r(292147),L=r(201882);function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){(0,A.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function V(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,D.default)(e);if(t){var o=(0,D.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,S.default)(this,r)}}const q=(n=(0,F.backgroundClass)(),o=(0,F.backgroundMethod)(),i=(0,F.backgroundMethod)(),a=(0,F.backgroundMethod)(),c=(0,F.backgroundMethod)(),u=(0,F.backgroundMethod)(),s=(0,F.backgroundMethod)(),d=(0,F.backgroundMethod)(),p=(0,F.backgroundMethod)(),l=(0,F.backgroundMethod)(),f=(0,F.backgroundMethod)(),y=(0,F.backgroundMethod)(),h=(0,F.backgroundMethod)(),v=(0,F.backgroundMethod)(),g=(0,F.backgroundMethod)(),k=(0,F.backgroundMethod)(),w=(0,F.backgroundMethod)(),n((m=function(e){(0,T.default)(r,e);var t=V(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getLanguage=function(){var e=(0,this.backgroundApi.appSelector)((function(e){return e.settings.locale}));return"system"===e?(0,_.getDefaultLocale)():e},n.init=function(){this.migrateFavorite(),this.organizeHistory(),this.clearData()},n.clearData=function(){var e=this.backgroundApi.dispatch;e((0,x.cleanOldState)()),e((0,E.clearTranslations)())},n.migrateFavorite=function(){var e=(0,I.default)((function*(){var e=this.backgroundApi,t=e.dispatch,r=e.appSelector,n=r((function(e){return e.discover.dappFavorites})),o=r((function(e){return e.discover.favoritesMigrated})),i=r((function(e){return e.discover.bookmarks}));if(!o&&n&&0!==n.length){for(var a=n.map((function(e){return{id:N.default.v4(),url:e}})),c=0;c<a.length;c+=1){var u=a[c],s=yield this.getUrlInfo(u.url);s&&(u.title=s.title,u.icon=s.icon)}i&&(a=i.concat(a)),W.default.common.info(`migrate favorite to bookmarks ${JSON.stringify(a)}`),t((0,x.resetBookmarks)(a),(0,x.setFavoritesMigrated)())}}));return function(){return e.apply(this,arguments)}}(),n.organizeHistory=function(){var e=this.backgroundApi,t=e.appSelector,r=e.dispatch,n=t((function(e){return e.discover.userBrowserHistories})),o=[];if(n&&n.length>0){var i=null==n?void 0:n.filter((function(e){return!e.timestamp}));if(i.length>0){var a=i.map((function(e){return(0,x.updateUserBrowserHistory)({url:e.url,timestamp:Date.now()})}));o=o.concat(a)}var c=Date.now(),u=n.filter((function(e){return e.timestamp&&c-e.timestamp>2592e6}));if(u.length){var s=u.map((function(e){return(0,x.removeUserBrowserHistory)({url:e.url})}));o=o.concat(s)}}o.length>0&&r.apply(void 0,(0,O.default)(o))},n.getCategoryDapps=function(){var e=(0,I.default)((function*(e){var t=`${this.baseUrl}/get_listing_category_dapps`;return(yield this.client.get(t,{params:{categoryId:e,language:this.getLanguage()}})).data}));return function(t){return e.apply(this,arguments)}}(),n.getTagDapps=function(){var e=(0,I.default)((function*(e){var t=`${this.baseUrl}/get_listing_tag_dapps`;return(yield this.client.get(t,{params:{tagId:e,language:this.getLanguage()}})).data}));return function(t){return e.apply(this,arguments)}}(),n.getDappsByIds=function(){var e=(0,I.default)((function*(e){var t=`${this.baseUrl}/get_listing_dapps`;return(yield this.client.post(t,{dappIds:e})).data}));return function(t){return e.apply(this,arguments)}}(),n.searchDapps=function(){var e=(0,I.default)((function*(e){var t=`${this.baseUrl}/search_dapps?keyword=${e}`;return(yield this.client.get(t)).data}));return function(t){return e.apply(this,arguments)}}(),n.searchDappsWithUrl=function(){var e=(0,I.default)((function*(e){var t=`${this.baseUrl}/search_dapps_by_url`;return(yield this.client.post(t,{urls:e})).data}));return function(t){return e.apply(this,arguments)}}(),n.searchDappsWithRegExp=function(){var e=(0,I.default)((function*(e){var t=`${this.baseUrl}/search_dapps_by_url_regexp`;return(yield this.client.post(t,{urls:e})).data}));return function(t){return e.apply(this,arguments)}}(),n.editFavorite=function(){var e=(0,I.default)((function*(e){var t=this.backgroundApi.dispatch;if(t((0,x.updateBookmark)(e)),e.url.trim())try{var r=yield this.getUrlInfo(e.url),n=H(H({},e),{},{icon:null==r?void 0:r.icon});t((0,x.updateBookmark)(n))}catch(o){console.error(`fetch ${e.url} url info failure`)}}));return function(t){return e.apply(this,arguments)}}(),n.getUrlInfo=function(){var e=(0,I.default)((function*(e){try{var t=yield this.searchDappsWithRegExp([e]);if(t&&t.length>0){var r=t[0];return{title:r.name,icon:r.logoURL}}var n=this.backgroundApi.serviceDappMetaData,o=yield n.getUrlMeta({url:e});if(o)return{title:o.title,icon:o.icon}}catch(i){return W.default.common.error(`failed to fetch dapp url info with reason ${i.message}`),{title:"",icon:""}}}));return function(t){return e.apply(this,arguments)}}(),n.fillInUserBrowserHistory=function(){var e=(0,I.default)((function*(e){var t=this.backgroundApi,r=t.dispatch,n=t.appSelector,o=e.dappId,i=e.url,a=n((function(e){return e.discover.userBrowserHistories}));if(a&&0!==a.length){var c=a.findIndex((function(e){return e.url===i}));if(!(c<0)){var u=a[c];if(!u.logoUrl||!u.title){var s="",d="";if(o){var p=yield this.getDappsByIds([o]);if(p.length>0){var l=p[0];s=l.name,d=l.logoURL}}if(!s||!d){var f=yield this.getUrlInfo(i);s||(s=(null==f?void 0:f.title)||""),d||(d=(null==f?void 0:f.icon)||"")}if(s||d){var y=H({},u);!y.logoUrl&&d&&(y.logoUrl=d),!y.title&&s&&(y.title=s),r((0,x.updateUserBrowserHistory)(y))}}}}}));return function(t){return e.apply(this,arguments)}}(),n.addFavorite=function(){var e=(0,I.default)((function*(e){var t=this.backgroundApi,r=t.dispatch,n=t.serviceCloudBackup,o=N.default.v4(),i=(0,B.getWebTabs)().tabs.filter((function(t){return t.url===e}));r((0,x.addBookmark)({url:e,id:o})),(0,C.batch)((function(){i.forEach((function(e){return j.webTabsActions.setWebTabData(H(H({},e),{},{isBookmarked:!0}))}))}));var a=yield this.getUrlInfo(e);a&&r((0,x.updateBookmark)({id:o,url:e,title:a.title,icon:a.icon})),n.requestBackup()}));return function(t){return e.apply(this,arguments)}}(),n.removeFavorite=function(){var e=(0,I.default)((function*(e){var t=this.backgroundApi,r=t.dispatch,n=t.appSelector,o=t.serviceCloudBackup,i=n((function(e){return e.discover.bookmarks})),a=null==i?void 0:i.find((function(t){return t.url===e}));if(a){var c=(0,x.removeBookmark)(a),u=(0,B.getWebTabs)().tabs.filter((function(t){return t.url===e}));r(c),(0,C.batch)((function(){u.forEach((function(e){return j.webTabsActions.setWebTabData(H(H({},e),{},{isBookmarked:!1}))}))}))}o.requestBackup()}));return function(t){return e.apply(this,arguments)}}(),n.toggleFavorite=function(){var e=(0,I.default)((function*(e){if(e){var t=(0,this.backgroundApi.appSelector)((function(e){return e.discover.bookmarks})),r=null==t?void 0:t.map((function(e){return e.url}));r&&r.includes(e)?this.removeFavorite(e):this.addFavorite(e)}}));return function(t){return e.apply(this,arguments)}}(),n.removeMatchItem=function(){var e=(0,I.default)((function*(e){var t;e.dapp&&this.backgroundApi.dispatch((0,x.removeUserBrowserHistory)({url:null==(t=e.dapp)?void 0:t.url}));e.webSite&&e.webSite.url&&new URL(e.webSite.url).host&&this.backgroundApi.dispatch((0,x.removeUserBrowserHistory)({url:e.webSite.url}))}));return function(t){return e.apply(this,arguments)}}(),n.clearHistory=function(){var e=(0,I.default)((function*(){this.backgroundApi.dispatch((0,x.clearHistory)())}));return function(){return e.apply(this,arguments)}}(),n.getFeatured=function(){var e=(0,I.default)((function*(){var e=`${this.baseUrl}/get_featured`;return(yield this.client.get(e,{params:{language:this.getLanguage()}})).data}));return function(){return e.apply(this,arguments)}}(),n.getExplore=function(){var e=(0,I.default)((function*(e){var t=`${this.baseUrl}/get_explore`;return(yield this.client.get(t,{params:{language:this.getLanguage(),categoryId:e.categoryId}})).data}));return function(t){return e.apply(this,arguments)}}(),(0,P.default)(r,[{key:"baseUrl",get:function(){return`${(0,R.getFiatEndpoint)()}/discover`}}]),r}(L.default),(0,M.default)(m.prototype,"getCategoryDapps",[o],Object.getOwnPropertyDescriptor(m.prototype,"getCategoryDapps"),m.prototype),(0,M.default)(m.prototype,"getTagDapps",[i],Object.getOwnPropertyDescriptor(m.prototype,"getTagDapps"),m.prototype),(0,M.default)(m.prototype,"getDappsByIds",[a],Object.getOwnPropertyDescriptor(m.prototype,"getDappsByIds"),m.prototype),(0,M.default)(m.prototype,"searchDapps",[c],Object.getOwnPropertyDescriptor(m.prototype,"searchDapps"),m.prototype),(0,M.default)(m.prototype,"searchDappsWithUrl",[u],Object.getOwnPropertyDescriptor(m.prototype,"searchDappsWithUrl"),m.prototype),(0,M.default)(m.prototype,"searchDappsWithRegExp",[s],Object.getOwnPropertyDescriptor(m.prototype,"searchDappsWithRegExp"),m.prototype),(0,M.default)(m.prototype,"editFavorite",[d],Object.getOwnPropertyDescriptor(m.prototype,"editFavorite"),m.prototype),(0,M.default)(m.prototype,"getUrlInfo",[p],Object.getOwnPropertyDescriptor(m.prototype,"getUrlInfo"),m.prototype),(0,M.default)(m.prototype,"fillInUserBrowserHistory",[l],Object.getOwnPropertyDescriptor(m.prototype,"fillInUserBrowserHistory"),m.prototype),(0,M.default)(m.prototype,"addFavorite",[f],Object.getOwnPropertyDescriptor(m.prototype,"addFavorite"),m.prototype),(0,M.default)(m.prototype,"removeFavorite",[y],Object.getOwnPropertyDescriptor(m.prototype,"removeFavorite"),m.prototype),(0,M.default)(m.prototype,"toggleFavorite",[h],Object.getOwnPropertyDescriptor(m.prototype,"toggleFavorite"),m.prototype),(0,M.default)(m.prototype,"removeMatchItem",[v],Object.getOwnPropertyDescriptor(m.prototype,"removeMatchItem"),m.prototype),(0,M.default)(m.prototype,"clearHistory",[g],Object.getOwnPropertyDescriptor(m.prototype,"clearHistory"),m.prototype),(0,M.default)(m.prototype,"getFeatured",[k],Object.getOwnPropertyDescriptor(m.prototype,"getFeatured"),m.prototype),(0,M.default)(m.prototype,"getExplore",[w],Object.getOwnPropertyDescriptor(m.prototype,"getExplore"),m.prototype),b=m))||b)},606492:(e,t,r)=>{r.r(t),r.d(t,{default:()=>w});var n,o,i,a,c,u,s=r(634795),d=r(887371),p=r(545754),l=r(411987),f=r(695058),y=r(859375),h=r(992431),v=r(438760),g=r(201882);function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var o=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}var w=(n=(0,v.backgroundClass)(),o=(0,v.backgroundMethod)(),i=(0,v.backgroundMethod)(),a=(0,v.backgroundMethod)(),n((u=function(e){(0,p.default)(r,e);var t=k(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getExternalAccountImage=function(){var e=(0,s.default)((function*(e){var t=e.accountId;return h.default.walletConnect.getExternalAccountImage({accountId:t})}));return function(t){return e.apply(this,arguments)}}(),n.generateExternalAccountInfoFromWalletService=function(){var e=(0,s.default)((function*(e){var t=e.walletService,r=e.externalAccountType,n=h.default.walletConnect.getBaseExternalAccountInfoFromWalletService({walletService:t});return n.type=r,Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),n.saveExternalAccountInfo=function(){var e=(0,s.default)((function*(e){var t=e.accountId,r=e.accountInfo;return h.default.walletConnect.saveExternalAccountInfo({accountId:t,accountInfo:r})}));return function(t){return e.apply(this,arguments)}}(),(0,d.default)(r)}(g.default),(0,y.default)(u.prototype,"getExternalAccountImage",[o],Object.getOwnPropertyDescriptor(u.prototype,"getExternalAccountImage"),u.prototype),(0,y.default)(u.prototype,"generateExternalAccountInfoFromWalletService",[i],Object.getOwnPropertyDescriptor(u.prototype,"generateExternalAccountInfoFromWalletService"),u.prototype),(0,y.default)(u.prototype,"saveExternalAccountInfo",[a],Object.getOwnPropertyDescriptor(u.prototype,"saveExternalAccountInfo"),u.prototype),c=u))||c)},416030:(e,t,r)=>{r.r(t),r.d(t,{default:()=>A});var n,o,i,a,c,u=r(256666),s=r(634795),d=r(887371),p=r(545754),l=r(411987),f=r(695058),y=r(859375),h=r(112889),v=r(134662),g=r(438760),k=r(201882);function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){(0,u.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var o=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}const A=(n=(0,g.backgroundClass)(),o=(0,g.backgroundMethod)(),i=(0,g.backgroundMethod)(),n((c=function(e){(0,p.default)(r,e);var t=m(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getFiatPayUrl=function(){var e=(0,s.default)((function*(e){var t,r=null!=(t=(0,this.backgroundApi.appSelector)((function(e){var t,r,n;return null!=(t=null==e||null==(r=e.settings)||null==(n=r.devMode)?void 0:n.onRamperTestMode)&&t})))&&t,n=new URLSearchParams(b(b({},e),{},{mode:r?"test":"live"})),o=`${this.baseUrl}/url?${n.toString()}`;return yield this.client.get(o).then((function(e){return e.data})).catch((function(){return""}))}));return function(t){return e.apply(this,arguments)}}(),n.getFiatPayList=function(){var e=(0,s.default)((function*(e){var t=new URLSearchParams(b({},e)),r=`${this.baseUrl}/list?${t.toString()}`;return(yield this.client.get(r).then((function(e){return e.data})).catch((function(){return[]}))).map((function(e){return(0,v.formatServerToken)(e)}))}));return function(t){return e.apply(this,arguments)}}(),(0,d.default)(r,[{key:"baseUrl",get:function(){return`${(0,h.getFiatEndpoint)()}/moonpay`}}]),r}(k.default),(0,y.default)(c.prototype,"getFiatPayUrl",[o],Object.getOwnPropertyDescriptor(c.prototype,"getFiatPayUrl"),c.prototype),(0,y.default)(c.prototype,"getFiatPayList",[i],Object.getOwnPropertyDescriptor(c.prototype,"getFiatPayList"),c.prototype),a=c))||a)},306810:(e,t,r)=>{r.r(t),r.d(t,{default:()=>O});var n,o,i,a,c,u,s,d=r(634795),p=r(887371),l=r(545754),f=r(411987),y=r(695058),h=r(859375),v=r(206391),g=r.n(v),k=r(520192),w=r(438760),b=r(942013),m=r(201882);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var o=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}const O=(n=(0,w.backgroundClass)(),o=(0,w.backgroundMethod)(),i=(0,w.backgroundMethod)(),a=(0,w.backgroundMethod)(),c=(0,w.backgroundMethod)(),n((s=function(e){(0,l.default)(r,e);var t=A(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).isRefresh={},e}var n=r.prototype;return n.getGasInfo=function(){var e=(0,d.default)((function*(e){var t=e.networkId;return this.backgroundApi.engine.getGasInfo(t)}));return function(t){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=(0,d.default)((function*(e){var t=e.networkId,r=this.backgroundApi.engine;return(yield r.getChainOnlyVault(t)).getTxWaitingSeconds()}));return function(t){return e.apply(this,arguments)}}(),n.refreshGasPrice=function(){var e=(0,d.default)((function*(e){var t=e.networkId;if(!this.isRefresh[t]){var r=this.backgroundApi,n=r.engine,o=r.dispatch;this.isRefresh[t]=!0;try{var i=(yield this.getGasInfo({networkId:t})).prices[0],a="";if(a="string"===typeof i?i:i.price||Number(i.baseFee).toFixed(0)||"",t===b.OnekeyNetwork.btc){var c,u=yield n.getNetwork(t);a=`${new(g())(a).shiftedBy(null!=(c=null==u?void 0:u.feeDecimals)?c:8).toFixed()}`}o((0,k.setNetworkPrice)({networkId:t,price:a}))}finally{this.isRefresh[t]=!1}}}));return function(t){return e.apply(this,arguments)}}(),n.attachFeeInfoToDAppEncodedTx=function(){var e=(0,d.default)((function*(e){var t=e.networkId,r=e.accountId,n=this.backgroundApi.engine,o=yield n.getVault({networkId:t,accountId:r});return yield o.attachFeeInfoToDAppEncodedTx(e)}));return function(t){return e.apply(this,arguments)}}(),(0,p.default)(r)}(m.default),(0,h.default)(s.prototype,"getGasInfo",[o],Object.getOwnPropertyDescriptor(s.prototype,"getGasInfo"),s.prototype),(0,h.default)(s.prototype,"getTxWaitingSeconds",[i],Object.getOwnPropertyDescriptor(s.prototype,"getTxWaitingSeconds"),s.prototype),(0,h.default)(s.prototype,"refreshGasPrice",[a],Object.getOwnPropertyDescriptor(s.prototype,"refreshGasPrice"),s.prototype),(0,h.default)(s.prototype,"attachFeeInfoToDAppEncodedTx",[c],Object.getOwnPropertyDescriptor(s.prototype,"attachFeeInfoToDAppEncodedTx"),s.prototype),u=s))||u)},812530:(e,t,r)=>{r.r(t),r.d(t,{HTTPServiceNames:()=>p,default:()=>D,httpServerEnable:()=>S});var n,o,i,a,c,u,s,d,p,l=r(634795),f=r(887371),y=r(545754),h=r(411987),v=r(695058),g=r(859375),k=r(800129),w=r(341290),b=r(438760),m=r(35116),A=r(292147),O=r(213208),I=r(201882);function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,v.default)(e);if(t){var o=(0,v.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}!function(e){e.Migrate="/migrate",e.Other="Other"}(p||(p={}));var T=w.default.HTTPServerManager;new k.default(T);function S(){return!1}const D=(n=(0,b.backgroundClass)(),o=(0,b.backgroundMethod)(),i=(0,b.backgroundMethod)(),a=(0,b.backgroundMethod)(),c=(0,b.backgroundMethod)(),u=(0,b.backgroundMethod)(),n((d=function(e){(0,y.default)(r,e);var t=P(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.startHttpServer=function(){var e=(0,l.default)((function*(){if(!this.httpServerEnable)return Promise.resolve("");O.default.isNativeIOS}));return function(){return e.apply(this,arguments)}}(),n.listenHttpRequest=function(){this.httpServerEnable},n.receivedHttpRequest=function(e){var t=e.requestId,r=e.url;new URL(r,"http://example.com").pathname.startsWith(p.Migrate)?m.appEventBus.emit(m.AppEventBusNames.HttpServerRequest,{type:p.Migrate,data:e}):this.serverRespond({requestId:t,respondData:!0})},n.serverRespond=function(e){e.requestId,e.respondData;this.httpServerEnable},n.stopHttpServer=function(){if(this.httpServerEnable)try{0}catch(e){A.default.migrate.error("stopHttpServer",e)}},(0,f.default)(r,[{key:"httpServerEnable",get:function(){return!1}}]),r}(I.default),(0,g.default)(d.prototype,"startHttpServer",[o],Object.getOwnPropertyDescriptor(d.prototype,"startHttpServer"),d.prototype),(0,g.default)(d.prototype,"listenHttpRequest",[i],Object.getOwnPropertyDescriptor(d.prototype,"listenHttpRequest"),d.prototype),(0,g.default)(d.prototype,"receivedHttpRequest",[a],Object.getOwnPropertyDescriptor(d.prototype,"receivedHttpRequest"),d.prototype),(0,g.default)(d.prototype,"serverRespond",[c],Object.getOwnPropertyDescriptor(d.prototype,"serverRespond"),d.prototype),(0,g.default)(d.prototype,"stopHttpServer",[u],Object.getOwnPropertyDescriptor(d.prototype,"stopHttpServer"),d.prototype),s=d))||s)},141409:(e,t,r)=>{r.r(t),r.d(t,{default:()=>de});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A,O,I,P,T,S,D,M,C,N,R,j,E,x,_,B,F,W=r(72579),L=r.n(W),U=r(256666),H=r(634795),V=r(887371),q=r(545754),K=r(411987),$=r(695058),G=r(859375),z=r(703599),J=(r(940915),r(920458)),Q=r(821919),X=r(432986),Y=r(302478),Z=r(776553),ee=r(438760),te=r(799075),re=r(814817),ne=r(292147),oe=r(213208),ie=r(961500),ae=r(201882);function ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(r),!0).forEach((function(t){(0,U.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ce(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function se(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,$.default)(e);if(t){var o=(0,$.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,K.default)(this,r)}}const de=(n=(0,ee.backgroundClass)(),o=(0,ee.backgroundMethod)(),i=(0,ee.backgroundMethod)(),a=(0,ee.backgroundMethod)(),c=(0,ee.backgroundMethod)(),u=(0,ee.backgroundMethod)(),s=(0,ee.backgroundMethod)(),d=(0,ee.backgroundMethod)(),p=(0,ee.backgroundMethod)(),l=(0,ee.backgroundMethod)(),f=(0,ee.backgroundMethod)(),y=(0,ee.backgroundMethod)(),h=(0,ee.backgroundMethod)(),v=(0,ee.backgroundMethod)(),g=(0,ee.backgroundMethod)(),k=(0,ee.backgroundMethod)(),w=(0,ee.backgroundMethod)(),b=(0,ee.backgroundMethod)(),m=(0,ee.backgroundMethod)(),A=(0,ee.backgroundMethod)(),O=(0,ee.backgroundMethod)(),I=(0,ee.backgroundMethod)(),P=(0,ee.backgroundMethod)(),T=(0,ee.backgroundMethod)(),S=(0,ee.backgroundMethod)(),D=(0,ee.backgroundMethod)(),M=(0,ee.backgroundMethod)(),C=(0,ee.backgroundMethod)(),N=(0,ee.backgroundMethod)(),R=(0,ee.backgroundMethod)(),j=(0,ee.backgroundMethod)(),E=(0,ee.backgroundMethod)(),x=(0,ee.backgroundMethod)(),_=(0,ee.backgroundMethod)(),n((F=function(e){(0,q.default)(r,e);var t=se(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).connectedDeviceType="classic",e.registeredEvents=!1,e.tryCount=0,e.stopConnect=!1,e.featuresCache={},e}var n=r.prototype;return n.getSDKInstance=function(){var e=(0,H.default)((function*(){var e=this,t=this.backgroundApi.store.getState().settings.devMode||{},r=t.enable,n=t.preReleaseUpdate,o=this.backgroundApi.store.getState().settings.hardwareConnectSrc,i=n&&r;return(0,te.getHardwareSDKInstance)({isPreRelease:null!=i&&i,hardwareConnectSrc:o}).then(function(){var t=(0,H.default)((function*(t){if(!e.registeredEvents){e.registeredEvents=!0;var r=yield(0,te.CoreSDKLoader)(),n=r.LOG_EVENT,o=r.DEVICE,i=r.FIRMWARE,a=r.FIRMWARE_EVENT,c=r.UI_REQUEST,u=r.supportInputPinOnSoftware;t.on("UI_EVENT",(function(t){var r=t.type,n=t.payload;setTimeout((function(){var t=n||{},o=t.device,i=t.type,a=t.passphraseState,c=o||{},s=c.deviceType,d=c.connectId,p=c.deviceId,l=c.features,f=(l||{}).bootloader_mode,y=u(l);e.backgroundApi.dispatch((0,J.setHardwarePopup)({uiRequest:r,payload:{type:i,deviceType:s,deviceId:p,deviceConnectId:d,deviceBootLoaderMode:!!f,passphraseState:a,supportInputPinOnSoftware:y.support}}))}),0)})),t.on(n,(function(e){Array.isArray(null==e?void 0:e.payload)&&ne.default.hardwareSDK.info(e.payload.join(" "))})),t.on(o.FEATURES,function(){var t=(0,H.default)((function*(t){if(t&&t.device_id)try{var r=yield e.backgroundApi.engine.getHWDeviceByDeviceId(t.device_id);if(!r)return;try{var n=(yield e.backgroundApi.engine.getWallets()).find((function(e){return e.associatedDevice===r.id&&!(0,re.isPassphraseWallet)(e)}));n&&(e.featuresCache[n.id]=t,e.syncDeviceLabel(t,n.id))}catch(o){}e._checkPassphraseEnableStatus(r.id,t)}catch(i){}}));return function(e){return t.apply(this,arguments)}}()),t.on(a,(function(t){t.type===i.RELEASE_INFO&&e._checkFirmwareUpdate(t.payload),t.type===i.BLE_RELEASE_INFO&&e._checkBleFirmwareUpdate(t.payload)})),t.on(o.SUPPORT_FEATURES,(function(t){e._checkDeviceSettings(t)})),t.on(o.CONNECT,(function(t){var r=t.device;r.connectId&&e.backgroundApi.dispatch((0,J.addConnectedConnectId)(r.connectId))})),t.on(o.DISCONNECT,(function(t){var r=t.device;r.connectId&&e.backgroundApi.dispatch((0,J.removeConnectedConnectId)(r.connectId))})),t.on(c.PREVIOUS_ADDRESS_RESULT,(function(t){e.backgroundApi.dispatch((0,J.setPreviousAddress)(t))}))}return t}));return function(e){return t.apply(this,arguments)}}())}));return function(){return e.apply(this,arguments)}}(),n.passHardwareEventsFromOffscreenToBackground=function(){var e=(0,H.default)((function*(e){(yield this.getSDKInstance()).emit(e.event,e)}));return function(t){return e.apply(this,arguments)}}(),n.getFeatursByWalletId=function(){var e=(0,H.default)((function*(e){var t;return Promise.resolve(null!=(t=this.featuresCache[e])?t:null)}));return function(t){return e.apply(this,arguments)}}(),n.updateFeaturesCache=function(){var e=(0,H.default)((function*(e,t){if(this.featuresCache[e])return this.featuresCache[e]=ue(ue({},this.featuresCache[e]),t),Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.cleanFeaturesCache=function(){var e=(0,H.default)((function*(e){return this.featuresCache[e]&&delete this.featuresCache[e],Promise.resolve(!0)}));return function(t){return e.apply(this,arguments)}}(),n.searchDevices=function(){var e=(0,H.default)((function*(){var e=yield this.getSDKInstance();return null==e?void 0:e.searchDevices()}));return function(){return e.apply(this,arguments)}}(),n.connect=function(){var e=(0,H.default)((function*(e){return Promise.resolve(!0)}));return function(t){return e.apply(this,arguments)}}(),n.getFeatures=function(){var e=(0,H.default)((function*(e){var t=yield this.getSDKInstance(),r=(yield(0,te.CoreSDKLoader)()).getDeviceType,n=yield null==t?void 0:t.getFeatures(e);if(n.success)return this.connectedDeviceType=r(n.payload),n.payload;var o=X.deviceUtils.convertDeviceError(n.payload);return Promise.reject(o)}));return function(t){return e.apply(this,arguments)}}(),n.unlockDevice=function(){var e=(0,H.default)((function*(e){return this.getPassphraseState(e,!0)}));return function(t){return e.apply(this,arguments)}}(),n.getPassphraseState=function(){var e=(0,H.default)((function*(e,t,r){var n,o=yield this.getSDKInstance(),i=yield null==o?void 0:o.getPassphraseState(e,{initSession:!0,useEmptyPassphrase:t,deriveCardano:r});if(i.success)return null!=(n=i.payload)?n:void 0;var a=X.deviceUtils.convertDeviceError(i.payload);return Promise.reject(a)}));return function(t,r,n){return e.apply(this,arguments)}}(),n.cancel=function(){var e=(0,H.default)((function*(e){return(yield this.getSDKInstance()).cancel(e)}));return function(t){return e.apply(this,arguments)}}(),n.sendUiResponse=function(){var e=(0,H.default)((function*(e){return(yield this.getSDKInstance()).uiResponse(e)}));return function(t){return e.apply(this,arguments)}}(),n.rebootToBootloader=function(){var e=(0,H.default)((function*(e){var t=yield this.getSDKInstance();return null==t?void 0:t.deviceUpdateReboot(e).then((function(e){return e.success?e:Promise.reject(X.deviceUtils.convertDeviceError(e.payload))}))}));return function(t){return e.apply(this,arguments)}}(),n.rebootToBoardloader=function(){var e=(0,H.default)((function*(e){var t=yield this.getSDKInstance();return null==t?void 0:t.deviceRebootToBoardloader(e).then((function(e){return e.success?e:Promise.reject(X.deviceUtils.convertDeviceError(e.payload))}))}));return function(t){return e.apply(this,arguments)}}(),n.getDeviceCertWithSig=function(){var e=(0,H.default)((function*(e,t){var r=yield this.getSDKInstance();return null==r?void 0:r.deviceVerify(e,{dataHex:t}).then((function(e){return e.success?e.payload:Promise.reject(X.deviceUtils.convertDeviceError(e.payload))}))}));return function(t,r){return e.apply(this,arguments)}}(),n.autoUpdateFirmware=function(){var e=(0,H.default)((function*(e,t,r){var n,o,i,a,c,u,s=this.backgroundApi.dispatch;s((0,J.setUpdateFirmwareStep)(""));var d=yield this.getSDKInstance(),p=function(e){s((0,J.setUpdateFirmwareStep)(L()(e,"data.message","")))};d.on("ui-firmware-tip",p);var l=this.backgroundApi.appSelector((function(e){return e.settings})),f=null!=(n=null==l||null==(o=l.devMode)?void 0:o.enable)&&n,y=null!=(i=null==l||null==(a=l.devMode)?void 0:a.updateDeviceRes)&&i,h=f&&y,v=null==(c=l.deviceUpdates)||null==(u=c[e][t])?void 0:u.version;try{var g,k=yield d.firmwareUpdateV2(void 0,{updateType:t,forcedUpdateRes:h,version:v,platform:null!=(g=oe.default.symbol)?g:"web"});if("touch"===r&&k.success&&"firmware"===t){var w=yield this.updateBootloader(e);if(!w.success)return w}return k}finally{d.off("ui-firmware-tip",p)}}));return function(t,r,n){return e.apply(this,arguments)}}(),n.ensureDeviceExist=function(){var e=(0,H.default)((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise((function(n){var o=0;X.deviceUtils.startDeviceScan((function(i){var a,c;((o+=1)>t&&(X.deviceUtils.stopScan(),n(!1)),i.success)&&((r?(null!=(a=i.payload)?a:[]).length>0:(null!=(c=i.payload)?c:[]).find((function(t){return(0,ie.equalsIgnoreCase)(t.connectId,e)})))&&(X.deviceUtils.stopScan(),n(!0)))}),(function(){}),1,3e3,Number.MAX_VALUE)}))}));return function(t){return e.apply(this,arguments)}}(),n.updateBootloader=function(e){var t=this;return new Promise(function(){var r=(0,H.default)((function*(r){var n=yield t.getSDKInstance();yield(0,Z.wait)(8e3);var o=0,i=function(){var a=(0,H.default)((function*(){(yield t.ensureDeviceExist(e))||r({success:!1,payload:{error:"Device Not Found",code:z.HardwareErrorCode.DeviceNotFound}});var a=yield n.deviceUpdateBootloader(e,{});if(!a.success){if(!(a.payload.error.indexOf("Request failed with status code")>-1&&o<3))return void r(a);o+=1,yield i()}r(a)}));return function(){return a.apply(this,arguments)}}();i()}));return function(e){return r.apply(this,arguments)}}())},n.changePin=function(){var e=(0,H.default)((function*(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=yield this.getSDKInstance();return null==r?void 0:r.deviceChangePin(e,{remove:t}).then((function(e){return e.success?e:Promise.reject(X.deviceUtils.convertDeviceError(e.payload))}))}));return function(t){return e.apply(this,arguments)}}(),n.applySettings=function(){var e=(0,H.default)((function*(e,t){var r=yield this.getSDKInstance();return null==r?void 0:r.deviceSettings(e,t).then((function(e){return e.success?e:Promise.reject(X.deviceUtils.convertDeviceError(e.payload))}))}));return function(t,r){return e.apply(this,arguments)}}(),n.setOnDeviceInputPin=function(){var e=(0,H.default)((function*(e,t,r){if(!r){var n,o,i=yield this.getDeviceSupportFeatures(e);if(null==(n=i.inputPinOnSoftware)||!n.support)throw new Y.FirmwareVersionTooLow({connectId:e,deviceId:t,params:{require:null==(o=i.inputPinOnSoftware)?void 0:o.require}})}return this.updateDevicePayload(t,{onDeviceInputPin:r})}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getDeviceSupportFeatures=function(){var e=(0,H.default)((function*(e){var t=yield this.getSDKInstance();return null==t?void 0:t.deviceSupportFeatures(e).then((function(e){return e.success?e.payload:Promise.reject(X.deviceUtils.convertDeviceError(e.payload))}))}));return function(t){return e.apply(this,arguments)}}(),n.updateDevicePayload=function(){var e=(0,H.default)((function*(e,t){return yield this.backgroundApi.engine.updateDevicePayload(e,t),this.backgroundApi.engine.getHWDeviceByDeviceId(e)}));return function(t,r){return e.apply(this,arguments)}}(),n.getDevicePayload=function(){var e=(0,H.default)((function*(e){return(yield this.backgroundApi.engine.getHWDeviceByDeviceId(e)).payload}));return function(t){return e.apply(this,arguments)}}(),n.checkBridge=function(){var e=(0,H.default)((function*(){if(!this._hasUseBridge())return Promise.resolve(!0);var e=yield this.getSDKInstance(),t=yield null==e?void 0:e.checkBridgeStatus();if(!t.success){var r=X.deviceUtils.convertDeviceError(t.payload);return r instanceof Y.InitIframeLoadFail||r instanceof Y.InitIframeTimeout?Promise.resolve(!0):r instanceof Y.BridgeTimeoutError?Promise.resolve(r):Promise.resolve(!1)}return Promise.resolve(t.payload)}));return function(){return e.apply(this,arguments)}}(),n._hasUseBridge=function(){return!0},n._toArrayBuffer=function(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;++n)r[n]=e[n];return t},n.getConnectId=function(){var e=(0,H.default)((function*(e){var t=e.device_id;if(!t)return null;try{var r=yield this.backgroundApi.engine.getHWDeviceByDeviceId(t);return r?r.mac:null}catch(n){return null}}));return function(t){return e.apply(this,arguments)}}(),n._checkDeviceSettings=function(){var e=(0,H.default)((function*(e){try{var t=e.inputPinOnSoftware,r=(e.device||{}).deviceId;if(r&&!t.support)yield this.updateDevicePayload(r,{onDeviceInputPin:!0});else if(r&&t.support){var n=yield this.getDevicePayload(r);n&&void 0!==n.onDeviceInputPin||(yield this.updateDevicePayload(r,{onDeviceInputPin:!1}))}}catch(o){}}));return function(t){return e.apply(this,arguments)}}(),n._checkPassphraseEnableStatus=function(e,t){try{"boolean"===typeof t.passphrase_protection&&this.backgroundApi.dispatch((0,J.updateDevicePassphraseOpenedState)({deviceId:e,opened:t.passphrase_protection}))}catch(r){}},n.checkFirmwareUpdate=function(){var e=(0,H.default)((function*(e){var t=this,r=yield this.getSDKInstance();return null==r?void 0:r.checkFirmwareRelease(e).then((function(r){if(!r.success)return Promise.reject(X.deviceUtils.convertDeviceError(r.payload));t._checkFirmwareUpdate(ue(ue({},r.payload),{},{connectId:e}));var n=r.payload.status;return"unknown"===n||"none"===n||"valid"===n?null:r.payload}))}));return function(t){return e.apply(this,arguments)}}(),n._checkFirmwareUpdate=function(){var e=(0,H.default)((function*(e){var t,r,n,o,i,a,c,u,s=null;if(e.connectId?s=e.connectId:e.features&&(s=yield this.getConnectId(e.features)),s){var d=e.release,p=!1,l=!1;switch(e.status){case"required":l=!0,p=!0;break;case"valid":case"none":default:p=!1;break;case"outdated":p=!0}var f=[],y=null!=(t=this.backgroundApi.appSelector((function(e){return e.settings})))?t:{},h=null!=(r=null==y||null==(n=y.devMode)?void 0:n.enable)&&r,v=null!=(o=null==y||null==(i=y.devMode)?void 0:i.updateDeviceSys)&&o,g=!!h&&!!v;f.push((0,Q.setDeviceUpdates)({connectId:s,type:"firmware",value:{forceFirmware:l,firmware:g||p?d:void 0}}));var k,w,b=null==y||null==(a=y.hardware)||null==(c=a.versions)?void 0:c[s];if(null==b||(null==(u=e.features)?void 0:u.onekey_version)!==b)f.push((0,Q.setDeviceVersion)({connectId:s,version:null!=(k=null==(w=e.features)?void 0:w.onekey_version)?k:"0.0.0"})),f.push((0,Q.setVerification)({connectId:s,verified:!1}));this.backgroundApi.dispatch.apply(void 0,f)}}));return function(t){return e.apply(this,arguments)}}(),n._checkBleFirmwareUpdate=function(){var e=(0,H.default)((function*(e){var t,r,n,o,i,a=yield this.getConnectId(e.features);if(a){var c=e.release,u=!1,s=!1;switch(e.status){case"required":s=!0,u=!0;break;case"valid":case"none":default:u=!1;break;case"outdated":u=!0}var d=null!=(t=this.backgroundApi.appSelector((function(e){return e.settings})))?t:{},p=null!=(r=null==d||null==(n=d.devMode)?void 0:n.enable)&&r,l=null!=(o=null==d||null==(i=d.devMode)?void 0:i.updateDeviceBle)&&o,f=!!p&&!!l;(0,this.backgroundApi.dispatch)((0,Q.setDeviceUpdates)({connectId:a,type:"ble",value:{forceBle:s,ble:f||u?c:void 0}}))}}));return function(t){return e.apply(this,arguments)}}(),n.syncDeviceLabel=function(){var e=(0,H.default)((function*(e,t){var r=this.backgroundApi.engine,n=e.label;try{var o=yield r.getWallet(t);"string"===typeof n&&n.length>0&&n!==o.name&&o.associatedDevice&&(yield r.updateWalletName(t,null!=n?n:o.name),yield this.backgroundApi.serviceAccount.initWallets())}catch(i){}}));return function(t,r){return e.apply(this,arguments)}}(),n.uploadResource=function(){var e=(0,H.default)((function*(e,t){var r=yield this.getSDKInstance();return null==r?void 0:r.deviceUploadResource(e,t).then((function(e){return e.success?e:Promise.reject(X.deviceUtils.convertDeviceError(e.payload))}))}));return function(t,r){return e.apply(this,arguments)}}(),n.checkBootloaderRelease=function(){var e=(0,H.default)((function*(e,t){var r=yield this.getSDKInstance();return null==r?void 0:r.checkBootloaderRelease(void 0,{willUpdateFirmwareVersion:t}).then((function(e){return e.success?e.payload:Promise.reject(X.deviceUtils.convertDeviceError(e.payload))}))}));return function(t,r){return e.apply(this,arguments)}}(),n.updateBootloaderForClassicAndMini=function(){var e=(0,H.default)((function*(e){var t=this.backgroundApi.dispatch;t((0,J.setUpdateFirmwareStep)(""));var r=yield this.getSDKInstance(),n=function(e){t((0,J.setUpdateFirmwareStep)(L()(e,"data.message","")))};r.on("ui-firmware-tip",n);try{var o;return yield r.firmwareUpdateV2(void 0,{updateType:"firmware",platform:null!=(o=oe.default.symbol)?o:"web",isUpdateBootloader:!0})}finally{r.off("ui-firmware-tip",n)}}));return function(t){return e.apply(this,arguments)}}(),n.checkBridgeRelease=function(){var e=(0,H.default)((function*(e,t){var r=yield this.getSDKInstance();return null==r?void 0:r.checkBridgeRelease(void 0,{willUpdateFirmwareVersion:t}).then((function(e){return e.success?e.payload:Promise.reject(X.deviceUtils.convertDeviceError(e.payload))}))}));return function(t,r){return e.apply(this,arguments)}}(),n.updateSettings=function(){var e=(0,H.default)((function*(e){var t=e.hardwareConnectSrc;try{var r=yield this.getSDKInstance(),n=(0,te.generateConnectSrc)(t);if(r&&r.updateSettings){var o=yield null==r?void 0:r.updateSettings({connectSrc:n});ne.default.hardwareSDK.debug("Switch hardware connect src success",o)}}catch(i){ne.default.hardwareSDK.debug("Switch hardware connect src setting failed",i)}}));return function(t){return e.apply(this,arguments)}}(),(0,V.default)(r)}(ae.default),(0,G.default)(F.prototype,"passHardwareEventsFromOffscreenToBackground",[o],Object.getOwnPropertyDescriptor(F.prototype,"passHardwareEventsFromOffscreenToBackground"),F.prototype),(0,G.default)(F.prototype,"getFeatursByWalletId",[i],Object.getOwnPropertyDescriptor(F.prototype,"getFeatursByWalletId"),F.prototype),(0,G.default)(F.prototype,"updateFeaturesCache",[a],Object.getOwnPropertyDescriptor(F.prototype,"updateFeaturesCache"),F.prototype),(0,G.default)(F.prototype,"cleanFeaturesCache",[c],Object.getOwnPropertyDescriptor(F.prototype,"cleanFeaturesCache"),F.prototype),(0,G.default)(F.prototype,"searchDevices",[u],Object.getOwnPropertyDescriptor(F.prototype,"searchDevices"),F.prototype),(0,G.default)(F.prototype,"connect",[s],Object.getOwnPropertyDescriptor(F.prototype,"connect"),F.prototype),(0,G.default)(F.prototype,"getFeatures",[d],Object.getOwnPropertyDescriptor(F.prototype,"getFeatures"),F.prototype),(0,G.default)(F.prototype,"unlockDevice",[p],Object.getOwnPropertyDescriptor(F.prototype,"unlockDevice"),F.prototype),(0,G.default)(F.prototype,"getPassphraseState",[l],Object.getOwnPropertyDescriptor(F.prototype,"getPassphraseState"),F.prototype),(0,G.default)(F.prototype,"cancel",[f],Object.getOwnPropertyDescriptor(F.prototype,"cancel"),F.prototype),(0,G.default)(F.prototype,"sendUiResponse",[y],Object.getOwnPropertyDescriptor(F.prototype,"sendUiResponse"),F.prototype),(0,G.default)(F.prototype,"rebootToBootloader",[h],Object.getOwnPropertyDescriptor(F.prototype,"rebootToBootloader"),F.prototype),(0,G.default)(F.prototype,"rebootToBoardloader",[v],Object.getOwnPropertyDescriptor(F.prototype,"rebootToBoardloader"),F.prototype),(0,G.default)(F.prototype,"getDeviceCertWithSig",[g],Object.getOwnPropertyDescriptor(F.prototype,"getDeviceCertWithSig"),F.prototype),(0,G.default)(F.prototype,"autoUpdateFirmware",[k],Object.getOwnPropertyDescriptor(F.prototype,"autoUpdateFirmware"),F.prototype),(0,G.default)(F.prototype,"ensureDeviceExist",[w],Object.getOwnPropertyDescriptor(F.prototype,"ensureDeviceExist"),F.prototype),(0,G.default)(F.prototype,"changePin",[b],Object.getOwnPropertyDescriptor(F.prototype,"changePin"),F.prototype),(0,G.default)(F.prototype,"applySettings",[m],Object.getOwnPropertyDescriptor(F.prototype,"applySettings"),F.prototype),(0,G.default)(F.prototype,"setOnDeviceInputPin",[A],Object.getOwnPropertyDescriptor(F.prototype,"setOnDeviceInputPin"),F.prototype),(0,G.default)(F.prototype,"getDeviceSupportFeatures",[O],Object.getOwnPropertyDescriptor(F.prototype,"getDeviceSupportFeatures"),F.prototype),(0,G.default)(F.prototype,"updateDevicePayload",[I],Object.getOwnPropertyDescriptor(F.prototype,"updateDevicePayload"),F.prototype),(0,G.default)(F.prototype,"getDevicePayload",[P],Object.getOwnPropertyDescriptor(F.prototype,"getDevicePayload"),F.prototype),(0,G.default)(F.prototype,"checkBridge",[T],Object.getOwnPropertyDescriptor(F.prototype,"checkBridge"),F.prototype),(0,G.default)(F.prototype,"getConnectId",[S],Object.getOwnPropertyDescriptor(F.prototype,"getConnectId"),F.prototype),(0,G.default)(F.prototype,"checkFirmwareUpdate",[D],Object.getOwnPropertyDescriptor(F.prototype,"checkFirmwareUpdate"),F.prototype),(0,G.default)(F.prototype,"_checkFirmwareUpdate",[M],Object.getOwnPropertyDescriptor(F.prototype,"_checkFirmwareUpdate"),F.prototype),(0,G.default)(F.prototype,"_checkBleFirmwareUpdate",[C],Object.getOwnPropertyDescriptor(F.prototype,"_checkBleFirmwareUpdate"),F.prototype),(0,G.default)(F.prototype,"syncDeviceLabel",[N],Object.getOwnPropertyDescriptor(F.prototype,"syncDeviceLabel"),F.prototype),(0,G.default)(F.prototype,"uploadResource",[R],Object.getOwnPropertyDescriptor(F.prototype,"uploadResource"),F.prototype),(0,G.default)(F.prototype,"checkBootloaderRelease",[j],Object.getOwnPropertyDescriptor(F.prototype,"checkBootloaderRelease"),F.prototype),(0,G.default)(F.prototype,"updateBootloaderForClassicAndMini",[E],Object.getOwnPropertyDescriptor(F.prototype,"updateBootloaderForClassicAndMini"),F.prototype),(0,G.default)(F.prototype,"checkBridgeRelease",[x],Object.getOwnPropertyDescriptor(F.prototype,"checkBridgeRelease"),F.prototype),(0,G.default)(F.prototype,"updateSettings",[_],Object.getOwnPropertyDescriptor(F.prototype,"updateSettings"),F.prototype),B=F))||B)},417470:(e,t,r)=>{r.r(t),r.d(t,{default:()=>V});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k=r(545455),w=r.n(k),b=r(680537),m=r.n(b),A=r(609850),O=r.n(A),I=r(301842),P=r.n(I),T=r(634795),S=r(887371),D=r(545754),M=r(411987),C=r(695058),N=r(859375),R=r(992431),j=r(740727),E=r(398514),x=r(195212),_=r(480601),B=r(415008),F=r(438760),W=r(613549),L=r(292147),U=r(201882);function H(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,C.default)(e);if(t){var o=(0,C.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,M.default)(this,r)}}const V=(n=(0,F.backgroundClass)(),o=(0,F.backgroundMethod)(),i=(0,F.backgroundMethod)(),a=(0,F.backgroundMethod)(),c=(0,F.backgroundMethod)(),u=(0,F.backgroundMethod)(),s=(0,F.backgroundMethod)(),d=(0,F.backgroundMethod)(),p=(0,F.backgroundMethod)(),l=(0,F.backgroundMethod)(),f=(0,F.backgroundMethod)(),y=(0,F.backgroundMethod)(),h=(0,F.backgroundMethod)(),n((g=function(e){(0,D.default)(r,e);var t=H(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getLocalHistory=function(){var e=(0,T.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.tokenIdOnNetwork,o=e.limit,i=e.isPending,a=this.backgroundApi,c=a.engine,u=(0,a.appSelector)((function(e){return e.settings.hideScamHistory})),s=yield c.getVaultSettings(t),d=(yield R.default.history.getAccountHistory({limit:null!=o?o:W.HISTORY_CONSTS.GET_LOCAL_LIMIT,networkId:t,accountId:r,tokenIdOnNetwork:n,isPending:i})).items;if(!s.supportFilterScam||!u)return d;for(var p=[],l=0;l<d.length;l+=1){(yield this.checkIsScamHistoryTx({accountId:r,networkId:t,historyTx:d[l]}))||p.push(d[l])}return p}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,T.default)((function*(e){var t,r,n=this,o=e.networkId,i=e.accountId,a=e.tokenIdOnNetwork,c=e.localHistory,u=this.backgroundApi,s=u.engine,d=u.servicePassword,p=yield s.getVault({networkId:o,accountId:i});return(yield s.getVaultSettings(o)).validationRequired&&(t=yield d.getPassword(),r=function(e){return n.backgroundApi.dispatch((0,x.setIsPasswordLoadedInVault)(e))}),L.default.http.info("fetchOnChainHistory",{networkId:o,accountId:i,tokenIdOnNetwork:a}),p.fetchOnChainHistory({localHistory:c,tokenIdOnNetwork:a,password:t,passwordLoadedCallback:r})}));return function(t){return e.apply(this,arguments)}}(),n.updateHistoryStatus=function(){var e=(0,T.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.items;if(n&&n.length){var o=this.backgroundApi.engine,i=yield o.getVault({networkId:t,accountId:r}),a=yield i.getAccountNonce(),c=yield i.getTransactionStatuses(n.map((function(e){return e.decodedTx.txid}))),u=[],s=function(e,t,r){e.decodedTx.status!==r.status&&(t().decodedTx.status=r.status),P()(r.isFinal)||e.decodedTx.isFinal!==r.isFinal&&(t().decodedTx.isFinal=r.isFinal)};n.forEach((function(e,t){var r,n=function(){return r||(r=O()(e)),r},o=c[t];"undefined"!==typeof o&&(o===j.TransactionStatus.CONFIRM_AND_SUCCESS&&s(e,n,{status:E.IDecodedTxStatus.Confirmed}),o===j.TransactionStatus.CONFIRM_BUT_FAILED&&s(e,n,{status:E.IDecodedTxStatus.Failed}),o!==j.TransactionStatus.NOT_FOUND&&o!==j.TransactionStatus.INVALID||m()(a)&&e.decodedTx.nonce<a&&s(e,n,{status:E.IDecodedTxStatus.Dropped,isFinal:!0})),r&&u.push(r)})),u.length&&(yield this.saveHistoryTx({networkId:t,accountId:r,items:u}))}}));return function(t){return e.apply(this,arguments)}}(),n.updateHistoryFee=function(){var e=(0,T.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.tx,o=this.backgroundApi.engine;if(!n.decodedTx.totalFeeInNative){var i=yield o.getVault({networkId:t,accountId:r}),a=yield i.getTransactionFeeInNative(n.decodedTx.txid);if(!w()(a)){var c=O()(n);c.decodedTx.totalFeeInNative=a,this.saveHistoryTx({accountId:r,networkId:t,items:[c]})}}}));return function(t){return e.apply(this,arguments)}}(),n.refreshPendingHistory=function(){var e=(0,T.default)((function*(e){var t=e.networkId,r=e.accountId,n=yield this.getLocalHistory({networkId:t,accountId:r}),o=Date.now(),i=n.filter((function(e){return e.decodedTx.status===E.IDecodedTxStatus.Pending||e.decodedTx.status===E.IDecodedTxStatus.Dropped&&e.decodedTx.createdAt&&e.decodedTx.createdAt>o-W.HISTORY_CONSTS.REFRESH_DROPPED_TX_IN}));yield this.updateHistoryStatus({networkId:t,accountId:r,items:i})}));return function(t){return e.apply(this,arguments)}}(),n.refreshHistory=function(){var e=(0,T.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.tokenIdOnNetwork,o=e.isRefreshPending;(void 0===o||o)&&(yield this.refreshPendingHistory({networkId:t,accountId:r}));var i=yield this.getLocalHistory({networkId:t,accountId:r,tokenIdOnNetwork:n}),a=i.filter((function(e){return e.decodedTx.isFinal})),c=yield this.fetchOnChainHistory({networkId:t,accountId:r,localHistory:i,tokenIdOnNetwork:n}),u=a.map((function(e){return e.id})),s=c.filter((function(e){return!u.includes(e.id)}));return s.length&&(yield this.saveHistoryTx({networkId:t,accountId:r,items:s})),c}));return function(t){return e.apply(this,arguments)}}(),n.refreshHistoryUi=function(){var e=(0,T.default)((function*(){return this.backgroundApi.dispatch((0,_.refreshHistory)()),Promise.resolve()}));return function(){return e.apply(this,arguments)}}(),n.saveHistoryTx=function(){var e=(0,T.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.items;if(n&&n.length){for(var o=this.backgroundApi.engine,i=yield o.getVault({networkId:t,accountId:r}),a=0;a<n.length;a+=1){var c=n[a];yield i.fixHistoryTx(c)}return R.default.history.saveHistoryTx(n)}}));return function(t){return e.apply(this,arguments)}}(),n.getOriginHistoryTxOfCancelTx=function(){var e=(0,T.default)((function*(e){if(e&&"cancel"===(null==e?void 0:e.replacedType)){for(var t=e;null!=(r=t)&&r.replacedPrevId;){var r,n,o,i=null==(n=t)?void 0:n.replacedPrevId;if((null==(o=t=yield R.default.history.getHistoryById({id:i,accountId:e.decodedTx.accountId,networkId:e.decodedTx.networkId}))?void 0:o.replacedPrevId)===i)break}return t}}));return function(t){return e.apply(this,arguments)}}(),n.saveSendConfirmHistory=function(){var e=(0,T.default)((function*(e){var t,r=e.networkId,n=e.accountId,o=e.data,i=e.resendActionInfo,a=e.feeInfo,c=this.backgroundApi,u=c.engine,s=c.servicePassword;if(o&&o.decodedTx){var d,p=o.encodedTx,l=o.decodedTx,f=o.signedTx,y=yield u.getVault({networkId:r,accountId:n}),h=yield y.buildHistoryTx({encodedTx:p,decodedTx:l,signedTx:f,isSigner:!0,isLocalCreated:!0});if(h.decodedTx.feeInfo=null!=(t=h.decodedTx.feeInfo)?t:a,(0,B.isEvmNetworkId)(r))try{h.decodedTx.encodedTxEncrypted=h.decodedTx.encodedTxEncrypted||(yield s.encryptByInstanceId(JSON.stringify(p||l.encodedTx)))}catch(v){console.error(v)}i&&i.replaceHistoryId&&(d=yield R.default.history.getHistoryById({id:i.replaceHistoryId,networkId:r,accountId:n}))&&(d.decodedTx.status=E.IDecodedTxStatus.Dropped,d.replacedNextId=h.id,h.replacedPrevId=d.id,h.replacedType=i.type,h.decodedTx.interactInfo=h.decodedTx.interactInfo||d.decodedTx.interactInfo),yield this.saveHistoryTx({networkId:r,accountId:n,items:d?[h,d]:[h]})}}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionsWithNonce=function(){var e=(0,T.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.nonce;return(yield this.getLocalHistory({networkId:t,accountId:r})).filter((function(e){return e.decodedTx.nonce===n}))}));return function(t){return e.apply(this,arguments)}}(),n.queryTransactionNonceStatus=function(){var e=(0,T.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.nonce;yield this.refreshPendingHistory({networkId:t,accountId:r});var o=yield this.getTransactionsWithNonce({networkId:t,accountId:r,nonce:n}),i=o.map((function(e){return e.decodedTx.status}));return i.includes(E.IDecodedTxStatus.Confirmed)?o.filter((function(e){return e.decodedTx.status===E.IDecodedTxStatus.Confirmed&&"cancel"===e.replacedType})).length>0?"canceled":"sucesss":i.includes(E.IDecodedTxStatus.Failed)?"failed":"pending"}));return function(t){return e.apply(this,arguments)}}(),n.queryTransactionByTxid=function(){var e=(0,T.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.txid;yield this.refreshPendingHistory({networkId:t,accountId:r});var o=(yield this.getLocalHistory({networkId:t,accountId:r})).find((function(e){return e.decodedTx.txid===n}));return o?o.decodedTx.status===E.IDecodedTxStatus.Confirmed?"sucesss":o.decodedTx.status===E.IDecodedTxStatus.Failed?"failed":o.decodedTx.status===E.IDecodedTxStatus.Dropped?"canceled":"pending":"failed"}));return function(t){return e.apply(this,arguments)}}(),n.checkIsScamHistoryTx=function(){var e=(0,T.default)((function*(e){var t=e.accountId,r=e.networkId,n=e.historyTx,o=this.backgroundApi.engine;return(yield o.getVault({networkId:r,accountId:t})).checkIsScamHistoryTx(n)}));return function(t){return e.apply(this,arguments)}}(),(0,S.default)(r)}(U.default),(0,N.default)(g.prototype,"getLocalHistory",[o],Object.getOwnPropertyDescriptor(g.prototype,"getLocalHistory"),g.prototype),(0,N.default)(g.prototype,"updateHistoryStatus",[i],Object.getOwnPropertyDescriptor(g.prototype,"updateHistoryStatus"),g.prototype),(0,N.default)(g.prototype,"updateHistoryFee",[a],Object.getOwnPropertyDescriptor(g.prototype,"updateHistoryFee"),g.prototype),(0,N.default)(g.prototype,"refreshPendingHistory",[c],Object.getOwnPropertyDescriptor(g.prototype,"refreshPendingHistory"),g.prototype),(0,N.default)(g.prototype,"refreshHistory",[u],Object.getOwnPropertyDescriptor(g.prototype,"refreshHistory"),g.prototype),(0,N.default)(g.prototype,"refreshHistoryUi",[s],Object.getOwnPropertyDescriptor(g.prototype,"refreshHistoryUi"),g.prototype),(0,N.default)(g.prototype,"getOriginHistoryTxOfCancelTx",[d],Object.getOwnPropertyDescriptor(g.prototype,"getOriginHistoryTxOfCancelTx"),g.prototype),(0,N.default)(g.prototype,"saveSendConfirmHistory",[p],Object.getOwnPropertyDescriptor(g.prototype,"saveSendConfirmHistory"),g.prototype),(0,N.default)(g.prototype,"getTransactionsWithNonce",[l],Object.getOwnPropertyDescriptor(g.prototype,"getTransactionsWithNonce"),g.prototype),(0,N.default)(g.prototype,"queryTransactionNonceStatus",[f],Object.getOwnPropertyDescriptor(g.prototype,"queryTransactionNonceStatus"),g.prototype),(0,N.default)(g.prototype,"queryTransactionByTxid",[y],Object.getOwnPropertyDescriptor(g.prototype,"queryTransactionByTxid"),g.prototype),(0,N.default)(g.prototype,"checkIsScamHistoryTx",[h],Object.getOwnPropertyDescriptor(g.prototype,"checkIsScamHistoryTx"),g.prototype),v=g))||v)},266075:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Y});var n,o,i,a,c,u,s,d,p,l,f=r(256666),y=r(609850),h=r.n(y),v=r(301842),g=r.n(v),k=r(655324),w=r.n(k),b=r(634795),m=r(887371),A=r(545754),O=r(411987),I=r(695058),P=r(859375),T=r(349779),S=r(789644),D=r.n(S),M=r(206391),C=r.n(M),N=r(992431),R=r(112889),j=r(940915),E=r(812852),x=r(459729),_=r(461966),B=r(71284),F=r(755074),W=r(16280),L=r(392853),U=r(776553),H=r(438760),V=r(942013),q=r(85397),K=r(465146),$=r(269482),G=r(396564),z=r(201882);function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){(0,f.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function X(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,I.default)(e);if(t){var o=(0,I.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,O.default)(this,r)}}var Y=(n=(0,H.backgroundClass)(),o=(0,H.backgroundMethod)(),i=(0,H.backgroundMethod)(),a=(0,H.backgroundMethod)(),c=(0,H.backgroundMethod)(),u=(0,H.backgroundMethod)(),s=(0,H.backgroundMethod)(),d=(0,H.backgroundMethod)(),n((l=function(e){(0,A.default)(r,e);var t=X(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).fetchFeeRatesCached=(0,G.memoizee)(function(){var e=(0,b.default)((function*(e){var t=e.apiMempool;return(yield D().get(`${t}/api/v1/fees/recommended`)).data}));return function(t){return e.apply(this,arguments)}}(),{promise:!0,maxAge:(0,U.getTimeDurationMs)({seconds:30}),max:5}),e.prepareInscribePrivateKey=(0,G.memoizee)((0,b.default)((function*(){try{var t=yield K.default.getItem(x.INSCRIBE_ACCOUNT_STORAGE_KEY);if(!t){var r=B.secp256k1SchnorrSdk.utils.randomPrivateKey(),n=yield e.backgroundApi.servicePassword.encryptByInstanceId($.default.bytesToHex(r),{inputEncoding:"hex",outputEncoding:"hex"});yield K.default.setItem(x.INSCRIBE_ACCOUNT_STORAGE_KEY,n)}if(!(t=yield K.default.getItem(x.INSCRIBE_ACCOUNT_STORAGE_KEY)))throw new Error("prepareInscribePrivateKey: read key from storage failed ");return yield e.backgroundApi.servicePassword.decryptByInstanceId(t,{inputEncoding:"hex",outputEncoding:"hex"})}catch(o){throw yield K.default.removeItem(x.INSCRIBE_ACCOUNT_STORAGE_KEY),new Error("prepareInscribePrivateKey ERROR:  clear storage")}})),{promise:!0,max:1,maxAge:(0,U.getTimeDurationMs)({minute:5})}),e}var n=r.prototype;return n.fetchFeeRates=function(){var e=(0,b.default)((function*(e){var t=(yield this.getBitcoinNetworkMap(e)).apiMempool;return this.fetchFeeRatesCached({apiMempool:t})}));return function(t){return e.apply(this,arguments)}}(),n.fetchAddressUtxo=function(){var e=(0,b.default)((function*(e){var t=e.address,r=e.networkId,n=`${(yield this.getBitcoinNetworkMap(r)).apiMempool}/api/address/${t}/utxo`,o=(yield D().get(n)).data||[],i=w()(o,(function(e){return e.value}));if(i&&o.length)return{txid:i.txid,vout:i.vout,amt:new(C())(i.value).toFixed()}}));return function(t){return e.apply(this,arguments)}}(),n.getCommitTxInfo=function(e){var t,r,n,o=e.address,i=e.commitSignedTx,a=i.txid,c=i.encodedTx,u=c.outputs.findIndex((function(e){return e.address===o}));if(g()(u))throw new Error(`getCommitTxInfo ERROR: vout not found for address ${o} in tx ${a}`);var s=null==(t=c.outputs[u])?void 0:t.value;if(new(C())(s).lt(null!=(r=null==(n=c.outputsForCoinSelect[0])?void 0:n.value)?r:Number.MAX_VALUE))throw new Error(`getCommitTxInfo ERROR: amt (${s}) too small for address ${o} in tx ${a}`);return Promise.resolve({txid:a,vout:u,amt:s})},n.verifyBroadcastTxs=function(){var e=(0,b.default)((function*(e){var t=e.rawTxs,r=e.order,n=e.networkId,o=(yield this.getBitcoinNetworkMap(n)).network,i=(0,W.decodeBtcRawTx)(t[0]),a=(0,W.decodeBtcRawTx)(t[1]);console.log("verifyBroadcastTxs",{commitTxInfo:i,revealTxInfo:a,order:r});var c=W.tapRootAccountUtils.parseScriptPubKey({network:o,scriptPubKey:i.tx.vout[0].scriptPubKey.toString()}),u=i.tx.vout[0].value,s=W.tapRootAccountUtils.parseScriptPubKey({network:o,scriptPubKey:a.tx.vout[0].scriptPubKey.toString()}),d=a.tx.vout[0].value,p=i.tx.vout[a.tx.vin[0].vout],l=yield this.prepareInscribePrivateKey(),f=yield this.createInscribeAccount({privateKey:l,networkId:n}),y=a.tx.vin[0].witness[1],h=f.createAddressInfo({script:y});if(y&&p.scriptPubKey.toString()===c.scriptPubKey.toString()&&p.value===u&&h.address===c.address&&r.fundingAddress===c.address&&new(C())(r.fundingValue).eq(u)&&r.toAddress===s.address&&new(C())(r.paddingSats).eq(d)&&i.txid===a.tx.vin[0].txid)return!0;throw new Error("verifyBroadcastTxs failed")}));return function(t){return e.apply(this,arguments)}}(),n.broadcastTxs=function(){var e=(0,b.default)((function*(e){var t=e.txs,r=e.networkId,n=(0,E.getNetworkImpl)(r),o=`${(0,R.getFiatEndpoint)()}/book/${n}/send_txs`,i=new q.JsonRPCRequest(o);return yield i.batchCall(t.map((function(e){return["sendrawtransaction",[e]]})))}));return function(t){return e.apply(this,arguments)}}(),n.buildRedeemTxInputOutput=function(e){var t=e.inscription,r=e.txInfo,n=r.txid,o=r.vout,i=r.amt,a=t.paddingSats,c=t.toAddressScriptPubKey,u=t.fee,s=[{txid:n,vout:o,prevout:{value:parseFloat(i),scriptPubKey:t.addressInfo.scriptPubKey},witness:[]}],d=[{value:a,scriptPubKey:c}],p=a+u,l=parseFloat(i);if(l<p)throw new Error(`Inscribe ERROR: Not enough funds to pay for inscription: ${i} < ${a} + ${u}`);var f=l-p;return f>=546&&d.push({value:f,scriptPubKey:t.addressInfo.scriptPubKey}),{input:s,output:d}},n.buildInitRedeemTxInputOutput=function(e){for(var t=e.initRedeemInfo,r=e.txInfo,n=t.addressInfo,o=t.inscriptions,i=t.internalTransferFees,a=t.paddingSats,c=r.txid,u=r.vout,s=r.amt,d=(parseFloat(s),n.scriptPubKey,[]),p=0,l=0;l<o.length;l+=1){var f=a+o[l].fee;p+=f,d.push({value:f,scriptPubKey:o[l].addressInfo.scriptPubKey})}var y=parseFloat(s)-p-i;if(y>=546&&d.push({value:y,scriptPubKey:n.scriptPubKey}),y<0)throw new Error(`Build init inscription tx ERROR: insufficient balance, ${n.address}`);throw new Error("buildInitRedeemTxInputOutput ERROR: not implemented")},n.buildInscribeTransaction=function(){var e=(0,b.default)((function*(e){var t,r=e.initRedeemInfo,n=e.redeemInfo,o=e.commitSignedTx,i=e.networkId,a=(null==r?void 0:r.addressInfo.address)||(null==n?void 0:n.inscription.addressInfo.address);if(!a)throw new Error("buildInscribeTransaction ERROR: no address provided");if(o){if(!o.txid)throw new Error("buildInscribeTransaction ERROR: no txid provided");t=yield this.getCommitTxInfo({address:a,commitSignedTx:o})}else t=yield this.fetchAddressUtxo({address:a,networkId:i});if(!t)throw new Error("buildInscribeTransaction ERROR: no available utxo txInfo provided");var c=[],u=[];if(r){var s=this.buildInitRedeemTxInputOutput({initRedeemInfo:r,txInfo:t});c=s.input,u=s.output}if(n){var d=n.inscription,p=this.buildRedeemTxInputOutput({txInfo:t,inscription:d});c=p.input,u=p.output}return{version:2,locktime:0,input:c,output:u}}));return function(t){return e.apply(this,arguments)}}(),n.saveInscriptionHistory=function(){var e=(0,b.default)((function*(e){var t=e.order,r=e.txids,n=0;e.commitSignedTx&&(n=1);for(var o=0;o<r.length;o+=1){var i=t.inscriptions[o];if(i){var a=i.addressInfo.address,c=t.toAddress,u=t.network,s=r[o+n],d={createdAt:Date.now(),txid:s,from:a,to:c,fee:i.fee,paddingSats:i.paddingSats,previewText:i.content.previewText,mimetype:i.content.mimetype,categoryType:i.content.categoryType,name:i.content.name};N.default.inscribe.savaItem(d,u)}}return Promise.resolve()}));return function(t){return e.apply(this,arguments)}}(),n.getOrderHistoryList=function(){var e=(0,b.default)((function*(e){return(yield N.default.inscribe.getItems(e)).sort((function(e,t){return e.createdAt>t.createdAt?-1:1}))}));return function(t){return e.apply(this,arguments)}}(),n.signAndSendAllInscribeTxs=function(){var e=(0,b.default)((function*(e){var t=this,r=e.order,n=e.privateKey,o=e.commitSignedTx,i=e.networkId;console.log("signAndSendAllInscribeTxs",r);var a=r.inscriptions,c=[],u=[];o&&u.push(o.rawTx);var s=function(){var e=(0,b.default)((function*(){if(null!=a&&a.length)for(var e=0;e<a.length;e+=1)try{var r=a[e],s=yield t.buildInscribeTransaction({commitSignedTx:o,redeemInfo:{inscription:r},networkId:i}),d=yield t.signTaprootTx({privateKey:n,tx:s,leaf:r.addressInfo.leaf,cBlock:r.addressInfo.cBlock,script:r.script,networkId:i}),p=B.Tx.encode(d).hex;u.push(p)}catch(l){console.error(l),c.push(l)}}));return function(){return e.apply(this,arguments)}}();yield s(),o&&(yield this.verifyBroadcastTxs({rawTxs:u,order:r,networkId:i}));var d=yield this.broadcastTxs({txs:u,networkId:i});try{yield this.saveInscriptionHistory({txids:d,order:r,commitSignedTx:o})}catch(p){console.error(p)}return{txids:d,errors:c}}));return function(t){return e.apply(this,arguments)}}(),n.signTaprootTx=function(){var e=(0,b.default)((function*(e){var t,r=e.privateKey,n=e.tx,o=e.leaf,i=e.script,a=e.cBlock,c=e.networkId,u=h()(n);u.vin=n.input,u.vout=n.output,delete u.input,delete u.output;var s=(yield this.createInscribeAccount({privateKey:r,networkId:c})).signTransaction({txToSign:u,leaf:o}),d=u;return d&&null!=d&&null!=(t=d.vin)&&t[0]&&(d.vin[0].witness=[$.default.bytesToHex(s),i,a]),d}));return function(t){return e.apply(this,arguments)}}(),n.getBitcoinNetworkMap=function(){var e=(0,b.default)((function*(e){if(e===V.OnekeyNetwork.btc)return Promise.resolve({network:"main",apiMempool:(0,R.getMempoolEndpoint)({network:"mainnet"}),apiGetblock:(0,R.getGetblockEndpoint)({chain:"btc",network:"mainnet"})});if(e===V.OnekeyNetwork.tbtc)return Promise.resolve({network:"testnet",apiMempool:(0,R.getMempoolEndpoint)({network:"testnet"}),apiGetblock:(0,R.getGetblockEndpoint)({chain:"btc",network:"testnet"})});throw new Error(`getBitcoinNetwork ERROR: Unknown network, ${null!=e?e:"null"}`)}));return function(t){return e.apply(this,arguments)}}(),n.createInscribeAccount=function(){var e=(0,b.default)((function*(e){var t=e.networkId,r=e.privateKey,n=(yield this.getBitcoinNetworkMap(t)).network;return new _.InscribeAccount({privateKey:r,network:n})}));return function(t){return e.apply(this,arguments)}}(),n.getRecommendPadding=function(){var e=(0,b.default)((function*(e){return"file"===e?Promise.resolve(x.INSCRIPTION_PADDING_SATS_VALUES.file):"text"===e||"domain"===e||"brc20_deploy"===e||"brc20_mint"===e?Promise.resolve(x.INSCRIPTION_PADDING_SATS_VALUES.text):Promise.resolve(x.INSCRIPTION_PADDING_SATS_VALUES.default)}));return function(t){return e.apply(this,arguments)}}(),n.buildInscriptionPayload=function(){var e=(0,b.default)((function*(e){var t=e.inscribeAccount,r=e.content,n=e.paddingSats,o=e.toAddressScriptPubKey,i=new TextEncoder,a=$.default.hexToBytes(r.hex),c=i.encode(r.mimetype),u=[$.default.bytesToHex(t.publicKeyBytes),"OP_CHECKSIG","OP_0","OP_IF",$.default.bytesToHex(i.encode("ord")),"01",$.default.bytesToHex(c),"OP_0",$.default.bytesToHex(a),"OP_ENDIF"],s=T.Script.encode(u).length,d=a.length,p=t.createAddressInfo({script:u}),l=Q({},r);null==l||delete l.hex,null==l||delete l.sha256;var f={addressInfo:p,script:u,content:l,dataLength:d,scriptLength:s,txsize:0,fee:0,paddingSats:n,toAddressScriptPubKey:o};return Promise.resolve(f)}));return function(t){return e.apply(this,arguments)}}(),n.createInscriptionContents=function(){var e=(0,b.default)((function*(e){var t=e.texts,r=void 0===t?[]:t,n=e.domains,o=void 0===n?[]:n,i=e.files,a=void 0===i?[]:i,c=[],u=204800,s=function(e){var t=e.name,r=e.text,n=e.categoryType,o=r.slice(0,200);o.length<r.length&&(o+="...");var i=$.default.textToHex(r);if($.default.hexToBytes(i).length>u)throw new j.InscribeFileTooLargeError;return{name:t||"",hex:i,mimetype:"text/plain;charset=utf-8",sha256:"",previewText:o,categoryType:n||"text"}};for(var d of r)c.push(s({categoryType:"text",text:d}));for(var p of o){var l=p.trim(),f=JSON.stringify({p:"sns",op:"reg",name:l});c.push(s({categoryType:"domain",name:l,text:f}))}for(var y of a){var h=y.mimetype,v=y.data,g=y.filename;if($.default.hexToBytes(v).length>u)throw new j.InscribeFileTooLargeError;c.push({categoryType:"file",name:g||"",hex:v,mimetype:h,sha256:"",previewText:g||h})}return Promise.resolve(c)}));return function(t){return e.apply(this,arguments)}}(),n.checkValidFeeRate=function(){var e=(0,b.default)((function*(e){var t=e.feeRate;if(!t||g()(t))throw new Error("createInscribeOrder ERROR: feeRate is not defined");return Promise.resolve(!0)}));return function(t){return e.apply(this,arguments)}}(),n.checkValidPadding=function(){var e=(0,b.default)((function*(e){var t=e.padding;if(t<x.INSCRIPTION_PADDING_SATS_VALUES.$min)throw new Error(`Padding is too small, min ${x.INSCRIPTION_PADDING_SATS_VALUES.$min}`);if(t>x.INSCRIPTION_PADDING_SATS_VALUES.$max)throw new Error(`Padding is too large, max ${x.INSCRIPTION_PADDING_SATS_VALUES.$max}`);return Promise.resolve(!0)}));return function(t){return e.apply(this,arguments)}}(),n.getActiveBtcVault=function(){var e=(0,b.default)((function*(e){var t=e.networkId,r=e.accountId,n=this.backgroundApi.engine;return yield n.getVault({networkId:t,accountId:r})}));return function(t){return e.apply(this,arguments)}}(),n.checkValidTaprootAddress=function(){var e=(0,b.default)((function*(e){var t=e.address,r=e.networkId,n=e.accountId;yield this.getBitcoinNetworkMap(r);var o=yield this.getActiveBtcVault({networkId:r,accountId:n}),i=(yield o.getProvider()).verifyAddress(t);if(null!=i&&i.isValid)return{isValidAddress:!0,isTaprootAddress:(null==i?void 0:i.encoding)===F.AddressEncodings.P2TR};throw new Error(`InscribeOrder ERROR: Invalid Taproot address:${t}`)}));return function(t){return e.apply(this,arguments)}}(),n.buildInscribeCommitEncodedTx=function(){var e=(0,b.default)((function*(e){var t=e.to,r=e.amount,n=e.networkId,o=e.accountId,i=yield this.backgroundApi.engine.getNetwork(n),a=yield this.getActiveBtcVault({accountId:o,networkId:n}),c=yield a.getAccountAddress(),u=yield this.fetchAddressUtxo({address:t,networkId:n});if(u&&u.amt&&i){var s=(0,L.convertFeeNativeToValue)({value:r,network:i});if(new(C())(u.amt).gte(s))return null}return yield a.buildEncodedTxFromTransfer({from:c,to:t,amount:r,coinControlDisabled:!0,isInscribe:!0,coinSelectAlgorithm:"accumulative_desc"})}));return function(t){return e.apply(this,arguments)}}(),n.createInscribeOrder=function(){var e=(0,b.default)((function*(e){var t=e.toAddress,r=e.contents,n=e.feeRate,o=e.globalPaddingSats,i=void 0===o?x.INSCRIPTION_PADDING_SATS_VALUES.default:o,a=e.networkId,c=e.accountId;yield this.checkValidTaprootAddress({address:t,networkId:a,accountId:c}),yield this.checkValidPadding({padding:i});var u=i,s=yield this.prepareInscribePrivateKey(),d=yield this.createInscribeAccount({privateKey:s,networkId:a});g()(n)&&(n=(yield this.fetchFeeRates(a)).halfHourFee);yield this.checkValidFeeRate({feeRate:n});for(var p=[],l=0,f=160,y=W.tapRootAccountUtils.parseAddress({address:t}),h=y.tapKey,v=y.scriptPubKey,k=0;k<r.length;k+=1){var w=r[k],b=yield this.buildInscriptionPayload({content:w,inscribeAccount:d,paddingSats:u,toAddressScriptPubKey:v}),m=b.dataLength,A=b.scriptLength,O=Math.max(m,A),I=600+Math.floor(O/4);w.sha256||(f=Math.floor(O/4)*k,I=300+Math.floor(O/4)),console.log("TXSIZE",{txsize:I,dataLength:m,scriptLength:A,contentSize:O});var P=n*I;l+=P,p.push(Q(Q({},b),{},{txsize:I,fee:P}))}var T,S,D="",M=0,N=0;if(p.length>1){N=(M=550+f*p.length)+l+u*p.length;var R=[d.publicKeyBytes,"OP_CHECKSIG"],j=d.createAddressInfo({script:R});if(D=j.address,S={addressInfo:j,script:R,inscriptions:p,internalTransferFees:M,paddingSats:u},!x.MULTIPLE_INSCRIPTIONS_ENABLED)throw new Error("createInscriptionsOrder ERROR: create multiple inscriptions not supported yet")}else D=(T=p[0].addressInfo).address,N=(M=0)+l+u*p.length;var E=yield this.backgroundApi.engine.getNetwork(a),_=N,B="";E&&(B=(0,L.convertFeeValueToNative)({value:new(C())(_).toFixed(),network:E}));var F={network:d.network,fundingAddressInfo:T,fundingAddress:D,fundingValue:_,fundingValueNative:B,initRedeemInfo:S,inscriptions:p,totalFees:N,internalTransferFees:M,toAddressScriptPubKey:v,toAddressTapKey:h,toAddress:t,paddingSats:u,createdAt:Date.now()};return Promise.resolve(F)}));return function(t){return e.apply(this,arguments)}}(),n.submitInscribeOrder=function(){var e=(0,b.default)((function*(e){var t=e.order,r=e.commitSignedTx,n=e.networkId;if(!t)throw new Error("submitInscribeOrder ERROR: order not found");try{var o=yield this.prepareInscribePrivateKey();return yield this.signAndSendAllInscribeTxs({order:t,privateKey:o,commitSignedTx:r,networkId:n})}finally{}}));return function(t){return e.apply(this,arguments)}}(),(0,m.default)(r)}(z.default),(0,P.default)(l.prototype,"fetchFeeRates",[o],Object.getOwnPropertyDescriptor(l.prototype,"fetchFeeRates"),l.prototype),(0,P.default)(l.prototype,"getOrderHistoryList",[i],Object.getOwnPropertyDescriptor(l.prototype,"getOrderHistoryList"),l.prototype),(0,P.default)(l.prototype,"createInscriptionContents",[a],Object.getOwnPropertyDescriptor(l.prototype,"createInscriptionContents"),l.prototype),(0,P.default)(l.prototype,"checkValidTaprootAddress",[c],Object.getOwnPropertyDescriptor(l.prototype,"checkValidTaprootAddress"),l.prototype),(0,P.default)(l.prototype,"buildInscribeCommitEncodedTx",[u],Object.getOwnPropertyDescriptor(l.prototype,"buildInscribeCommitEncodedTx"),l.prototype),(0,P.default)(l.prototype,"createInscribeOrder",[s],Object.getOwnPropertyDescriptor(l.prototype,"createInscribeOrder"),l.prototype),(0,P.default)(l.prototype,"submitInscribeOrder",[d],Object.getOwnPropertyDescriptor(l.prototype,"submitInscribeOrder"),l.prototype),p=l))||p)},216556:(e,t,r)=>{r.r(t),r.d(t,{default:()=>U});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A,O,I=r(634795),P=r(887371),T=r(545754),S=r(411987),D=r(695058),M=r(859375),C=r(789644),N=r.n(C),R=r(206391),j=r.n(R),E=r(940915),x=r(945375),_=r(254595),B=r(438760),F=r(613549),W=r(201882);function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,D.default)(e);if(t){var o=(0,D.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,S.default)(this,r)}}var U=(n=(0,B.backgroundClass)(),o=(0,B.backgroundMethod)(),i=(0,B.backgroundMethod)(),a=(0,B.backgroundMethod)(),c=(0,B.backgroundMethod)(),u=(0,B.backgroundMethod)(),s=(0,B.backgroundMethod)(),d=(0,B.backgroundMethod)(),p=(0,B.backgroundMethod)(),l=(0,B.backgroundMethod)(),f=(0,B.backgroundMethod)(),y=(0,B.backgroundMethod)(),h=(0,B.backgroundMethod)(),v=(0,B.backgroundMethod)(),g=(0,B.backgroundMethod)(),k=(0,B.backgroundMethod)(),w=(0,B.backgroundMethod)(),b=(0,B.backgroundMethod)(),m=(0,B.backgroundMethod)(),n((O=function(e){(0,T.default)(r,e);var t=L(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).previousRequestTokenAccountId="",e.previousRequestTokenTimestamp=null,e.isFetchingToken=!1,e}var n=r.prototype;return n.refreshToken=function(){var e=(0,I.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.password;if(!(this.previousRequestTokenAccountId===r&&this.previousRequestTokenTimestamp&&Date.now()-this.previousRequestTokenTimestamp<1e4||this.isFetchingToken))try{this.isFetchingToken=!0;var o=yield this.backgroundApi.engine.getVault({networkId:t,accountId:r});yield o.exchangeToken(n),this.previousRequestTokenAccountId=r,this.previousRequestTokenTimestamp=Date.now()}finally{this.isFetchingToken=!1}}));return function(t){return e.apply(this,arguments)}}(),n.createInvoice=function(){var e=(0,I.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.amount,o=e.description;return(yield this.backgroundApi.engine.getVault({networkId:t,accountId:r})).createInvoice(n,o)}));return function(t){return e.apply(this,arguments)}}(),n.fetchSpecialInvoice=function(){var e=(0,I.default)((function*(e){var t=e.paymentHash,r=e.networkId,n=e.accountId;return(yield this.backgroundApi.engine.getVault({networkId:r,accountId:n})).fetchSpecialInvoice(t)}));return function(t){return e.apply(this,arguments)}}(),n.decodedInvoice=function(){var e=(0,I.default)((function*(e){var t=e.payReq,r=e.networkId,n=e.accountId;return(yield this.backgroundApi.engine.getVault({networkId:r,accountId:n}))._decodedInvoceCache(t)}));return function(t){return e.apply(this,arguments)}}(),n.isZeroAmountInvoice=function(){var e=(0,I.default)((function*(e){var t=e.payReq,r=e.networkId,n=e.accountId,o=yield this.backgroundApi.engine.getVault({networkId:r,accountId:n}),i=yield o._decodedInvoceCache(t);return o.isZeroAmountInvoice(i)}));return function(t){return e.apply(this,arguments)}}(),n.checkAuth=function(){var e=(0,I.default)((function*(e){var t=e.networkId,r=e.accountId;return(yield this.backgroundApi.engine.getVault({networkId:t,accountId:r})).checkAuth().then((function(){return!1})).catch((function(e){return console.log("check auth error: ",e),!0}))}));return function(t){return e.apply(this,arguments)}}(),n.getInvoiceConfig=function(){var e=(0,I.default)((function*(e){var t=e.networkId,r=e.accountId,n=yield this.backgroundApi.engine.getVault({networkId:t,accountId:r}),o=yield n.getClient(),i=yield n.getCurrentBalanceAddress();return o.getConfig(i)}));return function(t){return e.apply(this,arguments)}}(),n.validateZeroInvoiceMaxSendAmount=function(){var e=(0,I.default)((function*(e){var t=e.accountId,r=e.networkId,n=e.amount;return(yield this.backgroundApi.engine.getVault({networkId:r,accountId:t})).validateSendAmount(n)}));return function(t){return e.apply(this,arguments)}}(),n.getLnurlDetails=function(){var e=(0,I.default)((function*(e){return(0,_.getLnurlDetails)(e)}));return function(t){return e.apply(this,arguments)}}(),n.fetchLnurlPayRequestResult=function(){var e=(0,I.default)((function*(e){var t=e.callback,r=e.params;try{var n=N().create({withCredentials:!0}),o=yield n.get(t,{params:r,validateStatus:function(){return!0}});if(o.status>=500)throw new E.OneKeyError("Recipient server error");if(!Object.prototype.hasOwnProperty.call(o.data,"pr"))throw new E.OneKeyError(o.data.reason);return o.data}catch(i){throw console.error(i),i}}));return function(t){return e.apply(this,arguments)}}(),n.verifyInvoice=function(){var e=(0,I.default)((function*(e){var t=e.paymentInfo,r=e.metadata,n=e.amount,o=e.networkId,i=e.accountId,a=yield this.decodedInvoice({payReq:t.pr,networkId:o,accountId:i});return(0,_.verifyInvoice)({decodedInvoice:a,paymentInfo:t,metadata:r,amount:n})}));return function(t){return e.apply(this,arguments)}}(),n.getSuccessAction=function(){var e=(0,I.default)((function*(e){var t=e.networkId,r=e.encodedTx;return(0,F.isLightningNetworkByNetworkId)(t)?Promise.resolve(r.successAction):null}));return function(t){return e.apply(this,arguments)}}(),n.fetchLnurlWithdrawRequestResult=function(){var e=(0,I.default)((function*(e){var t=e.callback,r=e.pr,n=e.k1;try{var o=yield N().get(t,{params:{k1:n,pr:r}});if(o.status>=500)throw new Error("Recipient server error");if("OK"===o.data.status.toUpperCase())return o.data;throw new E.OneKeyError(o.data.reason)}catch(s){var i,a;console.error(s);var c,u=s;if(null!=(i=u.response)&&null!=(a=i.data)&&a.reason)throw new Error(null==(c=u.response)?void 0:c.data.reason);throw s}}));return function(t){return e.apply(this,arguments)}}(),n.lnurlAuth=function(){var e=(0,I.default)((function*(e){var t=e.password,r=e.walletId,n=e.networkId,o=e.lnurlDetail;if("login"!==o.tag)throw new Error("lnurl-auth: invalid tag");var i=yield this.backgroundApi.engine.getWalletOnlyVault(n,r),a=yield i.getLnurlAuthUrl({lnurlDetail:o,password:t});try{var c,u,s=yield N().get(a.toString());if("OK"!==(null==s||null==(c=s.data.status)?void 0:c.toUpperCase()))throw new Error((null==s||null==(u=s.data)?void 0:u.reason)||"Auth: Something went wrong");return s.data}catch(f){if(N().isAxiosError(f)){var d,p;console.error("LNURL-AUTH FAIL:",f);var l=(null==(d=f.response)||null==(p=d.data)?void 0:p.reason)||f.message;throw new Error(l)}throw f}}));return function(t){return e.apply(this,arguments)}}(),n.weblnVerifyMessage=function(){var e=(0,I.default)((function*(e){var t=e.accountId,r=e.networkId,n=e.message,o=e.signature;return(new x.default.LndHub).verifyMessage({engine:this.backgroundApi.engine,accountId:t,networkId:r,message:n,signature:o})}));return function(t){return e.apply(this,arguments)}}(),n.weblnGetBalance=function(){var e=(0,I.default)((function*(e){var t,r=e.accountId,n=e.networkId,o=yield this.backgroundApi.engine.getVault({networkId:n,accountId:r}),i=yield o.getCurrentBalanceAddress(),a=yield o.getBalances([{address:i}]);return{balance:new(j())(null!=(t=null==a?void 0:a[0])?t:0).toNumber(),currency:"sats"}}));return function(t){return e.apply(this,arguments)}}(),n.batchGetLnUrl=function(){var e=(0,I.default)((function*(e){var t=e.networkId,r=e.addresses;return Array.isArray(r)&&r.length?(yield this.backgroundApi.engine.getChainOnlyVault(t)).batchGetLnurl(r):{}}));return function(t){return e.apply(this,arguments)}}(),n.batchGetLnUrlByAccounts=function(){var e=(0,I.default)((function*(e){var t=e.networkId,r=e.accounts,n=function(e){try{var t,r;return null!=(r=JSON.parse(null!=(t=e.addresses)?t:"{}").normalizedAddress)?r:""}catch(n){throw new Error("can not get normalized address: ",n)}},o=r.map((function(e){return n(e)})),i=yield this.batchGetLnUrl({networkId:t,addresses:o}),a={};return r.forEach((function(e){var t=n(e),r=i[t];a[e.id]=r})),a}));return function(t){return e.apply(this,arguments)}}(),(0,P.default)(r)}(W.default),(0,M.default)(O.prototype,"refreshToken",[o],Object.getOwnPropertyDescriptor(O.prototype,"refreshToken"),O.prototype),(0,M.default)(O.prototype,"createInvoice",[i],Object.getOwnPropertyDescriptor(O.prototype,"createInvoice"),O.prototype),(0,M.default)(O.prototype,"fetchSpecialInvoice",[a],Object.getOwnPropertyDescriptor(O.prototype,"fetchSpecialInvoice"),O.prototype),(0,M.default)(O.prototype,"decodedInvoice",[c],Object.getOwnPropertyDescriptor(O.prototype,"decodedInvoice"),O.prototype),(0,M.default)(O.prototype,"isZeroAmountInvoice",[u],Object.getOwnPropertyDescriptor(O.prototype,"isZeroAmountInvoice"),O.prototype),(0,M.default)(O.prototype,"checkAuth",[s],Object.getOwnPropertyDescriptor(O.prototype,"checkAuth"),O.prototype),(0,M.default)(O.prototype,"getInvoiceConfig",[d],Object.getOwnPropertyDescriptor(O.prototype,"getInvoiceConfig"),O.prototype),(0,M.default)(O.prototype,"validateZeroInvoiceMaxSendAmount",[p],Object.getOwnPropertyDescriptor(O.prototype,"validateZeroInvoiceMaxSendAmount"),O.prototype),(0,M.default)(O.prototype,"getLnurlDetails",[l],Object.getOwnPropertyDescriptor(O.prototype,"getLnurlDetails"),O.prototype),(0,M.default)(O.prototype,"fetchLnurlPayRequestResult",[f],Object.getOwnPropertyDescriptor(O.prototype,"fetchLnurlPayRequestResult"),O.prototype),(0,M.default)(O.prototype,"verifyInvoice",[y],Object.getOwnPropertyDescriptor(O.prototype,"verifyInvoice"),O.prototype),(0,M.default)(O.prototype,"getSuccessAction",[h],Object.getOwnPropertyDescriptor(O.prototype,"getSuccessAction"),O.prototype),(0,M.default)(O.prototype,"fetchLnurlWithdrawRequestResult",[v],Object.getOwnPropertyDescriptor(O.prototype,"fetchLnurlWithdrawRequestResult"),O.prototype),(0,M.default)(O.prototype,"lnurlAuth",[g],Object.getOwnPropertyDescriptor(O.prototype,"lnurlAuth"),O.prototype),(0,M.default)(O.prototype,"weblnVerifyMessage",[k],Object.getOwnPropertyDescriptor(O.prototype,"weblnVerifyMessage"),O.prototype),(0,M.default)(O.prototype,"weblnGetBalance",[w],Object.getOwnPropertyDescriptor(O.prototype,"weblnGetBalance"),O.prototype),(0,M.default)(O.prototype,"batchGetLnUrl",[b],Object.getOwnPropertyDescriptor(O.prototype,"batchGetLnUrl"),O.prototype),(0,M.default)(O.prototype,"batchGetLnUrlByAccounts",[m],Object.getOwnPropertyDescriptor(O.prototype,"batchGetLnUrlByAccounts"),O.prototype),A=O))||A)},37600:(e,t,r)=>{r.r(t),r.d(t,{createExchangeProxyEIP712Domain:()=>G,default:()=>J});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A,O,I=r(634795),P=r(887371),T=r(545754),S=r(411987),D=r(695058),M=r(859375),C=r(256666),N=r(112889),R=r(534756),j=r(37331),E=r(436873),x=r(363250),_=r(415008),B=r(438760),F=r(942013),W=r(201882);function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,D.default)(e);if(t){var o=(0,D.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,S.default)(this,r)}}function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){(0,C.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var V="0x0000000000000000000000000000000000000000",q=[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],K=[{type:"address",name:"makerToken"},{type:"address",name:"takerToken"},{type:"uint128",name:"makerAmount"},{type:"uint128",name:"takerAmount"},{type:"uint128",name:"takerTokenFeeAmount"},{type:"address",name:"maker"},{type:"address",name:"taker"},{type:"address",name:"sender"},{type:"address",name:"feeRecipient"},{type:"bytes32",name:"pool"},{type:"uint64",name:"expiry"},{type:"uint256",name:"salt"}],$={chainId:1,verifyingContract:V,name:"ZeroEx",version:"1.0.0"};function G(e,t){return H(H(H({},$),e?{chainId:e}:{}),t?{verifyingContract:t}:{})}var z="0xdef1c0ded9bec7f1a1670819833240f027b25eff";const J=(n=(0,B.backgroundClass)(),o=(0,B.backgroundMethod)(),i=(0,B.backgroundMethod)(),a=(0,B.backgroundMethod)(),c=(0,B.backgroundMethod)(),u=(0,B.backgroundMethod)(),s=(0,B.backgroundMethod)(),d=(0,B.backgroundMethod)(),p=(0,B.backgroundMethod)(),l=(0,B.backgroundMethod)(),f=(0,B.backgroundMethod)(),y=(0,B.backgroundMethod)(),h=(0,B.backgroundMethod)(),v=(0,B.backgroundMethod)(),g=(0,B.backgroundMethod)(),k=(0,B.backgroundMethod)(),w=(0,B.backgroundMethod)(),b=(0,B.backgroundMethod)(),m=(0,B.backgroundMethod)(),n((O=function(e){(0,T.default)(r,e);var t=L(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getEIP712TypedData=function(){var e=(0,I.default)((function*(e){var t=e.domain,r=e.message,n=t.networkId,o=(0,_.getChainIdFromNetworkId)(n);return{types:{EIP712Domain:q,LimitOrder:K},domain:G(Number(o),z),primaryType:"LimitOrder",message:{makerToken:r.makerToken,takerToken:r.takerToken,makerAmount:r.makerAmount,takerAmount:r.takerAmount,takerTokenFeeAmount:r.takerTokenFeeAmount,maker:r.maker,taker:r.taker,sender:r.sender,feeRecipient:r.feeRecipient,pool:r.pool,expiry:r.expiry,salt:r.salt}}}));return function(t){return e.apply(this,arguments)}}(),n.getServerEndPoint=function(){return(0,N.getFiatEndpoint)()},n.setDefaultTokens=function(){var e=(0,I.default)((function*(){var e=this.backgroundApi.appSelector,t=e((function(e){return e.swap.inputToken})),r=e((function(e){return e.swap.typedValue})),n=x.WETH9[F.OnekeyNetwork.eth];t&&x.limitOrderNetworkIds.includes(t.networkId)&&(n=(0,x.wrapToken)(t)),this.setInputToken(n),this.setSmartOutput(n),this.userInputValue(r)}));return function(){return e.apply(this,arguments)}}(),n.setSmartOutput=function(){var e=(0,I.default)((function*(e){if(x.limitOrderNetworkIds.includes(e.networkId)){var t=this.backgroundApi,r=t.appSelector,n=t.serviceSwap,o=r((function(e){return e.limitOrder.tokenOut}));if((null==o?void 0:o.networkId)!==e.networkId||o.tokenIdOnNetwork.toLowerCase()===e.tokenIdOnNetwork.toLowerCase()){var i,a=yield n.getPaymentToken(e),c=x.WETH9[e.networkId];a&&(i=(0,_.tokenEqual)(e,a)?c:a),i&&i.networkId===e.networkId&&this.setOutputToken(i)}}}));return function(t){return e.apply(this,arguments)}}(),n.setInputToken=function(){var e=(0,I.default)((function*(e){var t=this.backgroundApi,r=t.appSelector,n=t.dispatch,o=r((function(e){return e.limitOrder.tokenOut})),i=r((function(e){return e.limitOrder.tokenIn})),a=(0,x.wrapToken)(e);i&&(0,_.tokenEqual)(i,a)||(n((0,j.setTokenIn)(a)),a.networkId===(null==i?void 0:i.networkId)?o&&o.networkId===a.networkId&&o.tokenIdOnNetwork===a.tokenIdOnNetwork&&n((0,j.setTokenOut)(i)):this.setSmartOutput(a),this.setSendingAccountByNetwork(this.getNetwork(a.networkId)))}));return function(t){return e.apply(this,arguments)}}(),n.setOutputToken=function(){var e=(0,I.default)((function*(e){var t=this.backgroundApi,r=t.dispatch,n=t.appSelector,o=n((function(e){return e.limitOrder.tokenOut})),i=n((function(e){return e.limitOrder.tokenIn})),a=(0,x.wrapToken)(e);if(!o||!(0,_.tokenEqual)(o,a)){var c=[];i&&(0,_.tokenEqual)(i,a)&&c.push((0,j.setTokenIn)(o)),c.push((0,j.setTokenOut)(a)),r.apply(void 0,c)}}));return function(t){return e.apply(this,arguments)}}(),n.resetState=function(){var e=(0,I.default)((function*(){(0,this.backgroundApi.dispatch)((0,j.resetState)())}));return function(){return e.apply(this,arguments)}}(),n.getNetwork=function(e){if(e)return(0,this.backgroundApi.appSelector)((function(e){return e.runtime.networks})).find((function(t){return t.id===e}))},n.setSendingAccountByNetwork=function(){var e=(0,I.default)((function*(e){if(e){var t=this.backgroundApi,r=t.dispatch,n=t.appSelector,o=t.engine,i=n((function(e){return e.limitOrder.activeAccount}));if(i&&(0,R.isAccountCompatibleWithNetwork)(i.id,e.id))return i;var a=n((function(e){return e.runtime.wallets})),c=n((function(e){return e.runtime})).networks,u=n((function(e){return e.general})),s=u.activeNetworkId,d=u.activeWalletId,p=u.activeAccountId,l=a.find((function(e){return e.id===d})),f=c.find((function(e){return e.id===s}));if(l&&f){var y=yield o.getAccounts(l.accounts,e.id),h=e.impl===f.impl?y.find((function(e){return e.id===p})):y[0];if(h){var v=H(H({},h),{},{impl:e.impl});return r((0,j.setActiveAccount)(v)),v}var g=a.filter((function(e){return e.id!==p}));if(0!==g.length){for(var k=0;k<g.length;k+=1){var w=g[k],b=yield o.getAccounts(w.accounts,e.id);if(b.length>0)return void r((0,j.setActiveAccount)(b[0]))}r((0,j.setActiveAccount)(null))}}}}));return function(t){return e.apply(this,arguments)}}(),n.switchTokens=function(){var e=(0,I.default)((function*(){var e=this.backgroundApi,t=e.dispatch,r=e.appSelector,n=r((function(e){return e.limitOrder.tokenOut})),o=r((function(e){return e.limitOrder.tokenIn}));t((0,j.setTokenIn)(n),(0,j.setTokenOut)(o))}));return function(){return e.apply(this,arguments)}}(),n.userInputValue=function(e){(0,this.backgroundApi.dispatch)((0,j.setTypedValue)(e))},n.buildLimitOrder=function(){var e=(0,I.default)((function*(e){var t=e.params,r=e.instantRate,n=this.backgroundApi.appSelector,o=t.activeAccount,i=t.tokenIn,a=t.tokenOut,c=t.tokenInValue,u=n((function(e){return e.limitOrder.expireIn}));if(o&&i&&a&&c&&r){var s=(0,_.getTokenAmountString)(i,c),d=(0,_.getTokenAmountString)(a,(0,_.multiply)(c,r)),p={maker:o.address,taker:V,makerToken:i.tokenIdOnNetwork,takerToken:a.tokenIdOnNetwork,makerAmount:s,takerAmount:d,salt:String(Date.now()),pool:"0x0000000000000000000000000000000000000000000000000000000000000000",sender:V,takerTokenFeeAmount:"",feeRecipient:"",expiry:String(Math.floor(Date.now()/1e3)+60*u)},l=`${this.getServerEndPoint()}/limit_order/config_order`;return(yield this.client.post(l,{data:p})).data}}));return function(t){return e.apply(this,arguments)}}(),n.submitLimitOrder=function(){var e=(0,I.default)((function*(e){var t=e.signature,r=e.order,n=e.networkId,o=`0x${t.substring(2).substring(0,64)}`,i=`0x${t.substring(2).substring(64,128)}`,a=parseInt(t.substring(2).substring(128,130),16),c=(0,_.getChainIdFromNetworkId)(n),u=H(H({},r),{},{chainId:Number(c),verifyingContract:z,signature:{v:a,s:i,r:o,signatureType:2}}),s=`${this.getServerEndPoint()}/limit_order/submit_order`;return(yield this.client.post(s,{networkId:n,data:u})).data}));return function(t){return e.apply(this,arguments)}}(),n.fetchOrderState=function(){var e=(0,I.default)((function*(e){var t=e.networkId,r=e.orderHash,n=`${this.getServerEndPoint()}/limit_order/order_details`;return(yield this.client.get(n,{params:{networkId:t,orderHash:r}})).data}));return function(t){return e.apply(this,arguments)}}(),n.buildCancelLimitOrderTx=function(){var e=(0,I.default)((function*(e){var t=`${this.getServerEndPoint()}/limit_order/build_cancel_tx`;return{data:(yield this.client.post(t,{data:e})).data,to:z}}));return function(t){return e.apply(this,arguments)}}(),n.fetchAccountLimitOrderList=function(){var e=(0,I.default)((function*(e){var t,r,n=e.networkId,o=e.accountId,i=this.backgroundApi.engine,a=yield i.getAccount(o,n),c=`${this.getServerEndPoint()}/limit_order/query_orders`;return null!=(t=null==(r=(yield this.client.get(c,{params:{networkId:n,maker:a.address}})).data)?void 0:r.records)?t:[]}));return function(t){return e.apply(this,arguments)}}(),n.formatResponseToLimitOrder=function(){var e=(0,I.default)((function*(e){var t=e.response,r=e.accountId,n=e.networkId,o=t.order,i=o.makerToken,a=o.takerToken,c=this.backgroundApi.serviceToken,u=yield c.batchTokenDetail(n,[i,a]),s=u[i],d=u[a],p=t.order.makerAmount,l=t.order.takerAmount,f=(0,_.getTokenAmountValue)(s,p),y=(0,_.getTokenAmountValue)(d,l);return{orderHash:t.metaData.orderHash,accountId:r,networkId:n,tokenIn:s,tokenInValue:p,tokenOut:d,tokenOutValue:l,remainingFillable:t.metaData.remainingFillableTakerAmount,createdAt:Math.floor(new Date(t.metaData.createdAt).getTime()/1e3),expiredIn:Number(t.order.expiry),rate:(0,_.formatAmountExact)((0,_.div)(y,f))}}));return function(t){return e.apply(this,arguments)}}(),n.syncAccountOrders=function(){var e=(0,I.default)((function*(e){var t=this,r=e.networkId,n=e.accountId,o=this.backgroundApi.dispatch,i=(yield this.fetchAccountLimitOrderList({networkId:r,accountId:n})).map((function(e){return t.formatResponseToLimitOrder({response:e,networkId:r,accountId:n}).then((function(e){return{status:"fulfilled",value:e}})).catch((function(e){return{status:"rejected",reason:e}}))})),a=(yield Promise.all(i)).filter((function(e){return"fulfilled"===e.status})).map((function(e){return e.value}));o((0,E.resetLimitOrderTransactions)({networkId:r,accountId:n,limitOrders:a}))}));return function(t){return e.apply(this,arguments)}}(),n.syncAccount=function(){var e=(0,I.default)((function*(e){var t=e.accountId;this.syncAccountOrders({networkId:F.OnekeyNetwork.eth,accountId:t}),this.syncAccountOrders({networkId:F.OnekeyNetwork.bsc,accountId:t}),this.syncAccountOrders({networkId:F.OnekeyNetwork.polygon,accountId:t})}));return function(t){return e.apply(this,arguments)}}(),n.queryOrderStateProcess=function(){var e=(0,I.default)((function*(e){var t=e.networkId,r=e.orderHash,n=e.accountId,o=this.backgroundApi,i=o.dispatch,a=o.serviceToken;try{var c=yield this.fetchOrderState({networkId:t,orderHash:r});i((0,E.updateLimitOrderTransaction)({accountId:e.accountId,networkId:e.networkId,orderHash:r,details:{remainingFillable:c.metaData.remainingFillableTakerAmount}}))}catch(s){var u=(yield this.fetchAccountLimitOrderList({networkId:t,accountId:n})).map((function(e){return e.metaData.orderHash}));u&&0!==u.length&&u.includes(r)||(i((0,E.deleteLimitOrderTransaction)({accountId:e.accountId,networkId:e.networkId,orderHash:r})),a.fetchAndSaveAccountTokenBalance({accountId:e.accountId,networkId:e.networkId,tokenIds:[e.tokenIn.tokenIdOnNetwork]}))}}));return function(t){return e.apply(this,arguments)}}(),n.isStableToken=function(e){var t=e.tokenIdOnNetwork.toLowerCase();if(e.networkId===F.OnekeyNetwork.eth){return["0xdac17f958d2ee523a2206206994597c13d831ec7","0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48"].includes(t)}if(e.networkId===F.OnekeyNetwork.bsc){return["0x55d398326f99059ff775485246999027b3197955","0x8ac76a51cc950d9822d68b83fe1ad97b32cd580d"].includes(t)}if(e.networkId===F.OnekeyNetwork.polygon){return["0xc2132d05d31c914a87c6611c10748aeb04b58e8f","0x2791bca1f2de4661ed88a30c99a7a9449aa84174"].includes(t)}return!1},n.setRate=function(){var e=(0,I.default)((function*(e){var t=this.backgroundApi,r=t.dispatch,n=t.appSelector,o=[(0,j.setMktRate)(e)];if(!n((function(e){return e.limitOrder.instantRate}))){var i=n((function(e){return e.limitOrder.tokenIn}));if(i&&this.isStableToken(i)){var a=(0,_.formatAmountExact)((0,_.div)(1,e));o.push((0,j.setInstantRate)(e),(0,j.setTypedPrice)({value:a,reversed:!0}))}else o.push((0,j.setInstantRate)(e),(0,j.setTypedPrice)({value:e}))}r.apply(void 0,o)}));return function(t){return e.apply(this,arguments)}}(),(0,P.default)(r)}(W.default),(0,M.default)(O.prototype,"getEIP712TypedData",[o],Object.getOwnPropertyDescriptor(O.prototype,"getEIP712TypedData"),O.prototype),(0,M.default)(O.prototype,"setDefaultTokens",[i],Object.getOwnPropertyDescriptor(O.prototype,"setDefaultTokens"),O.prototype),(0,M.default)(O.prototype,"setSmartOutput",[a],Object.getOwnPropertyDescriptor(O.prototype,"setSmartOutput"),O.prototype),(0,M.default)(O.prototype,"setInputToken",[c],Object.getOwnPropertyDescriptor(O.prototype,"setInputToken"),O.prototype),(0,M.default)(O.prototype,"setOutputToken",[u],Object.getOwnPropertyDescriptor(O.prototype,"setOutputToken"),O.prototype),(0,M.default)(O.prototype,"resetState",[s],Object.getOwnPropertyDescriptor(O.prototype,"resetState"),O.prototype),(0,M.default)(O.prototype,"setSendingAccountByNetwork",[d],Object.getOwnPropertyDescriptor(O.prototype,"setSendingAccountByNetwork"),O.prototype),(0,M.default)(O.prototype,"switchTokens",[p],Object.getOwnPropertyDescriptor(O.prototype,"switchTokens"),O.prototype),(0,M.default)(O.prototype,"userInputValue",[l],Object.getOwnPropertyDescriptor(O.prototype,"userInputValue"),O.prototype),(0,M.default)(O.prototype,"buildLimitOrder",[f],Object.getOwnPropertyDescriptor(O.prototype,"buildLimitOrder"),O.prototype),(0,M.default)(O.prototype,"submitLimitOrder",[y],Object.getOwnPropertyDescriptor(O.prototype,"submitLimitOrder"),O.prototype),(0,M.default)(O.prototype,"fetchOrderState",[h],Object.getOwnPropertyDescriptor(O.prototype,"fetchOrderState"),O.prototype),(0,M.default)(O.prototype,"buildCancelLimitOrderTx",[v],Object.getOwnPropertyDescriptor(O.prototype,"buildCancelLimitOrderTx"),O.prototype),(0,M.default)(O.prototype,"fetchAccountLimitOrderList",[g],Object.getOwnPropertyDescriptor(O.prototype,"fetchAccountLimitOrderList"),O.prototype),(0,M.default)(O.prototype,"syncAccountOrders",[k],Object.getOwnPropertyDescriptor(O.prototype,"syncAccountOrders"),O.prototype),(0,M.default)(O.prototype,"syncAccount",[w],Object.getOwnPropertyDescriptor(O.prototype,"syncAccount"),O.prototype),(0,M.default)(O.prototype,"queryOrderStateProcess",[b],Object.getOwnPropertyDescriptor(O.prototype,"queryOrderStateProcess"),O.prototype),(0,M.default)(O.prototype,"setRate",[m],Object.getOwnPropertyDescriptor(O.prototype,"setRate"),O.prototype),A=O))||A)},976542:(e,t,r)=>{r.r(t),r.d(t,{default:()=>G});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A,O,I,P,T,S=r(256666),D=r(968079),M=r(634795),C=r(254073),N=r.n(C),R=r(887371),j=r(545754),E=r(411987),x=r(695058),_=r(859375),B=r(992431),F=r(134662),W=r(393093),L=r(929377),U=r(438760),H=r(402814),V=r(201882);function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach((function(t){(0,S.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,x.default)(e);if(t){var o=(0,x.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,E.default)(this,r)}}var G=(n=(0,U.backgroundClass)(),o=(0,U.backgroundMethod)(),i=(0,U.backgroundMethod)(),a=(0,U.backgroundMethod)(),c=(0,U.bindThis)(),u=(0,U.backgroundMethod)(),s=(0,U.backgroundMethod)(),d=(0,U.backgroundMethod)(),p=(0,U.backgroundMethod)(),l=(0,U.backgroundMethod)(),f=(0,U.backgroundMethod)(),y=(0,U.backgroundMethod)(),h=(0,U.backgroundMethod)(),v=(0,U.backgroundMethod)(),g=(0,U.backgroundMethod)(),k=(0,U.backgroundMethod)(),w=(0,U.backgroundMethod)(),b=(0,U.backgroundMethod)(),m=(0,U.backgroundMethod)(),A=(0,U.backgroundMethod)(),O=(0,U.backgroundMethod)(),I=(0,U.backgroundMethod)(),n((T=function(e){(0,j.default)(r,e);var t=$(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n)))._fetchMarketListDebounced=N()(e.fetchMarketList,1200,{leading:!1,trailing:!0}),e}var n=r.prototype;return n.fetchMarketCategorys=function(){var e=(0,M.default)((function*(){var e,t=this.backgroundApi,r=t.appSelector,n=t.dispatch,o=r((function(e){return e.settings.locale})),i=yield(0,H.fetchData)("/market/category/list",{locale:"system"===o?(0,L.getDefaultLocale)():o},[]),a=i.find((function(e){return e.categoryId===W.MARKET_FAVORITES_CATEGORYID}));a&&(a.coingeckoIds=(0,D.default)(new Set(null==(e=a.coingeckoIds)?void 0:e.concat(yield this.getMarketFavoriteTokens()))));n((0,W.saveMarketCategorys)(i));var c=r((function(e){return e.market.selectedCategoryId})),u=r((function(e){return e.market.categorys})),s=Object.values(u).find((function(e){return e.defaultSelected}));!c&&s&&this.toggleCategory(s.categoryId)}));return function(){return e.apply(this,arguments)}}(),n.toggleCategory=function(e){this.updateMarketListSort(null),this.backgroundApi.dispatch((0,W.updateSelectedCategory)(e))},n.fetchMarketListDebounced=function(){var e=(0,M.default)((function*(e){var t=e.categoryId,r=e.ids,n=e.sparkline;yield this._fetchMarketListDebounced({categoryId:t,ids:r,sparkline:n})}));return function(t){return e.apply(this,arguments)}}(),n.fetchMarketList=function(){var e=(0,M.default)((function*(e){var t,r=e.categoryId,n=e.ids,o=e.sparkline,i=this.backgroundApi,a=i.dispatch,c=i.appSelector,u=n&&n.length>0?n:void 0;if(r!==W.MARKET_FAVORITES_CATEGORYID||u){var s=c((function(e){return e.settings.selectedFiatMoneySymbol})),d=yield(0,H.fetchData)("/market/tokens",{category:r,vs_currency:null!=s?s:"usd",ids:u,sparkline:o,sparklinePoints:o?100:void 0},[]);if(0!==d.length){var p=c((function(e){return e.market.categorys}))[null!=r?r:""];if(r!==W.MARKET_FAVORITES_CATEGORYID||!p||(null==(t=p.coingeckoIds)?void 0:t.length)===d.length){a((0,W.updateMarketTokens)({categoryId:r,marketTokens:d}));var l=c((function(e){return e.market.marketTokens})),f=d.filter((function(e){var t;return!(null!=(t=l[e.coingeckoId])&&t.tokens)}));null!=f&&f.length&&this.fetchMarketTokensBaseInfo(f.map((function(e){return e.coingeckoId})).join(","))}}}}));return function(t){return e.apply(this,arguments)}}(),n.fetchMarketTokensBaseInfo=function(){var e=(0,M.default)((function*(e){var t=(yield(0,H.fetchData)("/market/tokens/base/",{coingeckoIds:e},[])).map((function(e){var t=e.tokens.map((function(e){return(0,F.formatServerToken)(e)}));return K(K({},e),{},{tokens:t})}));return this.backgroundApi.dispatch((0,W.updateMarketTokensBaseInfo)(t)),t}));return function(t){return e.apply(this,arguments)}}(),n.fetchMarketDetail=function(){var e=(0,M.default)((function*(e){var t=e.coingeckoId,r=e.locale,n=this.backgroundApi,o=n.appSelector,i=n.dispatch,a=o((function(e){return e.settings.selectedFiatMoneySymbol})),c=yield(0,H.fetchData)("/market/detail",{vs_currency:null!=a?a:"usd",id:t,locale:r,explorer_platforms:!0},null);c&&i((0,W.updateMarketTokenDetail)({coingeckoId:t,data:c}))}));return function(t){return e.apply(this,arguments)}}(),n.marketTokenCancelFavoriteForNtf=function(){var e=(0,M.default)((function*(e){var t=(0,this.backgroundApi.appSelector)((function(e){return e.settings.instanceId})),r=yield(0,H.fetchData)("/notification/favorite",{instanceId:t,coingeckoId:e},null,"DELETE");return r&&r.acknowledged?Promise.resolve(!0):Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),n.marketTokenAddFavoriteForNtf=function(){var e=(0,M.default)((function*(e,t){var r=(0,this.backgroundApi.appSelector)((function(e){return e.settings.instanceId})),n=yield(0,H.fetchData)("/notification/favorite",{instanceId:r,coingeckoId:e,symbol:t},null,"POST");return n&&n.coingeckoId?Promise.resolve(!0):Promise.resolve(!1)}));return function(t,r){return e.apply(this,arguments)}}(),n.fetchMarketTokenChart=function(){var e=(0,M.default)((function*(e){var t=e.coingeckoId,r=e.days,n=void 0===r?"1":r,o=e.points,i=void 0===o?"100":o,a=this.backgroundApi,c=a.appSelector,u=a.dispatch,s=c((function(e){return e.settings.selectedFiatMoneySymbol})),d=yield(0,H.fetchData)("/market/token/chart",{coingeckoId:t,days:n,points:i,vs_currency:null!=s?s:"usd"},[]);return d.length>0&&u((0,W.updateMarketChats)({coingeckoId:t,chart:d,days:n})),Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.updateMarketSearchKeyword=function(e){var t=e.searchKeyword;this.backgroundApi.dispatch((0,W.updateSearchKeyword)(t))},n.fetchMarketSearchTokens=function(){var e=(0,M.default)((function*(e){var t=e.searchKeyword;if(0!==t.length){var r=yield(0,H.fetchData)("/market/search/",{query:t},[]);this.backgroundApi.dispatch((0,W.updateSearchTokens)({searchKeyword:t,coingeckoIds:r})),r.length>0&&this.fetchMarketListDebounced({ids:r.join(","),sparkline:!1})}}));return function(t){return e.apply(this,arguments)}}(),n.getMarketFavoriteTokens=function(){var e=(0,M.default)((function*(){return B.default.market.getFavoriteMarketTokens()}));return function(){return e.apply(this,arguments)}}(),n.saveMarketFavoriteTokens=function(){var e=(0,M.default)((function*(e){var t=e.map((function(e){return e.coingeckoId}));for(var r of(this.backgroundApi.dispatch((0,W.saveMarketFavorite)(t)),e))r.symbol&&(yield this.marketTokenAddFavoriteForNtf(r.coingeckoId,r.symbol));return this.backgroundApi.serviceCloudBackup.requestBackup(),B.default.market.saveFavoriteMarketTokens(t)}));return function(t){return e.apply(this,arguments)}}(),n.getTokensDetail=function(){var e=(0,M.default)((function*(e){var t=e.join(",");return yield(0,H.fetchData)("/market/tokens",{vs_currency:"usd",ids:t},[])}));return function(t){return e.apply(this,arguments)}}(),n.clearMarketFavoriteTokens=function(){var e=(0,M.default)((function*(){return this.backgroundApi.serviceCloudBackup.requestBackup(),B.default.market.clearRawData()}));return function(){return e.apply(this,arguments)}}(),n.cancelMarketFavoriteToken=function(){var e=(0,M.default)((function*(e){return this.backgroundApi.dispatch((0,W.cancleMarketFavorite)(e)),this.marketTokenCancelFavoriteForNtf(e),this.backgroundApi.serviceCloudBackup.requestBackup(),B.default.market.deleteFavoriteMarketToken(e)}));return function(t){return e.apply(this,arguments)}}(),n.moveTopMarketFavoriteToken=function(){var e=(0,M.default)((function*(e){return this.backgroundApi.dispatch((0,W.moveTopMarketFavorite)(e)),B.default.market.unshiftFavoriteMarketToken(e)}));return function(t){return e.apply(this,arguments)}}(),n.updateMarketListSort=function(e){this.backgroundApi.dispatch((0,W.updateMarketListSort)(e))},n.switchMarketTopTab=function(e){this.backgroundApi.dispatch((0,W.switchMarketTopTab)(e))},n.syncSearchHistory=function(){var e=(0,M.default)((function*(){var e=yield B.default.market.getMarketSearchHistoryToken();this.backgroundApi.dispatch((0,W.syncMarketSearchTokenHistorys)({tokens:e}))}));return function(){return e.apply(this,arguments)}}(),n.saveSearchHistory=function(){var e=(0,M.default)((function*(e){return this.backgroundApi.dispatch((0,W.saveMarketSearchTokenHistory)({token:e})),B.default.market.saveMarketSearchHistoryToken(e)}));return function(t){return e.apply(this,arguments)}}(),n.clearSearchHistory=function(){var e=(0,M.default)((function*(){return this.backgroundApi.dispatch((0,W.clearMarketSearchTokenHistory)()),B.default.market.clearMarketSearchHistoryToken()}));return function(){return e.apply(this,arguments)}}(),n.setMarketSearchTab=function(e){e&&"string"===typeof e&&this.backgroundApi.dispatch((0,W.updateSearchTabCategory)(e))},(0,R.default)(r)}(V.default),(0,_.default)(T.prototype,"fetchMarketCategorys",[o],Object.getOwnPropertyDescriptor(T.prototype,"fetchMarketCategorys"),T.prototype),(0,_.default)(T.prototype,"toggleCategory",[i],Object.getOwnPropertyDescriptor(T.prototype,"toggleCategory"),T.prototype),(0,_.default)(T.prototype,"fetchMarketListDebounced",[a],Object.getOwnPropertyDescriptor(T.prototype,"fetchMarketListDebounced"),T.prototype),(0,_.default)(T.prototype,"fetchMarketList",[c],Object.getOwnPropertyDescriptor(T.prototype,"fetchMarketList"),T.prototype),(0,_.default)(T.prototype,"fetchMarketDetail",[u],Object.getOwnPropertyDescriptor(T.prototype,"fetchMarketDetail"),T.prototype),(0,_.default)(T.prototype,"marketTokenCancelFavoriteForNtf",[s],Object.getOwnPropertyDescriptor(T.prototype,"marketTokenCancelFavoriteForNtf"),T.prototype),(0,_.default)(T.prototype,"marketTokenAddFavoriteForNtf",[d],Object.getOwnPropertyDescriptor(T.prototype,"marketTokenAddFavoriteForNtf"),T.prototype),(0,_.default)(T.prototype,"fetchMarketTokenChart",[p],Object.getOwnPropertyDescriptor(T.prototype,"fetchMarketTokenChart"),T.prototype),(0,_.default)(T.prototype,"updateMarketSearchKeyword",[l],Object.getOwnPropertyDescriptor(T.prototype,"updateMarketSearchKeyword"),T.prototype),(0,_.default)(T.prototype,"fetchMarketSearchTokens",[f],Object.getOwnPropertyDescriptor(T.prototype,"fetchMarketSearchTokens"),T.prototype),(0,_.default)(T.prototype,"saveMarketFavoriteTokens",[y],Object.getOwnPropertyDescriptor(T.prototype,"saveMarketFavoriteTokens"),T.prototype),(0,_.default)(T.prototype,"getTokensDetail",[h],Object.getOwnPropertyDescriptor(T.prototype,"getTokensDetail"),T.prototype),(0,_.default)(T.prototype,"clearMarketFavoriteTokens",[v],Object.getOwnPropertyDescriptor(T.prototype,"clearMarketFavoriteTokens"),T.prototype),(0,_.default)(T.prototype,"cancelMarketFavoriteToken",[g],Object.getOwnPropertyDescriptor(T.prototype,"cancelMarketFavoriteToken"),T.prototype),(0,_.default)(T.prototype,"moveTopMarketFavoriteToken",[k],Object.getOwnPropertyDescriptor(T.prototype,"moveTopMarketFavoriteToken"),T.prototype),(0,_.default)(T.prototype,"updateMarketListSort",[w],Object.getOwnPropertyDescriptor(T.prototype,"updateMarketListSort"),T.prototype),(0,_.default)(T.prototype,"switchMarketTopTab",[b],Object.getOwnPropertyDescriptor(T.prototype,"switchMarketTopTab"),T.prototype),(0,_.default)(T.prototype,"syncSearchHistory",[m],Object.getOwnPropertyDescriptor(T.prototype,"syncSearchHistory"),T.prototype),(0,_.default)(T.prototype,"saveSearchHistory",[A],Object.getOwnPropertyDescriptor(T.prototype,"saveSearchHistory"),T.prototype),(0,_.default)(T.prototype,"clearSearchHistory",[O],Object.getOwnPropertyDescriptor(T.prototype,"clearSearchHistory"),T.prototype),(0,_.default)(T.prototype,"setMarketSearchTab",[I],Object.getOwnPropertyDescriptor(T.prototype,"setMarketSearchTab"),T.prototype),P=T))||P)},7075:(e,t,r)=>{r.r(t),r.d(t,{MigrateNotificationNames:()=>z,ServerUrl:()=>Q,checkServerUrl:()=>J,default:()=>X});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m=r(196234),A=r(256666),O=r(459740),I=r(634795),P=r(887371),T=r(545754),S=r(411987),D=r(695058),M=r(859375),C=r(636393),N=r(724623),R=r(112889),j=r(901187),E=r(707379),x=r(574393),_=r(438760),B=r(35116),F=r(447325),W=r(292147),L=(r(213208),r(201882)),U=r(812530),H=r(348834).Buffer,V=["publicKey"];function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach((function(t){(0,A.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,D.default)(e);if(t){var o=(0,D.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,S.default)(this,r)}}var G,z;function J(e){try{return new URL(e.replaceAll(" ","")).origin}catch(t){return""}}function Q(e,t){var r=e.replaceAll(" ","");return r.startsWith("http://")||(r=`http://${r}`),(r=J(r)).length>0?new URL(t,r).toString():""}!function(e){e.Connect="/migrate/connect",e.DisConnect="/migrate/disConnect",e.SendData="/migrate/send",e.RequestData="/migrate/data"}(G||(G={})),function(e){e.ReceiveDataFromClient="ReceiveDataFromClient",e.RequestDataFromClient="RequestDataFromClient",e.UpdateQrcode="UpdateQrcode",e.Other="Other"}(z||(z={}));const X=(n=(0,_.backgroundClass)(),o=(0,_.backgroundMethod)(),i=(0,_.backgroundMethod)(),a=(0,_.backgroundMethod)(),c=(0,_.backgroundMethod)(),u=(0,_.backgroundMethod)(),s=(0,_.backgroundMethod)(),d=(0,_.backgroundMethod)(),p=(0,_.backgroundMethod)(),l=(0,_.backgroundMethod)(),f=(0,_.backgroundMethod)(),y=(0,_.backgroundMethod)(),h=(0,_.backgroundMethod)(),v=(0,_.backgroundMethod)(),g=(0,_.backgroundMethod)(),k=(0,_.backgroundMethod)(),n((b=function(e){(0,T.default)(r,e);var t=$(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).randomNum="",e.connectUUID="",e.clientPubKey="",e.serverPubKey="",e.randomUUID="",e.keyPairProgress=!1,e.receivedHttpRequest=function(t){var r,n=t.type,o=t.data;if(n===U.HTTPServiceNames.Migrate){var i=o.requestId,a=o.url,c=e.backgroundApi.serviceHTTP,u=new URL(a,"http://example.com"),s=u.pathname,d=null!=(r=u.searchParams.get("uuid"))?r:"";W.default.migrate.info("receivedHttpRequest = ",s,d);var p=function(e,t){W.default.migrate.error(`apiName:${s},error:${e}`),c.serverRespond({requestId:i,respondData:{success:!1,message:e,code:t}})};if(0!==d.length)if(s===G.Connect){if(e.connectUUID.length>0)return void p("service already connected",E.MigrateErrorCode.ConnectFail);void 0===e.keypair&&(W.default.migrate.error("keypair not ready"),!1===e.keyPairProgress&&e.setupKeypair({reset:!0})),e.connectUUID=d,e.getPublicKey({key:d,type:"Client"}).then((function(t){t&&t.length>0&&e.keypair?(e.clientPubKey=H.from(t,"base64").toString("utf-8"),e.uploadPublicKey({key:d,type:"Server",publicKey:e.keypair.publicKey}).then((function(t){if(t){var r=(0,N.rsaEncrypt)(e.clientPubKey,e.randomNum);!1===r&&(e.clearMigrateInfo(),p("rsaEncrypt randomNum fail",E.MigrateErrorCode.EncryptFail)),c.serverRespond({requestId:i,respondData:{success:!0,data:{deviceInfo:(0,x.deviceInfo)(),password:r}}})}else e.clearMigrateInfo(),p("Upload server public key fail",E.MigrateErrorCode.PublicKeyError)}))):(e.clearMigrateInfo(),p("Get client public key",E.MigrateErrorCode.PublicKeyError))}))}else if(s===G.DisConnect)e.isConnectedUUID(d)?(c.serverRespond({requestId:i,respondData:{success:!0}}),e.setupKeypair({reset:!0}),e.clearMigrateInfo(),F.appUIEventBus.emit(F.AppUIEventBusNames.Migrate,{type:z.UpdateQrcode,data:{}})):p("uuid not match",E.MigrateErrorCode.UUIDNotMatch);else if(s===G.SendData){if(!e.isConnectedUUID(d))return void p("uuid not match",E.MigrateErrorCode.UUIDNotMatch);var l=o.postData;if(void 0===l)return void p("encryptData not found",E.MigrateErrorCode.ConnectFail);if(void 0===e.keypair)return void p("keypair lose",E.MigrateErrorCode.KetPairLose);var f=e.decryptDataWithPrivateKey(e.keypair.privateKey,l);F.appUIEventBus.emit(F.AppUIEventBusNames.Migrate,{type:z.ReceiveDataFromClient,data:{requestId:i,postData:f}})}else if(s===G.RequestData){if(!e.isConnectedUUID(d))return void p("uuid not match",E.MigrateErrorCode.UUIDNotMatch);F.appUIEventBus.emit(F.AppUIEventBusNames.Migrate,{type:z.RequestDataFromClient,data:o})}else F.appUIEventBus.emit(F.AppUIEventBusNames.Migrate,{type:z.Other,data:o});else p("uuid  is required",E.MigrateErrorCode.ConnectFail)}},e}var n=r.prototype;return n.ensureUUID=function(e){return e.reset&&(this.randomUUID=C.default.v4()),this.randomUUID},n.setupKeypair=function(){var e=(0,I.default)((function*(e){var t=this,r=e.reset;return new Promise((function(e){return(r||void 0===t.keypair)&&(t.keyPairProgress=!0,t.keypair=(0,N.generateKeypair)(),W.default.migrate.error("keypair setup"),t.keyPairProgress=!1),e("")}))}));return function(t){return e.apply(this,arguments)}}(),n.encryptDataWithPublicKey=function(){var e=(0,I.default)((function*(e,t){if(0===this.randomNum.length)return W.default.migrate.error("encryptData error: randomNum is empty"),!1;var r=(0,x.generatePassword)(90),n=(0,j.encrypt)(r,H.from(t,"utf-8")).toString("base64"),o=(0,N.rsaEncrypt)(e,r);if(!1===o)return!1;var i=H.from(this.randomNum,"utf-8").toString("base64");return Promise.resolve(`${n}${i}${o}`)}));return function(t,r){return e.apply(this,arguments)}}(),n.decryptDataWithPrivateKey=function(e,t){if(0===this.randomNum.length)return W.default.migrate.error("decryptData error: randomNum is empty"),!1;var r=H.from(this.randomNum,"utf-8").toString("base64"),n=t.split(r);if(2===n.length){var o=(0,N.rsaDecrypt)(e,n[1]);if(!1===o)return;return(0,j.decrypt)(o,H.from(n[0],"base64")).toString("utf-8")}},n.publicKey=function(){var e=(0,I.default)((function*(e){return Promise.resolve("Server"===e?this.serverPubKey:this.clientPubKey)}));return function(t){return e.apply(this,arguments)}}(),n.generateRandomNum=function(){var e=(0,I.default)((function*(){var e=(0,x.randomString)(2,"ABCDEFGHJKLMNPQRSTUVWXYZ")+(0,x.randomString)(2,"123456789");return this.randomNum=(0,x.shuffle)(e),Promise.resolve(this.randomNum)}));return function(){return e.apply(this,arguments)}}(),n.clearMigrateInfo=function(){var e=(0,I.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.connectUUID;return e.length>0&&this.deletePublicKey({key:e}),this.connectUUID="",this.serverPubKey="",this.clientPubKey="",this.randomNum="",Promise.resolve(!0)}));return function(){return e.apply(this,arguments)}}(),n.getPublicKey=function(){var e=(0,I.default)((function*(e){var t=new URLSearchParams(e),r=`${this.baseUrl}/key?${t.toString()}`;return(yield this.client.get(r).then((function(e){return e.data})).catch((function(){return{success:!1,data:void 0}}))).data}));return function(t){return e.apply(this,arguments)}}(),n.uploadPublicKey=function(){var e=(0,I.default)((function*(e){var t=e.publicKey,r=(0,O.default)(e,V),n=H.from(t,"utf-8").toString("base64"),o=`${this.baseUrl}/upload`;return(yield this.client.post(o,K(K({},r),{},{publicKey:n})).then((function(e){return e.data})).catch((function(){return{success:!1}}))).success}));return function(t){return e.apply(this,arguments)}}(),n.deletePublicKey=function(){var e=(0,I.default)((function*(e){var t=new URLSearchParams(e),r=`${this.baseUrl}/delete?${t.toString()}`;return(yield this.client.get(r).then((function(e){return e.data})).catch((function(){return{success:!1,data:void 0}}))).success}));return function(t){return e.apply(this,arguments)}}(),n.connectServer=function(){var e=(0,I.default)((function*(e){void 0===this.keypair&&(W.default.migrate.error("keypair not ready"),!1===this.keyPairProgress&&this.setupKeypair({reset:!0}));var t=e.split("/");if(2===t.length&&this.keypair){var r=(0,m.default)(t,2),n=r[0],o=r[1];if(4!==o.length)return;this.randomNum=o;var i=new URLSearchParams({deviceInfo:JSON.stringify((0,x.deviceInfo)()),uuid:this.ensureUUID({reset:!0})});if(!(yield this.uploadPublicKey({key:this.ensureUUID({reset:!1}),type:"Client",publicKey:this.keypair.publicKey})))return;var a=`${Q(n,G.Connect)}?${i.toString()}`,c=yield this.client.get(a,{timeout:6e4}).then((function(e){return e.data})).catch((function(e){return{success:!1,data:void 0,message:e.code}})),u=c.success,s=c.data,d=c.message;if(!u||void 0===s)return this.clearMigrateInfo(this.ensureUUID({reset:!1})),d||void 0;var p=s.deviceInfo,l=s.password,f=(0,N.rsaDecrypt)(this.keypair.privateKey,l);if(!1===f)return;if(f!==this.randomNum)return this.disConnectServer(n),void this.clearMigrateInfo(this.ensureUUID({reset:!1}));var y=yield this.getPublicKey({key:this.ensureUUID({reset:!1}),type:"Server"});return void 0===y||0===y.length?(W.default.migrate.error("Get server PublicKey fail"),void this.clearMigrateInfo(this.ensureUUID({reset:!1}))):(this.serverPubKey=H.from(y,"base64").toString("utf-8"),p)}}));return function(t){return e.apply(this,arguments)}}(),n.disConnectServer=function(){var e=(0,I.default)((function*(e){this.clearMigrateInfo();var t=new URLSearchParams({uuid:this.ensureUUID({reset:!1})});this.clientPubKey="";var r=`${Q(e,G.DisConnect)}?${t.toString()}`,n=(yield this.client.get(r).then((function(e){return e.data})).catch((function(){return{success:!1}}))).success;return this.setupKeypair({reset:!0}),n}));return function(t){return e.apply(this,arguments)}}(),n.sendDataToServer=function(){var e=(0,I.default)((function*(e){var t=e.ipAddress,r=e.data,n=new URLSearchParams({uuid:this.ensureUUID({reset:!1})}),o=`${Q(t,G.SendData)}?${n.toString()}`;try{if(0===this.serverPubKey.length)return W.default.migrate.error("sendDataToServer serverKey empty"),!1;var i=yield this.encryptDataWithPublicKey(this.serverPubKey,r);return!1!==i&&(yield this.client.post(o,i,{headers:{"Content-Type":"text/plain"}}).then((function(e){return e.data})).catch((function(e){return W.default.migrate.error("sendDataToServer :",e),{success:!1}}))).success}catch(a){return W.default.migrate.error("sendDataToServer encrypt:",a),!1}}));return function(t){return e.apply(this,arguments)}}(),n.getDataFromServer=function(){var e=(0,I.default)((function*(e){var t=e.ipAddress,r=new URLSearchParams({deviceInfo:JSON.stringify((0,x.deviceInfo)()),uuid:this.ensureUUID({reset:!1})}),n=`${Q(t,G.RequestData)}?${r.toString()}`;if(void 0!==this.keypair){var o=yield this.client.get(n).then((function(e){return e.data})).catch((function(){return{success:!1,data:void 0,code:E.MigrateErrorCode.ConnectFail}})),i=o.success,a=o.data,c=o.code;if(i&&a&&a.length>0){var u=this.decryptDataWithPrivateKey(this.keypair.privateKey,a);if("string"===typeof u)try{return(0,x.parseCloudData)(JSON.parse(u))}catch(s){W.default.migrate.error("parse decryptData error")}}return c}W.default.migrate.error("keypair lose")}));return function(t){return e.apply(this,arguments)}}(),n.isConnectedUUID=function(e){return this.connectUUID.length>0&&e===this.connectUUID},n.registerHttpEvents=function(){B.appEventBus.on(B.AppEventBusNames.HttpServerRequest,this.receivedHttpRequest)},n.unRegisterHttpEvents=function(){this.connectUUID="",B.appEventBus.removeListener(B.AppEventBusNames.HttpServerRequest,this.receivedHttpRequest)},(0,P.default)(r,[{key:"baseUrl",get:function(){return`${(0,R.getFiatEndpoint)()}/migrate`}}]),r}(L.default),(0,M.default)(b.prototype,"setupKeypair",[o],Object.getOwnPropertyDescriptor(b.prototype,"setupKeypair"),b.prototype),(0,M.default)(b.prototype,"encryptDataWithPublicKey",[i],Object.getOwnPropertyDescriptor(b.prototype,"encryptDataWithPublicKey"),b.prototype),(0,M.default)(b.prototype,"publicKey",[a],Object.getOwnPropertyDescriptor(b.prototype,"publicKey"),b.prototype),(0,M.default)(b.prototype,"generateRandomNum",[c],Object.getOwnPropertyDescriptor(b.prototype,"generateRandomNum"),b.prototype),(0,M.default)(b.prototype,"clearMigrateInfo",[u],Object.getOwnPropertyDescriptor(b.prototype,"clearMigrateInfo"),b.prototype),(0,M.default)(b.prototype,"getPublicKey",[s],Object.getOwnPropertyDescriptor(b.prototype,"getPublicKey"),b.prototype),(0,M.default)(b.prototype,"uploadPublicKey",[d],Object.getOwnPropertyDescriptor(b.prototype,"uploadPublicKey"),b.prototype),(0,M.default)(b.prototype,"deletePublicKey",[p],Object.getOwnPropertyDescriptor(b.prototype,"deletePublicKey"),b.prototype),(0,M.default)(b.prototype,"connectServer",[l],Object.getOwnPropertyDescriptor(b.prototype,"connectServer"),b.prototype),(0,M.default)(b.prototype,"disConnectServer",[f],Object.getOwnPropertyDescriptor(b.prototype,"disConnectServer"),b.prototype),(0,M.default)(b.prototype,"sendDataToServer",[y],Object.getOwnPropertyDescriptor(b.prototype,"sendDataToServer"),b.prototype),(0,M.default)(b.prototype,"getDataFromServer",[h],Object.getOwnPropertyDescriptor(b.prototype,"getDataFromServer"),b.prototype),(0,M.default)(b.prototype,"isConnectedUUID",[v],Object.getOwnPropertyDescriptor(b.prototype,"isConnectedUUID"),b.prototype),(0,M.default)(b.prototype,"registerHttpEvents",[g],Object.getOwnPropertyDescriptor(b.prototype,"registerHttpEvents"),b.prototype),(0,M.default)(b.prototype,"unRegisterHttpEvents",[k],Object.getOwnPropertyDescriptor(b.prototype,"unRegisterHttpEvents"),b.prototype),w=b))||w)},538975:(e,t,r)=>{r.r(t),r.d(t,{default:()=>V});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m=r(256666),A=r(196234),O=r(703440),I=r.n(O),P=r(634795),T=r(887371),S=r(545754),D=r(411987),M=r(695058),C=r(859375),N=r(992431),R=r(112889),j=r(940915),E=r(790656),x=r(918260),_=r(490415),B=r(438760),F=r(942013),W=r(201882);function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function U(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){(0,m.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function H(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,M.default)(e);if(t){var o=(0,M.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,D.default)(this,r)}}const V=(n=(0,B.backgroundClass)(),o=(0,B.backgroundMethod)(),i=(0,B.backgroundMethod)(),a=(0,B.backgroundMethod)(),c=(0,B.backgroundMethod)(),u=(0,B.backgroundMethod)(),s=(0,B.backgroundMethod)(),d=(0,B.backgroundMethod)(),p=(0,B.backgroundMethod)(),l=(0,B.backgroundMethod)(),f=(0,B.backgroundMethod)(),y=(0,B.backgroundMethod)(),h=(0,B.backgroundMethod)(),v=(0,B.backgroundMethod)(),g=(0,B.backgroundMethod)(),k=(0,B.backgroundMethod)(),n((b=function(e){(0,S.default)(r,e);var t=H(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.fetchAsset=function(){var e=(0,P.default)((function*(e){return E.fetchAsset(e)}));return function(t){return e.apply(this,arguments)}}(),n.getCollection=function(){var e=(0,P.default)((function*(e){var t=e.chain,r=e.contractAddress,n=e.showStatistics,o=void 0!==n&&n,i=new URLSearchParams({chain:t,contractAddress:r});o&&i.append("showStatistics","true");var a=`${this.baseUrl}/collection?${i.toString()}`,c=yield this.client.get(a).then((function(e){return e.data})).catch((function(){return{success:!1,data:{}}})),u=c.data;if(c.success)return u}));return function(t){return e.apply(this,arguments)}}(),n.searchCollections=function(){var e=(0,P.default)((function*(e){var t=e.chain,r=e.name,n=`${this.baseUrl}/collection/search?chain=${t}&name=${r}`,o=yield this.client.get(n).then((function(e){return e.data})).catch((function(){return{success:!1,data:[]}})),i=o.data;if(o.success)return i}));return function(t){return e.apply(this,arguments)}}(),n.getCollectionTransactions=function(){var e=(0,P.default)((function*(e){var t=e.chain,r=e.contractAddress,n=e.cursor,o=e.limit,i=void 0===o?50:o,a=e.eventTypes,c=e.showAsset,u=`${this.baseUrl}/collection/transactions?chain=${t}&contractAddress=${r}&limit=${i}`;a&&(u+=`&event_type=${a}`),!0===c&&(u+="&show_asset=true"),n&&(u+=`&cursor=${n}`);var s=yield this.client.get(u).then((function(e){return e.data})).catch((function(){return{success:!1,data:{total:0,next:void 0,content:[]}}})),d=s.data;if(s.success)return d}));return function(t){return e.apply(this,arguments)}}(),n.getMarketRanking=function(){var e=(0,P.default)((function*(e){var t=e.chain,r=e.time,n=`${this.baseUrl}/market/ranking?chain=${null!=t?t:F.OnekeyNetwork.eth}&time=${null!=r?r:"1d"}`,o=yield this.client.get(n).then((function(e){return e.data})).catch((function(){return{success:!1,data:[]}})),i=o.data;return o.success?i:[]}));return function(t){return e.apply(this,arguments)}}(),n.batchAsset=function(){var e=(0,P.default)((function*(e){return E.batchAsset(e)}));return function(t){return e.apply(this,arguments)}}(),n.getPNLData=function(){var e=(0,P.default)((function*(e){var t=e.address,r=e.ignoreError,n=void 0===r||r,o=`${this.baseUrl}/account/pnl?&address=${t}`,i=yield this.client.get(o).then((function(e){return e.data})).catch((function(){return{success:!1,data:[]}})),a=i.data;if(!i.success){if(n)return[];throw new j.OneKeyInternalError("data load error")}return a}));return function(t){return e.apply(this,arguments)}}(),n.getMarketPlaces=function(){var e=(0,P.default)((function*(e){var t=e.chain,r=`${this.baseUrl}/marketPlace/list`;t&&(r+=`?chain=${t}`);var n=yield this.client.get(r).then((function(e){return e.data})).catch((function(){return{success:!1,data:[]}})),o=n.data;return n.success?o:[]}));return function(t){return e.apply(this,arguments)}}(),n.fetchNFT=function(){var e=(0,P.default)((function*(e){var t=e.accountId,r=e.networkId,n=this.backgroundApi.serviceOverview;yield n.fetchAccountOverview({accountId:t,networkId:r,scanTypes:[_.EOverviewScanTaskType.nfts]})}));return function(t){return e.apply(this,arguments)}}(),n.getAsset=function(){var e=(0,P.default)((function*(e){return E.getAsset(e)}));return function(t){return e.apply(this,arguments)}}(),n.getAssetFromLocal=function(){var e=(0,P.default)((function*(e){return E.getAssetFromLocal(e)}));return function(t){return e.apply(this,arguments)}}(),n.getAllAssetsFromLocal=function(){var e=(0,P.default)((function*(e){return E.getAllAssetsFromLocal(e)}));return function(t){return e.apply(this,arguments)}}(),n.updatePriceType=function(e){(0,this.backgroundApi.dispatch)((0,x.setNFTPriceType)(e))},n.getNftListWithAssetType=function(){var e=(0,P.default)((function*(e){var t,r=e.networkId,n=e.accountId;if(!r||!n)return[];var o=yield N.default.accountPortfolios.getPortfolio({networkId:r,accountId:n}),i=null!=(t=null==o?void 0:o[_.EOverviewScanTaskType.nfts])?t:[],a=this.backgroundApi.engine,c=yield Promise.all(Object.entries(I()(i,"networkId")).map(function(){var e=(0,P.default)((function*(e){var t=(0,A.default)(e,2),r=t[0],n=t[1];return(yield a.getChainOnlyVault(r)).getUserNFTAssets({serviceData:n})}));return function(t){return e.apply(this,arguments)}}()));return c.filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),n.updateAsset=function(){var e=(0,P.default)((function*(e){var t=e.accountId,r=e.networkId,n=e.asset;if(t){var o=yield N.default.accountPortfolios.getData(),i=`${r}___${t}`,a=o.portfolios[i],c=(null==a?void 0:a[_.EOverviewScanTaskType.nfts])||[];if("btc"===(0,E.NFTDataType)(r)){var u,s,d,p,l=c.findIndex((function(e){return e.inscription_id===n.inscription_id}));if(-1!==l)c[l]=n,N.default.accountPortfolios.setRawData(U(U({},o),{},{portfolios:U(U({},null!=(u=o.portfolios)?u:{}),{},(p={},p[i]=U(U({},null==(s=o.portfolios)?void 0:s[i]),{},(d={},d[_.EOverviewScanTaskType.nfts]=c,d)),p))}))}}}));return function(t){return e.apply(this,arguments)}}(),(0,T.default)(r,[{key:"baseUrl",get:function(){return`${(0,R.getFiatEndpoint)()}/NFT`}}]),r}(W.default),(0,C.default)(b.prototype,"fetchAsset",[o],Object.getOwnPropertyDescriptor(b.prototype,"fetchAsset"),b.prototype),(0,C.default)(b.prototype,"getCollection",[i],Object.getOwnPropertyDescriptor(b.prototype,"getCollection"),b.prototype),(0,C.default)(b.prototype,"searchCollections",[a],Object.getOwnPropertyDescriptor(b.prototype,"searchCollections"),b.prototype),(0,C.default)(b.prototype,"getCollectionTransactions",[c],Object.getOwnPropertyDescriptor(b.prototype,"getCollectionTransactions"),b.prototype),(0,C.default)(b.prototype,"getMarketRanking",[u],Object.getOwnPropertyDescriptor(b.prototype,"getMarketRanking"),b.prototype),(0,C.default)(b.prototype,"batchAsset",[s],Object.getOwnPropertyDescriptor(b.prototype,"batchAsset"),b.prototype),(0,C.default)(b.prototype,"getPNLData",[d],Object.getOwnPropertyDescriptor(b.prototype,"getPNLData"),b.prototype),(0,C.default)(b.prototype,"getMarketPlaces",[p],Object.getOwnPropertyDescriptor(b.prototype,"getMarketPlaces"),b.prototype),(0,C.default)(b.prototype,"fetchNFT",[l],Object.getOwnPropertyDescriptor(b.prototype,"fetchNFT"),b.prototype),(0,C.default)(b.prototype,"getAsset",[f],Object.getOwnPropertyDescriptor(b.prototype,"getAsset"),b.prototype),(0,C.default)(b.prototype,"getAssetFromLocal",[y],Object.getOwnPropertyDescriptor(b.prototype,"getAssetFromLocal"),b.prototype),(0,C.default)(b.prototype,"getAllAssetsFromLocal",[h],Object.getOwnPropertyDescriptor(b.prototype,"getAllAssetsFromLocal"),b.prototype),(0,C.default)(b.prototype,"updatePriceType",[v],Object.getOwnPropertyDescriptor(b.prototype,"updatePriceType"),b.prototype),(0,C.default)(b.prototype,"getNftListWithAssetType",[g],Object.getOwnPropertyDescriptor(b.prototype,"getNftListWithAssetType"),b.prototype),(0,C.default)(b.prototype,"updateAsset",[k],Object.getOwnPropertyDescriptor(b.prototype,"updateAsset"),b.prototype),w=b))||w)},25962:(e,t,r)=>{r.r(t),r.d(t,{default:()=>R});var n,o,i,a,c,u=r(968079),s=r(703440),d=r.n(s),p=r(516760),l=r.n(p),f=r(190882),y=r.n(f),h=r(634795),v=r(887371),g=r(545754),k=r(411987),w=r(695058),b=r(859375),m=r(100223),A=r(47704),O=r(789644),I=r.n(O),P=r(291578),T=r(626015),S=r(438760),D=r(942013),M=r(613549),C=r(201882);function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,w.default)(e);if(t){var o=(0,w.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,k.default)(this,r)}}var R=(n=(0,S.backgroundClass)(),o=(0,S.backgroundMethod)(),i=(0,S.backgroundMethod)(),n((c=function(e){(0,g.default)(r,e);var t=N(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).UDSupportKeys=["crypto.ETH.address","crypto.POLY.address","crypto.CRO.address","crypto.CELO.address","crypto.AVAX.address","crypto.OKT.address","crypto.ETC.address","crypto.BNB.VERSION.BEP20.address","crypto.FTM.VERSION.ERC20.address","crypto.FTM.VERSION.OPERA.address","crypto.ADA.address","crypto.ALGO.address","crypto.APT.address","crypto.SUI.address","crypto.BCH.address","crypto.BTC.address","crypto.CFX.address","crypto.DOGE.address","crypto.FIL.address","crypto.LTC.address","crypto.NEAR.address","crypto.SOL.address","crypto.TRX.address","crypto.XRP.address","crypto.ATOM.address","crypto.FET.version.FETCHAI.address"],e.starNameServiceFetchApi="https://mainnet-api.sns.so/domain/getAllRecords/",e}var n=r.prototype;return n.checkIsValidName=function(){var e=(0,h.default)((function*(e,t){var r=this.config.some((function(r){return t?!!(t.startsWith("evm--")?r.supportImplsMap["evm--*"]:r.supportImplsMap[t])&&r.pattern.test(e):!r.networkRequired&&r.pattern.test(e)}));return Promise.resolve(r)}));return function(t,r){return e.apply(this,arguments)}}(),n._resolveName=function(){var e=(0,h.default)((function*(e,t){var r=yield this.checkIsValidName(e,null==t?void 0:t.networkId),n=this.config.find((function(t){return t.pattern.test(e)}));if(!r||!n)return{success:!1,message:"form__address_no_supported_address",shownSymbol:"-"};var o=yield null==n?void 0:n.resolver(e);if(!o)return{success:!1,message:"message__fetching_error",shownSymbol:null==n?void 0:n.shownSymbol};if("string"===typeof o)return{success:!1,message:o,shownSymbol:null==n?void 0:n.shownSymbol};if(!o.length)return{success:!1,message:"form__address_no_supported_address",shownSymbol:null==n?void 0:n.shownSymbol};var i=o.filter((function(e){return"address"===e.type})),a=null!=t&&t.disableBTC?y()(i,(function(e){var t;return"BTC"!==(null==e||null==(t=e.subtype)||null==t.toUpperCase?void 0:t.toUpperCase())})):i,c=null!=t&&t.networkId?y()(a,(function(e){var r,o;return function(e){var t,r;return e?e.startsWith("evm")?null!=(r=n.supportImplsMap["evm--*"])?r:[]:null!=(t=n.supportImplsMap[e])?t:[]:[]}(t.networkId).map((function(e){return e.toUpperCase()})).includes(null!=(r=null==(o=e.subtype)||null==o.toUpperCase?void 0:o.toUpperCase())?r:"")})):a,u=l()(d()(c,"subtype"),(function(e,t){return{title:null==t||null==t.toUpperCase?void 0:t.toUpperCase(),options:l()(e,(function(e){return{value:`${e.key}-${e.value}`,label:(0,T.shortenAddress)(e.value),badge:e.label}}))}}));return c.length?{success:!0,names:u,length:c.length,shownSymbol:null==n?void 0:n.shownSymbol}:{success:!1,message:"form__address_no_supported_address",shownSymbol:null==n?void 0:n.shownSymbol}}));return function(t,r){return e.apply(this,arguments)}}(),n.resolveName=function(){var e=(0,h.default)((function*(e,t){return yield this._resolveName(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.resolveENS=function(){var e=(0,h.default)((function*(e){var t=this.backgroundApi.engine,r=yield t.getChainOnlyVault(D.OnekeyNetwork.eth);try{var n=yield r.getEthersProvider(),o=yield n.getResolver(e);if(!o)return null;var i=yield o.getAddress(Number(M.COINTYPE_BTC)),a=yield o.getAddress(Number(M.COINTYPE_ETH)),c=yield o.getAddress(Number(M.COINTYPE_DOGE));return[{subtype:"btc",value:i,type:"address",key:"address.btc"},{subtype:"eth",value:a,type:"address",key:"address.eth"},{subtype:"ltc",value:yield o.getAddress(Number(M.COINTYPE_LTC)),type:"address",key:"address.ltc"},{subtype:"doge",value:c,type:"address",key:"address.doge"}].filter((function(e){return!!e.value}))}catch(u){return"msg__network_request_failed"}}));return function(t){return e.apply(this,arguments)}}(),n.resolveDotBit=function(){var e=(0,h.default)((function*(e){var t=(0,P.createInstance)();try{return yield t.records(e)}catch(r){return 20007===(null==r?void 0:r.code)?null:"msg__network_request_failed"}}));return function(t){return e.apply(this,arguments)}}(),n.resolveUnstoppableDomains=function(){var e=(0,h.default)((function*(e){var t=new A.Resolution({sourceConfig:{uns:{locations:{Layer1:{url:"https://node.onekey.so/eth",network:"mainnet"},Layer2:{url:"https://node.onekey.so/polygon",network:"polygon-mainnet"}}},zns:{url:"https://api.zilliqa.com",network:"mainnet"}}}),r=[];try{var n=yield t.records(e,this.UDSupportKeys);Object.keys(n).forEach((function(e){var t=n[e];if(null!=t&&t.length){var o={subtype:e.replace("crypto.","").replace(".address",""),value:t,type:"address",key:e};r=[].concat((0,u.default)(r),[o])}}))}catch(o){return"msg__network_request_failed"}return r}));return function(t){return e.apply(this,arguments)}}(),n.resolveSIDDomains=function(){var e=(0,h.default)((function*(e){var t=this.backgroundApi.engine,r=[],n=["eth"];e.endsWith(".bnb")&&(n=[].concat((0,u.default)(n),["bsc"])),e.endsWith(".arb")&&(n=[].concat((0,u.default)(n),["arbitrum"]));try{for(var o of n){var i,a=yield t.getChainOnlyVault(null==(i=Object.getOwnPropertyDescriptor(D.OnekeyNetwork,o))?void 0:i.value),c=yield a.getEthersProvider(),s=yield a.getNetworkChainId(),d=(0,m.getSidAddress)(s),p=new m.default({provider:c,sidAddress:d}).name(e),l=yield p.getAddress();if(l&&"0x0000000000000000000000000000000000000000"!==l){var f={subtype:o,value:l,type:"address",key:`address.${o}`};r=[].concat((0,u.default)(r),[f])}}}catch(y){return"msg__network_request_failed"}return r}));return function(t){return e.apply(this,arguments)}}(),n.resolveFilEvm=function(){var e=(0,h.default)((function*(e){var t=this.backgroundApi.engine,r=yield t.getChainOnlyVault(D.OnekeyNetwork.fil);return[{subtype:"fil",value:yield r.validateAddress(e),type:"address",key:"fileEvmAddress"}]}));return function(t){return e.apply(this,arguments)}}(),n.resolveStarDomains=function(){var e=(0,h.default)((function*(e){try{var t,r,n=(yield I().get(`${this.starNameServiceFetchApi}${e}`)).data;return n&&200===n.code?null==(t=Object.keys(n.data))||null==(r=t.filter((function(e){var t;return null==(t=n.data)?void 0:t[e]})))?void 0:r.map((function(e){return{subtype:e,value:n.data[e],type:"address",key:`address.${e}`}})):[]}catch(o){return"msg__network_request_failed"}}));return function(t){return e.apply(this,arguments)}}(),(0,v.default)(r,[{key:"config",get:function(){var e,t,r,n,o;return[{pattern:/\.eth$/,shownSymbol:"ENS",supportImplsMap:(e={"evm--*":["eth"]},e[D.OnekeyNetwork.btc]=["btc"],e[D.OnekeyNetwork.ltc]=["ltc"],e[D.OnekeyNetwork.doge]=["doge"],e),resolver:this.resolveENS.bind(this)},{pattern:/\.bit$/,shownSymbol:".bit",supportImplsMap:(t={"evm--*":["eth","bsc","etc","polygon","celo"]},t[D.OnekeyNetwork.btc]=["btc"],t[D.OnekeyNetwork.near]=["near"],t[D.OnekeyNetwork.sol]=["sol"],t[D.OnekeyNetwork.trx]=["trx"],t[D.OnekeyNetwork.ltc]=["ltc"],t[D.OnekeyNetwork.doge]=["doge"],t),resolver:this.resolveDotBit.bind(this)},{pattern:/(\.crypto|\.bitcoin|\.blockchain|\.dao|\.nft|\.888|\.wallet|\.x|\.klever|\.zil|\.hi)$/,shownSymbol:"UD",supportImplsMap:(r={"evm--*":["ETH","POLY","CRO","CELO","AVAX","OKT","ETC","BNB.VERSION.BEP20","FTM.VERSION.ERC20","FTM.VERSION.OPERA"]},r[D.OnekeyNetwork.ada]=["ADA"],r[D.OnekeyNetwork.algo]=["ALGO"],r[D.OnekeyNetwork.apt]=["APT"],r[D.OnekeyNetwork.sui]=["SUI"],r[D.OnekeyNetwork.bch]=["BCH"],r[D.OnekeyNetwork.btc]=["BTC"],r[D.OnekeyNetwork.cfx]=["CFX"],r[D.OnekeyNetwork.doge]=["DOGE"],r[D.OnekeyNetwork.fil]=["FIL"],r[D.OnekeyNetwork.ltc]=["LTC"],r[D.OnekeyNetwork.near]=["NEAR"],r[D.OnekeyNetwork.sol]=["SOL"],r[D.OnekeyNetwork.trx]=["TRX"],r[D.OnekeyNetwork.xrp]=["XRP"],r[D.OnekeyNetwork.cosmoshub]=["ATOM"],r[D.OnekeyNetwork.fetch]=["FET.version.FETCHAI"],r),resolver:this.resolveUnstoppableDomains.bind(this)},{pattern:/(\.bnb|\.arb)$/,shownSymbol:"SID",supportImplsMap:{"evm--*":["eth","bsc","arbitrum"]},resolver:this.resolveSIDDomains.bind(this)},{pattern:/^0x[a-fA-F0-9]{40}$/,shownSymbol:"FIL",supportImplsMap:(n={},n[D.OnekeyNetwork.fil]=["fil"],n),resolver:this.resolveFilEvm.bind(this),networkRequired:!0},{pattern:/(\.zk|\.base|\.linea)$/,shownSymbol:"STAR",supportImplsMap:(o={"evm--*":["eth"]},o[D.OnekeyNetwork.apt]=["APT"],o[D.OnekeyNetwork.ltc]=["LTC"],o[D.OnekeyNetwork.sui]=["SUI"],o[D.OnekeyNetwork.btc]=["BTC"],o[D.OnekeyNetwork.doge]=["DOGE"],o),resolver:this.resolveStarDomains.bind(this)}]}}]),r}(C.default),(0,b.default)(c.prototype,"checkIsValidName",[o],Object.getOwnPropertyDescriptor(c.prototype,"checkIsValidName"),c.prototype),(0,b.default)(c.prototype,"resolveName",[i],Object.getOwnPropertyDescriptor(c.prototype,"resolveName"),c.prototype),a=c))||a)},707040:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ie});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A,O,I,P,T,S,D,M,C,N=r(196234),R=r(634795),j=r(254073),E=r.n(j),x=r(887371),_=r(545754),B=r(411987),F=r(695058),W=r(859375),L=r(992431),U=r(849877),H=r(182564),V=r(62893),q=r(379573),K=r(932330),$=r(821919),G=r(830631),z=r(776553),J=r(438760),Q=r(613549),X=r(35116),Y=r(292147),Z=r(563089),ee=r(330526),te=r(201882);function re(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,F.default)(e);if(t){var o=(0,F.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,B.default)(this,r)}}var ne=q.default.actions;Z.default.configure({reachabilityShouldRun:function(){return!1}});var oe=new Map;const ie=(n=(0,J.backgroundClass)(),o=(0,J.bindThis)(),i=(0,J.backgroundMethod)(),a=(0,J.backgroundMethod)(),c=(0,J.backgroundMethod)(),u=(0,J.backgroundMethod)(),s=(0,J.backgroundMethod)(),d=(0,J.backgroundMethod)(),p=(0,J.backgroundMethod)(),l=(0,J.backgroundMethod)(),f=(0,J.backgroundMethod)(),y=(0,J.backgroundMethod)(),h=(0,J.backgroundMethod)(),v=(0,J.backgroundMethod)(),g=(0,J.backgroundMethod)(),k=(0,J.backgroundMethod)(),w=(0,J.backgroundMethod)(),b=(0,J.backgroundMethod)(),m=(0,J.backgroundMethod)(),A=(0,J.backgroundMethod)(),O=(0,J.bindThis)(),I=(0,J.backgroundMethod)(),P=(0,J.backgroundMethod)(),T=(0,J.backgroundMethod)(),S=(0,J.backgroundMethod)(),D=(0,J.backgroundMethod)(),n((C=function(e){(0,_.default)(r,e);var t=re(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).rpcMeasureInterval=null,e.measureRpcStatus=E()(e._measureRpcStatus,(0,z.getTimeDurationMs)({seconds:5}),{leading:!0,trailing:!0}),e}var n=r.prototype;return n.registerEvents=function(){var e=this;X.appEventBus.on(X.AppEventBusNames.NetworkChanged,this.measureRpcStatus),this.rpcMeasureInterval=setInterval(this.measureRpcStatus,(0,z.getTimeDurationMs)({minute:1})),Z.default.addEventListener((function(){e.measureRpcStatus()})),this.measureRpcStatus()},n.changeActiveNetwork=function(){var e=(0,R.default)((function*(e){var t=this.backgroundApi,r=t.appSelector,n=t.serviceAccount,o=t.engine,i=r((function(e){return e.general})),a=i.activeWalletId,c=i.activeNetworkId,u=i.activeAccountId,s=r((function(e){return e.runtime.networks})),d=s.find((function(e){return e.id===c})),p=s.find((function(t){return t.id===e}));!p||null!=p&&p.enabled||(yield this.updateNetworks(s.map((function(e){return[e.id,e.id===p.id||e.enabled]}))),p.enabled=!0),this.backgroundApi.engine.notifyChainChanged(e,null!=c?c:"");var l=[(0,V.changeActiveNetwork)(e),ne.updateSelectedNetworkId(e)],f=!0;this.notifyChainChanged();var y,h=(null==d?void 0:d.impl)!==(null==p?void 0:p.impl),v=(null==d?void 0:d.symbol)!==(null==p?void 0:p.symbol)&&n.shouldForceRefreshAccount(null==p?void 0:p.id),g=yield n.shouldChangeAccountWhenNetworkChanged({previousNetwork:d,newNetwork:p,activeAccountId:u}),k=g.shouldChangeActiveAccount,w=g.shouldReloadAccountList;if(h||v||k){var b,m,A=yield n.reloadAccountsByWalletIdNetworkId(a,e),O=null!=(b=null==A?void 0:A[0])?b:null;yield n.changeActiveAccount({accountId:null!=(m=null==O?void 0:O.id)?m:null,walletId:a,extraActions:[].concat(l),shouldReloadAccountsWhenWalletChanged:!1}),f=!1}(w&&(yield n.reloadAccountsByWalletIdNetworkId(a,e)),f)&&(y=this.backgroundApi).dispatch.apply(y,l);return yield o.updateOnlineTokens(e,!1),p}));return function(t){return e.apply(this,arguments)}}(),n.notifyChainChanged=function(){var e=(0,R.default)((function*(){var e=this;yield(0,z.wait)(600),Object.values(this.backgroundApi.providers).forEach((function(t){t.notifyDappChainChanged({send:e.backgroundApi.sendForProvider(t.providerName)})})),yield this.backgroundApi.walletConnect.notifySessionChanged(),yield(0,z.wait)(100),X.appEventBus.emit(X.AppEventBusNames.NetworkChanged)}));return function(){return e.apply(this,arguments)}}(),n.updateNetworks=function(){var e=(0,R.default)((function*(e){var t=this.backgroundApi,r=t.engine,n=t.dispatch,o=yield r.updateNetworkList(e);this.notifyChainChanged(),n((0,K.updateNetworks)(o))}));return function(t){return e.apply(this,arguments)}}(),n.initNetworks=function(){var e=(0,R.default)((function*(){var e=this.backgroundApi.engine;return yield(0,H.initNetworkList)(),yield this.syncPresetNetworks(),yield this.fetchNetworks(),e.listNetworks(!0)}));return function(){return e.apply(this,arguments)}}(),n.fetchNetworks=function(){var e=(0,R.default)((function*(){var e=this.backgroundApi,t=e.engine,r=e.dispatch,n=yield t.listNetworks(!1);return r((0,K.updateNetworks)(n)),n}));return function(){return e.apply(this,arguments)}}(),n.getPresetRpcEndpoints=function(){var e=(0,R.default)((function*(e){return this.backgroundApi.engine.getRPCEndpoints(e)}));return function(t){return e.apply(this,arguments)}}(),n.updateNetwork=function(){var e=(0,R.default)((function*(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.backgroundApi,o=n.engine,i=n.appSelector,a=n.dispatch,c=yield o.updateNetwork(e,t);if(t.rpcURL){var u=i((function(e){return e.status})).userSwitchedNetworkRpcFlag;!r||null!=u&&u[e]||(a((0,G.updateUserSwitchNetworkFlag)({networkId:e,flag:!0})),yield(0,z.wait)(600))}return this.fetchNetworks(),c}));return function(t,r){return e.apply(this,arguments)}}(),n.addNetwork=function(){var e=(0,R.default)((function*(e,t){var r=this.backgroundApi,n=r.engine,o=r.dispatch,i=yield n.addNetwork(e,t);return o((0,$.updateCustomNetworkRpc)({networkId:i.id,type:"add",rpc:t.rpcURL})),this.fetchNetworks(),i}));return function(t,r){return e.apply(this,arguments)}}(),n.deleteNetwork=function(){var e=(0,R.default)((function*(e){var t=this.backgroundApi,r=t.engine,n=t.dispatch;yield r.deleteNetwork(e),n((0,$.clearNetworkCustomRpcs)({networkId:e})),this.fetchNetworks()}));return function(t){return e.apply(this,arguments)}}(),n.rpcCall=function(){var e=(0,R.default)((function*(e,t){return this.backgroundApi.engine.proxyJsonRPCCall(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.preAddNetwork=function(){var e=(0,R.default)((function*(e){return this.backgroundApi.engine.preAddNetwork(e)}));return function(t){return e.apply(this,arguments)}}(),n.getRPCEndpointStatus=function(){var e=(0,R.default)((function*(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.backgroundApi.engine.getRPCEndpointStatus(e,t,r)}));return function(t,r){return e.apply(this,arguments)}}(),n.initCheckingNetwork=function(e){var t,r,n=(0,this.backgroundApi.appSelector)((function(e){return e.general.activeNetworkId})),o=e.some((function(e){return e.id===n}));return n&&o?n:null!=(t=null==(r=e[0])?void 0:r.id)?t:null},n.getCustomRpcUrls=function(e){var t=this.backgroundApi.appSelector;return Promise.resolve(t((function(t){var r;return(null==(r=t.settings.customNetworkRpcMap)?void 0:r[e])||[]})))},n.fetchChainList=function(e){return(0,U.fetchChainList)(e)},n.getNetworkCustomFee=function(){var e=(0,R.default)((function*(e){var t,r,n,o=yield this.backgroundApi.engine.dbApi.getCustomFee(e);if(o)return{price:o.price,eip1559:o.eip1559,price1559:{baseFee:null==(t=o.price1559)?void 0:t.baseFee,maxFeePerGas:null==(r=o.price1559)?void 0:r.maxFeePerGas,maxPriorityFeePerGas:null==(n=o.price1559)?void 0:n.maxPriorityFeePerGas},isBtcForkChain:o.isBtcForkChain,feeRate:o.feeRate,btcFee:o.btcFee}}));return function(t){return e.apply(this,arguments)}}(),n.updateNetworkCustomFee=function(){var e=(0,R.default)((function*(e,t){this.backgroundApi.engine.dbApi.updateCustomFee(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.getNetworkWithRuntime=function(){var e=(0,R.default)((function*(e){var t=(0,this.backgroundApi.appSelector)((function(t){return t.runtime.networks.find((function(t){return t.id===e}))}));return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n._measureRpcStatus=function(){var e=(0,R.default)((function*(e){var t=e,r=this.backgroundApi,n=r.appSelector,o=r.engine,i=r.dispatch,a=r.serviceApp;if(a.isAppInited||(yield a.waitForAppInited({logName:"measureRpcStatus"})),t||(t=n((function(e){return e.general.activeNetworkId}))),t&&!(0,U.isAllNetworks)(t)){var c={responseTime:void 0,latestBlock:void 0},u=(yield o.getNetwork(t)).rpcURL;try{if(t.startsWith(Q.IMPL_EVM)){var s=yield o.getChainOnlyVault(t);c=yield s.checkRpcBatchSupport(u)}else c=yield this.getRPCEndpointStatus(u,t,!1);if(t.startsWith(Q.IMPL_EVM)){var d=(yield L.default.setting.getRpcBatchFallbackWhitelistHosts()).find((function(e){return u.includes(e.url)})),p=!!d,l=oe.get(u);!1!==c.rpcBatchSupported||p||(!l||Date.now()-l>(0,z.getTimeDurationMs)({day:1}))&&(Y.default.http.info("add rpc to whitelistHosts",u,l),yield L.default.setting.addRpcBatchFallbackWhitelistHosts(u)),!1!==c.rpcBatchSupported&&oe.set(u,Date.now()),!1!==c.rpcBatchSupported&&p&&"custom"===d.type&&(Y.default.http.info("remove rpc from whitelistHosts",u,l),yield L.default.setting.removeRpcBatchFallbackWhitelistHosts(u))}}catch(f){Y.default.http.error("measureRpcStatus ERROR",f)}return i((0,G.setRpcStatus)({networkId:t,status:c})),c}}));return function(t){return e.apply(this,arguments)}}(),n.migrateServerNetworks=function(){var e=(0,R.default)((function*(e){null!=e&&e.length&&(yield L.default.serverNetworks.updateNetworks(e),yield this.initNetworks())}));return function(t){return e.apply(this,arguments)}}(),n.checkDisabledPresetNetworks=function(){var e=(0,R.default)((function*(){var e=this.backgroundApi,t=e.engine,r=e.appSelector,n=yield t.dbApi.listNetworks(),o=Object.values((0,H.getPresetNetworks)()),i=n.filter((function(e){var t=e.id,r=o.find((function(e){return e.id===t}));return!!r&&r.status===ee.ENetworkStatus.TRASH})),a=r((function(e){return e.general.activeNetworkId})),c=n.find((function(e){return!i.find((function(t){return t.id===e.id}))}));for(var u of i)Y.default.engine.warn(`[checkDisabledPresetNetworks] remove network: ${u.id}`),a===u.id&&c&&(Y.default.engine.warn(`[checkDisabledPresetNetworks] switch network: ${u.id}`),yield this.changeActiveNetwork(c.id)),yield t.dbApi.deleteNetwork(u.id)}));return function(){return e.apply(this,arguments)}}(),n.syncPresetNetworks=function(){var e=(0,R.default)((function*(){var e=this.backgroundApi.engine;yield this.checkDisabledPresetNetworks();try{var t=[],r=yield e.dbApi.listNetworks(),n=Object.fromEntries(r.map((function(e){return[e.id,e.enabled]}))),o=Object.values((0,H.getPresetNetworks)()).filter((function(e){return e.status!==ee.ENetworkStatus.TRASH})).sort((function(e,t){var r=(e.extensions||{}).position||Number.MAX_SAFE_INTEGER,n=(t.extensions||{}).position||Number.MAX_SAFE_INTEGER;return r>n?1:r<n?-1:e.name>t.name?1:-1}));for(var i of o)if((0,Q.getSupportedImpls)().has(i.impl)||(0,Q.getSupportedFakeNetworks)().has(i.impl)){var a=n[i.id];"undefined"!==typeof a?t.push([i.id,a]):(yield e.dbApi.addNetwork({id:i.id,name:i.name,impl:i.impl,symbol:i.symbol,logoURI:i.logoURI,enabled:i.enabled,feeSymbol:i.feeSymbol,decimals:i.decimals,feeDecimals:i.feeDecimals,balance2FeeDecimals:i.balance2FeeDecimals,rpcURL:i.presetRpcURLs[0],position:0}),n[i.id]=i.enabled,t.push([i.id,i.enabled]))}var c=yield e.dbApi.getContext();if("undefined"!==typeof c&&!0===(null==c?void 0:c.networkOrderChanged))return;var u=new Set(t.map((function(e){return(0,N.default)(e,1)[0]})));r.forEach((function(e){u.has(e.id)||t.push([e.id,e.enabled])})),yield e.dbApi.updateNetworkList(t,!0)}catch(s){console.error(s)}}));return function(){return e.apply(this,arguments)}}(),n.getPresetNetworks=function(){var e=(0,R.default)((function*(){return(0,H.getPresetNetworks)()}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=(0,R.default)((function*(e){var t=e.url,r=e.networkId,n=this.backgroundApi.engine;return(yield n.getChainOnlyVault(r)).fetchRpcChainId(t)}));return function(t){return e.apply(this,arguments)}}(),n.networkIsPreset=function(){var e=(0,R.default)((function*(e){return(0,H.networkIsPreset)(e)}));return function(t){return e.apply(this,arguments)}}(),(0,x.default)(r)}(te.default),(0,W.default)(C.prototype,"registerEvents",[o],Object.getOwnPropertyDescriptor(C.prototype,"registerEvents"),C.prototype),(0,W.default)(C.prototype,"changeActiveNetwork",[i],Object.getOwnPropertyDescriptor(C.prototype,"changeActiveNetwork"),C.prototype),(0,W.default)(C.prototype,"notifyChainChanged",[a],Object.getOwnPropertyDescriptor(C.prototype,"notifyChainChanged"),C.prototype),(0,W.default)(C.prototype,"updateNetworks",[c],Object.getOwnPropertyDescriptor(C.prototype,"updateNetworks"),C.prototype),(0,W.default)(C.prototype,"initNetworks",[u],Object.getOwnPropertyDescriptor(C.prototype,"initNetworks"),C.prototype),(0,W.default)(C.prototype,"fetchNetworks",[s],Object.getOwnPropertyDescriptor(C.prototype,"fetchNetworks"),C.prototype),(0,W.default)(C.prototype,"getPresetRpcEndpoints",[d],Object.getOwnPropertyDescriptor(C.prototype,"getPresetRpcEndpoints"),C.prototype),(0,W.default)(C.prototype,"updateNetwork",[p],Object.getOwnPropertyDescriptor(C.prototype,"updateNetwork"),C.prototype),(0,W.default)(C.prototype,"addNetwork",[l],Object.getOwnPropertyDescriptor(C.prototype,"addNetwork"),C.prototype),(0,W.default)(C.prototype,"deleteNetwork",[f],Object.getOwnPropertyDescriptor(C.prototype,"deleteNetwork"),C.prototype),(0,W.default)(C.prototype,"rpcCall",[y],Object.getOwnPropertyDescriptor(C.prototype,"rpcCall"),C.prototype),(0,W.default)(C.prototype,"preAddNetwork",[h],Object.getOwnPropertyDescriptor(C.prototype,"preAddNetwork"),C.prototype),(0,W.default)(C.prototype,"getRPCEndpointStatus",[v],Object.getOwnPropertyDescriptor(C.prototype,"getRPCEndpointStatus"),C.prototype),(0,W.default)(C.prototype,"initCheckingNetwork",[g],Object.getOwnPropertyDescriptor(C.prototype,"initCheckingNetwork"),C.prototype),(0,W.default)(C.prototype,"getCustomRpcUrls",[k],Object.getOwnPropertyDescriptor(C.prototype,"getCustomRpcUrls"),C.prototype),(0,W.default)(C.prototype,"fetchChainList",[w],Object.getOwnPropertyDescriptor(C.prototype,"fetchChainList"),C.prototype),(0,W.default)(C.prototype,"getNetworkCustomFee",[b],Object.getOwnPropertyDescriptor(C.prototype,"getNetworkCustomFee"),C.prototype),(0,W.default)(C.prototype,"updateNetworkCustomFee",[m],Object.getOwnPropertyDescriptor(C.prototype,"updateNetworkCustomFee"),C.prototype),(0,W.default)(C.prototype,"getNetworkWithRuntime",[A],Object.getOwnPropertyDescriptor(C.prototype,"getNetworkWithRuntime"),C.prototype),(0,W.default)(C.prototype,"_measureRpcStatus",[O,I],Object.getOwnPropertyDescriptor(C.prototype,"_measureRpcStatus"),C.prototype),(0,W.default)(C.prototype,"migrateServerNetworks",[P],Object.getOwnPropertyDescriptor(C.prototype,"migrateServerNetworks"),C.prototype),(0,W.default)(C.prototype,"getPresetNetworks",[T],Object.getOwnPropertyDescriptor(C.prototype,"getPresetNetworks"),C.prototype),(0,W.default)(C.prototype,"fetchRpcChainId",[S],Object.getOwnPropertyDescriptor(C.prototype,"fetchRpcChainId"),C.prototype),(0,W.default)(C.prototype,"networkIsPreset",[D],Object.getOwnPropertyDescriptor(C.prototype,"networkIsPreset"),C.prototype),M=C))||M)},773989:(e,t,r)=>{r.r(t),r.d(t,{default:()=>W});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w=r(196234),b=r(634795),m=r(887371),A=r(545754),O=r(411987),I=r(695058),P=r(859375),T=r(789644),S=r.n(T),D=r(212830),M=r.n(D),C=r(112889),N=r(121801),R=r(776553),j=r(438760),E=r(942013),x=r(814817),_=r(292147),B=r(201882);function F(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,I.default)(e);if(t){var o=(0,I.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,O.default)(this,r)}}var W=(n=(0,j.backgroundClass)(),o=(0,j.backgroundMethod)(),i=(0,j.backgroundMethod)(),a=(0,j.backgroundMethod)(),c=(0,j.backgroundMethod)(),u=(0,j.backgroundMethod)(),s=(0,j.backgroundMethod)(),d=(0,j.backgroundMethod)(),p=(0,j.backgroundMethod)(),l=(0,j.backgroundMethod)(),f=(0,j.backgroundMethod)(),y=(0,j.backgroundMethod)(),h=(0,j.backgroundMethod)(),v=(0,j.backgroundMethod)(),n((k=function(e){(0,A.default)(r,e);var t=F(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).expiryMap=new(M())((0,R.getTimeDurationMs)({minute:5})),e.cacheAutoSignMap=new Map,e}var n=r.prototype;return n.getCurrentAccountIndex=function(){var e=(0,b.default)((function*(e,t){var r,n=yield this.backgroundApi.engine.getAccount(e,t);if(!n)throw new Error("Invalid account");var o=this.backgroundApi.serviceAllNetwork.getAccountIndex(n,null!=(r=null==n?void 0:n.template)?r:"");if(o<0||Number.isNaN(o))throw new Error("Invalid account index");return o}));return function(t,r){return e.apply(this,arguments)}}(),n.getNostrAccount=function(){var e=(0,b.default)((function*(e){var t=e.walletId,r=e.currentAccountId,n=e.currentNetworkId,o=yield this.getCurrentAccountIndex(r,n),i=E.OnekeyNetwork.nostr,a=`${t}--${`${(0,N.getNostrPath)(o)}/${N.NOSTR_ADDRESS_INDEX}`}`;try{return yield this.backgroundApi.engine.getAccount(a,i)}catch(c){throw _.default.backgroundApi.error("Nostr: get nostr account failed: ",a),c}}));return function(t){return e.apply(this,arguments)}}(),n.getOrCreateNostrAccount=function(){var e=(0,b.default)((function*(e){var t=e.walletId,r=e.currentAccountId,n=e.currentNetworkId,o=e.password,i=yield this.getCurrentAccountIndex(r,n),a=E.OnekeyNetwork.nostr;try{var c=`${t}--${`${(0,N.getNostrPath)(i)}/${N.NOSTR_ADDRESS_INDEX}`}`;return yield this.backgroundApi.engine.getAccount(c,a)}catch(s){try{var u=yield this.backgroundApi.engine.addHdOrHwAccounts({password:o,walletId:t,networkId:a,indexes:[i]});return(0,w.default)(u,1)[0]}catch(d){throw console.error(d),d}}}));return function(t){return e.apply(this,arguments)}}(),n.getPublicKeyHex=function(){var e=(0,b.default)((function*(e){var t=e.walletId,r=e.networkId,n=e.accountId,o=e.password,i=yield this.getOrCreateNostrAccount({walletId:t,currentAccountId:n,currentNetworkId:r,password:o});if(!i.pubKey)throw new Error("Nostr: public key not found");return i.pubKey}));return function(t){return e.apply(this,arguments)}}(),n.getPublicKeyEncodedByNip19=function(){var e=(0,b.default)((function*(e){var t=e.walletId,r=e.networkId,n=e.accountId,o=e.password;return(yield this.getOrCreateNostrAccount({walletId:t,currentAccountId:n,currentNetworkId:r,password:o})).address}));return function(t){return e.apply(this,arguments)}}(),n.signEvent=function(){var e=(0,b.default)((function*(e){var t=e.walletId,r=e.networkId,n=e.accountId,o=e.password,i=e.event,a=e.options;try{if(!(0,N.validateEvent)(i))throw new Error("Invalid event");null!=a&&a.host&&this.cacheAutoSignMap.set(`${n}-${a.host}`,!(null==a||!a.autoSign));var c=yield this.getOrCreateNostrAccount({walletId:t,currentAccountId:n,currentNetworkId:r,password:o});i.pubkey||(i.pubkey=c.pubKey),i.id||(i.id=(0,N.getEventHash)(i));var u=yield this.backgroundApi.engine.getVault({networkId:E.OnekeyNetwork.nostr,accountId:c.id}),s=yield u.keyring.signTransaction({encodedTx:{event:i},inputs:[],outputs:[],payload:{}},{password:o});return{data:JSON.parse(s.rawTx)}}catch(d){console.error(d)}}));return function(t){return e.apply(this,arguments)}}(),n.getAutoSignStatus=function(){var e=(0,b.default)((function*(e,t){var r=`${e}-${t}`;return this.cacheAutoSignMap.has(r)?Promise.resolve(this.cacheAutoSignMap.get(r)):Promise.resolve(!1)}));return function(t,r){return e.apply(this,arguments)}}(),n.encrypt=function(){var e=(0,b.default)((function*(e){var t=e.walletId,r=e.networkId,n=e.accountId,o=e.password,i=e.pubkey,a=e.plaintext;if(!i||!a)throw new Error("Invalid encrypt params");var c=yield this.getOrCreateNostrAccount({walletId:t,currentAccountId:n,currentNetworkId:r,password:o}),u=yield this.backgroundApi.engine.getVault({networkId:E.OnekeyNetwork.nostr,accountId:c.id});return{data:yield u.encrypt({pubkey:i,plaintext:a},{password:o})}}));return function(t){return e.apply(this,arguments)}}(),n.decrypt=function(){var e=(0,b.default)((function*(e){var t=e.walletId,r=e.networkId,n=e.accountId,o=e.password,i=e.pubkey,a=e.ciphertext;if(!i||!a)throw new Error("Invalid encrypt params");var c=yield this.getOrCreateNostrAccount({walletId:t,currentAccountId:n,currentNetworkId:r,password:o}),u=yield this.backgroundApi.engine.getVault({networkId:E.OnekeyNetwork.nostr,accountId:c.id});return{data:yield u.decrypt({pubkey:i,ciphertext:a},{password:o})}}));return function(t){return e.apply(this,arguments)}}(),n.saveEncryptedData=function(){var e=(0,b.default)((function*(e){var t=e.pubkey,r=e.plaintext,n=e.encryptedData;return this.expiryMap.set(n,{pubkey:t,plaintext:r,encryptedData:n}),Promise.resolve()}));return function(t){return e.apply(this,arguments)}}(),n.getEncryptedData=function(){var e=(0,b.default)((function*(e){var t=this.expiryMap.get(e);return t?Promise.resolve(t):null}));return function(t){return e.apply(this,arguments)}}(),n.signSchnorr=function(){var e=(0,b.default)((function*(e){var t=e.walletId,r=e.networkId,n=e.accountId,o=e.password,i=e.sigHash;if(!i)throw new Error("Invalid sigHash");var a=yield this.getOrCreateNostrAccount({walletId:t,currentAccountId:n,currentNetworkId:r,password:o}),c=yield this.backgroundApi.engine.getVault({networkId:E.OnekeyNetwork.nostr,accountId:a.id}),u=yield c.keyring.signMessage([{message:i}],{password:o});if(1!==u.length)throw new Error("Nostr: wrong signature type");return{data:u[0]}}));return function(t){return e.apply(this,arguments)}}(),n.getRelays=function(){var e=(0,b.default)((function*(){return(yield S().get(`${(0,C.getFiatEndpoint)()}/nostr/getRelays`)).data}));return function(){return e.apply(this,arguments)}}(),n.validateNpubOnHardware=function(){var e=(0,b.default)((function*(e){var t=e.walletId,r=e.networkId,n=e.accountId;if(!(0,x.isHardwareWallet)({walletId:t}))throw new Error("Wallet is not hardware wallet");var o=yield this.getOrCreateNostrAccount({walletId:t,currentAccountId:n,currentNetworkId:r,password:""}),i=yield this.backgroundApi.engine.getVault({networkId:E.OnekeyNetwork.nostr,accountId:o.id});return yield i.keyring.getAddress({path:o.path,showOnOneKey:!0})}));return function(t){return e.apply(this,arguments)}}(),(0,m.default)(r)}(B.default),(0,P.default)(k.prototype,"getNostrAccount",[o],Object.getOwnPropertyDescriptor(k.prototype,"getNostrAccount"),k.prototype),(0,P.default)(k.prototype,"getOrCreateNostrAccount",[i],Object.getOwnPropertyDescriptor(k.prototype,"getOrCreateNostrAccount"),k.prototype),(0,P.default)(k.prototype,"getPublicKeyHex",[a],Object.getOwnPropertyDescriptor(k.prototype,"getPublicKeyHex"),k.prototype),(0,P.default)(k.prototype,"getPublicKeyEncodedByNip19",[c],Object.getOwnPropertyDescriptor(k.prototype,"getPublicKeyEncodedByNip19"),k.prototype),(0,P.default)(k.prototype,"signEvent",[u],Object.getOwnPropertyDescriptor(k.prototype,"signEvent"),k.prototype),(0,P.default)(k.prototype,"getAutoSignStatus",[s],Object.getOwnPropertyDescriptor(k.prototype,"getAutoSignStatus"),k.prototype),(0,P.default)(k.prototype,"encrypt",[d],Object.getOwnPropertyDescriptor(k.prototype,"encrypt"),k.prototype),(0,P.default)(k.prototype,"decrypt",[p],Object.getOwnPropertyDescriptor(k.prototype,"decrypt"),k.prototype),(0,P.default)(k.prototype,"saveEncryptedData",[l],Object.getOwnPropertyDescriptor(k.prototype,"saveEncryptedData"),k.prototype),(0,P.default)(k.prototype,"getEncryptedData",[f],Object.getOwnPropertyDescriptor(k.prototype,"getEncryptedData"),k.prototype),(0,P.default)(k.prototype,"signSchnorr",[y],Object.getOwnPropertyDescriptor(k.prototype,"signSchnorr"),k.prototype),(0,P.default)(k.prototype,"getRelays",[h],Object.getOwnPropertyDescriptor(k.prototype,"getRelays"),k.prototype),(0,P.default)(k.prototype,"validateNpubOnHardware",[v],Object.getOwnPropertyDescriptor(k.prototype,"validateNpubOnHardware"),k.prototype),g=k))||g)},545453:(e,t,r)=>{r.r(t),r.d(t,{default:()=>le});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A,O,I,P,T,S,D,M,C,N,R,j=r(413888),E=r.n(j),x=r(256666),_=r(634795),B=r(887371),F=r(545754),W=r(411987),L=r(695058),U=r(859375),H=r(427003),V=r(495086),q=r(534756),K=r(445425),$=r(493877),G=r(322987),z=r(481047),J=r(821919),Q=r(830631),X=r(776553),Y=r(929377),Z=r(336782),ee=r(438760),te=r(402814),re=r(942013),ne=r(613549),oe=r(35116),ie=r(292147),ae=(r(862983),r(213208)),ce=r(396564),ue=r(201882);function se(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function de(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?se(Object(r),!0).forEach((function(t){(0,x.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function pe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,L.default)(e);if(t){var o=(0,L.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,W.default)(this,r)}}var le=(n=(0,ee.backgroundClass)(),o=(0,ee.backgroundMethod)(),i=(0,ee.bindThis)(),a=(0,ee.backgroundMethod)(),c=(0,ee.backgroundMethod)(),u=(0,ee.backgroundMethod)(),s=(0,ee.backgroundMethod)(),d=(0,ee.backgroundMethod)(),p=(0,ee.backgroundMethod)(),l=(0,ee.backgroundMethod)(),f=(0,ee.backgroundMethod)(),y=(0,ee.backgroundMethod)(),h=(0,ee.backgroundMethod)(),v=(0,ee.backgroundMethod)(),g=(0,ee.backgroundMethod)(),k=(0,ee.backgroundMethod)(),w=(0,ee.backgroundMethod)(),b=(0,ee.bindThis)(),m=(0,ee.backgroundMethod)(),A=(0,ee.backgroundMethod)(),O=(0,ee.backgroundMethod)(),I=(0,ee.backgroundMethod)(),P=(0,ee.backgroundMethod)(),T=(0,ee.bindThis)(),S=(0,ee.backgroundMethod)(),D=(0,ee.backgroundMethod)(),M=(0,ee.backgroundMethod)(),C=(0,ee.backgroundMethod)(),n((R=function(e){(0,F.default)(r,e);var t=pe(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n)))._filterContractAddresses=(0,ce.memoizee)(function(){var e=(0,_.default)((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[re.OnekeyNetwork.eth,re.OnekeyNetwork.polygon,re.OnekeyNetwork.arbitrum,re.OnekeyNetwork.optimism];if(!e.length)return[];var r=yield(0,te.fetchData)("/notification/validate-account-address",{data:t.map((function(t){return e.map((function(e){return{networkId:t,address:e}}))})).flat()},[],"POST");return e.filter((function(e){return!r.some((function(t){return t.address===e&&t.code&&"0x"!==t.code}))}))}));return function(t){return e.apply(this,arguments)}}(),{promise:!0,primitive:!0,max:200,maxAge:(0,X.getTimeDurationMs)({hour:1})}),e}var n=r.prototype;return n.init=function(){var e=(0,_.default)((function*(e){var t=this;try{yield this.backgroundApi.serviceApp.waitForAppInited({logName:"ServiceNotification"})}catch(d){ie.default.notification.error(d)}if(this.clear(),this.interval=setInterval((function(){t.syncLocalEnabledAccounts()}),(0,X.getTimeDurationMs)({minute:5})),ae.default.isRuntimeBrowser)try{yield this.backgroundApi.serviceSocket.initSocket(),this.registerNotificationCallback()}catch(p){ie.default.notification.error("init socket failed",p)}if(ae.default.isNativeIOS&&e){var r=e||{},n=r._j_msgid,o=void 0===n?"":n,i=r.aps,a=(i=void 0===i?{}:i).title,c=void 0===a?"":a,u=i.body,s=void 0===u?"":u;ie.default.notification.info("launchNotification: ",e),this.handleNotificationCallback({title:c,content:s,messageID:o,notificationEventType:"notificationOpened",extras:e})}}));return function(t){return e.apply(this,arguments)}}(),n.clear=function(){this.interval&&clearInterval(this.interval),ae.default.isRuntimeBrowser&&this.backgroundApi.serviceSocket.clear()},n.getNotificationConfig=function(){var e=(0,_.default)((function*(){var e=this.backgroundApi.appSelector,t=e((function(e){var t;return null==e||null==(t=e.settings)?void 0:t.instanceId})),r=e((function(e){var r;return de(de({},(null==e||null==(r=e.settings)?void 0:r.pushNotification)||{}),{},{locale:"system"===e.settings.locale?(0,Y.getDefaultLocale)():e.settings.locale,currency:e.settings.selectedFiatMoneySymbol,instanceId:t})}));return ae.default.isRuntimeBrowser&&Object.assign(r,{registrationId:t}),Promise.resolve(r)}));return function(){return e.apply(this,arguments)}}(),n.syncPushNotificationConfig=function(){var e=(0,_.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=yield this.getNotificationConfig();return(0,K.syncPushNotificationConfig)(t,e)}));return function(){return e.apply(this,arguments)}}(),n.addPriceAlertConfig=function(){var e=(0,_.default)((function*(e){return(0,K.addPriceAlertConfig)(e)}));return function(t){return e.apply(this,arguments)}}(),n.removePriceAlertConfig=function(){var e=(0,_.default)((function*(e){return(0,K.removePriceAlertConfig)(e)}));return function(t){return e.apply(this,arguments)}}(),n.queryPriceAlertList=function(){var e=(0,_.default)((function*(){return K.queryPriceAlertList.apply(void 0,arguments)}));return function(){return e.apply(this,arguments)}}(),n.addAccountDynamic=function(){var e=(0,_.default)((function*(){return K.addAccountDynamic.apply(void 0,arguments)}));return function(){return e.apply(this,arguments)}}(),n.addAccountDynamicBatch=function(){var e=(0,_.default)((function*(){return K.addAccountDynamicBatch.apply(void 0,arguments)}));return function(){return e.apply(this,arguments)}}(),n.removeAccountDynamic=function(){var e=(0,_.default)((function*(){return K.removeAccountDynamic.apply(void 0,arguments)}));return function(){return e.apply(this,arguments)}}(),n.removeAccountDynamicBatch=function(){var e=(0,_.default)((function*(e){return(0,K.removeAccountDynamicBatch)(e)}));return function(t){return e.apply(this,arguments)}}(),n.queryAccountDynamic=function(){var e=(0,_.default)((function*(){return(0,K.queryAccountDynamic)()}));return function(){return e.apply(this,arguments)}}(),n.syncLocalEnabledAccounts=function(){var e=(0,_.default)((function*(){var e=(0,this.backgroundApi.appSelector)((function(e){return e.runtime.wallets})),t=(yield this.queryAccountDynamic()).filter((function(t){return e.map((function(e){return e.accounts})).flat().find((function(e){return e===t.accountId}))})).map((function(e){return e.address}));yield(0,K.syncLocalEnabledAccounts)(t)}));return function(){return e.apply(this,arguments)}}(),n.emitNotificationStatusChange=function(e){oe.appEventBus.emit(oe.AppEventBusNames.NotificationStatusChanged,e)},n.clearBadge=function(){ie.default.notification.debug("clearBadge")},n.handleConnectStateChangeCallback=function(e){ie.default.notification.debug("JPUSH.addConnectEventListener",e),e.connectEnable&&H.default.getRegistrationID(this.handleRegistrationIdCallback.bind(this))},n.handleRegistrationIdCallback=function(e){ie.default.notification.debug("JPUSH.getRegistrationID",e),(0,this.backgroundApi.dispatch)((0,J.setPushNotificationConfig)({registrationId:e.registerID})),this.syncPushNotificationConfig()},n.switchToTokenDetailScreen=function(){var e=(0,_.default)((function*(e){var t=(0,$.getAppNavigation)(),r=this.backgroundApi,n=r.appSelector,o=(r.serviceApp,n((function(e){return e.general}))),i=o.activeAccountId,a=o.activeNetworkId,c=!(null==e||!e.coingeckoId),u=c?{marketTokenId:e.coingeckoId}:{accountId:i,walletId:i?(0,q.getWalletIdFromAccountId)(i):"",networkId:e.networkId||a,tokenAddress:e.tokenId||""},s=c?z.HomeRoutes.MarketDetail:z.HomeRoutes.ScreenTokenDetail,d=c?z.TabRoutes.Market:z.TabRoutes.Home,p=(z.RootRoutes.Main,z.MainRoutes.Tab,{screen:z.MainRoutes.Tab,params:{screen:d,params:{screen:s,params:u}}});return null==t||t.navigate(z.RootRoutes.Main,p),Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),n.switchTab=function(){var e=(0,_.default)((function*(e){G.navigationShortcuts.navigateToAppRootTab(e),yield(0,X.wait)(600)}));return function(t){return e.apply(this,arguments)}}(),n.switchToScreen=function(){var e=(0,_.default)((function*(e){var t=e.action,r=e.params,n=this.backgroundApi,o=n.dispatch;n.serviceApp;switch(t){case K.NotificationAction.SwitchToTokenDetail:this.switchToTokenDetailScreen(r);break;case K.NotificationAction.SwitchToAccountHistoryTab:yield this.switchTab(z.TabRoutes.Home),o((0,Q.setHomeTabName)(Z.WalletHomeTabEnum.History))}}));return function(t){return e.apply(this,arguments)}}(),n.handleNotificationCallback=function(){var e=(0,_.default)((function*(e){ie.default.notification.info("notification",e),this.emitNotificationStatusChange(e);var t=this.backgroundApi,r=t.appSelector,n=t.serviceAccount,o=t.serviceNetwork,i=r((function(e){return e.general})),a=i.activeAccountId,c=i.activeNetworkId;if(a&&c&&"notificationOpened"===(null==e?void 0:e.notificationEventType)&&e.extras){var u;null==(u=window)||null==u.focus||u.focus();var s=null==e?void 0:e.extras;if(s.action){var d={};try{(d=ae.default.isNativeAndroid?JSON.parse(s.params):s.params).networkId&&(yield o.changeActiveNetwork(d.networkId)),d.accountId&&(yield n.changeActiveAccountByAccountId(d.accountId))}catch(p){ie.default.notification.error("Jpush parse params error",p instanceof Error?p.message:p)}this.switchToScreen({action:s.action,params:d})}}}));return function(t){return e.apply(this,arguments)}}(),n.getWindowWidthInBackground=function(){return ae.default.isExtensionBackground?new Promise((function(e){chrome.windows.getCurrent((function(t){e(t.width||0)}))})):Promise.resolve(V.default.get("window").width)},n.registerNotificationCallback=function(){var e=this;ae.default.isRuntimeBrowser&&("Notification"in window?this.backgroundApi.serviceSocket.registerSocketCallback(ne.SocketEvents.Notification,(function(t){var r;e.handleNotificationCallback(de(de({messageID:""},E()(t,"title","content","extras")),{},{notificationEventType:"notificationArrived"}));var n=null==(r=t.extras)?void 0:r.image,o=new Notification(t.title,{body:t.content,icon:n});o.onclick=function(){e.handleNotificationCallback(de(de({messageID:""},E()(t,"title","content","extras")),{},{notificationEventType:"notificationOpened"})),o.close()}})):ie.default.notification.error("This browser does not support desktop notification"))},n.filterContractAddresses=function(){var e=(0,_.default)((function*(){return this._filterContractAddresses(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])}));return function(){return e.apply(this,arguments)}}(),(0,B.default)(r)}(ue.default),(0,U.default)(R.prototype,"init",[o],Object.getOwnPropertyDescriptor(R.prototype,"init"),R.prototype),(0,U.default)(R.prototype,"clear",[i,a],Object.getOwnPropertyDescriptor(R.prototype,"clear"),R.prototype),(0,U.default)(R.prototype,"getNotificationConfig",[c],Object.getOwnPropertyDescriptor(R.prototype,"getNotificationConfig"),R.prototype),(0,U.default)(R.prototype,"syncPushNotificationConfig",[u],Object.getOwnPropertyDescriptor(R.prototype,"syncPushNotificationConfig"),R.prototype),(0,U.default)(R.prototype,"addPriceAlertConfig",[s],Object.getOwnPropertyDescriptor(R.prototype,"addPriceAlertConfig"),R.prototype),(0,U.default)(R.prototype,"removePriceAlertConfig",[d],Object.getOwnPropertyDescriptor(R.prototype,"removePriceAlertConfig"),R.prototype),(0,U.default)(R.prototype,"queryPriceAlertList",[p],Object.getOwnPropertyDescriptor(R.prototype,"queryPriceAlertList"),R.prototype),(0,U.default)(R.prototype,"addAccountDynamic",[l],Object.getOwnPropertyDescriptor(R.prototype,"addAccountDynamic"),R.prototype),(0,U.default)(R.prototype,"addAccountDynamicBatch",[f],Object.getOwnPropertyDescriptor(R.prototype,"addAccountDynamicBatch"),R.prototype),(0,U.default)(R.prototype,"removeAccountDynamic",[y],Object.getOwnPropertyDescriptor(R.prototype,"removeAccountDynamic"),R.prototype),(0,U.default)(R.prototype,"removeAccountDynamicBatch",[h],Object.getOwnPropertyDescriptor(R.prototype,"removeAccountDynamicBatch"),R.prototype),(0,U.default)(R.prototype,"queryAccountDynamic",[v],Object.getOwnPropertyDescriptor(R.prototype,"queryAccountDynamic"),R.prototype),(0,U.default)(R.prototype,"syncLocalEnabledAccounts",[g],Object.getOwnPropertyDescriptor(R.prototype,"syncLocalEnabledAccounts"),R.prototype),(0,U.default)(R.prototype,"emitNotificationStatusChange",[k],Object.getOwnPropertyDescriptor(R.prototype,"emitNotificationStatusChange"),R.prototype),(0,U.default)(R.prototype,"clearBadge",[w],Object.getOwnPropertyDescriptor(R.prototype,"clearBadge"),R.prototype),(0,U.default)(R.prototype,"handleConnectStateChangeCallback",[b,m],Object.getOwnPropertyDescriptor(R.prototype,"handleConnectStateChangeCallback"),R.prototype),(0,U.default)(R.prototype,"handleRegistrationIdCallback",[A],Object.getOwnPropertyDescriptor(R.prototype,"handleRegistrationIdCallback"),R.prototype),(0,U.default)(R.prototype,"switchToTokenDetailScreen",[O],Object.getOwnPropertyDescriptor(R.prototype,"switchToTokenDetailScreen"),R.prototype),(0,U.default)(R.prototype,"switchTab",[I],Object.getOwnPropertyDescriptor(R.prototype,"switchTab"),R.prototype),(0,U.default)(R.prototype,"switchToScreen",[P],Object.getOwnPropertyDescriptor(R.prototype,"switchToScreen"),R.prototype),(0,U.default)(R.prototype,"handleNotificationCallback",[T,S],Object.getOwnPropertyDescriptor(R.prototype,"handleNotificationCallback"),R.prototype),(0,U.default)(R.prototype,"getWindowWidthInBackground",[D],Object.getOwnPropertyDescriptor(R.prototype,"getWindowWidthInBackground"),R.prototype),(0,U.default)(R.prototype,"registerNotificationCallback",[M],Object.getOwnPropertyDescriptor(R.prototype,"registerNotificationCallback"),R.prototype),(0,U.default)(R.prototype,"filterContractAddresses",[C],Object.getOwnPropertyDescriptor(R.prototype,"filterContractAddresses"),R.prototype),N=R))||N)},656079:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var n,o,i,a,c=r(634795),u=r(887371),s=r(545754),d=r(411987),p=r(695058),l=r(859375),f=r(830631),y=r(438760),h=r(201882);function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var o=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var g=(n=(0,y.backgroundClass)(),o=(0,y.backgroundMethod)(),n((a=function(e){(0,s.default)(r,e);var t=v(r);function r(){return t.apply(this,arguments)}return r.prototype.checkOnboardingStatus=function(){var e=(0,c.default)((function*(){var e=this.backgroundApi,t=e.engine,r=e.dispatch;if(!(0,e.appSelector)((function(e){return e.status.boardingCompleted})))for(var n=yield t.getWallets(),o=0;o<n.length;o+=1){if(n[o].accounts.length>0){r((0,f.setBoardingCompleted)());break}}}));return function(){return e.apply(this,arguments)}}(),(0,u.default)(r)}(h.default),(0,l.default)(a.prototype,"checkOnboardingStatus",[o],Object.getOwnPropertyDescriptor(a.prototype,"checkOnboardingStatus"),a.prototype),i=a))||i)},288348:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Oe});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A,O,I,P,T,S,D,M,C,N,R=r(413888),j=r.n(R),E=r(609850),x=r.n(E),_=r(256666),B=r(785505),F=r.n(B),W=r(301842),L=r.n(W),U=r(196234),H=r(968079),V=r(475652),q=r.n(V),K=r(634795),$=r(254073),G=r.n($),z=r(887371),J=r(545754),Q=r(411987),X=r(695058),Y=r(859375),Z=r(206391),ee=r.n(Z),te=r(571747),re=r(992431),ne=r(849877),oe=r(790656),ie=r(134662),ae=r(556658),ce=r(63450),ue=r(97856),se=r(135463),de=r(918260),pe=r(266985),le=r(480601),fe=r(776553),ye=r(490415),he=r(438760),ve=r(402814),ge=r(613549),ke=r(292147),we=r(201882);function be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?be(Object(r),!0).forEach((function(t){(0,_.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,X.default)(e);if(t){var o=(0,X.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Q.default)(this,r)}}const Oe=(n=(0,he.backgroundClass)(),o=(0,he.bindThis)(),i=(0,he.backgroundMethod)(),a=(0,he.bindThis)(),c=(0,he.backgroundMethod)(),u=(0,he.backgroundMethod)(),s=(0,he.backgroundMethod)(),d=(0,he.bindThis)(),p=(0,he.backgroundMethod)(),l=(0,he.bindThis)(),f=(0,he.backgroundMethod)(),y=(0,he.backgroundMethod)(),h=(0,he.backgroundMethod)(),v=(0,he.backgroundMethod)(),g=(0,he.backgroundMethod)(),k=(0,he.backgroundMethod)(),w=(0,he.backgroundMethod)(),b=(0,he.backgroundMethod)(),m=(0,he.backgroundMethod)(),A=(0,he.backgroundMethod)(),O=(0,he.backgroundMethod)(),I=(0,he.backgroundMethod)(),P=(0,he.backgroundMethod)(),T=(0,he.backgroundMethod)(),S=(0,he.backgroundMethod)(),D=(0,he.backgroundMethod)(),M=(0,he.backgroundMethod)(),n((N=function(e){(0,J.default)(r,e);var t=Ae(r);function r(e){var r;return(r=t.call(this,e))._fetchAccountOverviewDebounced=G()(r.fetchAccountOverview,600,{leading:!1,trailing:!0}),r.refreshCurrentAccountWithDebounce=G()((function(){return r.refreshCurrentAccountNow()}),(0,fe.getTimeDurationMs)({seconds:1}),{leading:!1,trailing:!0}),r.startQueryPendingTasks(),r}var n=r.prototype;return n.startQueryPendingTasks=function(){var e=this;this.interval||(ke.default.common.info("startQueryPendingTasks"),this.interval=setInterval((function(){e.queryPendingTasks()}),(0,fe.getTimeDurationMs)({seconds:15})))},n.stopQueryPendingTasks=function(){var e=(0,K.default)((function*(){clearInterval(this.interval),this.interval=null,ke.default.common.info("stopQueryPendingTasks")}));return function(){return e.apply(this,arguments)}}(),n.getPenddingTasksByNetworkId=function(){var e=(0,K.default)((function*(e){var t=e.networkId,r=e.accountId;if(!t||!r)return Promise.resolve([]);var n=`${t}___${r}`;return Promise.resolve(Object.values(this.pendingTaskMap).filter((function(e){return e.key===n})))}));return function(t){return e.apply(this,arguments)}}(),n.queryPendingTasks=function(){var e=(0,K.default)((function*(){var e=this,t=this.backgroundApi,r=t.dispatch,n=(0,t.appSelector)((function(e){return e.general})),o=n.activeNetworkId,i=void 0===o?"":o,a=n.activeAccountId,c=void 0===a?"":a;if(i&&c){var u=yield this.getPenddingTasksByNetworkId({networkId:i,accountId:c});if(null!=u&&u.length){var s=`${i}___${c}`,d=yield(0,ve.fetchData)("/overview/query/all",{tasks:u,withBRC20Tokens:!0},null,"POST");if(d){var p=d.pending,l=[],f=function*(t){if(!p.find((function(e){return e.scanType===t}))){var r=e.processNftPriceActions({networkId:i,accountId:c,results:d}),n=r.data,o=r.actions;if("btc"===(0,oe.NFTDataType)(i)&&t===ye.EOverviewScanTaskType.nfts&&n[ye.EOverviewScanTaskType.nfts]){for(var a=n[ye.EOverviewScanTaskType.nfts],u=0,f=a.length;u<f;u+=1){var y=yield e.backgroundApi.serviceNFT.getAssetFromLocal({accountId:c,networkId:i,tokenId:a[u].inscription_id});y&&(a[u].listed=y.listed)}n[ye.EOverviewScanTaskType.nfts]=a}l.push.apply(l,(0,H.default)(o.map((function(e){return(0,de.setNFTPrice)(e)})))),yield re.default.accountPortfolios.setAllNetworksPortfolio({key:s,data:n,scanTypes:[t]}),l.push((0,le.updateRefreshHomeOverviewTs)([t]))}};for(var y of q()(u.map((function(e){return e.scanType}))))yield*f(y);if(null==p||!p.length){var h=u.map((function(t){return e.getTaksId(t)})).filter((function(e){return!p.find((function(t){return t.id===e}))}));null!=h&&h.length&&l.push((0,pe.removeOverviewPendingTasks)({ids:h}))}r.apply(void 0,l)}}}}));return function(){return e.apply(this,arguments)}}(),n.processNftPriceActions=function(e){var t=e.networkId,r=e.results,n=e.accountId,o=this.backgroundApi.appSelector,i={};(0,ne.isAllNetworks)(t)&&(i=o((function(e){var t,r;return null!=(t=null==(r=e.overview.allNetworksAccountsMap)?void 0:r[null!=n?n:""])?t:{}})));var a={};return r.nfts=(r.nfts||[]).map((function(e){var r,o,c,u,s,d,p=0;e.assets=null!=(r=null==(o=e.assets)?void 0:o.map((function(t){var r;return t.collection.floorPrice=e.floorPrice,p+=null!=(r=t.latestTradePrice)?r:0,t.networkId=e.networkId,t.accountAddress=e.accountAddress,t})))?r:[],e.totalPrice=p;var l=(0,ne.isAllNetworks)(t)?null==(c=i[null!=(s=e.networkId)?s:""])||null==(u=c.find((function(t){return t.address===e.accountAddress})))?void 0:u.id:n,f=`${null!=(d=e.networkId)?d:""}___${null!=l?l:""}`;return a[f]||(a[f]={floorPrice:0,lastSalePrice:0}),a[f].lastSalePrice+=p,e})),{data:r,actions:Object.entries(a).map((function(e){var t=(0,U.default)(e,2),r=t[0],n=t[1],o=r.split("___"),i=(0,U.default)(o,2),a=i[0],c=i[1];return a&&c?{networkId:a,accountId:c,price:n}:null})).filter(Boolean)}},n.getTaksId=function(e){var t=e.networkId,r=e.address,n=e.xpub,o=e.scanType,i=r,a=(0,ne.parseNetworkId)(t).impl;return a&&!ie.caseSensitiveImpls.has(a)&&(i=(i||"").toLowerCase()),`${o}___${t}___${i}___${null!=n?n:""}`},n.addPendingTasks=function(e,t){var r=this.backgroundApi.dispatch,n={};for(var o of e)for(var i of null!=(a=o.scanTypes)?a:[]){var a,c={id:"",key:t,networkId:o.networkId,address:o.address,xpub:o.xpub,scanType:i};n[this.getTaksId(c)]=c}r((0,pe.addOverviewPendingTasks)({data:n}))},n.buildOverviewScanTasks=function(){var e=(0,K.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.scanTypes,o=void 0===n?[ye.EOverviewScanTaskType.defi,ye.EOverviewScanTaskType.token,ye.EOverviewScanTaskType.nfts]:n,i=this.backgroundApi,a=i.serviceAccount,c=i.appSelector;if(!(0,ne.isAllNetworks)(t)){var u=yield a.getAcccountAddressWithXpub(r,t);return[{networkId:t,address:u.address,xpub:u.xpub,scanTypes:o}]}var s=c((function(e){var t,n;return null!=(t=null==(n=e.overview.allNetworksAccountsMap)?void 0:n[r])?t:{}})),d=[];for(var p of Object.entries(s)){var l=(0,U.default)(p,2),f=l[0],y=l[1];for(var h of y){var v=h.address,g=h.xpub;d.push({networkId:f,address:v,xpub:g,scanTypes:o})}}return d}));return function(t){return e.apply(this,arguments)}}(),n.fetchAccountOverviewDebounced=function(e){return this._fetchAccountOverviewDebounced(e)},n.fetchAccountOverview=function(){var e=(0,K.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.scanTypes,o=yield this.buildOverviewScanTasks({networkId:t,accountId:r,scanTypes:n});if(o.length){ke.default.allNetworks.info("subscribe overview tasks=",o);var i=yield(0,ve.fetchData)("/overview/subscribe",{tasks:o},{},"POST");return i.tasks&&this.addPendingTasks(o,`${t}___${r}`),i}}));return function(t){return e.apply(this,arguments)}}(),n.refreshAccountAssets=function(){var e=(0,K.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.walletId,o=this.backgroundApi,i=o.engine,a=o.serviceToken;if(t&&r&&n){var c=[ye.EOverviewScanTaskType.defi,ye.EOverviewScanTaskType.nfts];(0,ne.isAllNetworks)(t)?c.push(ye.EOverviewScanTaskType.token):(i.clearPriceCache(),yield a.fetchAccountTokens({accountId:r,networkId:t,forceReloadTokens:!0,includeTop50TokensQuery:!0,refreshHomeOverviewTs:!1})),yield this.fetchAccountOverview({networkId:t,accountId:r,scanTypes:c})}}));return function(t){return e.apply(this,arguments)}}(),n.refreshCurrentAccountNow=function(){var e=(0,K.default)((function*(){var e=this.backgroundApi,t=e.appSelector,r=e.dispatch,n=t((function(e){return e.general})),o=n.activeAccountId,i=n.activeNetworkId,a=n.activeWalletId,c=t((function(e){var t;return!!o&&(null==(t=e.refresher)?void 0:t.overviewHomeTokensLoading)}));if(o&&i&&!c){r((0,le.setOverviewHomeTokensLoading)(!0),(0,le.setOverviewAccountIsUpdating)({accountId:o,data:!0}));try{yield this.refreshAccountAssets({networkId:i,accountId:o,walletId:a})}finally{r((0,le.updateRefreshHomeOverviewTs)([ye.EOverviewScanTaskType.token,ye.EOverviewScanTaskType.defi,ye.EOverviewScanTaskType.nfts]),(0,le.setOverviewHomeTokensLoading)(!1),(0,le.setOverviewAccountIsUpdating)({accountId:o,data:!1}))}}}));return function(){return e.apply(this,arguments)}}(),n.refreshCurrentAccount=function(){var e=(0,K.default)((function*(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).debounceEnabled;if(void 0===e||e){var t=yield this.refreshCurrentAccountWithDebounce();return Promise.resolve(t)}return this.refreshCurrentAccountNow()}));return function(){return e.apply(this,arguments)}}(),n.getAccountPortfolio=function(){var e=(0,K.default)((function*(e){var t=e.accountId,r=e.networkId;return re.default.accountPortfolios.getPortfolio({networkId:r,accountId:t})}));return function(t){return e.apply(this,arguments)}}(),n.getTokensPrices=function(){return{prices:(0,ue.getReduxTokenPricesMap)()}},n.getValuesInfoOfTokenAsync=function(){var e=(0,K.default)((function*(e){return Promise.resolve(this.getValuesInfoOfToken(e))}));return function(t){return e.apply(this,arguments)}}(),n.getValuesInfoOfToken=function(e){var t=e.token,r=e.prices,n=e.balances,o=this.getPriceOfToken({token:t,prices:r}),i=this.getBalanceOfToken({token:t,balances:n});return(0,ue.getReduxSingleTokenFiatValues)({priceInfo:o,balanceInfo:i,token:t})},n.getBalanceOfTokenAsync=function(){var e=(0,K.default)((function*(e){return Promise.resolve(this.getBalanceOfToken(e))}));return function(t){return e.apply(this,arguments)}}(),n.getBalanceOfToken=function(e){var t=e.token,r=e.balances;return(0,ue.getReduxSingleTokenBalance)({token:t,balances:r})},n.getPriceOfTokenAsync=function(){var e=(0,K.default)((function*(e){return Promise.resolve(this.getPriceOfToken(e))}));return function(t){return e.apply(this,arguments)}}(),n.getPriceOfToken=function(e){var t=e.prices,r=e.token;return(0,ue.getReduxSingleTokenPrice)({prices:t,token:r})},n.getAccountTokensBalances=function(e){var t=e.networkId,r=e.accountId;return{balances:(0,ue.getReduxAccountTokenBalancesMap)({networkId:t,accountId:r})}},n.buildTokenKey=function(e){var t,r,n=e.networkId,o=e.accountId,i=e.token;return`${n}__${o}__${null!=(t=i.address)?t:""}__${null!=(r=i.sendAddress)?r:""}`},n.filterAccountTokenPredicate=function(e){var t=e.token,r=e.tokensFilter;if(!r)return!0;var n=r.hideRiskTokens,o=r.hideSmallBalance;return!(o&&!t.isNative&&!L()(t.usdValue)&&new(ee())(t.usdValue).isLessThan(F()(o)?o:"1"))&&!(n&&t.riskLevel&&t.riskLevel>ce.TokenRiskLevel.WARN)},n.sortTokens=function(e,t){var r=t.tokensSort;if(!r)return e;var n=r.name,o=r.native,i=r.value,a=r.price;return e.sort((function(e,t){var r,c,u,s,d=0;(o&&(d=d||(t.isNative?1:0)||(e.isNative?-1:0)),"desc"===i)&&(d=d||new(ee())(null!=(r=t.value)?r:0).comparedTo(null!=(c=e.value)?c:0));"desc"===a&&(d=d||new(ee())(null!=(u=t.price)?u:0).comparedTo(null!=(s=e.price)?s:0));return"asc"===n&&(d=d||(0,te.default)({insensitive:!0})(e.name,t.name)),d}))},n.limitTokens=function(e,t){var r=t.tokensLimit;return L()(r)?e:e.slice(0,r)},n.buildTokensMapKey=function(e,t){var r=t.buildTokensMapKey;if(r)return e.map((function(e){var t=null==e?void 0:e.key;if(!t)throw new Error("buildTokensMapKey ERROR: key is undefined");return t}))},n.buildSingleChainAccountTokens=function(){var e=(0,K.default)((function*(e,t){var r,n,o,i,a=this,c=e.accountId,u=e.networkId,s=e.tokensFilter,d=e.tokensSort,p=e.calculateTokensTotalValue,l=(0,ue.getReduxAccountTokensList)({networkId:u,accountId:c});if((0,se.getShouldHideInscriptions)({accountId:c,networkId:u})&&(l=l.filter((function(e){return e.isNative}))),d||p){var f=this.getTokensPrices();n=f.prices;var y=this.getAccountTokensBalances(e);r=y.balances}var h=new(ee())(0),v=new(ee())(0),g=[];l.forEach((function(e){var o={};L()(n)||L()(r)||(o=a.getValuesInfoOfToken({token:e,balances:r,prices:n}));var i=(e.isNative||!e.address)&&!(0,ne.isAllNetworks)(u),d=me(me(me({},e),o),{},{key:a.buildTokenKey({networkId:u,accountId:c,token:e}),isNative:i});if(a.filterAccountTokenPredicate({token:d,tokensFilter:s})){var l,f;if(p)h=h.plus(null!=(l=d.value)?l:0),v=v.plus(null!=(f=d.value24h)?f:0);if("overview"===t){var y,k,w={networkId:u,accountId:c,name:d.name,symbol:d.symbol,address:d.address,logoURI:d.logoURI,balance:d.balance,availableBalance:d.availableBalance,transferBalance:d.transferBalance,usdValue:d.usdValue,value:d.usdValue,value24h:void 0,price:d.price,price24h:d.price24h,isNative:d.isNative,riskLevel:d.riskLevel,key:a.buildTokenKey({networkId:u,accountId:c,token:d}),coingeckoId:d.coingeckoId,sendAddress:d.sendAddress,autoDetected:d.autoDetected,tokens:[{networkId:d.networkId,address:null!=(y=d.address)?y:"",balance:d.balance,decimals:d.decimals,riskLevel:null!=(k=d.riskLevel)?k:ce.TokenRiskLevel.UNKNOWN,value:d.value}]};g.push(w)}else g.push(d)}})),p&&(o=h.toFixed(3),i=v.toFixed(3));var k=g.length;g=this.sortTokens(g,e),g=this.limitTokens(g,e);var w=this.buildTokensMapKey(g,e);return Promise.resolve({tokensKeys:w,tokens:g,tokensTotal:k,tokensTotalValue:o,tokensTotalValue24h:i})}));return function(t,r){return e.apply(this,arguments)}}(),n.buildAllNetworksAccountTokens=function(){var e=(0,K.default)((function*(e){var t,r=this,n=e.networkId,o=e.accountId,i=e.tokensFilter,a=e.calculateTokensTotalValue,c=yield this.getAccountPortfolio({networkId:n,accountId:o}),u=new(ee())(0),s=new(ee())(0),d=[];(null!=(t=c[ye.EOverviewScanTaskType.token])?t:[]).forEach((function(e){var t,c,p,l,f,y=new(ee())(null!=(t=e.value)?t:"0"),h=new(ee())(null!=(c=e.value24h)?c:"0");a&&(u=u.plus(y),s=s.plus(h));var v={networkId:n,accountId:o,name:e.name,symbol:e.symbol,address:void 0,logoURI:e.logoURI,balance:e.balance,transferBalance:e.transferBalance,availableBalance:e.availableBalance,usdValue:null!=(p=e.value)?p:"0",value:y.toFixed(3),value24h:h.toFixed(3),price:new(ee())(null!=(l=e.price)?l:0).toNumber(),price24h:e.price24h,isNative:!1,riskLevel:ce.TokenRiskLevel.UNKNOWN,key:e.coingeckoId,coingeckoId:e.coingeckoId,sendAddress:void 0,autoDetected:!1,tokens:null!=(f=e.tokens)?f:[]};r.filterAccountTokenPredicate({token:v,tokensFilter:i})&&d.push(v)}));var p=d.length;return d=this.sortTokens(d,e),d=this.limitTokens(d,e),{tokensKeys:this.buildTokensMapKey(d,e),tokens:d,tokensTotal:p,tokensTotalValue:u.toFixed(3),tokensTotalValue24h:s.toFixed(3)}}));return function(t){return e.apply(this,arguments)}}(),n.refreshOverviewStats=function(e){var t,r,n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b=e.networkId,m=e.accountId,A=e.tokens,O=e.defis,I=e.nfts,P=x()(null!=(t=this.backgroundApi.appSelector((function(e){var t,r;return null==(t=e.overview.overviewStats)||null==(r=t[b])?void 0:r[m]})))?t:{});A&&(P.tokens=A),O&&(P.defis=O),I&&(P.nfts=I);var T=new(ee())(0).plus(null!=(r=null==(n=P.tokens)?void 0:n.totalValue)?r:0).plus(null!=(o=null==(i=P.defis)?void 0:i.totalValue)?o:0).plus(null!=(a=null==(c=P.nfts)?void 0:c.totalValue)?a:0).toFixed(3),S=new(ee())(0).plus(null!=(u=null==(s=P.tokens)?void 0:s.totalValue24h)?u:0).plus(null!=(d=null==(p=P.defis)?void 0:p.totalValue24h)?d:0).plus(null!=(l=null==(f=P.nfts)?void 0:f.totalValue24h)?l:0).toFixed(3),D=new(ee())(null!=(y=null==(h=P.tokens)?void 0:h.totalValue)?y:0).div(T).toFixed(3),M=new(ee())(null!=(v=null==(g=P.defis)?void 0:g.totalValue)?v:0).div(T).toFixed(3),C=new(ee())(null!=(k=null==(w=P.nfts)?void 0:w.totalValue)?k:0).div(T).toFixed(3);return P.summary={totalValue:T,totalValue24h:S,shareDefis:M,shareNfts:C,shareTokens:D},this.backgroundApi.dispatch((0,pe.updateOverviewStats)({networkId:b,accountId:m,stats:P})),P},n.buildAccountDefiList=function(){var e=(0,K.default)((function*(e){var t;ke.default.allNetworks.info("buildAccountDefiList >>> ",e);var r=null!=(t=(yield this.getAccountPortfolio(e))[ye.EOverviewScanTaskType.defi])?t:[],n=new(ee())(0),o=new(ee())(0),i={},a=[];r.forEach((function(e){e.protocolValue&&(n=n.plus(e.protocolValue)),e.protocolValue24h&&(o=o.plus(e.protocolValue24h));var t=`${e._id.networkId}_${e._id.address}_${e._id.protocolId}`;a.push(t),i[t]={value:e.protocolValue,claimable:e.claimableValue}})),"number"===typeof e.limitSize&&(r=r.slice(0,e.limitSize));var c=n.toFixed(3),u=o.toFixed(3);return this.refreshOverviewStats({networkId:e.networkId,accountId:e.accountId,defis:{totalCounts:r.length,totalValue:c,totalValue24h:u}}),{defiKeys:a,defiValuesMap:i,defis:r}}));return function(t){return e.apply(this,arguments)}}(),n.buildAccountNFTList=function(){var e=(0,K.default)((function*(e){var t,r=e.networkId,n=e.accountId,o=this.backgroundApi,i=o.serviceNFT,a=o.appSelector,c=(0,se.getShouldHideInscriptions)({accountId:n,networkId:r});ke.default.allNetworks.info("buildAccountNFTList >>> ",e);var u=yield i.getNftListWithAssetType(e),s=this.getTokensPrices().prices,d=(null==(t=a((function(e){return e.overview.allNetworksAccountsMap})))?void 0:t[e.accountId])||{},p=a((function(e){return e.nft.nftPrice})),l=a((function(e){return e.nft.disPlayPriceType})),f=new(ee())(0);if((0,ne.isAllNetworks)(r))for(var y of Object.entries(null!=d?d:{})){var h,v,g=(0,U.default)(y,2),k=g[0],w=g[1],b=new(ee())(null!=(h=null==s||null==(v=s[k])?void 0:v.usd)?h:0);for(var m of w){var A,O,I,P=null!=(A=null==p||null==(O=p[m.id])||null==(I=O[k])?void 0:I[l])?A:0;f=f.plus(b.multipliedBy(P))}}else{var T,S,D,M,C,N=new(ee())(null!=(T=null==s||null==(S=s[null!=r?r:""])?void 0:S.usd)?T:0),R=null!=(D=null==(M=p[null!=n?n:""])||null==(C=M[null!=r?r:""])?void 0:C[l])?D:0;f=N.multipliedBy(R)}var j=u.map((function(e){switch(e.type){case ae.NFTAssetType.BTC:return c?[]:e.data.map((function(e){var t,r;return`${null!=(t=e.networkId)?t:""}_${null!=(r=e.accountAddress)?r:""}_${e.inscription_id}`}));case ae.NFTAssetType.EVM:case ae.NFTAssetType.SOL:return e.data.map((function(e){var t,r,n=`${null!=(t=e.networkId)?t:""}_${null!=(r=e.accountAddress)?r:""}`,o=e.assets.map((function(e){var t,r,n,o;return`${null!=(t=e.tokenAddress)?t:""}_${null!=(r=e.contractAddress)?r:""}_${null!=(n=e.tokenId)?n:""}_${null!=(o=e.latestTradePrice)?o:""}`})).join(",");return n+o}));default:return""}})).flat();return this.refreshOverviewStats({networkId:r,accountId:n,nfts:{totalCounts:u.length,totalValue:new(ee())(f).toFixed(3),totalValue24h:void 0}}),{nfts:u,nftKeys:j}}));return function(t){return e.apply(this,arguments)}}(),n.buildAccountTokens=function(){var e=(0,K.default)((function*(e){ke.default.allNetworks.info("buildAccountTokens >>> ",e);var t=e.networkId,r=e.accountId,n=(0,ne.isAllNetworks)(t)?yield this.buildAllNetworksAccountTokens(e):yield this.buildSingleChainAccountTokens(e,"overview");return e.calculateTokensTotalValue&&this.refreshOverviewStats({networkId:t,accountId:r,tokens:{totalCounts:n.tokensTotal,totalValue:n.tokensTotalValue,totalValue24h:n.tokensTotalValue24h}}),n}));return function(t){return e.apply(this,arguments)}}(),n.getKeleStakingBalance=function(){var e=(0,K.default)((function*(e){var t,r,n,o,i,a,c=e.networkId,u=e.accountId,s=e.coingeckoId,d=e.tokenAddress,p=this.backgroundApi.serviceStaking,l=new(ee())(0);if((0,ne.isAllNetworks)(c)||"ethereum"!==s||d)return l;try{a=yield p.fetchMinerOverview({networkId:c,accountId:u})}catch(f){ke.default.allNetworks.warn("fetchMinerOverview error",f)}return a?new(ee())(null!=(t=null==(r=a)||null==(n=r.amount)?void 0:n.total_amount)?t:0).plus(null!=(o=null==(i=a)?void 0:i.amount.withdrawable)?o:0):l}));return function(t){return e.apply(this,arguments)}}(),n.buildTokenDetailInfo=function(){var e=(0,K.default)((function*(e){var t,r;ke.default.allNetworks.info("buildTokenDetailInfo >>> ",e);var n,o=this.backgroundApi,i=o.engine,a=o.serviceToken,c=e.networkId,u=e.accountId,s=e.tokenAddress,d=e.coingeckoId;(0,ne.isAllNetworks)(c)||(n=yield i.findToken({networkId:c,tokenIdOnNetwork:null!=s?s:""}));var p=yield a.fetchTokenDetailInfo({coingeckoId:d,networkId:c,tokenAddress:s,accountId:u}),l=(null!=p?p:{}).defaultChain,f=null!=(t=null==p?void 0:p.tokens)?t:[];null!=f&&f.length||!n||f.push(n);var y=null!=(r=null==f?void 0:f.find((function(e){return e.impl===(null==l?void 0:l.impl)&&e.chainId===(null==l?void 0:l.chainId)})))?r:null==f?void 0:f[0],h=null==f?void 0:f.find((function(e){return e.impl===ge.IMPL_EVM&&("1"===e.chainId||"5"===e.chainId)&&(e.isNative||!e.address)}));return me(me(me({},j()(n,"name","symbol","logoURI")),p),{},{tokens:f,defaultToken:y,ethereumNativeToken:h})}));return function(t){return e.apply(this,arguments)}}(),n.buildTokenDetailPositionInfo=function(){var e=(0,K.default)((function*(e){ke.default.allNetworks.info("buildTokenDetailPositionInfo >>> ",e);var t=this.backgroundApi.appSelector,r=e.accountId,n=e.networkId,o=e.coingeckoId,i=e.sendAddress,a=e.tokenAddress,c=(yield this.buildAccountDefiList({accountId:r,networkId:n})).defis,u=(yield this.buildAccountTokens({accountId:r,networkId:n,tokensFilter:{hideRiskTokens:!1,hideSmallBalance:!1},tokensSort:{native:!0},calculateTokensTotalValue:!1})).tokens,s=t((function(e){var t,o;return null==(t=e.overview.allNetworksAccountsMap)||null==(o=t[r])?void 0:o[n]})),d=t((function(e){var t,o;return null==(t=e.tokens.accountTokensBalance)||null==(o=t[n])?void 0:o[r]})),p=yield this.getKeleStakingBalance(e),l=yield this.buildTokenDetailInfo(e),f=[],y=p;return u.forEach((function(e){var t,r;((0,ne.isAllNetworks)(n)?o===e.coingeckoId:e.address===a&&e.sendAddress===i)&&(null==(t=e.tokens)||t.forEach((function(t){var r,n,o,i,a,c,u=null==s?void 0:s.find((function(e){return e.address===t.accountAddress}));new(ee())(null!=(r=t.balance)?r:0).isGreaterThan(0)&&f.push({name:e.name,address:e.address,symbol:e.symbol,logoURI:null!=(n=e.logoURI)?n:"",type:"Token",balance:null!=(o=null!=(i=t.balance)?i:null==(a=d[(0,ie.getBalanceKey)(e)])?void 0:a.balance)?o:"0",networkId:t.networkId,accountName:null!=(c=null==u?void 0:u.name)?c:""})})),y=y.plus(null!=(r=e.balance)?r:0))})),c.forEach((function(e){e.pools.forEach((function(t){t[1].forEach((function(r){[].concat((0,H.default)(r.supplyTokens),(0,H.default)(r.rewardTokens)).forEach((function(i){var c,u,s;((0,ne.isAllNetworks)(n)?o===i.coingeckoId:i.tokenAddress===a)&&(f.push({name:e.protocolName,symbol:null!=(c=i.symbol)?c:"",address:i.tokenAddress,logoURI:e.protocolIcon,type:t[0],balance:null!=(u=i.balanceParsed)?u:"0",networkId:e._id.networkId,poolCode:r.poolCode,protocol:e}),y=y.plus(null!=(s=i.balanceParsed)?s:0))}))}))}))})),{items:f,detailInfo:l,totalBalance:y.toFixed(),keleStakingBalance:p.toFixed()}}));return function(t){return e.apply(this,arguments)}}(),(0,z.default)(r,[{key:"pendingTaskMap",get:function(){return this.backgroundApi.appSelector((function(e){return e.overview.tasks}))}}]),r}(we.default),(0,Y.default)(N.prototype,"startQueryPendingTasks",[o,i],Object.getOwnPropertyDescriptor(N.prototype,"startQueryPendingTasks"),N.prototype),(0,Y.default)(N.prototype,"stopQueryPendingTasks",[a,c],Object.getOwnPropertyDescriptor(N.prototype,"stopQueryPendingTasks"),N.prototype),(0,Y.default)(N.prototype,"getPenddingTasksByNetworkId",[u],Object.getOwnPropertyDescriptor(N.prototype,"getPenddingTasksByNetworkId"),N.prototype),(0,Y.default)(N.prototype,"queryPendingTasks",[s],Object.getOwnPropertyDescriptor(N.prototype,"queryPendingTasks"),N.prototype),(0,Y.default)(N.prototype,"addPendingTasks",[d],Object.getOwnPropertyDescriptor(N.prototype,"addPendingTasks"),N.prototype),(0,Y.default)(N.prototype,"fetchAccountOverviewDebounced",[p],Object.getOwnPropertyDescriptor(N.prototype,"fetchAccountOverviewDebounced"),N.prototype),(0,Y.default)(N.prototype,"fetchAccountOverview",[l,f],Object.getOwnPropertyDescriptor(N.prototype,"fetchAccountOverview"),N.prototype),(0,Y.default)(N.prototype,"refreshAccountAssets",[y],Object.getOwnPropertyDescriptor(N.prototype,"refreshAccountAssets"),N.prototype),(0,Y.default)(N.prototype,"refreshCurrentAccount",[h],Object.getOwnPropertyDescriptor(N.prototype,"refreshCurrentAccount"),N.prototype),(0,Y.default)(N.prototype,"getAccountPortfolio",[v],Object.getOwnPropertyDescriptor(N.prototype,"getAccountPortfolio"),N.prototype),(0,Y.default)(N.prototype,"getValuesInfoOfTokenAsync",[g],Object.getOwnPropertyDescriptor(N.prototype,"getValuesInfoOfTokenAsync"),N.prototype),(0,Y.default)(N.prototype,"getBalanceOfTokenAsync",[k],Object.getOwnPropertyDescriptor(N.prototype,"getBalanceOfTokenAsync"),N.prototype),(0,Y.default)(N.prototype,"getPriceOfTokenAsync",[w],Object.getOwnPropertyDescriptor(N.prototype,"getPriceOfTokenAsync"),N.prototype),(0,Y.default)(N.prototype,"sortTokens",[b],Object.getOwnPropertyDescriptor(N.prototype,"sortTokens"),N.prototype),(0,Y.default)(N.prototype,"limitTokens",[m],Object.getOwnPropertyDescriptor(N.prototype,"limitTokens"),N.prototype),(0,Y.default)(N.prototype,"buildTokensMapKey",[A],Object.getOwnPropertyDescriptor(N.prototype,"buildTokensMapKey"),N.prototype),(0,Y.default)(N.prototype,"buildSingleChainAccountTokens",[O],Object.getOwnPropertyDescriptor(N.prototype,"buildSingleChainAccountTokens"),N.prototype),(0,Y.default)(N.prototype,"buildAccountDefiList",[I],Object.getOwnPropertyDescriptor(N.prototype,"buildAccountDefiList"),N.prototype),(0,Y.default)(N.prototype,"buildAccountNFTList",[P],Object.getOwnPropertyDescriptor(N.prototype,"buildAccountNFTList"),N.prototype),(0,Y.default)(N.prototype,"buildAccountTokens",[T],Object.getOwnPropertyDescriptor(N.prototype,"buildAccountTokens"),N.prototype),(0,Y.default)(N.prototype,"getKeleStakingBalance",[S],Object.getOwnPropertyDescriptor(N.prototype,"getKeleStakingBalance"),N.prototype),(0,Y.default)(N.prototype,"buildTokenDetailInfo",[D],Object.getOwnPropertyDescriptor(N.prototype,"buildTokenDetailInfo"),N.prototype),(0,Y.default)(N.prototype,"buildTokenDetailPositionInfo",[M],Object.getOwnPropertyDescriptor(N.prototype,"buildTokenDetailPositionInfo"),N.prototype),C=N))||C)},544711:(e,t,r)=>{r.r(t),r.d(t,{default:()=>T});var n,o,i,a,c,u,s,d,p,l=r(634795),f=r(887371),y=r(545754),h=r(411987),v=r(695058),g=r(859375),k=r(992431),w=r(901187),b=r(776553),m=r(438760),A=r(35116),O=r(201882),I=r(348834).Buffer;function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,v.default)(e);if(t){var o=(0,v.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var T=(n=(0,m.backgroundClass)(),o=(0,m.backgroundMethod)(),i=(0,m.backgroundMethod)(),a=(0,m.backgroundMethod)(),c=(0,m.backgroundMethod)(),u=(0,m.backgroundMethod)(),s=(0,m.backgroundMethod)(),n((p=function(e){(0,y.default)(r,e);var t=P(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getRandomString=function(){return(0,b.generateUUID)()},n.clearData=function(){this.data=void 0},n.setData=function(){var e=(0,l.default)((function*(e){var t=this.getRandomString(),r=(0,w.encrypt)(t,I.from(e,"utf-8"),{skipSafeCheck:!0}).toString("hex");return yield k.default.pwkey.setRawData({key:t}),this.data=r,r}));return function(t){return e.apply(this,arguments)}}(),n.encryptByInstanceId=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.inputEncoding,n=void 0===r?"utf-8":r,o=t.outputEncoding,i=void 0===o?"hex":o,a=(0,this.backgroundApi.appSelector)((function(e){return e.settings})).instanceId,c=(0,w.encrypt)(a,I.from(e,n),{skipSafeCheck:!0}).toString(i);return Promise.resolve(c)},n.decryptByInstanceId=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.inputEncoding,n=void 0===r?"hex":r,o=t.outputEncoding,i=void 0===o?"utf-8":o,a=(0,this.backgroundApi.appSelector)((function(e){return e.settings})).instanceId,c=(0,w.decrypt)(a,I.from(e,n),{skipSafeCheck:!0}).toString(i);return Promise.resolve(c)},n.getData=function(){var e=(0,l.default)((function*(e){if(this.data){var t=yield k.default.pwkey.getRawData(),r=k.default.pwkey.updatedAt;if(t&&t.key){var n;try{n=(0,w.decrypt)(t.key,I.from(this.data,"hex"),{skipSafeCheck:!0}).toString("utf-8")}catch(o){return}return!e||Number.isNaN(e)||Date.now()-r<=e?n:void 0}}}));return function(t){return e.apply(this,arguments)}}(),n.verifyPassword=function(){var e=(0,l.default)((function*(e){return this.backgroundApi.engine.verifyMasterPassword(e)}));return function(t){return e.apply(this,arguments)}}(),n.savePassword=function(){var e=(0,l.default)((function*(e){(yield this.verifyPassword(e))&&(yield this.setData(e),A.appEventBus.emit(A.AppEventBusNames.BackupRequired))}));return function(t){return e.apply(this,arguments)}}(),n.getPassword=function(){var e=(0,l.default)((function*(){var e=(0,this.backgroundApi.appSelector)((function(e){return e.settings.enableAppLock}))?void 0:144e5;return this.getPasswordWithTTL(e)}));return function(){return e.apply(this,arguments)}}(),n.getPasswordWithTTL=function(){var e=(0,l.default)((function*(e){var t=yield this.getData(e);if(t)return(yield this.verifyPassword(t))?t:void 0}));return function(t){return e.apply(this,arguments)}}(),n.getBgSensitiveTextEncodeKey=function(){var e=(0,l.default)((function*(){return Promise.resolve((0,w.getBgSensitiveTextEncodeKey)())}));return function(){return e.apply(this,arguments)}}(),(0,f.default)(r)}(O.default),(0,g.default)(p.prototype,"encryptByInstanceId",[o],Object.getOwnPropertyDescriptor(p.prototype,"encryptByInstanceId"),p.prototype),(0,g.default)(p.prototype,"decryptByInstanceId",[i],Object.getOwnPropertyDescriptor(p.prototype,"decryptByInstanceId"),p.prototype),(0,g.default)(p.prototype,"verifyPassword",[a],Object.getOwnPropertyDescriptor(p.prototype,"verifyPassword"),p.prototype),(0,g.default)(p.prototype,"savePassword",[c],Object.getOwnPropertyDescriptor(p.prototype,"savePassword"),p.prototype),(0,g.default)(p.prototype,"getPassword",[u],Object.getOwnPropertyDescriptor(p.prototype,"getPassword"),p.prototype),(0,g.default)(p.prototype,"getBgSensitiveTextEncodeKey",[s],Object.getOwnPropertyDescriptor(p.prototype,"getBgSensitiveTextEncodeKey"),p.prototype),d=p))||d)},296558:(e,t,r)=>{r.r(t),r.d(t,{default:()=>U});var n,o,i,a,c,u,s,d,p,l,f,y,h,v=r(862349),g=r.n(v),k=r(798783),w=r.n(k),b=r(475652),m=r.n(b),A=r(634795),O=r(254073),I=r.n(O),P=r(887371),T=r(545754),S=r(411987),D=r(695058),M=r(859375),C=r(316597),N=r(480601),R=r(821919),j=r(90184),E=r(490415),x=r(438760),_=r(402814),B=r(613549),F=r(35116),W=r(201882);function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,D.default)(e);if(t){var o=(0,D.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,S.default)(this,r)}}var U=(n=(0,x.backgroundClass)(),o=(0,x.bindThis)(),i=(0,x.backgroundMethod)(),a=(0,x.backgroundMethod)(),c=(0,x.bindThis)(),u=(0,x.backgroundMethod)(),s=(0,x.backgroundMethod)(),d=(0,x.backgroundMethod)(),p=(0,x.backgroundMethod)(),l=(0,x.backgroundMethod)(),f=(0,x.backgroundMethod)(),n((h=function(e){(0,T.default)(r,e);var t=L(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n)))._fetchSimpleTokenPriceDebounced=I()(e.fetchSimpleTokenPrice,600,{leading:!1,trailing:!0}),e}var n=r.prototype;return n.registerEvents=function(){var e=this;F.appEventBus.on(F.AppEventBusNames.CurrencyChanged,(function(){var t=e.backgroundApi.appSelector,r=t((function(e){return e.general})),n=r.activeAccountId,o=r.activeNetworkId;if(o&&n){var i=t((function(e){var t,r;return null==(t=e.tokens.accountTokens)||null==(r=t[o])?void 0:r[n]})),a=t((function(e){return e.settings.selectedFiatMoneySymbol}));e.fetchSimpleTokenPrice({networkId:o,accountId:n,tokenIds:i.map((function(e){return e.tokenIdOnNetwork})),vsCurrency:a})}}))},n.fetchSimpleTokenPrice=function(){var e=(0,A.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.tokenIds,o=e.vsCurrency,i=void 0===o?"usd":o,a=this.backgroundApi,c=a.appSelector,u=a.dispatch,s=a.engine,d=c((function(e){var n,o,i;return null!=(n=null==(o=e.tokens.accountTokens)||null==(i=o[t])?void 0:i[null!=r?r:""])?n:[]})),p=[];if(n)p=n;else{var l=yield s.getTopTokensOnNetwork(t,50);p=m()(l.concat(d).map((function(e){return e.tokenIdOnNetwork})))}var f=this.getTokenPricesInCache(t,p,i),y=f.cachePrices,h=f.cachedTokenIds,v=w()(h,p);if(!v.length)return y;var g={vsCurrency:i,platform:t,contractAddresses:v},k=yield this.getCgkTokenPrice(g);return Object.keys(k).length>0&&u((0,j.setTokenPriceMap)({prices:k,vsCurrency:i}),(0,N.updateRefreshHomeOverviewTs)([E.EOverviewScanTaskType.token])),k}));return function(t){return e.apply(this,arguments)}}(),n.testUpdateTokenPriceMap=function(){(0,this.backgroundApi.dispatch)((0,j.setTokenPriceMap)({prices:{"evm--1":{usd:g()(1800,2500),usd_24h_change:-.28172809241920566},"evm--1-0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2":{usd:g()(1800,2500),usd_24h_change:null},"evm--1-0x630fe3adb53f3d2e0c594bc180309fdfdd0a854d":{usd:null,usd_24h_change:null},"evm--1-0x7f08c7cc37fe1718017e7900fe63fe7604daf253":{usd:null,usd_24h_change:null},"evm--1-0x9d6b29308ff0dd2f0e3115fb08baa0819313834c":{usd:null,usd_24h_change:null}},vsCurrency:"usd"}))},n.getTokenPricesInCache=function(e,t,r){var n=Date.now(),o=[],i={},a=(0,this.backgroundApi.appSelector)((function(e){var t;return null!=(t=e.tokens.tokenPriceMap)?t:{}}));for(var c of t){var u=c?`${e}-${c}`:e,s=null==a?void 0:a[u],d=null==s?void 0:s[`updatedAt--${r}`];d&&"undefined"!==typeof s[r]&&n-d<=B.PRICE_EXPIRED_TIME&&(i[u]=s,o.push(c))}return{cachePrices:i,cachedTokenIds:o}},n.fetchSimpleTokenPriceDebounced=function(e){this._fetchSimpleTokenPriceDebounced(e)},n.getSimpleTokenPrice=function(){var e=(0,A.default)((function*(e){var t,r=e.networkId,n=e.tokenId,o=this.backgroundApi.appSelector,i=o((function(e){return e.tokens.tokenPriceMap})),a=`${r}${n?`-${n}`:""}`,c=o((function(e){return e.settings.selectedFiatMoneySymbol}));if(null!=i&&i[a]&&null!=(t=i[a])&&t[c])return i[a][c];var u={networkId:r,vsCurrency:c};n&&(u.tokenIds=[n]);var s,d=yield this.fetchSimpleTokenPrice(u);return d&&Object.keys(d).length>0?null==(s=d[a])?void 0:s[c]:void 0}));return function(t){return e.apply(this,arguments)}}(),n.getSimpleTokenPriceByCgkId=function(){var e=(0,A.default)((function*(e){var t,r=(0,this.backgroundApi.appSelector)((function(e){return e.settings.selectedFiatMoneySymbol})),n=yield this.getCgkTokenPrice({vsCurrency:r,coingeckIds:[e]});if(n&&Object.keys(n).length>0)return null==(t=n[e])?void 0:t[r]}));return function(t){return e.apply(this,arguments)}}(),n.getCgkTokenPrice=function(){var e=(0,A.default)((function*(e){var t=e.platform,r=e.contractAddresses,n=e.coingeckIds,o=e.vsCurrency,i={vs_currency:void 0===o?"usd":o};if(t&&(i.platform=t),null!=r&&r.length){var a=r.filter((function(e){return null==e?void 0:e.length}));i.contracts=a.join(",")}if(null!=n&&n.length){var c=n.filter((function(e){return null==e?void 0:e.length}));i.ids=c.join(",")}try{return yield(0,_.fetchData)("/simple/price",i,{})}catch(u){return{}}}));return function(t){return e.apply(this,arguments)}}(),n.currencyChanged=function(e){var t=this.backgroundApi,r=t.dispatch,n=t.serviceNotification;r((0,R.setSelectedFiatMoneySymbol)(e)),F.appEventBus.emit(F.AppEventBusNames.CurrencyChanged),n.syncPushNotificationConfig()},n.updateFiatMoneyMap=function(){var e=(0,A.default)((function*(e){return(0,this.backgroundApi.dispatch)((0,C.updateFiatMoneyMap)(e)),Promise.resolve()}));return function(t){return e.apply(this,arguments)}}(),(0,P.default)(r)}(W.default),(0,M.default)(h.prototype,"registerEvents",[o],Object.getOwnPropertyDescriptor(h.prototype,"registerEvents"),h.prototype),(0,M.default)(h.prototype,"fetchSimpleTokenPrice",[i],Object.getOwnPropertyDescriptor(h.prototype,"fetchSimpleTokenPrice"),h.prototype),(0,M.default)(h.prototype,"testUpdateTokenPriceMap",[a],Object.getOwnPropertyDescriptor(h.prototype,"testUpdateTokenPriceMap"),h.prototype),(0,M.default)(h.prototype,"getTokenPricesInCache",[c],Object.getOwnPropertyDescriptor(h.prototype,"getTokenPricesInCache"),h.prototype),(0,M.default)(h.prototype,"fetchSimpleTokenPriceDebounced",[u],Object.getOwnPropertyDescriptor(h.prototype,"fetchSimpleTokenPriceDebounced"),h.prototype),(0,M.default)(h.prototype,"getSimpleTokenPrice",[s],Object.getOwnPropertyDescriptor(h.prototype,"getSimpleTokenPrice"),h.prototype),(0,M.default)(h.prototype,"getSimpleTokenPriceByCgkId",[d],Object.getOwnPropertyDescriptor(h.prototype,"getSimpleTokenPriceByCgkId"),h.prototype),(0,M.default)(h.prototype,"getCgkTokenPrice",[p],Object.getOwnPropertyDescriptor(h.prototype,"getCgkTokenPrice"),h.prototype),(0,M.default)(h.prototype,"currencyChanged",[l],Object.getOwnPropertyDescriptor(h.prototype,"currencyChanged"),h.prototype),(0,M.default)(h.prototype,"updateFiatMoneyMap",[f],Object.getOwnPropertyDescriptor(h.prototype,"updateFiatMoneyMap"),h.prototype),y=h))||y)},421002:(e,t,r)=>{r.r(t),r.d(t,{default:()=>w});var n,o,i,a,c,u=r(887371),s=r(545754),d=r(411987),p=r(695058),l=r(859375),f=r(291026),y=r(438760),h=r(292147),v=r(201882);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var o=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var k=1;const w=(n=(0,y.backgroundClass)(),o=(0,y.backgroundMethod)(),i=(0,y.backgroundMethod)(),n((c=function(e){(0,s.default)(r,e);var t=g(r);function r(e){var r,n=e.backgroundApi;return(r=t.call(this,{backgroundApi:n})).callbacks=[],r.callbacksExpireTimeout=6e5,r._rejectExpiredCallbacks(),r}var n=r.prototype;return n.createCallback=function(e){var t=e.resolve,r=e.reject,n=e.data;if((k+=1)<=0)throw new Error(`PromiseContainer ERROR: callback id can NOT negative, id=${k}`);if(this.callbacks[k])throw new Error(`PromiseContainer ERROR: callback exists, id=${k}`);return this.callbacks[k]={id:k,created:Date.now(),resolve:t,reject:r,data:n},k},n.rejectCallback=function(e){var t=e.id,r=e.error;this._processCallback({method:"reject",id:t,error:r})},n.resolveCallback=function(e){var t=e.id,r=e.data;this._processCallback({method:"resolve",id:t,data:r})},n._processCallback=function(e){var t=e.method,r=e.id,n=e.data,o=e.error;r||console.error("ServicePromise processCallback ERROR: id not exists");var i=this.callbacks[r];i&&("reject"===t&&i.reject&&(i.reject(o),h.default.dappApprove.info("rejectCallback",r,null==o?void 0:o.message)),"resolve"===t&&i.resolve&&(i.resolve(n),h.default.dappApprove.info("resolveCallback",r,n)),this.removeCallback(r))},n.removeCallback=function(e){delete this.callbacks[e]},n._rejectExpiredCallbacks=function(){var e=this;if(this.callbacksExpireTimeout){var t=Date.now(),r=!0;for(var n in this.callbacks){r=!1;var o=this.callbacks[n];if(o&&o.created&&t-o.created>this.callbacksExpireTimeout){var i=f.web3Errors.provider.requestTimeout();this.rejectCallback({id:n,error:i})}}r&&(this.callbacks=[]),setTimeout((function(){e._rejectExpiredCallbacks()}),this.callbacksExpireTimeout)}},(0,u.default)(r)}(v.default),(0,l.default)(c.prototype,"rejectCallback",[o],Object.getOwnPropertyDescriptor(c.prototype,"rejectCallback"),c.prototype),(0,l.default)(c.prototype,"resolveCallback",[i],Object.getOwnPropertyDescriptor(c.prototype,"resolveCallback"),c.prototype),a=c))||a)},473755:(e,t,r)=>{r.r(t),r.d(t,{ERC20:()=>oe,ERC721Metadata:()=>ie,default:()=>ce});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A,O,I,P=r(256666),T=r(196234),S=r(968079),D=r(634795),M=r(887371),C=r(545754),N=r(411987),R=r(695058),j=r(859375),E=r(571696),x=r(299780),_=r(785947),B=r(129624),F=r(206391),W=r.n(F),L=r(629503),U=r(458105),H=r(626015),V=r(849472),q=r(849877),K=r(393587),$=r(134662),G=r(240634),z=r(389342),J=r(380845),Q=r(38484),X=r(317279),Y=r(438760),Z=r(292147),ee=r(201882);function te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function re(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?te(Object(r),!0).forEach((function(t){(0,P.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ne(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,R.default)(e);if(t){var o=(0,R.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,N.default)(this,r)}}var oe=_.abi,ie=B.abi,ae=new U.Interface(ie),ce=(n=(0,Y.backgroundClass)(),o=(0,Y.backgroundMethod)(),i=(0,Y.backgroundMethod)(),a=(0,Y.backgroundMethod)(),c=(0,Y.backgroundMethod)(),u=(0,Y.backgroundMethod)(),s=(0,Y.backgroundMethod)(),d=(0,Y.backgroundMethod)(),p=(0,Y.backgroundMethod)(),l=(0,Y.backgroundMethod)(),f=(0,Y.backgroundMethod)(),y=(0,Y.backgroundMethod)(),h=(0,Y.backgroundMethod)(),v=(0,Y.backgroundMethod)(),g=(0,Y.backgroundMethod)(),k=(0,Y.backgroundMethod)(),w=(0,Y.backgroundMethod)(),b=(0,Y.backgroundMethod)(),m=(0,Y.backgroundMethod)(),A=(0,Y.backgroundMethod)(),n((I=function(e){(0,C.default)(r,e);var t=ne(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getProvider=function(){var e=(0,D.default)((function*(e){var t=this.backgroundApi.engine;return(yield t.getChainOnlyVault(e)).getEthersProvider()}));return function(t){return e.apply(this,arguments)}}(),n.getReadProvider=function(){var e=(0,D.default)((function*(e){var t=yield X.default.getModule(),r=yield this.getProvider(e);if(r)return new t.MulticallProvider(r,{verbose:!1})}));return function(t){return e.apply(this,arguments)}}(),n.getLogsProvider=function(){var e=(0,D.default)((function*(e){var t=(0,q.parseNetworkId)(null!=e?e:"").chainId;if(t){var r=yield this.getProvider(e);if(r){var n=new K.BackendProvider(+t);return(0,K.isBackendSupportedChain)(+t)?n:r}}}));return function(t){return e.apply(this,arguments)}}(),n.getTransferEvents=function(){var e=(0,D.default)((function*(e,t){var r,n=(0,J.appSelector)((function(e){return e.runtime.networks})).find((function(t){return t.id===e}));if(!n)throw new Error("no active network found");var o=yield this.getLogsProvider(e);if(!o)throw new Error("no logs provider found");var i=(yield this.backgroundApi.serviceNetwork.getRPCEndpointStatus(null!=(r=null==n?void 0:n.rpcURL)?r:"",e)).latestBlock;if(!i)throw new Error("fetch latestBlock error");var a={topics:[ae.getEventTopic("Transfer"),void 0,(0,U.hexZeroPad)(t,32)]},c={topics:[ae.getEventTopic("Approval"),(0,U.hexZeroPad)(t,32)]},u={topics:[ae.getEventTopic("ApprovalForAll"),(0,U.hexZeroPad)(t,32)]},s=yield(0,K.getLogs)(o,a,0,i);Z.default.backgroundApi.info("Transfer events",s);var d=yield(0,K.getLogs)(o,c,0,i);Z.default.backgroundApi.info("Approval events",d);var p=yield(0,K.getLogs)(o,u,0,i);return Z.default.backgroundApi.info("ApprovalForAll events",p),{transferEvents:s,approvalEvents:d,approvalForAllEvents:p}}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){var e=(0,D.default)((function*(e,t){var r,n,o,i;try{return(0,U.getAddress)(e.toLowerCase())}catch(s){}var a=yield this.backgroundApi.serviceNameResolver.resolveName(e,{disableBTC:!0,networkId:t}),c=a.success,u=a.names;if(c)return(null!=(r=null==u||null==(n=u[0])||null==(o=n.options)||null==(i=o[0])?void 0:i.value)?r:"").split("-")[1]}));return function(t,r){return e.apply(this,arguments)}}(),n.getERC20TokenApprovals=function(){var e=(0,D.default)((function*(e,t,r){var n=r.approvalEvents,o=r.transferEvents,i=this.backgroundApi.engine,a=[].concat((0,S.default)(n),(0,S.default)(o)).filter((function(e){return 3===e.topics.length})),c=yield this.getReadProvider(e);if(!c)return[];var u=a.filter((function(e,t){return t===a.findIndex((function(t){return e.address===t.address}))})).map((function(e){return new L.Contract((0,U.getAddress)(e.address),oe,c)})),s=(yield Promise.all(u.map(function(){var r=(0,D.default)((function*(r){var o=n.filter((function(e){return e.address===r.address}));try{var a=yield i.findToken({networkId:e,tokenIdOnNetwork:r.address}),c=yield r.functions.totalSupply(),u=yield r.functions.balanceOf(t);return{token:a,balance:String(u[0]),contract:r,approvals:o,totalSupply:c[0].toString()}}catch(s){}}));return function(e){return r.apply(this,arguments)}}()))).filter((function(e){return!!e}));return s.filter((function(e){return!!e.token})).filter((function(e){return!(0,K.isSpamToken)(e.token)})).filter((function(e){return e.approvals.length>0||"0.000"!==(0,K.toFloat)(Number(e.balance),e.token.decimals)})).sort((function(e,t){return e.token.symbol.localeCompare(t.token.symbol)}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getERC721TokenApprovals=function(){var e=(0,D.default)((function*(e,t,r){var n=r.approvalEvents,o=r.transferEvents,i=r.approvalForAllEvents,a=yield this.getReadProvider(e);if(!a)return[];var c=yield(0,K.getOpenSeaProxyAddress)(t,a),u=[].concat((0,S.default)(i),(0,S.default)((0,K.generatePatchedAllowanceEvents)(t,c,[].concat((0,S.default)(n),(0,S.default)(i),(0,S.default)(o))))),s=n.filter((function(e){return 4===e.topics.length})),d=o.filter((function(e){return 4===e.topics.length})),p=[].concat((0,S.default)(s),(0,S.default)(u),(0,S.default)(d)),l=p.filter((function(e,t){return t===p.findIndex((function(t){return e.address===t.address}))})).map((function(e){return new L.Contract((0,U.getAddress)(e.address),ie,a)})),f=yield Promise.all(l.map(function(){var r=(0,D.default)((function*(r){var o=u.filter((function(e){return e.address===r.address})),i=n.filter((function(e){return e.address===r.address}));try{var a=yield r.functions.isApprovedForAll(K.DUMMY_ADDRESS,K.DUMMY_ADDRESS_2);if(!1!==(0,T.default)(a,1)[0])return;var c=yield Promise.all([(0,K.withFallback)((0,K.convertString)((0,K.unpackResult)(r.functions.balanceOf(t))),"ERC1155"),(0,K.withFallback)((0,K.unpackResult)(r.functions.name()),(0,H.shortenAddress)(r.address))]),s=(0,T.default)(c,2),d=s[0];return{token:{symbol:s[1],address:r.address,tokenIdOnNetwork:r.address,networkId:e},balance:d,contract:r,approvals:i,approvalsForAll:o}}catch(p){}}));return function(e){return r.apply(this,arguments)}}()));return f.filter((function(e){return void 0!==e})).sort((function(e,t){return e.token.symbol.localeCompare(t.token.symbol)}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getAllowanceFromApproval=function(){var e=(0,D.default)((function*(e,t,r){var n=(0,U.getAddress)((0,U.hexDataSlice)(r.topics[2],12)),o=yield e.functions.allowance(t,n);return{spender:n,allowance:String(yield o[0])}}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getERC20AllowancesFromApprovals=function(){var e=(0,D.default)((function*(e,t){var r=this,n=t.token,o=t.contract,i=t.approvals,a=t.totalSupply,c=i.filter((function(e,t){return t===i.findIndex((function(t){return e.topics[2]===t.topics[2]}))}));return(yield Promise.all(c.map((function(t){return r.getAllowanceFromApproval(o,e,t)})))).filter((function(e){var t=e.allowance;return"0.000"!==(0,K.formatAllowance)(t,n.decimals,a)})).sort((function(e,t){return-1*(0,K.compareBN)(e.allowance,t.allowance)}))}));return function(t,r){return e.apply(this,arguments)}}(),n.getERC721AllowancesFromApprovals=function(){var e=(0,D.default)((function*(e,t){var r=t.contract,n=t.approvals,o=t.approvalsForAll,i=yield(0,K.getUnlimitedAllowancesFromApprovals)(r,e,o),a=yield(0,K.getLimitedAllowancesFromApprovals)(r,n);return[].concat((0,S.default)(a),(0,S.default)(i)).filter((function(e){return void 0!==e}))}));return function(t,r){return e.apply(this,arguments)}}(),n.fetchERC20TokenAllowences=function(){var e=(0,D.default)((function*(e,t){var r=this,n=yield this.getTransferEvents(e,t),o=yield this.getERC20TokenApprovals(e,t,n),i=yield Promise.all(o.map(function(){var e=(0,D.default)((function*(e){var n=yield r.getERC20AllowancesFromApprovals(t,e);return{token:e.token,balance:e.balance,allowance:n,totalSupply:e.totalSupply}}));return function(t){return e.apply(this,arguments)}}())),a=i.filter((function(e){return"0.000"!==(0,K.toFloat)(Number(e.balance),e.token.decimals)||0!==e.allowance.length})),c=a.map((function(e){var t;return null==(t=e.token.address)?void 0:t.toLowerCase()})).filter((function(e){return!!e}));return{allowance:a,prices:yield this.getTokenPriceMap(e,c)}}));return function(t,r){return e.apply(this,arguments)}}(),n.fetchERC721TokenAllowances=function(){var e=(0,D.default)((function*(e,t){var r=this,n=yield this.getTransferEvents(e,t),o=yield this.getERC721TokenApprovals(e,t,n),i=yield Promise.all(o.map(function(){var e=(0,D.default)((function*(e){var n=yield r.getERC721AllowancesFromApprovals(t,e);return{token:e.token,balance:e.balance,allowance:n}}));return function(t){return e.apply(this,arguments)}}()));return i.filter((function(e){var t=e.balance,r=e.allowance;return("0"!==t||0!==r.length)&&("ERC1155"!==t||0!==r.length)}))}));return function(t,r){return e.apply(this,arguments)}}(),n.getSpenderName=function(){var e=(0,D.default)((function*(e,t){var r=(0,q.parseNetworkId)(e).chainId;if(r){var n=yield(0,K.getNameFromEthereumList)(t,r);if(n)return n}return(0,H.shortenAddress)(t)}));return function(t,r){return e.apply(this,arguments)}}(),n.buildEncodedTxsFromSetApprovalForAll=function(e){var t=`${z.Erc721MethodSelectors.setApprovalForAll}${x.defaultAbiCoder.encode(["address","bool"],[e.spender,e.approved]).slice(2)}`;return Promise.resolve({from:e.from,to:e.to,value:"0x0",data:t})},n.buildEncodedTxsFromApprove=function(e){var t=`${z.Erc721MethodSelectors.Approval}${x.defaultAbiCoder.encode(["address","uint256"],[e.approve,e.tokenId]).slice(2)}`;return Promise.resolve({from:e.from,to:e.to,value:"0x0",data:t})},n.getTokenPriceMap=function(){var e=(0,D.default)((function*(e,t){var r=this.backgroundApi.servicePrice,n=(0,J.appSelector)((function(e){return e.settings.selectedFiatMoneySymbol})),o=yield r.getCgkTokenPrice({platform:e,contractAddresses:t});return Object.fromEntries(Object.entries(o).map((function(e){var t=(0,T.default)(e,2),r=t[0],o=t[1];return[r.split("-").pop(),null==o?void 0:o[n]]})))}));return function(t,r){return e.apply(this,arguments)}}(),n.fetchGoPlusERC20TokenApproval=function(){var e=(0,D.default)((function*(e,t){var r=this.backgroundApi.engine,n=yield this.getReadProvider(e);if(!n)return{allowances:[],prices:{}};var o=yield(0,V.fetchSecurityInfo)({networkId:e,address:t,apiName:G.GoPlusSupportApis.token_approval_security});(0,E.ok)(!!o,"fetch gp approval error");var i=yield Promise.all(o.map(function(){var t=(0,D.default)((function*(t){var o,i,a=new L.Contract(t.token_address,oe,n),c=yield r.findToken({networkId:e,tokenIdOnNetwork:t.token_address}),u=yield a.functions.totalSupply(),s=null==u||null==(o=u[0])||null==o.toString?void 0:o.toString();return{token:c,balance:new(W())(t.balance).multipliedBy(10**(null!=(i=null==c?void 0:c.decimals)?i:0)).toString(),totalSupply:s,allowance:t.approved_list.map((function(e){var t;return{spender:e.approved_contract,allowance:"Unlimited"===e.approved_amount?new(W())(s).plus(1).toString():new(W())(e.approved_amount).multipliedBy(10**(null!=(t=null==c?void 0:c.decimals)?t:0)).toString()}}))}}));return function(e){return t.apply(this,arguments)}}())),a=i.map((function(e){var t,r;return null==(t=e.token)||null==(r=t.address)?void 0:r.toLowerCase()})).filter((function(e){return!!e}));return{allowance:i,prices:yield this.getTokenPriceMap(e,a)}}));return function(t,r){return e.apply(this,arguments)}}(),n.fetchGoPlusNFTApproval=function(){var e=(0,D.default)((function*(e,t){var r=yield this.getReadProvider(e);if(!r)return{allowances:[],prices:{}};var n=yield(0,V.fetchSecurityInfo)({networkId:e,address:t,apiName:G.GoPlusSupportApis.nft721_approval_security});(0,E.ok)(!!n,"fetch gp erc721 nft approval error");var o=yield(0,V.fetchSecurityInfo)({networkId:e,address:t,apiName:G.GoPlusSupportApis.nft1155_approval_security});(0,E.ok)(!!o,"fetch gp erc 1155 nft approval error");var i=yield Promise.all([].concat((0,S.default)(n),(0,S.default)(o)).map(function(){var n=(0,D.default)((function*(n){var o=new L.Contract(n.nft_address,ie,r),i=yield(0,K.withFallback)((0,K.convertString)((0,K.unpackResult)(o.functions.balanceOf(t))),"ERC1155");return{token:{symbol:n.nft_symbol,address:o.address,tokenIdOnNetwork:o.address,networkId:e},balance:i,allowance:n.approved_list.map((function(e){return{spender:e.approved_contract,tokenId:e.approved_token_id}}))}}));return function(e){return n.apply(this,arguments)}}()));return{allowance:i}}));return function(t,r){return e.apply(this,arguments)}}(),n.fetchTokenAllowance=function(){var e=(0,D.default)((function*(e,t,r){var n={allowance:[],prices:{},isFromRpc:!1};if(!t)return n;if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])try{if(yield(0,V.fetchValidGoPlusChainId)(r===Q.AssetType.tokens?G.GoPlusSupportApis.token_approval_security:G.GoPlusSupportApis.nft721_approval_security,e))return r===Q.AssetType.tokens?Object.assign(n,re({},yield this.fetchGoPlusERC20TokenApproval(e,t))):Object.assign(n,re({},yield this.fetchGoPlusNFTApproval(e,t)))}catch(i){}if(Object.assign(n,{isFromRpc:!0}),r===Q.AssetType.tokens)Object.assign(n,re({},yield this.fetchERC20TokenAllowences(e,t)));else{var o=yield this.fetchERC721TokenAllowances(e,t);Object.assign(n,{allowance:o})}return n}));return function(t,r,n){return e.apply(this,arguments)}}(),n.lookupEnsName=function(){var e=(0,D.default)((function*(e){return(0,$.fetchData)("/network/lookup_ens_name",{address:e},"")}));return function(t){return e.apply(this,arguments)}}(),(0,M.default)(r)}(ee.default),(0,j.default)(I.prototype,"getProvider",[o],Object.getOwnPropertyDescriptor(I.prototype,"getProvider"),I.prototype),(0,j.default)(I.prototype,"getReadProvider",[i],Object.getOwnPropertyDescriptor(I.prototype,"getReadProvider"),I.prototype),(0,j.default)(I.prototype,"getLogsProvider",[a],Object.getOwnPropertyDescriptor(I.prototype,"getLogsProvider"),I.prototype),(0,j.default)(I.prototype,"getTransferEvents",[c],Object.getOwnPropertyDescriptor(I.prototype,"getTransferEvents"),I.prototype),(0,j.default)(I.prototype,"getAddress",[u],Object.getOwnPropertyDescriptor(I.prototype,"getAddress"),I.prototype),(0,j.default)(I.prototype,"getERC20TokenApprovals",[s],Object.getOwnPropertyDescriptor(I.prototype,"getERC20TokenApprovals"),I.prototype),(0,j.default)(I.prototype,"getERC721TokenApprovals",[d],Object.getOwnPropertyDescriptor(I.prototype,"getERC721TokenApprovals"),I.prototype),(0,j.default)(I.prototype,"getAllowanceFromApproval",[p],Object.getOwnPropertyDescriptor(I.prototype,"getAllowanceFromApproval"),I.prototype),(0,j.default)(I.prototype,"getERC20AllowancesFromApprovals",[l],Object.getOwnPropertyDescriptor(I.prototype,"getERC20AllowancesFromApprovals"),I.prototype),(0,j.default)(I.prototype,"getERC721AllowancesFromApprovals",[f],Object.getOwnPropertyDescriptor(I.prototype,"getERC721AllowancesFromApprovals"),I.prototype),(0,j.default)(I.prototype,"fetchERC20TokenAllowences",[y],Object.getOwnPropertyDescriptor(I.prototype,"fetchERC20TokenAllowences"),I.prototype),(0,j.default)(I.prototype,"fetchERC721TokenAllowances",[h],Object.getOwnPropertyDescriptor(I.prototype,"fetchERC721TokenAllowances"),I.prototype),(0,j.default)(I.prototype,"getSpenderName",[v],Object.getOwnPropertyDescriptor(I.prototype,"getSpenderName"),I.prototype),(0,j.default)(I.prototype,"buildEncodedTxsFromSetApprovalForAll",[g],Object.getOwnPropertyDescriptor(I.prototype,"buildEncodedTxsFromSetApprovalForAll"),I.prototype),(0,j.default)(I.prototype,"buildEncodedTxsFromApprove",[k],Object.getOwnPropertyDescriptor(I.prototype,"buildEncodedTxsFromApprove"),I.prototype),(0,j.default)(I.prototype,"getTokenPriceMap",[w],Object.getOwnPropertyDescriptor(I.prototype,"getTokenPriceMap"),I.prototype),(0,j.default)(I.prototype,"fetchGoPlusERC20TokenApproval",[b],Object.getOwnPropertyDescriptor(I.prototype,"fetchGoPlusERC20TokenApproval"),I.prototype),(0,j.default)(I.prototype,"fetchTokenAllowance",[m],Object.getOwnPropertyDescriptor(I.prototype,"fetchTokenAllowance"),I.prototype),(0,j.default)(I.prototype,"lookupEnsName",[A],Object.getOwnPropertyDescriptor(I.prototype,"lookupEnsName"),I.prototype),O=I))||O)},781821:(e,t,r)=>{r.r(t),r.d(t,{default:()=>F});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w=r(634795),b=r(887371),m=r(545754),A=r(411987),O=r(695058),I=r(859375),P=r(197699),T=r.n(P),S=r(992431),D=r(112889),M=r(520192),C=r(821919),N=r(436873),R=r(834298),j=r(852547),E=r(438760),x=r(213208),_=r(201882);function B(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,O.default)(e);if(t){var o=(0,O.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,A.default)(this,r)}}var F=(n=(0,E.backgroundClass)(),o=(0,E.backgroundMethod)(),i=(0,E.backgroundMethod)(),a=(0,E.backgroundMethod)(),c=(0,E.backgroundMethod)(),u=(0,E.backgroundMethod)(),s=(0,E.backgroundMethod)(),d=(0,E.backgroundMethod)(),p=(0,E.backgroundMethod)(),l=(0,E.backgroundMethod)(),f=(0,E.backgroundMethod)(),y=(0,E.backgroundMethod)(),h=(0,E.backgroundMethod)(),v=(0,E.backgroundMethod)(),n((k=function(e){(0,m.default)(r,e);var t=B(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getFiatEndpoint=function(){return(0,D.getFiatEndpoint)()},n.updateRemoteSetting=function(){var e=(0,w.default)((function*(){var e=`${this.getFiatEndpoint()}/setting/list`,t=(yield this.client.get(e)).data;return this.updateRemoteSettingWithData(t)}));return function(){return e.apply(this,arguments)}}(),n.updateRemoteSettingWithData=function(){var e=(0,w.default)((function*(e){var t=this.backgroundApi,r=t.appSelector,n=t.dispatch;yield S.default.setting.setEnableAppRatings(e.enableAppRatings),yield S.default.setting.setSwapMaintain(e.swapMaintain),yield S.default.setting.setRpcBatchFallbackWhitelistHosts(e.disabledRpcBatchHosts.map((function(e){return{type:"default",url:e}})));var o=[(0,C.setEnableETH2Unstake)(e.enableETH2Unstake),(0,N.setSwapMaintain)(e.swapMaintain),(0,N.setLimitOrderMaintain)(!!e.limitOrderMaintain)],i="";if(x.default.isNativeIOS||x.default.isMas){if(x.default.isNativeIOS&&e.helloVersion?i=e.helloVersion:x.default.isMas&&e.bookmarkVersion&&(i=e.bookmarkVersion),i&&T().valid(i)){var a=r((function(e){return e.settings.version}));T().lte(a,i)&&o.push((0,M.setShowBookmark)(!0))}var c=e.iOSSupportSearchVersion;if(c&&T().valid(c)){var u=r((function(e){return e.settings.version}));T().lte(u,c)&&o.push((0,M.setEnableIOSDappSearch)(!0))}}n.apply(void 0,o)}));return function(t){return e.apply(this,arguments)}}(),n.getInstanceId=function(){var e=(0,w.default)((function*(){return(0,this.backgroundApi.appSelector)((function(e){return e.settings.instanceId}))}));return function(){return e.apply(this,arguments)}}(),n.getWebAuthnCredentialID=function(){var e=(0,w.default)((function*(){return S.default.setting.getWebAuthnCredentialID()}));return function(){return e.apply(this,arguments)}}(),n.setWebAuthnCredentialID=function(){var e=(0,w.default)((function*(e){return S.default.setting.setWebAuthnCredentialID(e)}));return function(t){return e.apply(this,arguments)}}(),n.setAppReviewsLastOpenedAt=function(){var e=(0,w.default)((function*(e){return S.default.setting.setAppReviewsLastOpenedAt(e)}));return function(t){return e.apply(this,arguments)}}(),n.getAppReviewsLastOpenedAt=function(){var e=(0,w.default)((function*(){return S.default.setting.getAppReviewsLastOpenedAt()}));return function(){return e.apply(this,arguments)}}(),n.getEnableAppRatings=function(){var e=(0,w.default)((function*(){return S.default.setting.getEnableAppRatings()}));return function(){return e.apply(this,arguments)}}(),n.checkBrowserActionIcon=function(){var e=(0,w.default)((function*(){var e=this.backgroundApi.appSelector((function(e){return e.settings.disableExt}));R.default.updatBrowserActionIcon(!e)}));return function(){return e.apply(this,arguments)}}(),n.toggleDisableExt=function(){var e=(0,w.default)((function*(){this.backgroundApi.dispatch((0,C.toggleDisableExt)()),this.backgroundApi.providers.$private.notifyExtSwitchChanged({send:this.backgroundApi.sendForProvider("$private")}),this.checkBrowserActionIcon()}));return function(){return e.apply(this,arguments)}}(),n.disableExtSwitchTips=function(){var e=(0,w.default)((function*(){return this.backgroundApi.dispatch((0,C.disableExtSwitchTips)())}));return function(){return e.apply(this,arguments)}}(),n.setWalletSwitchConfig=function(){var e=(0,w.default)((function*(e){return this.backgroundApi.dispatch((0,C.setWalletSwitch)(e))}));return function(t){return e.apply(this,arguments)}}(),n.toggleWalletSwitchConfig=function(){var e=(0,w.default)((function*(e,t){var r,n=[],o=(0,j.getNetworkWithWalletId)(e),i=this.backgroundApi.store.getState().settings.walletSwitchData||{};if(j.MonopolizeNetwork.includes(o)){var a=Object.keys(i).filter((function(t){return t!==e&&t.startsWith(o)})),c=!1;for(var u of a){i[u].enable&&(t||c?n.push((0,C.toggleWalletSwitch)({walletId:u,enable:!1})):c=!0)}}n.push((0,C.toggleWalletSwitch)({walletId:e,enable:t})),(r=this.backgroundApi).dispatch.apply(r,n),this.backgroundApi.providers.$private.notifyExtSwitchChanged({send:this.backgroundApi.sendForProvider("$private")})}));return function(t,r){return e.apply(this,arguments)}}(),(0,b.default)(r)}(_.default),(0,I.default)(k.prototype,"updateRemoteSetting",[o],Object.getOwnPropertyDescriptor(k.prototype,"updateRemoteSetting"),k.prototype),(0,I.default)(k.prototype,"updateRemoteSettingWithData",[i],Object.getOwnPropertyDescriptor(k.prototype,"updateRemoteSettingWithData"),k.prototype),(0,I.default)(k.prototype,"getInstanceId",[a],Object.getOwnPropertyDescriptor(k.prototype,"getInstanceId"),k.prototype),(0,I.default)(k.prototype,"getWebAuthnCredentialID",[c],Object.getOwnPropertyDescriptor(k.prototype,"getWebAuthnCredentialID"),k.prototype),(0,I.default)(k.prototype,"setWebAuthnCredentialID",[u],Object.getOwnPropertyDescriptor(k.prototype,"setWebAuthnCredentialID"),k.prototype),(0,I.default)(k.prototype,"setAppReviewsLastOpenedAt",[s],Object.getOwnPropertyDescriptor(k.prototype,"setAppReviewsLastOpenedAt"),k.prototype),(0,I.default)(k.prototype,"getAppReviewsLastOpenedAt",[d],Object.getOwnPropertyDescriptor(k.prototype,"getAppReviewsLastOpenedAt"),k.prototype),(0,I.default)(k.prototype,"getEnableAppRatings",[p],Object.getOwnPropertyDescriptor(k.prototype,"getEnableAppRatings"),k.prototype),(0,I.default)(k.prototype,"checkBrowserActionIcon",[l],Object.getOwnPropertyDescriptor(k.prototype,"checkBrowserActionIcon"),k.prototype),(0,I.default)(k.prototype,"toggleDisableExt",[f],Object.getOwnPropertyDescriptor(k.prototype,"toggleDisableExt"),k.prototype),(0,I.default)(k.prototype,"disableExtSwitchTips",[y],Object.getOwnPropertyDescriptor(k.prototype,"disableExtSwitchTips"),k.prototype),(0,I.default)(k.prototype,"setWalletSwitchConfig",[h],Object.getOwnPropertyDescriptor(k.prototype,"setWalletSwitchConfig"),k.prototype),(0,I.default)(k.prototype,"toggleWalletSwitchConfig",[v],Object.getOwnPropertyDescriptor(k.prototype,"toggleWalletSwitchConfig"),k.prototype),g=k))||g)},676070:(e,t,r)=>{r.r(t),r.d(t,{default:()=>I});var n,o,i,a,c,u,s,d,p=r(887371),l=r(545754),f=r(411987),y=r(695058),h=r(859375),v=r(235228),g=r(112889),k=r(380845),w=r(776553),b=r(438760),m=r(292147),A=r(201882);function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var o=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}var I=(n=(0,b.backgroundClass)(),o=(0,b.backgroundMethod)(),i=(0,b.bindThis)(),a=(0,b.backgroundMethod)(),c=(0,b.backgroundMethod)(),u=(0,b.backgroundMethod)(),n((d=function(e){(0,l.default)(r,e);var t=O(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).socket=null,e}var n=r.prototype;return n.initSocket=function(){var e=this,t=(0,g.getSocketEndpoint)();return m.default.notification.info("init websocket",t),this.interval=setInterval((function(){e.login()}),(0,w.getTimeDurationMs)({minute:5})),new Promise((function(r,n){e.socket=(0,v.io)(t,{transports:["websocket"]});var o=setTimeout((function(){n(new Error("socket connection failed"))}),(0,w.getTimeDurationMs)({minute:3}));e.socket.on("connect",(function(){m.default.notification.info("websocket connected"),e.login(),clearTimeout(o),r(!0)})),e.socket.on("reconnect",(function(){m.default.notification.info("websocket reconnected"),e.login()})),e.socket.on("disconnect",(function(){m.default.notification.info("websocket disconnected")}))}))},n.clear=function(){var e,t;null==(e=this.socket)||null==e.removeAllListeners||e.removeAllListeners(),null==(t=this.socket)||null==t.disconnect||t.disconnect(),this.interval&&clearInterval(this.interval)},n.registerSocketCallback=function(e,t){var r,n;null==(r=this.socket)||r.off(e),null==(n=this.socket)||n.on(e,t),m.default.notification.info(`register socket callback: ${e}`)},n.login=function(){var e,t=(0,k.appSelector)((function(e){return e.settings.instanceId}));t&&(m.default.notification.info("websocket login",t),null==(e=this.socket)||null==e.emit||e.emit("login",t))},(0,p.default)(r)}(A.default),(0,h.default)(d.prototype,"initSocket",[o],Object.getOwnPropertyDescriptor(d.prototype,"initSocket"),d.prototype),(0,h.default)(d.prototype,"clear",[i,a],Object.getOwnPropertyDescriptor(d.prototype,"clear"),d.prototype),(0,h.default)(d.prototype,"registerSocketCallback",[c],Object.getOwnPropertyDescriptor(d.prototype,"registerSocketCallback"),d.prototype),(0,h.default)(d.prototype,"login",[u],Object.getOwnPropertyDescriptor(d.prototype,"login"),d.prototype),s=d))||s)},882798:(e,t,r)=>{r.r(t),r.d(t,{default:()=>pe});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A,O,I,P,T,S,D,M,C,N,R,j=r(968079),E=r(256666),x=r(196234),_=r(167341),B=r.n(_),F=r(94030),W=r.n(F),L=r(459740),U=r(634795),H=r(887371),V=r(545754),q=r(411987),K=r(695058),$=r(859375),G=r(206391),z=r.n(G),J=r(112889),Q=r(179498),X=r(133531),Y=r(964253),Z=r(415008),ee=r(438760),te=r(942013),re=r(798909),ne=r(922073),oe=r(548036),ie=r(396564),ae=r(201882),ce=["networkId"];function ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(r),!0).forEach((function(t){(0,E.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ue(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function de(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,K.default)(e);if(t){var o=(0,K.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,q.default)(this,r)}}var pe=(n=(0,ee.backgroundClass)(),o=(0,ee.backgroundMethod)(),i=(0,ee.backgroundMethod)(),a=(0,ee.backgroundMethod)(),c=(0,ee.backgroundMethod)(),u=(0,ee.backgroundMethod)(),s=(0,ee.backgroundMethod)(),d=(0,ee.backgroundMethod)(),p=(0,ee.backgroundMethod)(),l=(0,ee.backgroundMethod)(),f=(0,ee.backgroundMethod)(),y=(0,ee.backgroundMethod)(),h=(0,ee.backgroundMethod)(),v=(0,ee.backgroundMethod)(),g=(0,ee.backgroundMethod)(),k=(0,ee.backgroundMethod)(),w=(0,ee.backgroundMethod)(),b=(0,ee.backgroundMethod)(),m=(0,ee.backgroundMethod)(),A=(0,ee.backgroundMethod)(),O=(0,ee.backgroundMethod)(),I=(0,ee.backgroundMethod)(),P=(0,ee.backgroundMethod)(),T=(0,ee.backgroundMethod)(),S=(0,ee.backgroundMethod)(),D=(0,ee.backgroundMethod)(),M=(0,ee.backgroundMethod)(),C=(0,ee.backgroundMethod)(),n((R=function(e){(0,V.default)(r,e);var t=de(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).transactionReceipts={},e._fetchEthAprSma=(0,ie.memoizee)((0,U.default)((function*(){var t=e.backgroundApi.dispatch,r=`${e.getServerEndPoint()}/staking/eth/apr/overview`,n=(yield e.client.get(r)).data;if(n)return t((0,Q.setETHStakingApr)(n)),n})),{promise:!0,primitive:!0,max:1,maxAge:36e5}),e}var n=r.prototype;return n.getServerEndPoint=function(){return(0,J.getFiatEndpoint)()},n.getKeleBaseUrl=function(e){var t=this.getServerEndPoint();if(e===te.OnekeyNetwork.eth)return`${t}/keleMainnet`;if(e===te.OnekeyNetwork.goerli)return`${t}/keleTestnet`;throw new Error("Not supported network")},n.isValidRes=function(e){return Boolean(e.data&&e.data.data&&0===e.data.code)},n.registerOnKele=function(){var e=(0,U.default)((function*(e){var t=`${this.getKeleBaseUrl(e.networkId)}/user/v2/anonymouslogin`;yield this.client.post(t,{payee_addr:e.payeeAddr,token:"eth",source:"onekey"})}));return function(t){return e.apply(this,arguments)}}(),n.buildTxForStakingETHtoKele=function(){var e=(0,U.default)((function*(e){return{data:"0xd9712d546f6e656b65790000000000000000000000000000000000000000000000000000",to:(0,X.getKeleContractAddress)(e.networkId),value:(0,Z.toHex)(e.value)}}));return function(t){return e.apply(this,arguments)}}(),n.prepareBuildTxForFastStakingToKele=function(){var e=(0,U.default)((function*(e){var t=`${this.getKeleBaseUrl(e.networkId)}/fast/stake`,r=(yield this.client.get(t)).data;if(0!==Number(r.code)||!r.data)throw new Error("Failed to build kele pool fast stake transaction");return r.data}));return function(t){return e.apply(this,arguments)}}(),n.buildTxForFastStakingETHtoKele=function(){var e=(0,U.default)((function*(e){var t=this.backgroundApi.engine,r=this.getKeleBaseUrl(e.networkId),n=yield t.getAccount(e.accountId,e.networkId),o=`${r}/build/fast/stake/tx`,i=(yield this.client.post(o,{address:n.address,amount:e.value})).data,a=i.to;return yield t.validator.validateAddress(e.networkId,a),i.value=(0,Z.toHex)(i.value),i}));return function(t){return e.apply(this,arguments)}}(),n.buildTxForStakingETHtoLido=function(){var e=(0,U.default)((function*(e){var t=this.backgroundApi.serviceContract;return{data:yield t.buildLidoStakeTransaction(),to:(0,X.getLidoContractAddress)(e.networkId),value:(0,Z.toHex)(e.value)}}));return function(t){return e.apply(this,arguments)}}(),n.fetchKeleIncomeHistory=function(){var e=(0,U.default)((function*(e){var t=e.accountId,r=e.networkId,n=this.backgroundApi,o=n.engine,i=n.dispatch,a=this.getKeleBaseUrl(e.networkId),c=yield o.getAccount(t,r),u=`${a}/eth2/v2/miner/income/query`,s=yield this.client.get(u,{params:{address:c.address}});if(this.isValidRes(s)){var d=s.data.data;i((0,Q.setKeleIncomes)({accountId:t,networkId:r,incomes:d}))}}));return function(t){return e.apply(this,arguments)}}(),n.getDashboardGlobal=function(){var e=(0,U.default)((function*(e){var t=this.backgroundApi.dispatch,r=`${this.getKeleBaseUrl(e.networkId)}/eth2/v2/global`,n=yield this.client.get(r);if(this.isValidRes(n)){var o=n.data.data;t((0,Q.setKeleNetworkDashboardGlobal)({networkId:e.networkId,dashboard:o}))}}));return function(t){return e.apply(this,arguments)}}(),n.fetchKeleUnstakeOverview=function(){var e=(0,U.default)((function*(e){var t=e.networkId,r=e.accountId,n=this.getKeleBaseUrl(t),o=this.backgroundApi,i=o.engine,a=o.dispatch,c=yield i.getAccount(r,t),u=`${n}/unstake/overview`,s=yield this.client.get(u,{params:{address:c.address}});if(this.isValidRes(s)){var d=s.data.data;a((0,Q.setKeleUnstakeOverview)({networkId:t,accountId:r,unstakeOverview:d}))}}));return function(t){return e.apply(this,arguments)}}(),n.unstake=function(){var e=(0,U.default)((function*(e){e.networkId;var t=(0,L.default)(e,ce),r=`${this.getKeleBaseUrl(e.networkId)}/unstake`;return(yield this.client.post(r,t)).data}));return function(t){return e.apply(this,arguments)}}(),n.fetchWithdrawOverview=function(){var e=(0,U.default)((function*(e){var t=e.networkId,r=e.accountId,n=this.getKeleBaseUrl(e.networkId),o=this.backgroundApi,i=o.engine,a=o.dispatch,c=yield i.getAccount(r,t),u=`${n}/withdraw/overview`,s=yield this.client.get(u,{params:{address:c.address}});if(this.isValidRes(s)){var d=s.data.data;a((0,Q.setKeleWithdrawOverview)({networkId:t,accountId:r,withdrawOverview:d}))}}));return function(t){return e.apply(this,arguments)}}(),n.withdraw=function(){var e=(0,U.default)((function*(e){var t=this.getKeleBaseUrl(e.networkId),r=this.backgroundApi.engine,n=yield r.getAccount(e.accountId,e.networkId),o=`${t}/withdraw`;return(yield this.client.post(o,{amount:e.amount,address:n.address})).data}));return function(t){return e.apply(this,arguments)}}(),n.getKeleOpHistory=function(){var e=(0,U.default)((function*(e){var t,r,n=e.networkId,o=e.accountId,i=this.backgroundApi.engine,a=this.getKeleBaseUrl(e.networkId),c=yield i.getAccount(o,n),u=`${a}/op/v4/history`,s=yield this.client.get(u,{params:{address:c.address,op_type:e.opType}});if(this.isValidRes(s))return null==(t=s.data)||null==(r=t.data)?void 0:r.data}));return function(t){return e.apply(this,arguments)}}(),n.fetchKeleOpHistory=function(){var e=(0,U.default)((function*(e){var t=e.networkId,r=e.accountId,n=this.backgroundApi.dispatch,o=yield this.getKeleOpHistory({networkId:t,accountId:r,opType:"1,2,3,4,5,6,7,8"});if(o&&Array.isArray(o))return n((0,Q.setKeleOpHistory)({accountId:r,networkId:t,items:o})),o}));return function(t){return e.apply(this,arguments)}}(),n.fetchPendingWithdrawAmount=function(){var e=(0,U.default)((function*(e){var t=e.networkId,r=e.accountId,n=this.backgroundApi.dispatch,o=yield this.getKeleOpHistory({networkId:t,accountId:r,opType:"6,7"});if(o&&Array.isArray(o)){var i=o.filter((function(e){return 6===Number(e.op_type)})).map((function(e){return e.amount})),a=W()(i),c=o.filter((function(e){return 7===Number(e.op_type)}));try{for(var u=0;u<c.length;u+=1){var s=c[u];if(s.transaction_id.startsWith("0x")){var d=yield this.getTransactionReceipt(t,s.transaction_id);if(d&&"0x0"!==d.status){if("0x1"===(null==d?void 0:d.status))break}else a=B()(a,s.amount)}}}catch(p){console.error("fetch pending withdraw error")}n((0,Q.setKelePendingWithdraw)({accountId:r,networkId:t,amount:a}))}this.fetchWithdrawOverview({networkId:t,accountId:r})}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionReceipt=function(){var e=(0,U.default)((function*(e,t){var r,n;if(this.transactionReceipts[e]||(this.transactionReceipts[e]={}),null!=(r=this.transactionReceipts[e])&&r[t])return null==(n=this.transactionReceipts[e])?void 0:n[t];var o=this.backgroundApi.serviceNetwork,i=yield o.rpcCall(e,{method:"eth_getTransactionReceipt",params:[t]});return i&&"0x1"===i.status&&(this.transactionReceipts[e][t]=i),i}));return function(t,r){return e.apply(this,arguments)}}(),n.fetchMinerOverview=function(){var e=(0,U.default)((function*(e){var t=e.networkId,r=e.accountId,n=this.backgroundApi,o=n.dispatch,i=n.engine,a=this.getKeleBaseUrl(e.networkId),c=yield i.getAccount(r,t),u=`${a}/eth2/v2/miner/dashboard`,s=yield this.client.get(u,{params:{address:c.address,interval:"day"}});if(this.isValidRes(s)){var d=s.data.data;return o((0,Q.setKeleMinerOverviews)({networkId:t,accountId:r,minerOverview:d})),d}}));return function(t){return e.apply(this,arguments)}}(),n.fetchEthAprSma=function(){return this._fetchEthAprSma()},n.addStEthToUserAccount=function(){var e=(0,U.default)((function*(e){var t=e.networkId,r=e.accountId,n=this.backgroundApi.serviceToken,o=(0,X.getLidoContractAddress)(t);yield n.addAccountToken(t,r,o)}));return function(t){return e.apply(this,arguments)}}(),n.fetchLidoOverview=function(){var e=(0,U.default)((function*(e){var t,r,n=e.networkId,o=e.accountId,i=this.backgroundApi,a=i.engine,c=i.serviceContract,u=i.dispatch,s=i.serviceToken;if(n===te.OnekeyNetwork.eth||n===te.OnekeyNetwork.goerli){var d=yield a.getAccount(o,n),p=(0,X.getLidoNFTContractAddress)(n),l=(0,X.getLidoContractAddress)(n),f=c.buildEvmCalldata({abi:ne.LIDO_NFT_ABI,method:"getWithdrawalRequests",params:[d.address]}),y=yield a.getVault({networkId:n,accountId:o}),h=yield y.getJsonRPCClient(),v=[{to:p,data:f}],g=yield h.batchEthCall(v);if(g.length===v.length){var k=l.toLowerCase(),w=yield s.fetchAndSaveAccountTokenBalance({networkId:n,accountId:o,tokenIds:[k],withMain:!0}),b=(0,x.default)(w,1)[0],m=null!=(t=null==b||null==(r=b[k])?void 0:r.balance)?t:"0",A=g[0],O=c.parseJsonResponse({abi:ne.LIDO_NFT_ABI,method:"getWithdrawalRequests",data:A});if(O[0]){var I=O[0].map((function(e){return e.toNumber()})),P=c.buildEvmCalldata({abi:ne.LIDO_NFT_ABI,method:"getWithdrawalStatus",params:[I]}),T=yield a.proxyJsonRPCCall(n,{method:"eth_call",params:[{from:d.address,to:p,data:P},"latest"]}),S=c.parseJsonResponse({abi:ne.LIDO_NFT_ABI,method:"getWithdrawalStatus",data:T});if(null!=S&&S[0]){var D=S[0].map((function(e){return{owner:e.owner,isFinalized:e.isFinalized,isClaimed:e.isClaimed,amountOfShares:e.amountOfShares.toString(),amountOfStETH:e.amountOfStETH.toString(),timestamp:e.timestamp.toNumber()}}));if(D.length===I.length){var M=D.map((function(e,t){return se(se({},e),{},{requestId:I[t],stETH:new(z())(e.amountOfStETH).shiftedBy(-18).toString()})})),C=M.filter((function(e){return!e.isFinalized})),N=M.filter((function(e){return e.isFinalized})),R=M.reduce((function(e,t){return(0,Z.plus)(t.stETH,e)}),"0"),j=C.reduce((function(e,t){return(0,Z.plus)(t.stETH,e)}),"0"),E=N.reduce((function(e,t){return(0,Z.plus)(t.stETH,e)}),"0"),_={total:(0,Z.plus)(m,R),pending:j,withdrawal:E,pendingNums:C.length,balance:m,nfts:M,nftsBalance:R};u((0,Q.setLidoOverview)({accountId:o,networkId:n,overview:_}))}}}}}}));return function(t){return e.apply(this,arguments)}}(),n.getStEthEip712Domain=function(e){return{name:"Liquid staked Ether 2.0",version:"2",chainId:e===te.OnekeyNetwork.eth?1:5,verifyingContract:(0,X.getLidoContractAddress)(e)}},n.buildStEthPermit=function(){var e=(0,U.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.value,o=e.deadline,i=this.getStEthEip712Domain(t),a=this.backgroundApi,c=a.serviceContract,u=a.engine,s=yield u.getAccount(r,t),d=c.buildEvmCalldata({abi:re.ERC20PermitABI,method:"nonces",params:[s.address]}),p=(0,X.getLidoContractAddress)(t),l=yield u.proxyJsonRPCCall(t,{method:"eth_call",params:[{from:s.address,to:p,data:d},"latest"]}),f=c.parseJsonResponse({abi:re.ERC20PermitABI,method:"nonces",data:l});if(f[0]){var y=f[0].toNumber(),h=(0,X.getLidoNFTContractAddress)(t);return yield c.buildERC20PermitData({eip712Domain:i,eip712Message:{owner:s.address,spender:h,value:n,nonce:y,deadline:o}})}}));return function(t){return e.apply(this,arguments)}}(),n.buildRequestWithdrawalsWithPermit=function(){var e=(0,U.default)((function*(e){var t=this.backgroundApi.serviceContract,r=e.amounts,n=e.owner,o=e.permit,i=e.networkId,a=t.buildEvmCalldata({abi:ne.LIDO_NFT_ABI,method:"requestWithdrawalsWithPermit",params:[r,n,o]});return{to:(0,X.getLidoNFTContractAddress)(i),data:a,value:"0x0"}}));return function(t){return e.apply(this,arguments)}}(),n.getLastCheckpointIndex=function(){var e=(0,U.default)((function*(e){var t=e.networkId,r=(0,X.getLidoNFTContractAddress)(t),n=this.backgroundApi.serviceContract,o=yield n.ethCallWithABI({abi:ne.LIDO_NFT_ABI,method:"getLastCheckpointIndex",params:[],networkId:t,to:r});if(null==o||!o[0])throw new Error("Failed to fetch getLastCheckpointIndex");return o[0].toNumber()}));return function(t){return e.apply(this,arguments)}}(),n.findLidoCheckpointHints=function(){var e=(0,U.default)((function*(e){var t=e.requestIds,r=e.firstIndex,n=e.lastIndex,o=e.networkId,i=this.backgroundApi.serviceContract,a=(0,X.getLidoNFTContractAddress)(o),c=yield i.ethCallWithABI({abi:ne.LIDO_NFT_ABI,method:"findCheckpointHints",params:[t,r,n],networkId:o,to:a});if(null==c||!c[0])throw new Error("Failed to fetch findCheckpointHints");return c[0].map((function(e){return e.toNumber()}))}));return function(t){return e.apply(this,arguments)}}(),n.buildLidoClaimWithdrawals=function(){var e=(0,U.default)((function*(e){var t=e.requestIds,r=e.networkId,n=(0,j.default)(t),o=yield this.getLastCheckpointIndex({networkId:r});n.sort((function(e,t){return e-t}));var i=yield this.findLidoCheckpointHints({requestIds:n,firstIndex:1,lastIndex:o,networkId:r}),a=this.backgroundApi.serviceContract.buildEvmCalldata({abi:ne.LIDO_NFT_ABI,method:"claimWithdrawals",params:[t,i]});return{to:(0,X.getLidoNFTContractAddress)(r),data:a,value:"0x0"}}));return function(t){return e.apply(this,arguments)}}(),n.getStEthToken=function(){var e=(0,U.default)((function*(e){var t=e.networkId,r={id:"",networkId:"",tokenIdOnNetwork:"",name:"Liquid staked Ether 2.0",symbol:"stETH",decimals:18,logoURI:"https://common.onekey-asset.com/token/evm-1/0xae7ab96520de3a18e5e111b5eaab095312d7fe84.png"};if(t===te.OnekeyNetwork.eth)r.id=`${te.OnekeyNetwork.eth}--${Y.MainnetLidoContractAddress}`,r.networkId=te.OnekeyNetwork.eth,r.tokenIdOnNetwork=Y.MainnetLidoContractAddress;else{if(t!==te.OnekeyNetwork.goerli)throw new Error("Wrong networkId");r.id=`${te.OnekeyNetwork.goerli}--${Y.TestnetLidoContractAddress}`,r.networkId=te.OnekeyNetwork.goerli,r.tokenIdOnNetwork=Y.TestnetLidoContractAddress}return r}));return function(t){return e.apply(this,arguments)}}(),n.localRpcFetchLidoMaticOverview=function(){var e=(0,U.default)((function*(e){var t,r,n=e.networkId,o=e.accountId,i=this.backgroundApi,a=i.engine,c=i.serviceContract,u=i.serviceToken;if(n===te.OnekeyNetwork.eth||n===te.OnekeyNetwork.goerli){var s=(0,X.getStMaticContractAdderess)(n),d=c.buildEvmCalldata({abi:oe.StMaticABI,method:"stakeManager",params:[]}),p=c.buildEvmCalldata({abi:oe.StMaticABI,method:"poLidoNFT",params:[]}),l=new(z())(1).shiftedBy(9),f=c.buildEvmCalldata({abi:oe.StMaticABI,method:"convertMaticToStMatic",params:[l.toFixed()]}),y=yield a.getVault({networkId:n,accountId:o}),h=yield y.getJsonRPCClient(),v=[{to:s,data:d},{to:s,data:p},{to:s,data:f}],g=yield h.batchEthCall(v);if(g.length===v.length){var k=c.parseJsonResponse({abi:oe.StMaticABI,method:"stakeManager",data:g[0]}),w=c.parseJsonResponse({abi:oe.StMaticABI,method:"poLidoNFT",data:g[1]}),b=c.parseJsonResponse({abi:oe.StMaticABI,method:"convertMaticToStMatic",data:g[2]}),m=k[0],A=w[0],O="";if(b){var I=b[0];O=new(z())(I.toNumber()).dividedBy(l).toFixed(8)}if(m&&A){var P=yield a.getAccount(o,n),T=[{to:A,data:c.buildEvmCalldata({abi:oe.poLidoNFTABI,method:"getOwnedTokens",params:[P.address]})},{to:m,data:c.buildEvmCalldata({abi:oe.stakeManagerABI,method:"epoch",params:[]})}],S=yield h.batchEthCall(T);if(T.length===S.length){var D=c.parseJsonResponse({abi:oe.poLidoNFTABI,method:"getOwnedTokens",data:S[0]}),M=c.parseJsonResponse({abi:oe.stakeManagerABI,method:"epoch",data:S[1]})[0].toNumber(),C=D[0].map((function(e){return e.toNumber()})),N=C.map((function(e){return c.buildEvmCalldata({abi:oe.StMaticABI,method:"getToken2WithdrawRequests",params:[e]})})),R=C.map((function(e){return c.buildEvmCalldata({abi:oe.StMaticABI,method:"getMaticFromTokenId",params:[e]})})),j=(yield Promise.all([].concat(N).concat(R))).map((function(e){return{to:s,data:e}})),E=yield h.batchEthCall(j);if(j.length===E.length){var _=E.slice(0,N.length).map(function(){var e=(0,U.default)((function*(e){var t=c.parseJsonResponse({abi:oe.StMaticABI,method:"getToken2WithdrawRequests",data:e})[0][0];if(t)return{amount2WithdrawFromStMATIC:t[0].toNumber(),validatorNonce:t[1].toNumber(),requestTime:t[2].toNumber(),validatorAddress:t[3]}}));return function(t){return e.apply(this,arguments)}}()),B=(yield Promise.all(_)).filter((function(e){return"undefined"!==typeof e})),F=E.slice(N.length).map(function(){var e=(0,U.default)((function*(e){return c.parseJsonResponse({abi:oe.StMaticABI,method:"getMaticFromTokenId",data:e})[0].toString()}));return function(t){return e.apply(this,arguments)}}()),W=yield Promise.all(F);if(B.length===C.length&&W.length===C.length){var L=B.map((function(e,t){var r=C[t],n=new(z())(W[t]).shiftedBy(-18).toString();return{nftId:r,claimable:e.requestTime<=M,maticAmount:n}})),H=s.toLowerCase(),V=yield u.fetchAndSaveAccountTokenBalance({networkId:n,accountId:o,tokenIds:[H],withMain:!0}),q=(0,x.default)(V,1)[0];return{balance:null!=(t=null==q||null==(r=q[H])?void 0:r.balance)?t:"0",nfts:L,maticToStMaticRate:O,stMaticAddress:s}}}}}}}}));return function(t){return e.apply(this,arguments)}}(),n.remoteSeverFetchLidoMaticOverview=function(){var e=(0,U.default)((function*(e){var t=e.accountId,r=e.networkId,n=this.backgroundApi,o=n.engine,i=n.serviceToken,a=this.getServerEndPoint(),c=yield o.getAccount(t,r),u=`${a}/staking/stmatic/overview`,s=(yield this.client.get(u,{params:{address:c.address,networkId:r}})).data;if(null!=s&&s.stMaticAddress){var d=s.stMaticAddress.toLowerCase();yield i.fetchAndSaveAccountTokenBalance({networkId:r,accountId:t,tokenIds:[d],withMain:!0})}return s}));return function(t){return e.apply(this,arguments)}}(),n.fetchLidoMaticOverview=function(){var e=(0,U.default)((function*(e){var t;try{t=yield this.remoteSeverFetchLidoMaticOverview(e)}catch(r){t=yield this.localRpcFetchLidoMaticOverview(e)}t&&(0,this.backgroundApi.dispatch)((0,Q.setLidoMaticOverview)(se(se({},e),{},{overview:t})))}));return function(t){return e.apply(this,arguments)}}(),n.buildTxForStakingMaticToLido=function(){var e=(0,U.default)((function*(e){var t=this.backgroundApi.engine,r=this.getServerEndPoint(),n=yield t.getAccount(e.accountId,e.networkId),o=`${r}/staking/stmatic/build_stake_transaction`;return(yield this.client.post(o,{networkId:e.networkId,amount:e.amount,address:n.address})).data}));return function(t){return e.apply(this,arguments)}}(),n.buildTransactionUnstakeMatic=function(){var e=(0,U.default)((function*(e){var t=this.backgroundApi.engine,r=this.getServerEndPoint(),n=yield t.getAccount(e.accountId,e.networkId),o=`${r}/staking/stmatic/build_unstake_transaction`;return(yield this.client.post(o,{networkId:e.networkId,amount:e.amount,address:n.address})).data}));return function(t){return e.apply(this,arguments)}}(),n.buildLidoMaticClaimWithdrawals=function(){var e=(0,U.default)((function*(e){var t=this.backgroundApi.engine,r=this.getServerEndPoint(),n=yield t.getAccount(e.accountId,e.networkId),o=`${r}/staking/stmatic/build_claim_transaction`;return(yield this.client.post(o,{networkId:e.networkId,nftId:e.nftId,address:n.address})).data}));return function(t){return e.apply(this,arguments)}}(),(0,H.default)(r)}(ae.default),(0,$.default)(R.prototype,"registerOnKele",[o],Object.getOwnPropertyDescriptor(R.prototype,"registerOnKele"),R.prototype),(0,$.default)(R.prototype,"buildTxForStakingETHtoKele",[i],Object.getOwnPropertyDescriptor(R.prototype,"buildTxForStakingETHtoKele"),R.prototype),(0,$.default)(R.prototype,"prepareBuildTxForFastStakingToKele",[a],Object.getOwnPropertyDescriptor(R.prototype,"prepareBuildTxForFastStakingToKele"),R.prototype),(0,$.default)(R.prototype,"buildTxForFastStakingETHtoKele",[c],Object.getOwnPropertyDescriptor(R.prototype,"buildTxForFastStakingETHtoKele"),R.prototype),(0,$.default)(R.prototype,"buildTxForStakingETHtoLido",[u],Object.getOwnPropertyDescriptor(R.prototype,"buildTxForStakingETHtoLido"),R.prototype),(0,$.default)(R.prototype,"fetchKeleIncomeHistory",[s],Object.getOwnPropertyDescriptor(R.prototype,"fetchKeleIncomeHistory"),R.prototype),(0,$.default)(R.prototype,"getDashboardGlobal",[d],Object.getOwnPropertyDescriptor(R.prototype,"getDashboardGlobal"),R.prototype),(0,$.default)(R.prototype,"fetchKeleUnstakeOverview",[p],Object.getOwnPropertyDescriptor(R.prototype,"fetchKeleUnstakeOverview"),R.prototype),(0,$.default)(R.prototype,"unstake",[l],Object.getOwnPropertyDescriptor(R.prototype,"unstake"),R.prototype),(0,$.default)(R.prototype,"fetchWithdrawOverview",[f],Object.getOwnPropertyDescriptor(R.prototype,"fetchWithdrawOverview"),R.prototype),(0,$.default)(R.prototype,"withdraw",[y],Object.getOwnPropertyDescriptor(R.prototype,"withdraw"),R.prototype),(0,$.default)(R.prototype,"fetchKeleOpHistory",[h],Object.getOwnPropertyDescriptor(R.prototype,"fetchKeleOpHistory"),R.prototype),(0,$.default)(R.prototype,"fetchPendingWithdrawAmount",[v],Object.getOwnPropertyDescriptor(R.prototype,"fetchPendingWithdrawAmount"),R.prototype),(0,$.default)(R.prototype,"fetchMinerOverview",[g],Object.getOwnPropertyDescriptor(R.prototype,"fetchMinerOverview"),R.prototype),(0,$.default)(R.prototype,"fetchEthAprSma",[k],Object.getOwnPropertyDescriptor(R.prototype,"fetchEthAprSma"),R.prototype),(0,$.default)(R.prototype,"addStEthToUserAccount",[w],Object.getOwnPropertyDescriptor(R.prototype,"addStEthToUserAccount"),R.prototype),(0,$.default)(R.prototype,"fetchLidoOverview",[b],Object.getOwnPropertyDescriptor(R.prototype,"fetchLidoOverview"),R.prototype),(0,$.default)(R.prototype,"buildStEthPermit",[m],Object.getOwnPropertyDescriptor(R.prototype,"buildStEthPermit"),R.prototype),(0,$.default)(R.prototype,"buildRequestWithdrawalsWithPermit",[A],Object.getOwnPropertyDescriptor(R.prototype,"buildRequestWithdrawalsWithPermit"),R.prototype),(0,$.default)(R.prototype,"getLastCheckpointIndex",[O],Object.getOwnPropertyDescriptor(R.prototype,"getLastCheckpointIndex"),R.prototype),(0,$.default)(R.prototype,"findLidoCheckpointHints",[I],Object.getOwnPropertyDescriptor(R.prototype,"findLidoCheckpointHints"),R.prototype),(0,$.default)(R.prototype,"buildLidoClaimWithdrawals",[P],Object.getOwnPropertyDescriptor(R.prototype,"buildLidoClaimWithdrawals"),R.prototype),(0,$.default)(R.prototype,"getStEthToken",[T],Object.getOwnPropertyDescriptor(R.prototype,"getStEthToken"),R.prototype),(0,$.default)(R.prototype,"fetchLidoMaticOverview",[S],Object.getOwnPropertyDescriptor(R.prototype,"fetchLidoMaticOverview"),R.prototype),(0,$.default)(R.prototype,"buildTxForStakingMaticToLido",[D],Object.getOwnPropertyDescriptor(R.prototype,"buildTxForStakingMaticToLido"),R.prototype),(0,$.default)(R.prototype,"buildTransactionUnstakeMatic",[M],Object.getOwnPropertyDescriptor(R.prototype,"buildTransactionUnstakeMatic"),R.prototype),(0,$.default)(R.prototype,"buildLidoMaticClaimWithdrawals",[C],Object.getOwnPropertyDescriptor(R.prototype,"buildLidoMaticClaimWithdrawals"),R.prototype),N=R))||N)},594822:(e,t,r)=>{r.r(t),r.d(t,{default:()=>$e});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A,O,I,P,T,S,D,M,C,N,R,j,E,x,_,B,F,W,L,U,H,V,q,K,$,G,z,J,Q,X,Y,Z,ee,te,re,ne,oe,ie,ae,ce,ue,se,de,pe,le,fe,ye,he,ve,ge=r(968079),ke=r(196234),we=r(256666),be=r(634795),me=r(887371),Ae=r(545754),Oe=r(411987),Ie=r(695058),Pe=r(859375),Te=r(206391),Se=r.n(Te),De=r(992431),Me=r(112889),Ce=r(534756),Ne=r(134662),Re=r(945821),je=r(859071),Ee=r(177510),xe=r(436873),_e=r(415008),Be=r(438760),Fe=r(942013),We=r(613549),Le=r(35116),Ue=r(292147),He=r(201882);function Ve(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function qe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(r),!0).forEach((function(t){(0,we.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ve(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ke(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,Ie.default)(e);if(t){var o=(0,Ie.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Oe.default)(this,r)}}var $e=(n=(0,Be.backgroundClass)(),o=(0,Be.bindThis)(),i=(0,Be.backgroundMethod)(),a=(0,Be.backgroundMethod)(),c=(0,Be.backgroundMethod)(),u=(0,Be.backgroundMethod)(),s=(0,Be.backgroundMethod)(),d=(0,Be.backgroundMethod)(),p=(0,Be.backgroundMethod)(),l=(0,Be.backgroundMethod)(),f=(0,Be.backgroundMethod)(),y=(0,Be.backgroundMethod)(),h=(0,Be.backgroundMethod)(),v=(0,Be.backgroundMethod)(),g=(0,Be.backgroundMethod)(),k=(0,Be.backgroundMethod)(),w=(0,Be.backgroundMethod)(),b=(0,Be.backgroundMethod)(),m=(0,Be.backgroundMethod)(),A=(0,Be.backgroundMethod)(),O=(0,Be.backgroundMethod)(),I=(0,Be.backgroundMethod)(),P=(0,Be.backgroundMethod)(),T=(0,Be.backgroundMethod)(),S=(0,Be.backgroundMethod)(),D=(0,Be.backgroundMethod)(),M=(0,Be.backgroundMethod)(),C=(0,Be.backgroundMethod)(),N=(0,Be.backgroundMethod)(),R=(0,Be.backgroundMethod)(),j=(0,Be.backgroundMethod)(),E=(0,Be.backgroundMethod)(),x=(0,Be.backgroundMethod)(),_=(0,Be.backgroundMethod)(),B=(0,Be.backgroundMethod)(),F=(0,Be.backgroundMethod)(),W=(0,Be.backgroundMethod)(),L=(0,Be.backgroundMethod)(),U=(0,Be.backgroundMethod)(),H=(0,Be.backgroundMethod)(),V=(0,Be.backgroundMethod)(),q=(0,Be.backgroundMethod)(),K=(0,Be.backgroundMethod)(),$=(0,Be.backgroundMethod)(),G=(0,Be.backgroundMethod)(),z=(0,Be.backgroundMethod)(),J=(0,Be.backgroundMethod)(),Q=(0,Be.backgroundMethod)(),X=(0,Be.backgroundMethod)(),Y=(0,Be.backgroundMethod)(),Z=(0,Be.backgroundMethod)(),ee=(0,Be.backgroundMethod)(),te=(0,Be.backgroundMethod)(),re=(0,Be.backgroundMethod)(),ne=(0,Be.backgroundMethod)(),oe=(0,Be.backgroundMethod)(),ie=(0,Be.backgroundMethod)(),ae=(0,Be.backgroundMethod)(),ce=(0,Be.backgroundMethod)(),ue=(0,Be.backgroundMethod)(),se=(0,Be.backgroundMethod)(),de=(0,Be.backgroundMethod)(),pe=(0,Be.backgroundMethod)(),le=(0,Be.bindThis)(),fe=(0,Be.backgroundMethod)(),ye=(0,Be.backgroundMethod)(),n((ve=function(e){(0,Ae.default)(r,e);var t=Ke(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.registerEvents=function(){Le.appEventBus.on(Le.AppEventBusNames.CurrencyChanged,this.refreshSelectedTokenPrice)},n.getServerEndPoint=function(){var e=(0,be.default)((function*(){return(0,Me.getFiatEndpoint)()}));return function(){return e.apply(this,arguments)}}(),n.getSwftcCoins=function(){var e=(0,be.default)((function*(){return De.default.swap.getSwftcCoins()}));return function(){return e.apply(this,arguments)}}(),n.setSwftcCoins=function(){var e=(0,be.default)((function*(e){return De.default.swap.setSwftcCoins(e)}));return function(t){return e.apply(this,arguments)}}(),n.selectToken=function(){var e=(0,be.default)((function*(e,t,r){var n=this.backgroundApi.dispatch;n("INPUT"===e?(0,Ee.setInputToken)({token:r,network:t}):(0,Ee.setOutputToken)({token:r,network:t}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.setDefaultInputToken=function(){var e=(0,be.default)((function*(){var e=this.backgroundApi,t=e.engine,r=e.appSelector,n=yield t.getNetwork(Fe.OnekeyNetwork.eth),o=yield t.getNativeTokenInfo(n.id),i=r((function(e){return e.swap.inputToken}));if(o&&!i&&this.setInputToken(o),!r((function(e){return e.swap.outputToken}))){var a=(0,Ne.formatServerToken)({name:"USD Coin",symbol:"USDC",address:"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",decimals:6,logoURI:"https://common.onekey-asset.com/token/evm-1/0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48.jpg",impl:"evm",chainId:"1"});this.setOutputToken(qe(qe({},a),{},{coingeckoId:"usd-coin"}))}}));return function(){return e.apply(this,arguments)}}(),n.setInputToken=function(){var e=(0,be.default)((function*(e){var t,r=this.backgroundApi,n=r.appSelector,o=r.engine,i=n((function(e){return e.swap.outputToken})),a=n((function(e){return e.swap.inputToken}));i&&(0,_e.tokenEqual)(i,e)&&(null!=a&&a.networkId&&(t=yield o.getNetwork(null==a?void 0:a.networkId)),this.selectToken("OUTPUT",t,a));var c=yield o.getNetwork(e.networkId);this.selectToken("INPUT",c,e),yield this.setSendingAccountByNetwork(c)}));return function(t){return e.apply(this,arguments)}}(),n.setOutputToken=function(){var e=(0,be.default)((function*(e){var t=this.backgroundApi,r=t.appSelector,n=t.engine,o=r((function(e){return e.swap.outputToken})),i=r((function(e){return e.swap.inputToken}));if(i&&(0,_e.tokenEqual)(i,e))if((0,je.getActiveWalletAccount)().networkId!==(null==o?void 0:o.networkId))this.selectToken("INPUT");else{var a=yield n.getNetwork(null==o?void 0:o.networkId);this.selectToken("INPUT",a,o)}var c=yield n.getNetwork(e.networkId);this.selectToken("OUTPUT",c,e),c&&(yield this.setRecipientByNetwork(c))}));return function(t){return e.apply(this,arguments)}}(),n.switchTokens=function(){var e=(0,be.default)((function*(){var e=this.backgroundApi,t=e.dispatch,r=e.appSelector,n=e.engine,o=r((function(e){return e.swap.outputToken})),i=r((function(e){return e.swap.inputToken}));if(t((0,Ee.setQuote)(void 0),(0,Ee.setResponses)(void 0),(0,Ee.switchTokens)()),o){var a=yield n.getNetwork(o.networkId);yield this.setSendingAccountByNetwork(a)}if(i){var c=yield n.getNetwork(i.networkId);yield this.setRecipientByNetwork(c)}}));return function(){return e.apply(this,arguments)}}(),n.resetState=function(){var e=(0,be.default)((function*(){(0,this.backgroundApi.dispatch)((0,Ee.resetState)())}));return function(){return e.apply(this,arguments)}}(),n.userInput=function(){var e=(0,be.default)((function*(e,t){(0,this.backgroundApi.dispatch)((0,Ee.setTypedValue)({independentField:e,typedValue:t}))}));return function(t,r){return e.apply(this,arguments)}}(),n.resetTypedValue=function(){var e=(0,be.default)((function*(){(0,this.backgroundApi.dispatch)((0,Ee.resetTypedValue)())}));return function(){return e.apply(this,arguments)}}(),n.clearState=function(){var e=(0,be.default)((function*(){(0,this.backgroundApi.dispatch)((0,Ee.clearState)())}));return function(){return e.apply(this,arguments)}}(),n.setSendingAccountSimple=function(){var e=(0,be.default)((function*(e){(0,this.backgroundApi.dispatch)((0,Ee.setSendingAccount)(e))}));return function(t){return e.apply(this,arguments)}}(),n.clearTransactions=function(){var e=(0,be.default)((function*(){(0,this.backgroundApi.dispatch)((0,xe.clearTransactions)())}));return function(){return e.apply(this,arguments)}}(),n.setQuote=function(){var e=(0,be.default)((function*(e){var t=this.backgroundApi.dispatch,r=[(0,Ee.setQuote)(e)];t.apply(void 0,r)}));return function(t){return e.apply(this,arguments)}}(),n.refreshParams=function(){var e=(0,be.default)((function*(e){var t=this.backgroundApi.appSelector((function(e){return e.swap.quote})),r=!1;this.prevParams&&(r=JSON.stringify(e)===JSON.stringify(this.prevParams)&&!!t);return this.prevParams=e,r}));return function(t){return e.apply(this,arguments)}}(),n.buildWrapperTransaction=function(){var e=(0,be.default)((function*(e){var t=(0,this.backgroundApi.appSelector)((function(e){return e.swapTransactions.wrapperTokens}));if(e&&t){var r=e.tokenIn,n=e.activeAccount,o=e.typedValue,i=e.tokenOut,a=e.receivingAddress,c=n.address.toLowerCase();if(r.networkId===i.networkId&&c.toLowerCase()===(null==a?void 0:a.toLowerCase())){var u=t[r.networkId];if(u)if(r.tokenIdOnNetwork){if(r.tokenIdOnNetwork.toLowerCase()===u.toLowerCase()&&!i.tokenIdOnNetwork)return{isWrapperTransaction:!0,encodedTx:yield Re.default.engine.buildEncodedTxFromWrapperTokenWithdraw({networkId:r.networkId,accountId:n.id,amount:o,contract:u}),type:"Withdraw"}}else if(i.tokenIdOnNetwork.toLowerCase()===u.toLowerCase())return{isWrapperTransaction:!0,encodedTx:yield Re.default.engine.buildEncodedTxFromWrapperTokenDeposit({networkId:r.networkId,accountId:n.id,amount:o,contract:u}),type:"Deposite"}}}}));return function(t){return e.apply(this,arguments)}}(),n.needToResetApproval=function(){var e=(0,be.default)((function*(e){var t=(0,this.backgroundApi.appSelector)((function(e){return e.swapTransactions.approvalIssueTokens}));return!!(null==t?void 0:t.find((function(t){return t.address.toLowerCase()===e.tokenIdOnNetwork&&t.networkId===e.networkId})))}));return function(t){return e.apply(this,arguments)}}(),n.setQuoteLimited=function(){var e=(0,be.default)((function*(e){(0,this.backgroundApi.dispatch)((0,Ee.setQuoteLimited)(e))}));return function(t){return e.apply(this,arguments)}}(),n.getSwapInputToken=function(){var e=(0,be.default)((function*(){return(0,this.backgroundApi.appSelector)((function(e){return e.swap.inputToken}))}));return function(){return e.apply(this,arguments)}}(),n.setRecipientByNetwork=function(){var e=(0,be.default)((function*(e){var t=this.backgroundApi,r=t.dispatch,n=t.appSelector,o=t.engine,i=n((function(e){return e.swap.recipient}));if(null!=i&&i.address&&i.networkImpl===e.impl)return i;var a=n((function(e){return e.runtime})),c=a.wallets,u=a.networks,s=n((function(e){return e.general})),d=s.activeNetworkId,p=s.activeWalletId,l=s.activeAccountId,f=c.find((function(e){return e.id===p})),y=u.find((function(e){return e.id===d}));if(f&&y){var h=yield o.getAccounts(f.accounts,e.id),v=e.impl===y.impl?h.find((function(e){return e.id===l})):h[0];if(v){var g,k=v.address;if((0,We.isLightningNetworkByNetworkId)(e.id))k=null!=(g=(yield this.backgroundApi.serviceLightningNetwork.batchGetLnUrlByAccounts({networkId:e.id,accounts:[v]}))[v.id])?g:v.address;var w={address:k,name:v.name,accountId:v.id,networkId:e.id,networkImpl:e.impl};return r((0,Ee.setRecipient)(w)),w}r((0,Ee.setRecipient)())}}));return function(t){return e.apply(this,arguments)}}(),n.setRecipientToAccount=function(e,t){var r=this.backgroundApi.dispatch,n={address:e.address,name:e.name,accountId:e.id,networkId:null==t?void 0:t.id,networkImpl:null==t?void 0:t.impl};r((0,Ee.setRecipient)(n))},n.refreshSendingAccount=function(){var e=(0,be.default)((function*(){var e=this.backgroundApi,t=e.appSelector,r=e.engine;if(null===t((function(e){return e.swap.sendingAccount}))){var n=t((function(e){return e.swap.inputToken}));if(n){var o=yield r.getNetwork(n.networkId);this.setSendingAccountByNetwork(o)}}}));return function(){return e.apply(this,arguments)}}(),n.handleAccountRemoved=function(){var e=(0,be.default)((function*(e){var t=this.backgroundApi,r=t.appSelector,n=t.dispatch,o=r((function(e){return e.swap.sendingAccount}));o&&o.id===e.id&&n((0,Ee.setSendingAccount)(void 0));var i=r((function(e){return e.swap.recipient}));i&&(null==i?void 0:i.accountId)===e.id&&n((0,Ee.setRecipient)(void 0))}));return function(t){return e.apply(this,arguments)}}(),n.handleWalletRemove=function(){var e=(0,be.default)((function*(e){if(e&&e.accounts.length>0){var t=this.backgroundApi,r=t.appSelector,n=t.dispatch,o=r((function(e){return e.swap.sendingAccount}));o&&e.accounts.includes(null==o?void 0:o.id)&&n((0,Ee.setSendingAccount)(void 0));var i=r((function(e){return e.swap.recipient}));i&&i.accountId&&e.accounts.includes(i.accountId)&&n((0,Ee.setRecipient)(void 0))}}));return function(t){return e.apply(this,arguments)}}(),n.setSendingAccountByNetwork=function(){var e=(0,be.default)((function*(e){if(e){var t=this.backgroundApi,r=t.dispatch,n=t.appSelector,o=t.engine,i=n((function(e){return e.swap.sendingAccount}));if(i&&(0,Ce.isAccountCompatibleWithNetwork)(i.id,e.id))return i;var a=n((function(e){return e.runtime.wallets})),c=n((function(e){return e.runtime.networks})),u=n((function(e){return e.general})),s=u.activeNetworkId,d=u.activeWalletId,p=u.activeAccountId,l=a.find((function(e){return e.id===d})),f=c.find((function(e){return e.id===s}));if(l&&f||(d&&(l=yield o.getWallet(d)),s&&(f=yield o.getNetwork(s)),l&&f))if("watching"!==l.type){var y=yield o.getAccounts(l.accounts,e.id),h=e.impl===f.impl?y.find((function(e){return e.id===p})):y[0];if(h){var v=qe(qe({},h),{},{impl:e.impl});return r((0,Ee.setSendingAccount)(v)),v}r((0,Ee.setSendingAccount)(null))}else r((0,Ee.setSendingAccount)(null))}}));return function(t){return e.apply(this,arguments)}}(),n.getRecipient=function(){var e=(0,be.default)((function*(){var e=this.backgroundApi.appSelector,t=e((function(e){return e.swap.recipient})),r=e((function(e){return e.swap.inputToken})),n=e((function(e){return e.swap.outputToken})),o=e((function(e){return e.swap.allowAnotherRecipientAddress}));if(r&&n){var i=(0,_e.recipientMustBeSendingAccount)(r,n,o),a=e((function(e){return e.swap.sendingAccount}));if(a&&i)return{accountId:a.id,address:a.address,name:a.name,networkId:r.networkId,networkImpl:r.impl}}return t}));return function(){return e.apply(this,arguments)}}(),n.getAccountRelatedWallet=function(){var e=(0,be.default)((function*(e){for(var t=(0,this.backgroundApi.appSelector)((function(e){return e.runtime.wallets})),r=0;r<t.length;r+=1){var n=t[r];if(n.accounts.includes(e))return n}}));return function(t){return e.apply(this,arguments)}}(),n.searchTokens=function(){var e=(0,be.default)((function*(e){var t=e.networkId,r=e.keyword,n=this.backgroundApi,o=n.engine,i=(0,n.appSelector)((function(e){return e.runtime.networks}));if(!r||!r.trim())return[];var a=r.trim(),c=yield o.searchTokens(t,a,1),u=i.map((function(e){return e.id}));return c.filter((function(e){return u.includes(e.networkId)}))}));return function(t){return e.apply(this,arguments)}}(),n.checkAccountInWallets=function(){var e=(0,be.default)((function*(e){for(var t=(0,this.backgroundApi.appSelector)((function(e){return e.runtime.wallets})),r=0;r<t.length;r+=1){if(t[r].accounts.includes(e))return!0}return!1}));return function(t){return e.apply(this,arguments)}}(),n.initSwap=function(){var e=(0,be.default)((function*(){var e=this.backgroundApi,t=e.appSelector,r=e.dispatch;t((function(e){return e.swapTransactions.slippage}))||r((0,xe.setSlippage)({mode:"auto"}))}));return function(){return e.apply(this,arguments)}}(),n.getSwapConfig=function(){var e=(0,be.default)((function*(){var e=`${yield this.getServerEndPoint()}/swap/config`,t=(yield this.client.get(e)).data;return this.initSwapConfig(t)}));return function(){return e.apply(this,arguments)}}(),n.initSwapConfig=function(){var e=(0,be.default)((function*(e){var t=this.backgroundApi.dispatch,r=[];if(e){var n=e.tokens,o=e.coingeckoIds,i=e.recommendedSlippage,a=e.approvalIssueTokens,c=e.wrapperTokens,u=e.payments,s=e.retainedValues;if(n&&n&&Array.isArray(n)){var d=n.map((function(e){return qe(qe({},e),{},{tokens:e.tokens.map((function(e){return(0,Ne.formatServerToken)(e)}))})}));r.push((0,xe.updateTokenList)(d))}if(o){var p={};o.popular&&Array.isArray(o.popular)&&(p.popular=o.popular),o.stable&&Array.isArray(o.stable)&&(p.stable=o.stable),r.push((0,xe.setCoingeckoIds)(p))}if(i&&r.push((0,xe.setRecommendedSlippage)(i)),a&&Array.isArray(a)&&a.length>0&&r.push((0,xe.setApprovalIssueTokens)(a)),c&&Array.isArray(c)&&c.length>0){var l=c.reduce((function(e,t){return e[t.networkId]=t.address,e}),{});r.push((0,xe.setWrapperTokens)(l))}if(u){var f=u.list,y=Object.entries(f);if(y&&Array.isArray(y)&&y.length>0){var h=y.reduce((function(e,t){var r=(0,ke.default)(t,2),n=r[0],o=r[1];return e[n]=(0,Ne.formatServerToken)(o),e}),{});r.push((0,xe.setPayments)(h))}var v=u.fallback;v&&r.push((0,xe.setDefaultPayment)((0,Ne.formatServerToken)(v)))}s&&r.push((0,xe.setReservedNetworkFees)(s)),r.length>0&&t.apply(void 0,r)}}));return function(t){return e.apply(this,arguments)}}(),n.getReservedNetworkFee=function(){var e=(0,be.default)((function*(e){var t,r,n=this.backgroundApi,o=n.appSelector,i=n.dispatch,a=`${yield this.getServerEndPoint()}/swap/minimum_gas`,c=o((function(e){return e.swapTransactions.reservedNetworkFees}));try{var u=(yield this.client.get(a)).data;u&&(i((0,xe.setReservedNetworkFees)(u)),c=u)}catch(s){Ue.default.swap.error("failed to fetch minimum network gas")}return null!=(t=null==(r=c)?void 0:r[e])?t:"0.01"}));return function(t){return e.apply(this,arguments)}}(),n.getBasicGasFeeWithTimeout=function(){var e=(0,be.default)((function*(e){var t=this,r=this.backgroundApi,n=r.appSelector,o=r.engine,i=yield new Promise((function(r){t.getReservedNetworkFee(e).then(r),setTimeout((function(){var t=n((function(e){return e.swapTransactions.reservedNetworkFees})),o=null==t?void 0:t[e];o&&r(o)}),500)})),a=yield o.getNetwork(e);return(0,_e.formatAmount)(i,a.decimals,Se().ROUND_CEIL)}));return function(t){return e.apply(this,arguments)}}(),n.getSwapTokens=function(){var e=(0,be.default)((function*(){var e=this.backgroundApi.dispatch,t=`${yield this.getServerEndPoint()}/swap/tokens`,r=(yield this.client.get(t)).data;if(r&&Array.isArray(r)){var n=r.map((function(e){return qe(qe({},e),{},{tokens:e.tokens.map((function(e){return(0,Ne.formatServerToken)(e)}))})}));e((0,xe.updateTokenList)(n))}}));return function(){return e.apply(this,arguments)}}(),n.setShowMoreQuoteDetail=function(){var e=(0,be.default)((function*(e){(0,this.backgroundApi.dispatch)((0,Ee.setShowMoreQuoteDetail)(e))}));return function(t){return e.apply(this,arguments)}}(),n.recipientIsUnknown=function(){var e=(0,be.default)((function*(e){if(!e)return!1;if(!e.accountId)return!0;var t=(0,this.backgroundApi.appSelector)((function(e){return e.runtime.wallets})).find((function(e){return"watching"===e.type}));return!!t&&t.accounts.includes(e.accountId)}));return function(t){return e.apply(this,arguments)}}(),n.getPaymentToken=function(){var e=(0,be.default)((function*(e){var t,r=this.backgroundApi.appSelector,n=r((function(e){return e.swapTransactions.payments})),o=r((function(e){return e.swapTransactions.defaultPayment})),i=e.networkId;return null!=(t=null==n?void 0:n[i])?t:o}));return function(t){return e.apply(this,arguments)}}(),n.tokenIsSupported=function(){var e=(0,be.default)((function*(e){var t=(0,this.backgroundApi.appSelector)((function(e){return e.swapTransactions.tokenList})),r=null!=t?t:[],n=null==r?void 0:r.map((function(e){return e.networkId})).filter((function(e){return"All"!==e})),o=r.find((function(e){return"All"===e.networkId}));return null!=o&&o.tokens&&(n=n.concat(o.tokens.map((function(e){return e.networkId})))),new Set(n).has(e.networkId)}));return function(t){return e.apply(this,arguments)}}(),n.buyToken=function(){var e=(0,be.default)((function*(e){var t=this.backgroundApi,r=t.engine,n=t.appSelector,o=t.dispatch;"swap"!==n((function(e){return e.swap.mode}))&&o((0,Ee.setMode)("swap"));var i=yield this.getPaymentToken(e);if(this.clearState(),yield this.setOutputToken(e),i)if((0,_e.tokenEqual)(e,i)){var a=yield r.getNativeTokenInfo(e.networkId);this.setInputToken(a)}else this.setInputToken(i)}));return function(t){return e.apply(this,arguments)}}(),n.sellToken=function(){var e=(0,be.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.backgroundApi,n=r.engine,o=r.appSelector,i=r.dispatch;"swap"!==o((function(e){return e.swap.mode}))&&i((0,Ee.setMode)("swap"));var a=yield this.getPaymentToken(e);if(this.clearState(),yield this.setInputToken(e),a&&t)if((0,_e.tokenEqual)(e,a)){var c=yield n.getNativeTokenInfo(e.networkId);this.setOutputToken(c)}else this.setOutputToken(a)}));return function(t){return e.apply(this,arguments)}}(),n.setSwapWelcomeShown=function(){var e=(0,be.default)((function*(e){De.default.setting.setSwapWelcomeShown(e)}));return function(t){return e.apply(this,arguments)}}(),n.getSwapWelcomeShown=function(){var e=(0,be.default)((function*(){return De.default.setting.getSwapWelcomeShown()}));return function(){return e.apply(this,arguments)}}(),n.setSwapReceivingUnknownShown=function(){var e=(0,be.default)((function*(e){De.default.setting.setSwapReceivingUnknownShown(e)}));return function(t){return e.apply(this,arguments)}}(),n.getSwapReceivingUnknownShown=function(){var e=(0,be.default)((function*(){return De.default.setting.getSwapReceivingUnknownShown()}));return function(){return e.apply(this,arguments)}}(),n.getSwapReceivingIsNotSendingAccountShown=function(){var e=(0,be.default)((function*(){return De.default.setting.getSwapReceivingIsNotSendingAccountShown()}));return function(){return e.apply(this,arguments)}}(),n.setSwapReceivingIsNotSendingAccountShown=function(){var e=(0,be.default)((function*(e){return De.default.setting.setSwapReceivingIsNotSendingAccountShown(e)}));return function(t){return e.apply(this,arguments)}}(),n.getSwapPriceImpactShown=function(){var e=(0,be.default)((function*(){return De.default.setting.getSwapPriceImpactShown()}));return function(){return e.apply(this,arguments)}}(),n.setSwapPriceImpactShown=function(){var e=(0,be.default)((function*(e){return De.default.setting.setSwapPriceImpactShown(e)}));return function(t){return e.apply(this,arguments)}}(),n.setSwapChartMode=function(){var e=(0,be.default)((function*(e){return this.backgroundApi.dispatch((0,xe.setSwapChartMode)(e))}));return function(t){return e.apply(this,arguments)}}(),n.setSwapFeePresetIndex=function(){var e=(0,be.default)((function*(e){return this.backgroundApi.dispatch((0,xe.setSwapFeePresetIndex)(e))}));return function(t){return e.apply(this,arguments)}}(),n.getSwapFeePresetIndex=function(){var e=(0,be.default)((function*(){return this.backgroundApi.appSelector((function(e){return e.swapTransactions.swapFeePresetIndex}))}));return function(){return e.apply(this,arguments)}}(),n.setUserSelectedQuoter=function(){var e=(0,be.default)((function*(e,t){return this.backgroundApi.dispatch((0,Ee.setUserSelectedQuoter)({hash:e,type:t}))}));return function(t,r){return e.apply(this,arguments)}}(),n.clearUserSelectedQuoter=function(){var e=(0,be.default)((function*(){return this.backgroundApi.dispatch((0,Ee.clearUserSelectedQuoter)())}));return function(){return e.apply(this,arguments)}}(),n.getCurrentUserSelectedQuoter=function(){var e=(0,be.default)((function*(){var e=this.backgroundApi.appSelector,t=e((function(e){return e.swap.userSelectedQuoter}));if(t){var r=e((function(e){return e.swap.inputToken})),n=e((function(e){return e.swap.outputToken})),o=(0,_e.stringifyTokens)(r,n);if(o)return t[o]}}));return function(){return e.apply(this,arguments)}}(),n.sendTransaction=function(){var e=(0,be.default)((function*(e){var t=e.accountId,r=e.networkId,n=e.encodedTx,o=e.payload,i=e.autoFallback,a=e.prepaidFee,c=this.backgroundApi,u=c.appSelector,s=c.serviceTransaction,d=u((function(e){return e.swapTransactions.swapFeePresetIndex}));return s.sendTransaction({accountId:t,networkId:r,encodedTx:n,payload:o,feePresetIndex:d,autoFallback:i,prepaidFee:a})}));return function(t){return e.apply(this,arguments)}}(),n.getSwapError=function(){var e=(0,be.default)((function*(){return(0,this.backgroundApi.appSelector)((function(e){return e.swap.error}))}));return function(){return e.apply(this,arguments)}}(),n.getCurrentSwapSlippageStatus=function(){var e=(0,be.default)((function*(){var e=this.backgroundApi.appSelector,t=e((function(e){return e.swap.inputToken})),r=e((function(e){return e.swap.outputToken})),n=e((function(e){return e.swapTransactions.slippage})),o=e((function(e){return e.swapTransactions.recommendedSlippage})),i=e((function(e){return e.swapTransactions.coingeckoIds})),a="1",c=function(e){if(!i||!o||!e)return a;var t=o.popular,r=o.stable,n=o.others,c=i.popular,u=i.stable;return u&&u.includes(e)?r||a:c&&c.includes(e)?t||a:n||a},u=!n||"auto"===n.mode,s=a;if(u){if(t&&r){var d=c(t.coingeckoId),p=c(r.coingeckoId);s=Number(d)>Number(p)?d:p}}else n.value&&(s=n.value);return s||a}));return function(){return e.apply(this,arguments)}}(),n.fetchSwapTokenBalance=function(){var e=(0,be.default)((function*(e){var t,r,n,o=e.networkId,i=e.accountId;if(o&&i&&(0,Ce.isAccountCompatibleWithNetwork)(i,o)){var a=this.backgroundApi.appSelector,c=a((function(e){return e.swapTransactions.tokenList}));if(c){var u=c.find((function(e){return e.networkId===o})),s=null!=(t=null==u?void 0:u.tokens)?t:[],d=a((function(e){return e.tokens.accountTokens})),p=null!=(r=null==d||null==(n=d[o])?void 0:n[i])?r:[],l=[].concat((0,ge.default)(s),(0,ge.default)(p)),f=new Set;l=l.filter((function(e){return!f.has(e.tokenIdOnNetwork)&&(f.add(e.tokenIdOnNetwork),!0)})),this.backgroundApi.serviceToken.fetchAndSaveAccountTokenBalance({accountId:i,networkId:o,tokenIds:l.map((function(e){return e.tokenIdOnNetwork}))})}}}));return function(t){return e.apply(this,arguments)}}(),n.resetSwapSlippage=function(){var e=this.backgroundApi,t=e.appSelector,r=e.dispatch,n=t((function(e){return e.swapTransactions.slippage}));n&&n.autoReset&&r((0,xe.setSlippage)({mode:"auto"}))},n.addRecord=function(){var e=(0,be.default)((function*(e){var t=`${yield this.getServerEndPoint()}/swap/add_record`,r=e.params,n=e.response,o=e.txid,i=e.from,a=e.to,c=(0,_e.convertBuildParams)(r),u=n.result,s=n.attachment,d=n.requestId;return this.client.post(t,{params:c,txid:o,from:i,to:a,requestId:d,result:u,attachment:s})}));return function(t){return e.apply(this,arguments)}}(),n.refreshSelectedTokenPrice=function(){var e=(0,be.default)((function*(){var e,t,r,n,o,i,a=this.backgroundApi,c=a.appSelector,u=a.servicePrice,s=c((function(e){var t;return null!=(t=e.swap)?t:{}})),d=s.inputToken,p=s.inputTokenNetwork,l=s.outputToken,f=s.outputTokenNetwork,y=c((function(e){return e.general.activeNetworkId})),h=null!=(e=null!=(t=null==p?void 0:p.id)?t:null==d?void 0:d.networkId)?e:"",v=null!=(r=null!=(n=null==f?void 0:f.id)?n:null==l?void 0:l.networkId)?r:"";h!==y&&(yield u.getSimpleTokenPrice({networkId:h,tokenId:null!=(o=null==d?void 0:d.tokenIdOnNetwork)?o:""}));v!==y&&(yield u.getSimpleTokenPrice({networkId:v,tokenId:null!=(i=null==l?void 0:l.tokenIdOnNetwork)?i:""}))}));return function(){return e.apply(this,arguments)}}(),n.switchToNativeOutputToken=function(){var e=(0,be.default)((function*(e){var t=yield this.backgroundApi.engine.getNativeTokenInfo(e);t&&this.setOutputToken(t)}));return function(t){return e.apply(this,arguments)}}(),n.setNativInputAndOutputToken=function(){var e=(0,be.default)((function*(e,t){var r=this.backgroundApi,n=r.engine,o=r.appSelector,i=r.dispatch,a=o((function(e){return e.swap.mode})),c=yield n.getNativeTokenInfo(e),u=yield n.getNativeTokenInfo(t);yield this.setInputToken(c),yield this.setOutputToken(u),"swap"!==a&&i((0,Ee.setMode)("swap"))}));return function(t,r){return e.apply(this,arguments)}}(),(0,me.default)(r)}(He.default),(0,Pe.default)(ve.prototype,"registerEvents",[o],Object.getOwnPropertyDescriptor(ve.prototype,"registerEvents"),ve.prototype),(0,Pe.default)(ve.prototype,"getServerEndPoint",[i],Object.getOwnPropertyDescriptor(ve.prototype,"getServerEndPoint"),ve.prototype),(0,Pe.default)(ve.prototype,"getSwftcCoins",[a],Object.getOwnPropertyDescriptor(ve.prototype,"getSwftcCoins"),ve.prototype),(0,Pe.default)(ve.prototype,"setSwftcCoins",[c],Object.getOwnPropertyDescriptor(ve.prototype,"setSwftcCoins"),ve.prototype),(0,Pe.default)(ve.prototype,"selectToken",[u],Object.getOwnPropertyDescriptor(ve.prototype,"selectToken"),ve.prototype),(0,Pe.default)(ve.prototype,"setDefaultInputToken",[s],Object.getOwnPropertyDescriptor(ve.prototype,"setDefaultInputToken"),ve.prototype),(0,Pe.default)(ve.prototype,"setInputToken",[d],Object.getOwnPropertyDescriptor(ve.prototype,"setInputToken"),ve.prototype),(0,Pe.default)(ve.prototype,"setOutputToken",[p],Object.getOwnPropertyDescriptor(ve.prototype,"setOutputToken"),ve.prototype),(0,Pe.default)(ve.prototype,"switchTokens",[l],Object.getOwnPropertyDescriptor(ve.prototype,"switchTokens"),ve.prototype),(0,Pe.default)(ve.prototype,"resetState",[f],Object.getOwnPropertyDescriptor(ve.prototype,"resetState"),ve.prototype),(0,Pe.default)(ve.prototype,"userInput",[y],Object.getOwnPropertyDescriptor(ve.prototype,"userInput"),ve.prototype),(0,Pe.default)(ve.prototype,"resetTypedValue",[h],Object.getOwnPropertyDescriptor(ve.prototype,"resetTypedValue"),ve.prototype),(0,Pe.default)(ve.prototype,"clearState",[v],Object.getOwnPropertyDescriptor(ve.prototype,"clearState"),ve.prototype),(0,Pe.default)(ve.prototype,"setSendingAccountSimple",[g],Object.getOwnPropertyDescriptor(ve.prototype,"setSendingAccountSimple"),ve.prototype),(0,Pe.default)(ve.prototype,"clearTransactions",[k],Object.getOwnPropertyDescriptor(ve.prototype,"clearTransactions"),ve.prototype),(0,Pe.default)(ve.prototype,"setQuote",[w],Object.getOwnPropertyDescriptor(ve.prototype,"setQuote"),ve.prototype),(0,Pe.default)(ve.prototype,"refreshParams",[b],Object.getOwnPropertyDescriptor(ve.prototype,"refreshParams"),ve.prototype),(0,Pe.default)(ve.prototype,"buildWrapperTransaction",[m],Object.getOwnPropertyDescriptor(ve.prototype,"buildWrapperTransaction"),ve.prototype),(0,Pe.default)(ve.prototype,"needToResetApproval",[A],Object.getOwnPropertyDescriptor(ve.prototype,"needToResetApproval"),ve.prototype),(0,Pe.default)(ve.prototype,"setQuoteLimited",[O],Object.getOwnPropertyDescriptor(ve.prototype,"setQuoteLimited"),ve.prototype),(0,Pe.default)(ve.prototype,"getSwapInputToken",[I],Object.getOwnPropertyDescriptor(ve.prototype,"getSwapInputToken"),ve.prototype),(0,Pe.default)(ve.prototype,"setRecipientByNetwork",[P],Object.getOwnPropertyDescriptor(ve.prototype,"setRecipientByNetwork"),ve.prototype),(0,Pe.default)(ve.prototype,"setRecipientToAccount",[T],Object.getOwnPropertyDescriptor(ve.prototype,"setRecipientToAccount"),ve.prototype),(0,Pe.default)(ve.prototype,"refreshSendingAccount",[S],Object.getOwnPropertyDescriptor(ve.prototype,"refreshSendingAccount"),ve.prototype),(0,Pe.default)(ve.prototype,"handleAccountRemoved",[D],Object.getOwnPropertyDescriptor(ve.prototype,"handleAccountRemoved"),ve.prototype),(0,Pe.default)(ve.prototype,"handleWalletRemove",[M],Object.getOwnPropertyDescriptor(ve.prototype,"handleWalletRemove"),ve.prototype),(0,Pe.default)(ve.prototype,"setSendingAccountByNetwork",[C],Object.getOwnPropertyDescriptor(ve.prototype,"setSendingAccountByNetwork"),ve.prototype),(0,Pe.default)(ve.prototype,"getRecipient",[N],Object.getOwnPropertyDescriptor(ve.prototype,"getRecipient"),ve.prototype),(0,Pe.default)(ve.prototype,"getAccountRelatedWallet",[R],Object.getOwnPropertyDescriptor(ve.prototype,"getAccountRelatedWallet"),ve.prototype),(0,Pe.default)(ve.prototype,"searchTokens",[j],Object.getOwnPropertyDescriptor(ve.prototype,"searchTokens"),ve.prototype),(0,Pe.default)(ve.prototype,"checkAccountInWallets",[E],Object.getOwnPropertyDescriptor(ve.prototype,"checkAccountInWallets"),ve.prototype),(0,Pe.default)(ve.prototype,"initSwap",[x],Object.getOwnPropertyDescriptor(ve.prototype,"initSwap"),ve.prototype),(0,Pe.default)(ve.prototype,"getSwapConfig",[_],Object.getOwnPropertyDescriptor(ve.prototype,"getSwapConfig"),ve.prototype),(0,Pe.default)(ve.prototype,"initSwapConfig",[B],Object.getOwnPropertyDescriptor(ve.prototype,"initSwapConfig"),ve.prototype),(0,Pe.default)(ve.prototype,"getBasicGasFeeWithTimeout",[F],Object.getOwnPropertyDescriptor(ve.prototype,"getBasicGasFeeWithTimeout"),ve.prototype),(0,Pe.default)(ve.prototype,"getSwapTokens",[W],Object.getOwnPropertyDescriptor(ve.prototype,"getSwapTokens"),ve.prototype),(0,Pe.default)(ve.prototype,"setShowMoreQuoteDetail",[L],Object.getOwnPropertyDescriptor(ve.prototype,"setShowMoreQuoteDetail"),ve.prototype),(0,Pe.default)(ve.prototype,"recipientIsUnknown",[U],Object.getOwnPropertyDescriptor(ve.prototype,"recipientIsUnknown"),ve.prototype),(0,Pe.default)(ve.prototype,"getPaymentToken",[H],Object.getOwnPropertyDescriptor(ve.prototype,"getPaymentToken"),ve.prototype),(0,Pe.default)(ve.prototype,"tokenIsSupported",[V],Object.getOwnPropertyDescriptor(ve.prototype,"tokenIsSupported"),ve.prototype),(0,Pe.default)(ve.prototype,"buyToken",[q],Object.getOwnPropertyDescriptor(ve.prototype,"buyToken"),ve.prototype),(0,Pe.default)(ve.prototype,"sellToken",[K],Object.getOwnPropertyDescriptor(ve.prototype,"sellToken"),ve.prototype),(0,Pe.default)(ve.prototype,"setSwapWelcomeShown",[$],Object.getOwnPropertyDescriptor(ve.prototype,"setSwapWelcomeShown"),ve.prototype),(0,Pe.default)(ve.prototype,"getSwapWelcomeShown",[G],Object.getOwnPropertyDescriptor(ve.prototype,"getSwapWelcomeShown"),ve.prototype),(0,Pe.default)(ve.prototype,"setSwapReceivingUnknownShown",[z],Object.getOwnPropertyDescriptor(ve.prototype,"setSwapReceivingUnknownShown"),ve.prototype),(0,Pe.default)(ve.prototype,"getSwapReceivingUnknownShown",[J],Object.getOwnPropertyDescriptor(ve.prototype,"getSwapReceivingUnknownShown"),ve.prototype),(0,Pe.default)(ve.prototype,"getSwapReceivingIsNotSendingAccountShown",[Q],Object.getOwnPropertyDescriptor(ve.prototype,"getSwapReceivingIsNotSendingAccountShown"),ve.prototype),(0,Pe.default)(ve.prototype,"setSwapReceivingIsNotSendingAccountShown",[X],Object.getOwnPropertyDescriptor(ve.prototype,"setSwapReceivingIsNotSendingAccountShown"),ve.prototype),(0,Pe.default)(ve.prototype,"getSwapPriceImpactShown",[Y],Object.getOwnPropertyDescriptor(ve.prototype,"getSwapPriceImpactShown"),ve.prototype),(0,Pe.default)(ve.prototype,"setSwapPriceImpactShown",[Z],Object.getOwnPropertyDescriptor(ve.prototype,"setSwapPriceImpactShown"),ve.prototype),(0,Pe.default)(ve.prototype,"setSwapChartMode",[ee],Object.getOwnPropertyDescriptor(ve.prototype,"setSwapChartMode"),ve.prototype),(0,Pe.default)(ve.prototype,"setSwapFeePresetIndex",[te],Object.getOwnPropertyDescriptor(ve.prototype,"setSwapFeePresetIndex"),ve.prototype),(0,Pe.default)(ve.prototype,"getSwapFeePresetIndex",[re],Object.getOwnPropertyDescriptor(ve.prototype,"getSwapFeePresetIndex"),ve.prototype),(0,Pe.default)(ve.prototype,"setUserSelectedQuoter",[ne],Object.getOwnPropertyDescriptor(ve.prototype,"setUserSelectedQuoter"),ve.prototype),(0,Pe.default)(ve.prototype,"clearUserSelectedQuoter",[oe],Object.getOwnPropertyDescriptor(ve.prototype,"clearUserSelectedQuoter"),ve.prototype),(0,Pe.default)(ve.prototype,"getCurrentUserSelectedQuoter",[ie],Object.getOwnPropertyDescriptor(ve.prototype,"getCurrentUserSelectedQuoter"),ve.prototype),(0,Pe.default)(ve.prototype,"sendTransaction",[ae],Object.getOwnPropertyDescriptor(ve.prototype,"sendTransaction"),ve.prototype),(0,Pe.default)(ve.prototype,"getSwapError",[ce],Object.getOwnPropertyDescriptor(ve.prototype,"getSwapError"),ve.prototype),(0,Pe.default)(ve.prototype,"getCurrentSwapSlippageStatus",[ue],Object.getOwnPropertyDescriptor(ve.prototype,"getCurrentSwapSlippageStatus"),ve.prototype),(0,Pe.default)(ve.prototype,"fetchSwapTokenBalance",[se],Object.getOwnPropertyDescriptor(ve.prototype,"fetchSwapTokenBalance"),ve.prototype),(0,Pe.default)(ve.prototype,"resetSwapSlippage",[de],Object.getOwnPropertyDescriptor(ve.prototype,"resetSwapSlippage"),ve.prototype),(0,Pe.default)(ve.prototype,"addRecord",[pe],Object.getOwnPropertyDescriptor(ve.prototype,"addRecord"),ve.prototype),(0,Pe.default)(ve.prototype,"refreshSelectedTokenPrice",[le],Object.getOwnPropertyDescriptor(ve.prototype,"refreshSelectedTokenPrice"),ve.prototype),(0,Pe.default)(ve.prototype,"switchToNativeOutputToken",[fe],Object.getOwnPropertyDescriptor(ve.prototype,"switchToNativeOutputToken"),ve.prototype),(0,Pe.default)(ve.prototype,"setNativInputAndOutputToken",[ye],Object.getOwnPropertyDescriptor(ve.prototype,"setNativInputAndOutputToken"),ve.prototype),he=ve))||he)},281668:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Se});var n,o,i,a,c,u,s,d,p,l,f,y,h,v,g,k,w,b,m,A,O,I,P,T,S,D,M,C,N,R,j=r(459740),E=r(545455),x=r.n(E),_=r(862349),B=r.n(_),F=r(475652),W=r.n(F),L=r(798783),U=r.n(L),H=r(256666),V=r(196234),q=r(968079),K=r(634795),$=r(254073),G=r.n($),z=r(887371),J=r(545754),Q=r(411987),X=r(695058),Y=r(859375),Z=r(206391),ee=r.n(Z),te=r(682053),re=r(992431),ne=r(534756),oe=r(849472),ie=r(849877),ae=r(134662),ce=r(398145),ue=r(506885),se=r(135463),de=r(195212),pe=r(480601),le=r(90184),fe=r(776553),ye=r(490415),he=r(438760),ve=r(402814),ge=r(613549),ke=r(35116),we=r(292147),be=r(213208),me=r(396564),Ae=r(201882),Oe=["accountId","networkId"];function Ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(r),!0).forEach((function(t){(0,H.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Te(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,X.default)(e);if(t){var o=(0,X.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Q.default)(this,r)}}var Se=(n=(0,he.backgroundClass)(),o=(0,he.bindThis)(),i=(0,he.backgroundMethod)(),a=(0,he.bindThis)(),c=(0,he.backgroundMethod)(),u=(0,he.backgroundMethod)(),s=(0,he.bindThis)(),d=(0,he.backgroundMethod)(),p=(0,he.backgroundMethod)(),l=(0,he.bindThis)(),f=(0,he.backgroundMethod)(),y=(0,he.backgroundMethod)(),h=(0,he.backgroundMethod)(),v=(0,he.backgroundMethod)(),g=(0,he.backgroundMethod)(),k=(0,he.backgroundMethod)(),w=(0,he.backgroundMethod)(),b=(0,he.backgroundMethod)(),m=(0,he.backgroundMethod)(),A=(0,he.backgroundMethod)(),O=(0,he.backgroundMethod)(),I=(0,he.backgroundMethod)(),P=(0,he.backgroundMethod)(),T=(0,he.backgroundMethod)(),S=(0,he.backgroundMethod)(),D=(0,he.backgroundMethod)(),M=(0,he.backgroundMethod)(),C=(0,he.backgroundMethod)(),n((R=function(e){(0,J.default)(r,e);var t=Te(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).intervalPaused=!0,e._startRefreshAccountTokensDebounced=G()(e.startRefreshAccountTokens,1e3,{leading:!0,trailing:!1}),e._refreshTokenBalanceWithMemo=(0,me.memoizee)(function(){var t=(0,K.default)((function*(t){var r,n,o=t.accountId,i=t.networkId,a=t.forceReloadTokens,c=void 0!==a&&a,u=t.includeTop50TokensQuery,s=void 0!==u&&u,d=t.refreshHomeOverviewTs,p=void 0===d||d,l=t.simpleRefreshBalanceOnly,f=void 0!==l&&l,y=e.backgroundApi,h=y.engine,v=y.dispatch,g=y.servicePrice,k=(0,y.appSelector)((function(e){var t,r,n;return null!=(t=null==(r=e.tokens.accountTokens)||null==(n=r[i])?void 0:n[o])?t:[]})).filter((function(e){return!e.autoDetected})),w=yield h.getTokens(i,o,!0,!0,c);null!=k&&k.length?(n=w).push.apply(n,(0,q.default)(k)):v((0,le.setAccountTokens)({accountId:o,networkId:i,tokens:w}));try{var b,m=yield e.fetchAndSaveAccountTokenBalance({accountId:o,networkId:i,tokenIds:w.map((function(e){return e.tokenIdOnNetwork})),withMain:!0,includeTop50TokensQuery:s}),A=(0,V.default)(m,2)[1],O=void 0===A?[]:A;if(O.length)(b=w).push.apply(b,(0,q.default)(O))}catch(S){return we.default.common.error("fetchAccountTokens error",S),w}if(f)return w;g.fetchSimpleTokenPrice({networkId:i,accountId:o,tokenIds:w.map((function(e){return e.tokenIdOnNetwork}))});var I=yield h.getVault({accountId:o,networkId:i});w=yield Promise.all(w.map(function(){var e=(0,K.default)((function*(e){var t,r=null!=(t=e.address)?t:e.tokenIdOnNetwork;if(r)try{r=yield I.validateTokenAddress(r)}catch(n){we.default.common.error("validateTokenAddress error",n)}return Pe(Pe({},e),{},{address:r,tokenIdOnNetwork:r})}));return function(t){return e.apply(this,arguments)}}()));var P=yield re.default.token.localTokens.getRemovedTokens(o,i);w=w.filter((function(e){var t;return!P.includes(null!=(t=e.address)?t:"")}));var T=[(0,le.setAccountTokens)({accountId:o,networkId:i,tokens:[].concat((0,q.default)(null!=(r=null==k?void 0:k.filter((function(e){return w.find((function(t){return t.address!==e.address}))})))?r:[]),(0,q.default)(w))})];return p&&T.push((0,pe.updateRefreshHomeOverviewTs)([ye.EOverviewScanTaskType.token])),v.apply(void 0,T),w}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,primitive:!0,max:50,maxAge:(0,fe.getTimeDurationMs)({seconds:1}),normalizer:function(e){var t=(0,V.default)(e,1)[0];return`${t.accountId}-${t.networkId}`}}),e.batchFetchAccountBalancesDebounce=G()(e._batchFetchAccountTokenBalances,600,{leading:!1,trailing:!0}),e._getTokenRiskyItemsWithMemo=(0,me.memoizee)(oe.getTokenRiskyItems,{promise:!0,primitive:!0,max:500,maxAge:(0,fe.getTimeDurationMs)({day:1})}),e}var n=r.prototype;return n.registerEvents=function(){var e=this;ke.appEventBus.on(ke.AppEventBusNames.NetworkChanged,(function(){e.refreshAccountTokens({includeTop50TokensQuery:!0})})),ke.appEventBus.on(ke.AppEventBusNames.AccountChanged,(function(){e.refreshAccountTokens({includeTop50TokensQuery:!0})})),be.isExtensionBackground&&chrome.runtime.onConnect.addListener((function(t){t.onDisconnect.addListener((function(){e.stopRefreshAccountTokens()}))}))},n.refreshAccountTokens=function(){var e=(0,K.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.backgroundApi,r=t.appSelector,n=t.dispatch,o=r((function(e){return e.general})),i=o.activeNetworkId,a=o.activeAccountId;if(i&&a)try{return n((0,pe.setOverviewHomeTokensLoading)(!0)),yield this.fetchAccountTokens(Pe(Pe({},e),{},{accountId:a,networkId:i,refreshHomeOverviewTs:!0}))}finally{n((0,pe.setOverviewHomeTokensLoading)(!1))}}));return function(){return e.apply(this,arguments)}}(),n.startRefreshAccountTokens=function(){var e=(0,K.default)((function*(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).runAtStart,r=void 0===t||t;if(we.default.common.info("startRefreshAccountTokens"),this.intervalPaused=!1,!this.interval){var n=(0,this.backgroundApi.appSelector)((function(e){return e.general})).activeWalletId===ue.WALLET_TYPE_WATCHING?(0,fe.getTimeDurationMs)({minute:1}):(0,fe.getTimeDurationMs)({seconds:15}),o=function(){e.intervalPaused||e.refreshAccountTokens({includeTop50TokensQuery:!1})};r&&o(),this.interval=setInterval(o,n)}}));return function(){return e.apply(this,arguments)}}(),n.startRefreshAccountTokensDebounced=function(){var e=(0,K.default)((function*(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).runAtStart,t=void 0===e||e;return this._startRefreshAccountTokensDebounced({runAtStart:t})}));return function(){return e.apply(this,arguments)}}(),n.stopRefreshAccountTokens=function(){var e=(0,K.default)((function*(){clearInterval(this.interval),this.interval=null,this.intervalPaused=!0,we.default.common.info("stopRefreshAccountTokens")}));return function(){return e.apply(this,arguments)}}(),n.pauseRefreshAccountTokens=function(){var e=(0,K.default)((function*(){return this.intervalPaused=!0,we.default.common.info("pauseRefreshAccountTokens"),Promise.resolve()}));return function(){return e.apply(this,arguments)}}(),n.fetchAccountTokens=function(){var e=(0,K.default)((function*(e){var t=e.accountId,r=e.networkId;return t&&r&&(0,ne.isAccountCompatibleWithNetwork)(t,r)?(0,ie.isAllNetworks)(r)?[]:this._refreshTokenBalanceWithMemo(e):[]}));return function(t){return e.apply(this,arguments)}}(),n._batchFetchAccountTokenBalances=function(){var e=(0,K.default)((function*(e){var t,r,n,o,i=e.walletId,a=e.networkId,c=e.accountIds,u=e.tokenAddress,s=this.backgroundApi,d=s.dispatch,p=s.engine,l=s.servicePassword,f=yield p.getWalletOnlyVault(a,i),y=yield p.getVaultSettings(a),h=yield p.dbApi.getNetwork(a),v=yield p.dbApi.getAccounts(c);u&&(t=yield p.findToken({networkId:a,tokenIdOnNetwork:u})),y.validationRequired&&(n=yield l.getPassword(),o=function(e){return d((0,de.setIsPasswordLoadedInVault)(e))});try{var g=yield Promise.all(v.map(function(){var e=(0,K.default)((function*(e){return e.type===ce.AccountType.UTXO||(0,ge.isLightningNetwork)(e.coinType)?{address:yield f.getFetchBalanceAddress(e),accountId:e.id}:e.type===ce.AccountType.VARIANT?{address:yield f.addressFromBase(e),accountId:e.id}:{address:e.address,accountId:e.id}}));return function(t){return e.apply(this,arguments)}}())),k=g.map((function(e){return{address:e.address,tokenAddress:u,accountId:e.accountId}}));r=yield f.getBalances(k,n,o)}catch(m){r=v.map((function(){}))}var w=v.reduce((function(e,n,o){var i,a,c=r[o];return e[n.id]=c?c.div(new(ee())(10).pow(null!=(i=null==(a=t)?void 0:a.decimals)?i:h.decimals)).toFixed():void 0,e}),{}),b=[];return Object.entries(w).forEach((function(e){var t,r=(0,V.default)(e,2),n=r[0],o=r[1];"undefined"===typeof o||Number.isNaN(o)||b.push((0,le.setAccountTokensBalances)({accountId:n,networkId:a,tokensBalance:u?(t={},t[u]={balance:null!=o?o:"0"},t):{main:{balance:null!=o?o:"0"}}}))})),b.length>0&&d.apply(void 0,b),Promise.resolve(w)}));return function(t){return e.apply(this,arguments)}}(),n.batchFetchAccountTokenBalances=function(){var e=(0,K.default)((function*(e){var t=e.walletId,r=e.networkId,n=e.accountIds,o=e.tokenAddress;return this._batchFetchAccountTokenBalances({walletId:t,networkId:r,accountIds:n,tokenAddress:o})}));return function(t){return e.apply(this,arguments)}}(),n.batchFetchAccountBalances=function(){var e=(0,K.default)((function*(e){var t=e.walletId,r=e.networkId,n=e.accountIds;return e.disableDebounce?this._batchFetchAccountTokenBalances({walletId:t,networkId:r,accountIds:n}):this.batchFetchAccountBalancesDebounce({walletId:t,networkId:r,accountIds:n})}));return function(t){return e.apply(this,arguments)}}(),n.addAccountToken=function(){var e=(0,K.default)((function*(e,t,r,n){var o,i,a=this.backgroundApi,c=a.engine,u=a.appSelector,s=a.dispatch;if(r){var d=null!=(o=null==(i=u((function(e){return e.tokens.accountTokens}))[e])?void 0:i[t])?o:[];if(!d.find((function(e){return e.tokenIdOnNetwork===r&&!e.autoDetected}))){var p=yield c.quickAddToken(t,e,r,n);return p&&s((0,le.setAccountTokens)({networkId:e,accountId:t,tokens:[].concat((0,q.default)(d),[p])})),p}}}));return function(t,r,n,o){return e.apply(this,arguments)}}(),n.fetchTokenSource=function(){var e=(0,K.default)((function*(){return(0,ae.fetchTokenSource)()}));return function(){return e.apply(this,arguments)}}(),n.getTokenRiskyItems=function(){var e=(0,K.default)((function*(e){return this._getTokenRiskyItemsWithMemo(e)}));return function(t){return e.apply(this,arguments)}}(),n.getAddressRiskyItems=function(){var e=(0,K.default)((function*(e){return(0,oe.getAddressRiskyItems)(e)}));return function(t){return e.apply(this,arguments)}}(),n.getSiteSecurityInfo=function(){var e=(0,K.default)((function*(e,t){return(0,oe.checkSite)(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.fetchTools=function(){var e=(0,K.default)((function*(){var e=yield(0,ae.fetchTools)();(0,this.backgroundApi.dispatch)((0,de.setTools)(e))}));return function(){return e.apply(this,arguments)}}(),n.getAccountBalanceFromServerApi=function(){var e=(0,K.default)((function*(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.backgroundApi,o=n.engine,i=n.serviceAccount,a=yield i.getAcccountAddressWithXpub(t,e),c=a.address,u=a.xpub,s=yield o.getTokens(e,t,r,!0,!1),d={},p=(yield(0,te.getBalancesFromApi)({networkId:e,address:c,xpub:u}))||[],l=[],f=yield this.batchTokenDetail(e,p.map((function(e){return e.address}))),y=function*(e){var t,r=f[e];r&&(Object.assign(d,((t={})[(0,ae.getBalanceKey)({address:e,sendAddress:b})]={balance:g,availableBalance:k,transferBalance:w,blockHeight:m},t)),l.push(Pe(Pe({},r),{},{sendAddress:b,autoDetected:!s.some((function(t){return t.address===e}))})))};for(var h of p){var v=h.address,g=h.balance,k=h.availableBalance,w=h.transferBalance,b=h.sendAddress,m=h.bestBlockNumber;yield*y(v)}return[d,l,f]}));return function(t,r){return e.apply(this,arguments)}}(),n.batchTokenDetail=function(){var e=(0,K.default)((function*(e,t){var r=t.reduce((function(e,t){var r;return Pe(Pe({},e),{},((r={})[t]=1,r))}),{}),n=(yield this.backgroundApi.engine.getTokens(e,void 0,!0,!0)).filter((function(e){var t;return r[null!=(t=null==e?void 0:e.address)?t:""]})),o=U()(t,n.map((function(e){var t;return null!=(t=e.address)?t:""}))),i=[];o.length&&(i=(yield(0,ve.fetchData)("/token/detail/batch",{networkId:e,addresses:o},[],"POST")).map(ae.formatServerToken));var a=[].concat((0,q.default)(i),(0,q.default)(n)).reduce((function(e,t){var r;return e[null!=(r=t.address)?r:""]=t,e}),{}),c=U()(o,i.map((function(e){return e.address}))),u=[];for(var s of c){var d=yield this.backgroundApi.engine.findToken({networkId:e,tokenIdOnNetwork:null!=s?s:""});d&&(a[null!=s?s:""]=d,u.push(d))}return yield re.default.token.insertTokens(e,[].concat((0,q.default)(i),u)),a}));return function(t,r){return e.apply(this,arguments)}}(),n.getAccountBalanceFromRpc=function(){var e=(0,K.default)((function*(e,t,r){var n,o,i,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},u=this.backgroundApi,s=u.engine,d=u.dispatch,p=u.serviceNetwork,l=u.servicePassword,f=yield s.getNetwork(e);(yield s.getVaultSettings(e)).validationRequired&&(o=yield l.getPassword(),i=function(e){return d((0,de.setIsPasswordLoadedInVault)(e))});var y=yield s.getVault({networkId:e,accountId:t}),h=yield p.measureRpcStatus(e),v=String(null!=(n=null==h?void 0:h.latestBlock)?n:"0"),g=W()(r),k={},w=yield y.getAccountBalance(g,a,o,i);a&&"undefined"!==typeof w[0]&&Object.assign(k,{main:{balance:w[0].div(new(ee())(10).pow(f.decimals)).toFixed(),blockHeight:v}});for(var b=w.slice(a?1:0),m=yield this.batchTokenDetail(e,g),A=Object.assign(m,c),O=0;O<b.length;O+=1){var I=b[O],P=g[O],T=A[P],S=null==T?void 0:T.decimals;if(T&&"undefined"!==typeof S&&"undefined"!==typeof I){var D,M=I.div(new(ee())(10).pow(S)).toFixed();Object.assign(k,((D={})[(0,ae.getBalanceKey)({address:P})]={balance:M,blockHeight:v},D))}}return[k,void 0]}));return function(t,r,n){return e.apply(this,arguments)}}(),n.fetchAndSaveAccountTokenBalance=function(){var e=(0,K.default)((function*(e){var t=this.backgroundApi,r=t.engine,n=t.dispatch,o=t.appSelector,i=e.accountId,a=e.networkId,c=e.tokenIds,u=e.withMain,s=void 0===u||u,d=e.includeTop50TokensQuery,p=void 0!==d&&d,l=!1,f={},y={},h=[],v={};try{var g=yield this.getAccountBalanceFromServerApi(a,i,s),k=(0,V.default)(g,3);f=k[0];var w=k[1];h=void 0===w?[]:w,v=k[2]}catch(E){l=!0,we.default.common.error("getAccountBalanceFromServerApi",{params:[a,i],message:E instanceof Error?E.message:E},E)}var b=o((function(e){var t,r,n;return null!=(t=null==(r=e.tokens.accountTokens)||null==(n=r[a])?void 0:n[i])?t:[]})).filter((function(e){return!e.autoDetected})),m=[].concat((0,q.default)(b),(0,q.default)(h));if(p||l){var A=yield r.getTopTokensOnNetwork(a,50),O=yield r.getTokens(a,i,!0,!0);m.push.apply(m,(0,q.default)(A).concat((0,q.default)(O)))}var I=m.map((function(e){return e.tokenIdOnNetwork})).concat(c||[]).filter(Boolean);try{var P=yield this.getAccountBalanceFromRpc(a,i,I,s,v);y=(0,V.default)(P,1)[0]}catch(E){we.default.http.error("getAccountBalanceFromRpc Error",E)}var T={};for(var S of Object.keys(Pe(Pe({},f),y))){var D,M=y[S],C=f[S];if(C&&M)if(C.blockHeight&&M.blockHeight){var N,R=new(ee())(M.blockHeight).isGreaterThan(C.blockHeight)?M:C;Object.assign(T,((N={})[S]=R,N))}else{var j;Object.assign(T,((j={})[S]=M,j))}else Object.assign(T,((D={})[S]=C||M,D))}return n((0,le.setAccountTokensBalances)({accountId:i,networkId:a,tokensBalance:T})),[T,h]}));return function(t){return e.apply(this,arguments)}}(),n.testUpdateTokensBalances=function(){var e={main:{balance:B()(.01,.001).toString(),blockHeight:"17890143"},"0x1f068a896560632a4d2e05044bd7f03834f1a465":{balance:"350",blockHeight:"17890143"},"0x4d224452801aced8b2f0aebe155379bb5d594381":{balance:"0.263075550601590144",blockHeight:"17890143"},"0x62b9c7356a2dc64a1969e19c23e4f579f9810aa7":{balance:B()(1.0001,11.01).toString(),blockHeight:"17890143"},"0x630fe3adb53f3d2e0c594bc180309fdfdd0a854d":{balance:"956.9117814",blockHeight:"17890143"},"0x7d1afa7b718fb893db30a3abc0cfc608aacfebb0":{balance:"1.146709805513342312",blockHeight:"17890143"},"0x7f08c7cc37fe1718017e7900fe63fe7604daf253":{balance:"628.5",blockHeight:"17890143"},"0x9d6b29308ff0dd2f0e3115fb08baa0819313834c":{balance:"0.005",blockHeight:"17890143"},"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48":{balance:"1",blockHeight:"17890143"},"0xae7ab96520de3a18e5e111b5eaab095312d7fe84":{balance:"0.000000000000000001",blockHeight:"17890143"},"0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2":{balance:"0.00250057981515956",blockHeight:"17890143"},"0xd533a949740bb3306d119cc777fa900ba034cd52":{balance:"0.250836027942953024",blockHeight:"17890143"},"0xdac17f958d2ee523a2206206994597c13d831ec7":{balance:"1.395202",blockHeight:"17890143"}};this.backgroundApi.dispatch((0,le.setAccountTokensBalances)({accountId:"hd-1--m/44'/60'/0'/0/0",networkId:"evm--1",tokensBalance:e}))},n.getMinDepositAmount=function(){var e=(0,K.default)((function*(e){var t=e.accountId,r=e.networkId;if(x()(r)||x()(t))return 0;var n=this.backgroundApi.engine;return(yield n.getVault({accountId:t,networkId:r})).getMinDepositAmount()}));return function(t){return e.apply(this,arguments)}}(),n.deleteAccountToken=function(){var e=(0,K.default)((function*(e){var t=e.accountId,r=e.networkId,n=e.address,o=e.tokenId,i=this.backgroundApi,a=i.dispatch,c=i.appSelector,u=i.engine;yield u.removeTokenFromAccount(t,o);var s=c((function(e){var n,o;return null==(n=e.tokens.accountTokens)||null==(o=n[r])?void 0:o[t]}));return a((0,le.setAccountTokens)({accountId:t,networkId:r,tokens:s.filter((function(e){return e.address!==n}))})),Promise.resolve()}));return function(t){return e.apply(this,arguments)}}(),n.fetchTokenDetailInfo=function(){var e=(0,K.default)((function*(e){var t,r,n=this.backgroundApi,o=n.appSelector,i=n.engine,a=null!=(t=o((function(e){var t,r;return null==e||null==(t=e.settings)||null==(r=t.devMode)?void 0:r.onRamperTestMode})))&&t?"test":"live",c=e.accountId,u=e.networkId,s=(0,j.default)(e,Oe);if(!(0,ie.isAllNetworks)(u)&&(delete s.coingeckoId,u&&c)){var d=yield i.getAccount(c,u);d&&Object.assign(s,{accountAddress:null==d?void 0:d.address})}var p=yield(0,ve.fetchData)("/token/detailInfo",Pe(Pe({},s),{},{mode:a,networkId:u}),void 0);return Pe(Pe({},p),{},{tokens:null!=(r=null==p?void 0:p.tokens.map((function(e){return(0,ae.formatServerToken)(e)})))?r:[]})}));return function(t){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=(0,K.default)((function*(e){var t,r=e.networkId,n=e.accountId,o=e.useRecycleBalance,i=e.isInscribe,a=e.useCustomAddressesBalance,c=yield this.backgroundApi.engine.getVault({networkId:r,accountId:n});c.settings.validationRequired&&(t=yield this.backgroundApi.servicePassword.getPassword());var u=!i&&(0,se.getShouldHideInscriptions)({accountId:n,networkId:r});return c.fetchBalanceDetails({password:t,useRecycleBalance:o,ignoreInscriptions:u,useCustomAddressesBalance:a})}));return function(t){return e.apply(this,arguments)}}(),n.buildManageTokensList=function(){var e=(0,K.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.search;we.default.allNetworks.info("buildManageTokensList >>> ",{networkId:t,accountId:r,search:n});var o=this.backgroundApi,i=o.serviceOverview,a=o.engine,c={},u=(yield i.buildSingleChainAccountTokens({networkId:t,accountId:r,calculateTokensTotalValue:!0,buildTokensMapKey:!1},"overview")).tokens.filter((function(e){var t,r=null!=(t=e.address)?t:"";return c[r]=!0,e.address&&!e.autoDetected}));return n?[{title:"form__my_tokens",data:[]},{title:"form__top_50_tokens",data:(yield a.searchTokens(t,n)).map((function(e){var t;return Pe(Pe({},e),{},{isOwned:!!c[null!=(t=e.address)?t:""]})}))}]:[{title:"form__my_tokens",data:u},{title:"form__top_50_tokens",data:(yield a.getTopTokensOnNetwork(t)).map((function(e){var t;return Pe(Pe({},e),{},{isOwned:!!c[null!=(t=e.address)?t:""]})}))}]}));return function(t){return e.apply(this,arguments)}}(),(0,z.default)(r)}(Ae.default),(0,Y.default)(R.prototype,"registerEvents",[o],Object.getOwnPropertyDescriptor(R.prototype,"registerEvents"),R.prototype),(0,Y.default)(R.prototype,"refreshAccountTokens",[i],Object.getOwnPropertyDescriptor(R.prototype,"refreshAccountTokens"),R.prototype),(0,Y.default)(R.prototype,"startRefreshAccountTokens",[a,c],Object.getOwnPropertyDescriptor(R.prototype,"startRefreshAccountTokens"),R.prototype),(0,Y.default)(R.prototype,"startRefreshAccountTokensDebounced",[u],Object.getOwnPropertyDescriptor(R.prototype,"startRefreshAccountTokensDebounced"),R.prototype),(0,Y.default)(R.prototype,"stopRefreshAccountTokens",[s,d],Object.getOwnPropertyDescriptor(R.prototype,"stopRefreshAccountTokens"),R.prototype),(0,Y.default)(R.prototype,"pauseRefreshAccountTokens",[p],Object.getOwnPropertyDescriptor(R.prototype,"pauseRefreshAccountTokens"),R.prototype),(0,Y.default)(R.prototype,"fetchAccountTokens",[l,f],Object.getOwnPropertyDescriptor(R.prototype,"fetchAccountTokens"),R.prototype),(0,Y.default)(R.prototype,"batchFetchAccountTokenBalances",[y],Object.getOwnPropertyDescriptor(R.prototype,"batchFetchAccountTokenBalances"),R.prototype),(0,Y.default)(R.prototype,"batchFetchAccountBalances",[h],Object.getOwnPropertyDescriptor(R.prototype,"batchFetchAccountBalances"),R.prototype),(0,Y.default)(R.prototype,"addAccountToken",[v],Object.getOwnPropertyDescriptor(R.prototype,"addAccountToken"),R.prototype),(0,Y.default)(R.prototype,"fetchTokenSource",[g],Object.getOwnPropertyDescriptor(R.prototype,"fetchTokenSource"),R.prototype),(0,Y.default)(R.prototype,"getTokenRiskyItems",[k],Object.getOwnPropertyDescriptor(R.prototype,"getTokenRiskyItems"),R.prototype),(0,Y.default)(R.prototype,"getAddressRiskyItems",[w],Object.getOwnPropertyDescriptor(R.prototype,"getAddressRiskyItems"),R.prototype),(0,Y.default)(R.prototype,"getSiteSecurityInfo",[b],Object.getOwnPropertyDescriptor(R.prototype,"getSiteSecurityInfo"),R.prototype),(0,Y.default)(R.prototype,"fetchTools",[m],Object.getOwnPropertyDescriptor(R.prototype,"fetchTools"),R.prototype),(0,Y.default)(R.prototype,"getAccountBalanceFromServerApi",[A],Object.getOwnPropertyDescriptor(R.prototype,"getAccountBalanceFromServerApi"),R.prototype),(0,Y.default)(R.prototype,"getAccountBalanceFromRpc",[O],Object.getOwnPropertyDescriptor(R.prototype,"getAccountBalanceFromRpc"),R.prototype),(0,Y.default)(R.prototype,"fetchAndSaveAccountTokenBalance",[I],Object.getOwnPropertyDescriptor(R.prototype,"fetchAndSaveAccountTokenBalance"),R.prototype),(0,Y.default)(R.prototype,"testUpdateTokensBalances",[P],Object.getOwnPropertyDescriptor(R.prototype,"testUpdateTokensBalances"),R.prototype),(0,Y.default)(R.prototype,"getMinDepositAmount",[T],Object.getOwnPropertyDescriptor(R.prototype,"getMinDepositAmount"),R.prototype),(0,Y.default)(R.prototype,"deleteAccountToken",[S],Object.getOwnPropertyDescriptor(R.prototype,"deleteAccountToken"),R.prototype),(0,Y.default)(R.prototype,"fetchTokenDetailInfo",[D],Object.getOwnPropertyDescriptor(R.prototype,"fetchTokenDetailInfo"),R.prototype),(0,Y.default)(R.prototype,"fetchBalanceDetails",[M],Object.getOwnPropertyDescriptor(R.prototype,"fetchBalanceDetails"),R.prototype),(0,Y.default)(R.prototype,"buildManageTokensList",[C],Object.getOwnPropertyDescriptor(R.prototype,"buildManageTokensList"),R.prototype),N=R))||N)},43277:(e,t,r)=>{r.r(t),r.d(t,{default:()=>M});var n,o,i,a,c,u,s,d,p=r(256666),l=r(196234),f=r(634795),y=r(887371),h=r(545754),v=r(411987),g=r(695058),k=r(859375),w=r(206391),b=r.n(w),m=r(940915),A=r(392853),O=r(438760),I=r(613549),P=r(201882);function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){(0,p.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,g.default)(e);if(t){var o=(0,g.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,v.default)(this,r)}}var M=(n=(0,O.backgroundClass)(),o=(0,O.backgroundMethod)(),i=(0,O.backgroundMethod)(),a=(0,O.backgroundMethod)(),c=(0,O.backgroundMethod)(),u=(0,O.backgroundMethod)(),n((d=function(e){(0,h.default)(r,e);var t=D(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPassword=function(){var e=(0,f.default)((function*(e){var t,r=this.backgroundApi,n=r.servicePassword,o=(0,r.appSelector)((function(e){return e.runtime.wallets})).find((function(t){return t.accounts.includes(e)}));if(void 0===(t="hw"===(null==o?void 0:o.type)?"":yield n.getPassword()))throw new Error("Failed to find the password");return t}));return function(t){return e.apply(this,arguments)}}(),n.checkAccountBalanceGreaterThan=function(){var e=(0,f.default)((function*(e){var t,r,n,o=this.backgroundApi,i=o.serviceToken,a=o.servicePassword,c=o.engine,u=yield i.getAccountBalanceFromRpc(e.networkId,e.accountId,[],!0),s=(0,l.default)(u,1)[0],d=null==s||null==(t=s.main)?void 0:t.balance;if(!d)throw new m.FailedToEstimatedGasError;var p=yield a.getPassword(),f=yield c.getFrozenBalance({accountId:e.accountId,networkId:e.networkId,password:p}),y="number"===typeof f?f:null!=(r=null==f?void 0:f.main)?r:0,h=new(b())(y).plus(e.totalFeeInNative),v=h.plus(null!=(n=e.prepaidFee)?n:"0");if(new(b())(d).lt(v)){var g=yield c.getNativeTokenInfo(e.networkId);throw new m.InsufficientGasFee(g.symbol,h.toFixed())}}));return function(t){return e.apply(this,arguments)}}(),n.sendTransaction=function(){var e=(0,f.default)((function*(e){var t,r,n,o,i,a=e.accountId,c=e.networkId,u=e.encodedTx,s=e.feePresetIndex,d=e.autoFallback,p=this.backgroundApi,l=p.engine,f=p.serviceHistory,y=yield l.getNetwork(e.networkId),h=yield this.getPassword(a);try{if(i=yield l.fetchFeeInfo({accountId:a,networkId:c,encodedTx:u}),Number.isNaN(Number(i.limit)))throw new m.FailedToEstimatedGasError;if(y.impl===I.IMPL_EVM&&Number(i.limit)<=0)throw new m.FailedToEstimatedGasError;var v=i.prices[i.prices.length-1];if(s){var g=Number(s);!Number.isNaN(g)&&i.prices[g]&&(v=i.prices[g])}o=S({eip1559:i.eip1559,limit:i.limit},i.eip1559?{price1559:v}:{price:v})}catch(E){if(d&&y.impl===I.IMPL_EVM){var k=(yield l.getGasInfo(e.networkId)).prices,w=+(yield l.proxyJsonRPCCall(e.networkId,{method:"eth_getBlockByNumber",params:["latest",!1]})).gasLimit/10,b=Math.min(w,1e6),O=Boolean((null==k?void 0:k.length)&&(null==k?void 0:k.every((function(e){return"object"===typeof e})))),P=k[k.length-1];o=S({eip1559:O,limit:String(b)},O?{price1559:P}:{price:P})}}if(!o)throw new m.FailedToEstimatedGasError;var T,D=(0,A.calculateTotalFeeRange)(o,y.feeDecimals).max,M="";i&&(M=(0,A.calculateTotalFeeNative)({amount:D,info:i}),yield this.checkAccountBalanceGreaterThan({accountId:a,networkId:c,totalFeeInNative:M,prepaidFee:null!=(T=e.prepaidFee)?T:"0"}));var C=yield l.attachFeeInfoToEncodedTx({networkId:c,accountId:a,encodedTx:u,feeInfoValue:o}),N=yield l.signAndSendEncodedTx({encodedTx:C,networkId:c,accountId:a,password:h,signOnly:!1});if(!N.encodedTx)throw new Error("signedTx.encodedTx is missing, please check code");var R=e.payload;null!=(t=R)&&t.swapInfo&&null!=(r=R)&&null!=(n=r.swapInfo)&&n.isApprove&&(R=void 0);var j=(yield l.decodeTx({networkId:c,accountId:a,encodedTx:N.encodedTx,payload:R})).decodedTx;return j.feeInfo||(j.feeInfo=o),!j.totalFeeInNative&&M&&(j.totalFeeInNative=M),yield f.saveSendConfirmHistory({networkId:c,accountId:a,data:{signedTx:N,decodedTx:j,encodedTx:N.encodedTx}}),{result:N,decodedTx:j,encodedTx:N.encodedTx}}));return function(t){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,f.default)((function*(e){var t=e.accountId,r=e.networkId,n=e.unsignedMessage,o=this.backgroundApi.engine,i=yield this.getPassword(t);return yield o.signMessage({password:i,networkId:r,accountId:t,unsignedMessage:n})}));return function(t){return e.apply(this,arguments)}}(),n.getNextTransactionNonce=function(){var e=(0,f.default)((function*(e){var t=e.accountId,r=e.networkId,n=this.backgroundApi.engine,o=yield n.getVault({accountId:t,networkId:r}),i=yield o.getDbAccount();return o.getNextNonce(r,i)}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionDetail=function(){var e=(0,f.default)((function*(e){var t=e.txId,r=e.networkId,n=this.backgroundApi.engine;return(yield n.getChainOnlyVault(r)).getTransactionDetail(t)}));return function(t){return e.apply(this,arguments)}}(),n.isEarliestPendingTx=function(){var e=(0,f.default)((function*(e){var t=e.accountId,r=e.networkId,n=e.encodedTx,o=this.backgroundApi.engine;return(yield o.getVault({accountId:t,networkId:r})).isEarliestPendingTx({encodedTx:n})}));return function(t){return e.apply(this,arguments)}}(),(0,y.default)(r)}(P.default),(0,k.default)(d.prototype,"sendTransaction",[o],Object.getOwnPropertyDescriptor(d.prototype,"sendTransaction"),d.prototype),(0,k.default)(d.prototype,"signMessage",[i],Object.getOwnPropertyDescriptor(d.prototype,"signMessage"),d.prototype),(0,k.default)(d.prototype,"getNextTransactionNonce",[a],Object.getOwnPropertyDescriptor(d.prototype,"getNextTransactionNonce"),d.prototype),(0,k.default)(d.prototype,"getTransactionDetail",[c],Object.getOwnPropertyDescriptor(d.prototype,"getTransactionDetail"),d.prototype),(0,k.default)(d.prototype,"isEarliestPendingTx",[u],Object.getOwnPropertyDescriptor(d.prototype,"isEarliestPendingTx"),d.prototype),s=d))||s)},573693:(e,t,r)=>{r.r(t),r.d(t,{default:()=>W});var n,o,i,a,c,u,s,d,p,l=r(968079),f=r(256666),y=r(196234),h=r(634795),v=r(887371),g=r(545754),k=r(411987),w=r(695058),b=r(859375),m=r(206391),A=r.n(m),O=r(732349),I=r(992431),P=r(790656),T=r(16280),S=r(135463),D=r(776553),M=r(438760),C=r(613549),N=r(396564),R=r(201882);function j(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?j(Object(r),!0).forEach((function(t){(0,f.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,w.default)(e);if(t){var o=(0,w.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,k.default)(this,r)}}function _(e,t){return e.address<t.address?-1:e.address>t.address?1:0}function B(e){return function(t,r){var n=new(A())(t[e]),o=new(A())(r[e]);return n.isGreaterThan(o)?-1:n.isLessThan(o)?1:0}}function F(e,t){return e.label&&t.label?e.label<t.label?-1:e.label>t.label?1:0:e.label&&!t.label?-1:!e.label&&t.label?1:0}var W=(n=(0,M.backgroundClass)(),o=(0,M.backgroundMethod)(),i=(0,M.backgroundMethod)(),a=(0,M.backgroundMethod)(),c=(0,M.backgroundMethod)(),u=(0,M.backgroundMethod)(),s=(0,M.backgroundMethod)(),n((p=function(e){(0,g.default)(r,e);var t=x(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n)))._getUtxos=(0,N.memoizee)(function(){var t=(0,h.default)((function*(t,r){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"balance",i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=yield e.backgroundApi.engine.getVault({networkId:t,accountId:r}),s=yield Promise.all([u.getDbAccount(),e.backgroundApi.engine.getNetwork(t)]),d=(0,y.default)(s,2),p=d[0],l=d[1],f=new(A())((null!=(n=u.settings.dust)?n:u.settings.minTransferAmount)||0).shiftedBy(l.decimals),h=(0,S.getShouldHideInscriptions)({accountId:r,networkId:t}),v=yield I.default.utxoAccounts.getCoinControlList(t,p.xpub),g=c;i&&(g=E(E({},c),{},{forceSelectUtxos:v.filter((function(e){return e.recycle})).map((function(e){var t=e.key.split("_"),r=(0,y.default)(t,2),n=r[0],o=r[1];return{txId:n,vout:parseInt(o,10),address:p.address}}))})),a&&(g=E(E({},c),{},{customAddressMap:u.getCustomAddressMap(p)}));var k=(yield u.collectUTXOsInfo(g)).utxos,w=B("value");"height"===o?w=B("height"):"address"===o?w=_:"label"===o&&(w=F);var b=k.filter((function(e){var r;return!(0,C.isBTCNetwork)(t)||new(A())(null!=(r=null==e?void 0:e.confirmations)?r:0).isGreaterThan(0)})).map((function(e){var r=v.find((function(r){return r.id===(0,O.getUtxoId)(t,e)})),n=E({height:NaN},e);return r&&(n.label=r.label,n.frozen=r.frozen,n.recycle=r.recycle),n})).sort(w),m=b.filter((function(e){return new(A())(e.value).isGreaterThan(f)&&!e.frozen&&(!!h||!e.recycle)})),P=b.filter((function(e){return new(A())(e.value).isLessThanOrEqualTo(f)&&!e.frozen&&(!!h||!e.recycle)})),T=b.filter((function(e){return e.frozen})),D=b.filter((function(e){return e.frozen&&(!!h||!e.recycle)})),M=T.filter((function(e){return!h&&e.recycle&&e.frozen})),N=b.filter((function(e){return!h&&e.recycle})),R=b.filter((function(e){return!h&&e.recycle&&!e.frozen}));return{utxos:b,utxosWithoutDust:m,utxosDust:P,frozenUtxos:T,frozenUtxosWithoutRecycle:D,frozenRecycleUtxos:M,recycleUtxos:N,recycleUtxosWithoutFrozen:R}}));return function(e,r){return t.apply(this,arguments)}}(),{promise:!0,maxAge:(0,D.getTimeDurationMs)({seconds:1})}),e._getUtxosBlockTime=(0,N.memoizee)(function(){var t=(0,h.default)((function*(t,r,n){var o=yield e.backgroundApi.engine.getVault({networkId:t,accountId:r}),i=Math.min.apply(Math,(0,l.default)(n.map((function(e){return e.height})))),a=Math.max.apply(Math,(0,l.default)(n.map((function(e){return e.height})))),c=yield o.getAccountInfo({details:"txs",from:i,to:a}),u={};return c.transactions.forEach((function(e){u[e.blockHeight]||(u[e.blockHeight]=e.blockTime)})),u}));return function(e,r,n){return t.apply(this,arguments)}}(),{promise:!0,maxAge:(0,D.getTimeDurationMs)({seconds:30})}),e}var n=r.prototype;return n.getUtxos=function(e){var t=e.networkId,r=e.accountId,n=e.sortBy,o=void 0===n?"balance":n,i=e.options,a=void 0===i?{}:i,c=e.useRecycleUtxos,u=void 0!==c&&c,s=e.useCustomAddressesBalance,d=void 0!==s&&s;return this._getUtxos(t,r,o,u,d,E({checkInscription:!(0,S.getShouldHideInscriptions)({accountId:r,networkId:t})},a))},n.getArchivedUtxos=function(){var e=(0,h.default)((function*(e,t){return t&&t.length?(yield Promise.all(t.map((function(t){return I.default.utxoAccounts.getCoinControlList(null!=e?e:"",(0,T.isTaprootXpubSegwit)(null!=t?t:"")?(0,T.getTaprootXpub)(null!=t?t:""):null!=t?t:"")})))).flat():[]}));return function(t,r){return e.apply(this,arguments)}}(),n.getUtxosBlockTime=function(){var e=(0,h.default)((function*(e,t,r){return this._getUtxosBlockTime(e,t,r)}));return function(t,r,n){return e.apply(this,arguments)}}(),n.updateLabel=function(){var e=(0,h.default)((function*(e,t,r,n){var o=(0,O.getUtxoId)(e,r),i=yield this.backgroundApi.engine.dbApi.getAccount(t),a=yield I.default.utxoAccounts.getCoinControlById(o);return a?I.default.utxoAccounts.updateCoinControlItem(o,{label:n,frozen:a.frozen,recycle:a.recycle}):I.default.utxoAccounts.addCoinControlItem(e,r,i.xpub,{label:n,frozen:!1,recycle:!1})}));return function(t,r,n,o){return e.apply(this,arguments)}}(),n.updateFrozen=function(){var e=(0,h.default)((function*(e,t,r,n){var o=(0,O.getUtxoId)(e,r),i=yield this.backgroundApi.engine.dbApi.getAccount(t),a=yield I.default.utxoAccounts.getCoinControlById(o),c=(0,S.getShouldHideInscriptions)({accountId:t,networkId:e}),u=!!a&&a.recycle;n&&c&&((yield(0,P.getLocalNFTs)({accountId:t,networkId:e})).find((function(e){var t=e.output.split(":"),n=(0,y.default)(t,2),o=n[0],i=n[1];return o===r.txid&&i===String(r.vout)}))&&(u=!0));return a?I.default.utxoAccounts.updateCoinControlItem(o,{label:a.label,frozen:n,recycle:u}):I.default.utxoAccounts.addCoinControlItem(e,r,i.xpub,{label:"",frozen:n,recycle:u})}));return function(t,r,n,o){return e.apply(this,arguments)}}(),n.updateRecycle=function(){var e=(0,h.default)((function*(e){var t=e.networkId,r=e.accountId,n=e.utxo,o=e.recycle,i=e.frozen,a=(0,O.getUtxoId)(t,n),c=yield this.backgroundApi.engine.dbApi.getAccount(r),u=yield I.default.utxoAccounts.getCoinControlById(a);return u?I.default.utxoAccounts.updateCoinControlItem(a,{label:u.label,frozen:null!=i?i:u.frozen,recycle:o}):I.default.utxoAccounts.addCoinControlItem(t,n,c.xpub,{label:"",frozen:!1,recycle:o})}));return function(t){return e.apply(this,arguments)}}(),(0,v.default)(r)}(R.default),(0,b.default)(p.prototype,"getUtxos",[o],Object.getOwnPropertyDescriptor(p.prototype,"getUtxos"),p.prototype),(0,b.default)(p.prototype,"getArchivedUtxos",[i],Object.getOwnPropertyDescriptor(p.prototype,"getArchivedUtxos"),p.prototype),(0,b.default)(p.prototype,"getUtxosBlockTime",[a],Object.getOwnPropertyDescriptor(p.prototype,"getUtxosBlockTime"),p.prototype),(0,b.default)(p.prototype,"updateLabel",[c],Object.getOwnPropertyDescriptor(p.prototype,"updateLabel"),p.prototype),(0,b.default)(p.prototype,"updateFrozen",[u],Object.getOwnPropertyDescriptor(p.prototype,"updateFrozen"),p.prototype),(0,b.default)(p.prototype,"updateRecycle",[s],Object.getOwnPropertyDescriptor(p.prototype,"updateRecycle"),p.prototype),d=p))||d)},387833:(e,t,r)=>{r.r(t),r.d(t,{default:()=>A});var n,o,i,a,c,u,s,d,p,l=r(634795),f=r(887371),y=r(545754),h=r(411987),v=r(695058),g=r(859375),k=r(992431),w=r(438760),b=r(201882);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,v.default)(e);if(t){var o=(0,v.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}const A=(n=(0,w.backgroundClass)(),o=(0,w.backgroundMethod)(),i=(0,w.backgroundMethod)(),a=(0,w.backgroundMethod)(),c=(0,w.backgroundMethod)(),u=(0,w.backgroundMethod)(),s=(0,w.backgroundMethod)(),n((p=function(e){(0,y.default)(r,e);var t=m(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.findWalletServiceBySession=function(){var e=(0,l.default)((function*(e){var t=e.session;return k.default.walletConnect.findWalletServiceBySession({session:t})}));return function(t){return e.apply(this,arguments)}}(),n.getWalletServicesList=function(){var e=(0,l.default)((function*(){return k.default.walletConnect.getWalletServicesList()}));return function(){return e.apply(this,arguments)}}(),n.saveWalletServicesList=function(){var e=(0,l.default)((function*(e){return k.default.walletConnect.saveWalletServicesList(e)}));return function(t){return e.apply(this,arguments)}}(),n.removeWalletSession=function(){var e=(0,l.default)((function*(e){return k.default.walletConnect.removeWalletSession(e)}));return function(t){return e.apply(this,arguments)}}(),n.getWalletConnectSessionOfAccount=function(){var e=(0,l.default)((function*(e){var t=e.accountId;return k.default.walletConnect.getWalletConnectSessionOfAccount({accountId:t})}));return function(t){return e.apply(this,arguments)}}(),n.saveWalletConnectSessionOfAccount=function(){var e=(0,l.default)((function*(e){var t=e.accountId,r=e.session,n=e.walletService;return k.default.walletConnect.saveWalletConnectSessionOfAccount({accountId:t,session:r,walletService:n})}));return function(t){return e.apply(this,arguments)}}(),(0,f.default)(r)}(b.default),(0,g.default)(p.prototype,"findWalletServiceBySession",[o],Object.getOwnPropertyDescriptor(p.prototype,"findWalletServiceBySession"),p.prototype),(0,g.default)(p.prototype,"getWalletServicesList",[i],Object.getOwnPropertyDescriptor(p.prototype,"getWalletServicesList"),p.prototype),(0,g.default)(p.prototype,"saveWalletServicesList",[a],Object.getOwnPropertyDescriptor(p.prototype,"saveWalletServicesList"),p.prototype),(0,g.default)(p.prototype,"removeWalletSession",[c],Object.getOwnPropertyDescriptor(p.prototype,"removeWalletSession"),p.prototype),(0,g.default)(p.prototype,"getWalletConnectSessionOfAccount",[u],Object.getOwnPropertyDescriptor(p.prototype,"getWalletConnectSessionOfAccount"),p.prototype),(0,g.default)(p.prototype,"saveWalletConnectSessionOfAccount",[s],Object.getOwnPropertyDescriptor(p.prototype,"saveWalletConnectSessionOfAccount"),p.prototype),d=p))||d)},658041:(e,t,r)=>{r.r(t);r(166985);var n=r(761351),o=r(171292);(0,n.default)(o.default)}}]);