"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[54329],{786141:(e,t,r)=>{r.r(t),r.d(t,{VaultBase:()=>S,VaultBaseChainOnly:()=>A});var n=r(72579),o=r.n(n),i=r(256666),a=r(301842),u=r.n(a),c=r(634795),s=r(887371),l=r(545754),d=r(411987),f=r(695058),p=r(206391),y=r.n(p),h=r(636393),v=r(613549),g=r(292147),w=r(213208),m=r(992431),x=r(940915),I=r(278489),T=r(969618),b=r(398514),O=r(114540),E=r(348834).Buffer;function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var o=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}if(w.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var A=function(e){(0,l.default)(r,e);var t=k(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.initProvider=function(){var e=(0,c.default)((function*(){var e=(yield this.getNetwork()).impl;u()(T.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,c.default)((function*(e){throw new x.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new x.NotImplemented},n.getEthersProvider=function(){var e=(0,c.default)((function*(){throw new x.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,c.default)((function*(e){var t=this.createClientFromURL(e),r=performance.now(),n=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.checkRpcBatchSupport=function(){var e=(0,c.default)((function*(e){throw new x.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getDisplayAddress=function(){var e=(0,c.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),r=t.normalizedAddress;if(!t.isValid||!r)throw new x.InvalidAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},n.validateWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),r=t.normalizedAddress;if(!t.isValid||"undefined"===typeof r)throw new x.InvalidTokenAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateCanCreateNextAccount=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.checkAccountExistence=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,c.default)((function*(e,t,r){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:P({},"string"===typeof r?{tokenAddress:r}:{})}})))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),n.isEarliestPendingTx=function(){var e=(0,c.default)((function*(e){e.encodedTx;return!0}));return function(t){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},n.getTransactionFeeInNative=function(e){return Promise.resolve("")},n.isContractAddress=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=(0,c.default)((function*(){var e=yield this.getNetwork();return(0,I.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=(0,c.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),n.filterAccounts=function(){var e=(0,c.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,c.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=(0,c.default)((function*(e){throw new x.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=(0,c.default)((function*(e){throw new x.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new x.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,c.default)((function*(){throw new x.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=(0,c.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=(0,c.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=(0,c.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionDetail=function(){var e=(0,c.default)((function*(e){return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(r)}(O.VaultContext),S=function(e){(0,l.default)(r,e);var t=k(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).uuid=h.default.v4().toString(),e}var n=r.prototype;return n.init=function(){var e=(0,c.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),n.initKeyring=function(){var e=(0,c.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,c.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.signAndSendTransaction=function(){var e=(0,c.default)((function*(e,t,r){var n=yield this.signTransaction(e,t);return r?P(P({},n),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(P(P({},n),{},{encodedTx:e.encodedTx}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,c.default)((function*(e,t){g.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return g.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),P(P({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new x.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,c.default)((function*(e,t){throw new x.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.activateAccount=function(){var e=(0,c.default)((function*(){throw new x.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.activateToken=function(){var e=(0,c.default)((function*(e,t){throw new x.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getTokenAllowance=function(){var e=(0,c.default)((function*(e,t){throw new x.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.batchTokensAllowance=function(){var e=(0,c.default)((function*(e,t){throw new x.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getOutputAccount=function(){var e=(0,c.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:o()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),n.getAccountBalance=function(){var e=(0,c.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,o=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:o}]:[]).concat(e.map((function(e){return{address:o,tokenAddress:e}}))),r,n)}));return function(t){return e.apply(this,arguments)}}(),n.updatePendingTxs=function(){var e=(0,c.default)((function*(e){throw new x.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNonce=function(){var e=(0,c.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),n.fixActionDirection=function(){var e=(0,c.default)((function*(e){var t,r,n,o,i=e.action,a=e.accountAddress;(i.direction=b.IDecodedTxDirection.OTHER,i.type===b.IDecodedTxActionType.NATIVE_TRANSFER)&&(i.direction=yield this.buildTxActionDirection({from:(null==(t=i.nativeTransfer)?void 0:t.from)||"",to:(null==(r=i.nativeTransfer)?void 0:r.to)||"",address:a}));i.type===b.IDecodedTxActionType.TOKEN_TRANSFER&&(i.direction=yield this.buildTxActionDirection({from:(null==(n=i.tokenTransfer)?void 0:n.from)||"",to:(null==(o=i.tokenTransfer)?void 0:o.to)||"",address:a}));return i}));return function(t){return e.apply(this,arguments)}}(),n.fixDecodedTx=function(){var e=(0,c.default)((function*(e){var t,r;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var n=null==(r=e.encodedTx)?void 0:r.nonce;e.nonce=u()(n)?e.nonce:new(y())(n).toNumber();for(var o=e.owner,i=0;i<e.actions.length;i+=1){var a=e.actions[i];yield this.fixActionDirection({action:a,accountAddress:o})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var s=e.outputActions[c];yield this.fixActionDirection({action:s,accountAddress:o})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.fixHistoryTx=function(){var e=(0,c.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.buildHistoryTx=function(){var e=(0,c.default)((function*(e){var t=e.historyTxToMerge,r=(e.encodedTx,e.decodedTx),n=e.signedTx,o=e.isSigner,i=e.isLocalCreated,a=(null==n?void 0:n.txid)||(null==r?void 0:r.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();r.txid=a||r.txid,r.owner=u,o&&(r.signer=u),null!=n&&n.txKey&&(r.extraInfo?r.extraInfo.txKey=n.txKey:r.extraInfo={txKey:n.txKey});var c=P(P({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(i)},t),{},{decodedTx:r});return c=yield this.fixHistoryTx(c),Promise.resolve(c)}));return function(t){return e.apply(this,arguments)}}(),n.checkIsScamHistoryTx=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,c.default)((function*(e){throw new x.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.fixAddressCase=function(e){return Promise.resolve(e)},n.buildTxActionDirection=function(){var e=(0,c.default)((function*(e){var t=e.from,r=e.to,n=e.address;return t=yield this.fixAddressCase(t||""),r=yield this.fixAddressCase(r),n=yield this.fixAddressCase(n),t===r&&t===n?b.IDecodedTxDirection.SELF:t&&t===n?b.IDecodedTxDirection.OUT:r&&r===n?b.IDecodedTxDirection.IN:b.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),n.getNextNonce=function(){var e=(0,c.default)((function*(e,t){var r,n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce;if(u()(n))throw new x.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(e,t.id,void 0,!1);var o=yield m.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),i=yield m.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),a=Math.max(u()(o)?0:o+1,n);if(Number.isNaN(a)&&(a=n),a>n)for(var c=n;c<a;c+=1)if(!i.includes(c)){a=c;break}if(a<n&&(a=n),a-n>=v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new x.PendingQueueTooLong(v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return a}));return function(t,r){return e.apply(this,arguments)}}(),n.validateSendAmount=function(e,t,r){return Promise.resolve(!0)},n.notifyChainChanged=function(e,t){},n.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},n.getPrivateKeyByCredential=function(e){return Promise.resolve(E.from(e.startsWith("0x")?e.slice(2):e,"hex"))},n.getMinDepositAmount=function(){var e=(0,c.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),n.specialCheckEncodedTx=function(){var e=(0,c.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),n.getAllUsedAddress=function(){var e=(0,c.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),n.attachFeeInfoToDAppEncodedTx=function(){var e=(0,c.default)((function*(e){return Promise.resolve(e.encodedTx)}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(r)}(A)},854329:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Re});var n=r(968079),o=r(256666),i=r(196234),a=r(634795),u=r(887371),c=r(163473),s=r(545754),l=r(411987),d=r(695058),f=r(356997),p=r(999330),y=r(30655),h=r(587472),v=r(39337),g=r(206391),w=r.n(g),m=r(223556),x=r.n(m),I=r(940915),T=r(740727),b=r(398514),O=r(392853),E=r(786141),C=r(776553),P=r(292147),k=r(368652),A=r(214231),S=r(84658),D=r(997293),B=r(278489),H=r(398145),N=r(82406),R=r(153546),F=r(613549),j=r(486532);function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function U(e){var t=(0,j.getConfig)();if("mainnet"===e&&"ckb"===t.PREFIX)return t;if("testnet"===e&&"ckt"===t.PREFIX)return t;throw new Error("Invalid chainId")}function _(e){return L.apply(this,arguments)}function L(){return L=(0,a.default)((function*(e){var t=e.client,r=e.transaction,n=function(){var e=(0,a.default)((function*(e){var r=(yield t.getLiveCell(e,!0)).cell;if(!r)throw new Error("Cell not found");return{outPoint:e,cellOutput:{capacity:r.output.capacity,lock:v.ResultFormatter.toScript({args:r.output.lock.args,code_hash:r.output.lock.codeHash,hash_type:r.output.lock.hashType}),type:r.output.type?v.ResultFormatter.toScript({args:r.output.type.args,code_hash:r.output.type.codeHash,hash_type:r.output.type.hashType}):void 0},data:r.data.content}}));return function(t){return e.apply(this,arguments)}}();return(0,h.createTransactionSkeleton)(r,n)})),L.apply(this,arguments)}function V(e){var t,r=y.common.prepareSigningEntries(e),n=r.get("signingEntries");if(0===(null==n?void 0:n.size))throw new Error("No signingEntries");return{txSkeleton:r,message:null==(t=n.get(0))?void 0:t.message}}function $(e){return(0,h.createTransactionFromSkeleton)(e)}function G(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?G(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function X(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var o=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}var z=function(e){(0,s.default)(r,e);var t=X(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.prepareAccounts=function(){var e=(0,a.default)((function*(e){var t,r=e.indexes,n=e.names,o=e.template,i=(0,D.slicePathTemplate)(o).pathPrefix,a=r.map((function(e){return`${i}/${e}`})),u=yield this.getHardwareSDKInstance(),c=yield this.getHardwareInfo(),s=c.connectId,l=c.deviceId,d=yield this.getWalletPassphraseState(),f=U(yield this.getNetworkChainId()),p=(0,B.getAccountNameInfoByImpl)(F.IMPL_NERVOS).default.prefix;try{t=yield u.nervosGetAddress(s,l,W({bundle:a.map((function(e){return{path:e,showOnOneKey:false,network:f.PREFIX}}))},d))}catch(x){throw P.default.common.error(x),new I.OneKeyHardwareError(x)}if(!t.success)throw P.default.common.error(t.payload),(0,R.convertDeviceError)(t.payload);var y=[],h=0;for(var v of t.payload){var g=v.address,w=v.path,m=(n||[])[h]||`${p} #${r[h]+1}`;y.push({id:`${this.walletId}--${w}`,name:m,type:H.AccountType.SIMPLE,path:w,coinType:F.COINTYPE_NERVOS,pub:"",address:g}),h+=1}return y}));return function(t){return e.apply(this,arguments)}}(),n.getAddress=function(){var e=(0,a.default)((function*(e){var t,r,n=yield this.getHardwareSDKInstance(),o=yield this.getHardwareInfo(),i=o.connectId,a=o.deviceId,u=yield this.getWalletPassphraseState(),c=U(yield this.getNetworkChainId()),s=yield n.nervosGetAddress(i,a,W({path:e.path,showOnOneKey:e.showOnOneKey,network:c.PREFIX},u));if(s.success&&null!=(t=s.payload)&&t.address)return null==(r=s.payload)?void 0:r.address;throw(0,R.convertDeviceError)(s.payload)}));return function(t){return e.apply(this,arguments)}}(),n.batchGetAddress=function(){var e=(0,a.default)((function*(e){var t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),n=r.connectId,o=r.deviceId,i=yield this.getWalletPassphraseState(),a=U(yield this.getNetworkChainId()),u=yield t.nervosGetAddress(n,o,W(W({},i),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey,network:a.PREFIX}}))}));if(!u.success)throw(0,R.convertDeviceError)(u.payload);return u.payload.map((function(e){return{path:e.path,address:e.address}}))}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,a.default)((function*(e){P.default.common.info("signTransaction",e);var t=yield this.getDbAccount(),r=U(yield this.getNetworkChainId()),n=e.payload.txSkeleton,o=V(n).txSkeleton,i=n.witnesses.get(0);if(!i)throw new I.OneKeyInternalError("Transaction serialization failure");var a=(0,h.createTransactionFromSkeleton)(n),u=A.blockchain.RawTransaction.pack(a),c=yield this.getHardwareInfo(),s=c.connectId,l=c.deviceId,d=yield this.getWalletPassphraseState(),f=yield this.getHardwareSDKInstance(),p=yield f.nervosSignTransaction(s,l,W({path:t.path,network:r.PREFIX,rawTx:(0,S.bytesToHex)(u),witnessHex:i},d));if(p.success){var y=p.payload.signature,v=(0,h.sealTransaction)(o,[(0,k.addHexPrefix)(y)]);return{txid:"",rawTx:(0,S.bytesToHex)(A.blockchain.Transaction.pack(v))}}throw(0,R.convertDeviceError)(p.payload)}));return function(t){return e.apply(this,arguments)}}(),(0,u.default)(r)}(N.KeyringHardwareBase),q=r(794292),Y=r(605851),J=r(810887);function Q(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).config,r=void 0===t?void 0:t;return(0,h.generateAddress)(e,{config:r})}function Z(e,t){var r=t.config,n=function(e){return(new A.utils.CKBHasher).update(e).digestHex().slice(0,42)}(e),o=r.SCRIPTS.SECP256K1_BLAKE160;if(!o)throw new Error("SECP256K1_BLAKE160 not found in config");return Q({codeHash:o.CODE_HASH,hashType:o.HASH_TYPE,args:n},{config:r})}var ee=r(348834).Buffer;function te(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var o=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}var re=function(e){(0,s.default)(r,e);var t=te(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getSigners=function(){var e=(0,a.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new I.OneKeyInternalError("Nervos signers number should be 1.");if(t[0]!==n.address)throw new I.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof o)throw new I.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new q.Signer(o,e,"secp256k1"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=(0,a.default)((function*(e){var t=e.password,r=e.indexes,n=e.names,o=e.template,i=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,a=(0,D.slicePathTemplate)(o).pathPrefix,u=(0,Y.batchGetPublicKeys)("secp256k1",i,t,a,r.map((function(e){return`${e.toString()}`})));if(u.length!==r.length)throw new I.OneKeyInternalError("Unable to get publick key.");var c=U(yield this.getNetworkChainId()),s=(0,B.getAccountNameInfoByImpl)(F.IMPL_NERVOS).default.prefix,l=[],d=0;for(var f of u){var p=f.path,y=f.extendedKey.key,h=(0,S.bytesToHex)(y),v=Z((0,k.addHexPrefix)(h),{config:c}),g=(n||[])[d]||`${s} #${r[d]+1}`;l.push({id:`${this.walletId}--${p}`,name:g,type:H.AccountType.SIMPLE,path:p,coinType:F.COINTYPE_NERVOS,pub:h,address:v}),d+=1}return l}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,a.default)((function*(e,t){P.default.common.info("signTransaction result",e);var r=(yield this.getDbAccount()).address,n=(yield this.getSigners(t.password||"",[r]))[r],o=V(e.payload.txSkeleton),a=o.txSkeleton,u=o.message;if(!u)throw new I.OneKeyInternalError("Unable to serialize transaction message.");var c=yield n.sign(ee.from((0,k.stripHexPrefix)(u),"hex")),s=(0,i.default)(c,2),l=s[0],d=s[1].toString(16).padStart(2,"0"),f=(0,k.addHexPrefix)((0,S.bytesToHex)(l)+d),p=(0,h.sealTransaction)(a,[f]),y=A.blockchain.Transaction.pack(p);return{txid:"",rawTx:(0,S.bytesToHex)(y)}}));return function(t,r){return e.apply(this,arguments)}}(),(0,u.default)(r)}(J.KeyringHdBase);function ne(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var o=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}var oe=function(e){(0,s.default)(r,e);var t=ne(r);function r(){return t.apply(this,arguments)}return(0,u.default)(r)}(r(255942).KeyringImportedBase);function ie(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var o=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}var ae=function(e){(0,s.default)(r,e);var t=ie(r);function r(){return t.apply(this,arguments)}return(0,u.default)(r)}(r(701625).KeyringWatchingBase),ue=r(959607),ce=r(412397);function se(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return se=function(e){this.s=e,this.n=e.next},se.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new se(e)}var le=24;function de(e){return new(w())(e.cellOutput.capacity,16)}function fe(e,t){var r;if(null!=e&&null!=(r=e.cellOutput)&&r.type){var n,o,i,a,u,c;if((null==e||null==(n=e.cellOutput)||null==(o=n.type)?void 0:o.codeHash)===(null==(i=t.SCRIPTS.XUDT)?void 0:i.CODE_HASH))return new(w())(ce.number.Uint128.unpack(ce.bytes.bytify(e.data).slice(0,16)).toString());if((null==e||null==(a=e.cellOutput)||null==(u=a.type)?void 0:u.codeHash)===(null==(c=t.SCRIPTS.SUDT)?void 0:c.CODE_HASH))return new(w())(ce.number.Uint128LE.unpack(ce.bytes.bytify(e.data).slice(0,16)).toString())}return de(e)}function pe(e){return ye.apply(this,arguments)}function ye(){return(ye=(0,a.default)((function*(e){var t,r=e.indexer,n=e.address,o=e.type,i=e.onAllowCollect,a=void 0===i?function(){return!0}:i;t=n.startsWith("ckt")?U("testnet"):U("mainnet");var u,c=(0,h.parseAddress)(n,{config:t}),s=r.collector({lock:c,type:null!=o?o:"empty"}),l=[],d=!1,f=!1;try{for(var p,y=function(e){var t,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new se(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}(s.collect());d=!(p=yield y.next()).done;d=!1){var v=p.value;(yield null==a?void 0:a(v))&&l.push(v)}}catch(g){f=!0,u=g}finally{try{d&&null!=y.return&&(yield y.return())}finally{if(f)throw u}}return l}))).apply(this,arguments)}function he(){return(he=(0,a.default)((function*(e){return pe({indexer:e.indexer,address:e.address,type:e.type})}))).apply(this,arguments)}function ve(){return ve=(0,a.default)((function*(e){var t=e.indexer,r=e.address,n=e.config,o=e.type,i=yield function(e){return he.apply(this,arguments)}({indexer:t,address:r,type:o});return i.reduce((function(e,t){return e.plus(fe(t,n))}),new(w())(0))})),ve.apply(this,arguments)}function ge(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return ge=function(e){this.s=e,this.n=e.next},ge.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new ge(e)}function we(){return(we=(0,a.default)((function*(e){var t,r=e.transactionCollector,n=e.limit,o=void 0===n?10:n,i=r.collect(),a=0,u=[],c=!1,s=!1;try{for(var l,d=function(e){var t,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new ge(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}(i);c=!(l=yield d.next()).done;c=!1){var f=l.value;if(u.push(f),(a+=1)>=o)break}}catch(p){s=!0,t=p}finally{try{c&&null!=d.return&&(yield d.return())}finally{if(s)throw t}}return u.filter((function(e,t,r){return r.findIndex((function(t){return t.transaction.hash===e.transaction.hash}))===t}))}))).apply(this,arguments)}function me(){return me=(0,a.default)((function*(e){var t=e.client,r=e.transferHistoryArray,n=function(){var e=(0,a.default)((function*(e){var r=yield t.getTransaction(e.txHash),n=parseInt(e.index,16);return{cellOutput:r.transaction.outputs[n],data:r.transaction.outputsData[n],outPoint:e}}));return function(t){return e.apply(this,arguments)}}(),o=[];for(var i of r)if(i.txStatus.blockHash){var u=yield(0,h.createTransactionSkeleton)(i.transaction,n),c=yield t.getHeader(i.txStatus.blockHash,"0x1");o.push({txSkeleton:u,txWithStatus:i,txBlockHeader:c})}return o})),me.apply(this,arguments)}function xe(e,t,r,n){return null==e?void 0:e.map((function(e){return{address:Q(e.cellOutput.lock,{config:n}),balance:new(w())(e.cellOutput.capacity,16).shiftedBy(-r.decimals).toFixed(),balanceValue:new(w())(e.cellOutput.capacity,16).toString(),symbol:r.symbol,isMine:Q(e.cellOutput.lock,{config:n})===t}}))}function Ie(e,t,r,n){return null==e?void 0:e.map((function(e){return{address:Q(e.cellOutput.lock,{config:n}),balance:fe(e,n).shiftedBy(-r.decimals).toFixed(),balanceValue:fe(e,n).toString(),symbol:r.symbol,isMine:Q(e.cellOutput.lock,{config:n})===t}}))}var Te=r(496279),be=r.n(Te),Oe=r(727623);function Ee(e){var t,r,n,o=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);o--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new Ce(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function Ce(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return Ce=function(e){this.s=e,this.n=e.next},Ce.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new Ce(e)}function Pe(e,t){var r=t.SCRIPTS.XUDT;return{codeHash:r.CODE_HASH,hashType:r.HASH_TYPE,args:e}}function ke(e){return ce.bytes.hexify(ce.number.Uint128.pack(e))}function Ae(){return Ae=(0,a.default)((function*(e,t,r,n,o,i,a,u){var c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{requireToAddress:!0,splitChangeCell:!1},s=c.config,l=void 0===s?void 0:s,d=c.requireToAddress,p=void 0===d||d;c.splitChangeCell;l=l||(0,j.getConfig)();var v=f.BI.from(i),g=u?f.BI.from(u):void 0,m=l.SCRIPTS.XUDT;if(!m)throw new Error("Provided config does not have XUDT script setup!");var x=(0,h.parseAddress)(t,{config:l});if(p&&!o)throw new Error("You must provide a to address!");var T=(0,h.parseAddress)(o,{config:l}),b=a?(0,h.parseAddress)(a,{config:l}):x;if(v.lte(0))throw new Error("amount must be greater than 0");var O=Pe(n,l),E=e.get("cellProvider");if(!E)throw new Error("Cell provider is missing!");var C={cellOutput:{capacity:"0x0",lock:T,type:O},data:ke(v),outPoint:void 0,blockHash:void 0};g||(g=f.BI.from((0,h.minimalCellCapacityCompatible)(C))),C.cellOutput.capacity=`0x${g.toString(16)}`,e=function(e,t){return e.get("cellDeps").find((function(e){return e.depType===t.depType&&new A.values.OutPointValue(e.outPoint,{validate:!1}).equals(new A.values.OutPointValue(t.outPoint,{validate:!1}))}))||(e=e.update("cellDeps",(function(e){return e.push({outPoint:t.outPoint,depType:t.depType})}))),e}(e=(e=e.update("outputs",(function(e){return e.push(C)}))).update("fixedEntries",(function(t){return t.push({field:"outputs",index:e.get("outputs").size-1})})),{outPoint:{txHash:m.TX_HASH,index:m.INDEX},depType:m.DEP_TYPE});var P={cellOutput:{capacity:"0x0",lock:b,type:O},data:ke(0),outPoint:void 0,blockHash:void 0},k={cellOutput:{capacity:"0x0",lock:b,type:void 0},data:"0x",outPoint:void 0,blockHash:void 0},S=f.BI.from(0),D=f.BI.from(0),B=(0,Oe.Set)();for(var H of e.get("inputs"))B=B.add(`${H.outPoint.txHash}_${H.outPoint.index}`);var N=(0,Oe.List)(),R=new y.secp256k1Blake160.CellCollector(t,E,{config:l,queryOptions:{type:O,data:"any"}}),F=new y.secp256k1Blake160.CellCollector(t,E,{config:l});N=N.push({cellCollector:R,index:0},{cellCollector:F,index:0});var K=f.BI.from(0),M=f.BI.from(0),U=f.BI.from(0),_=f.BI.from(0),L=!1;for(var V of N){var $,G=V.cellCollector,W=!1,X=!1;try{for(var z,q=function*(){var r,o=z.value;if(L)return"break";var i=`${o.outPoint.txHash}_${o.outPoint.index}`;if(B.has(i))return"continue";B=B.add(i);var a=t,u=(e=yield y.common.setupInputCell(e,o,a,{config:l})).get("outputs").size-1,c=(e=e.update("outputs",(function(e){return e.remove(u)}))).get("fixedEntries").findIndex((function(e){return"outputs"===e.field&&e.index===u}));c>=0&&(e=e.update("fixedEntries",(function(e){return e.remove(c)})));var s=f.BI.from(o.cellOutput.capacity),d=o.cellOutput.type?(w=o.data,ce.number.Uint128.unpack(ce.bytes.bytify(w).slice(0,16))):f.BI.from(0);K=K.add(s),M=M.add(d),(null==(r=o.cellOutput.type)?void 0:r.args)===n&&(U=U.add(s));var p=v,g=(0,h.minimalCellCapacityCompatible)(C);M.gt(p)&&(g=g.add((0,h.minimalCellCapacityCompatible)(P)));var w,m=g.add((0,h.minimalCellCapacityCompatible)(k));return _=m.sub(U),K.gt(m)&&M.gte(p)?(S=K.sub(g),D=M.sub(p),L=!0,"break"):void 0},Y=Ee(G.collect());W=!(z=yield Y.next()).done;W=!1){var J=yield*q();if("break"===J)break}}catch(ee){X=!0,$=ee}finally{try{W&&null!=Y.return&&(yield Y.return())}finally{if(X)throw $}}}if(!L||D.lt(0)||S.lt(0))throw new I.MinimumTransferBalanceRequiredForSendingAssetError(`${new(w())(i.toString()).shiftedBy(-r.decimals).toString()} ${r.symbol}`,_.div(10**8).toString(),"CKB");var Q=f.BI.from((0,h.minimalCellCapacityCompatible)(k));if(S.gte(Q)){var Z=f.BI.from((0,h.minimalCellCapacityCompatible)(P));P.cellOutput.capacity=`0x${Z.toString(16)}`,D.gt(0)&&(P.data=ke(D)),S.gt(0)&&(k.cellOutput.capacity=`0x${S.toString(16)}`),D.gt(0)&&(e=(e=e.update("outputs",(function(e){return e.push(P)}))).update("fixedEntries",(function(t){return t.push({field:"outputs",index:e.get("outputs").size-1})}))),e=e.update("outputs",(function(e){return e.push(k)}))}else if(D.gt(0)&&S.lt((0,h.minimalCellCapacityCompatible)(P)))throw new Error("Not enough capacity for change in from infos!");return e})),Ae.apply(this,arguments)}function Se(e,t){return De.apply(this,arguments)}function De(){return(De=(0,a.default)((function*(e,t){var r=Pe(e,t),n=A.utils.computeScriptHash(r);try{var o=yield be()(`https://mainnet-api.explorer.nervos.org/api/v1/xudts/${n}`,{headers:{"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"}});if(200===o.status){var i=JSON.parse(yield o.text());if(i.data.attributes.type_script.args.toLowerCase()===e.toLowerCase())return{name:i.data.attributes.full_name,symbol:i.data.attributes.symbol,decimals:parseInt(i.data.attributes.decimal)}}}catch(a){}}))).apply(this,arguments)}function Be(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function He(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Be(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ne(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var o=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}var Re=function(e){(0,s.default)(r,e);var t=Ne(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).keyringMap={hd:re,hw:z,imported:oe,watching:ae,external:ae},e.settings=ue.default,e.getClientCache=x()(function(){var t=(0,a.default)((function*(t){return e.getNervosClient(t)}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:(0,C.getTimeDurationMs)({minute:5})}),e.getIndexer=x()((0,a.default)((function*(){var t,r=yield e.getRpcUrl(),n=yield e.getChainImplInfo(),o=n.indexer.find((function(e){return e.rpcUrl===r})),i=(null==o?void 0:o.indexerUrl)||(null==(t=n.indexer[0])?void 0:t.indexerUrl)||r;return new p.Indexer(i,r)})),{promise:!0,max:1,maxAge:(0,C.getTimeDurationMs)({minute:5})}),e.getTransactionCollector=x()(function(){var t=(0,a.default)((function*(t){var r=yield e.getRpcUrl(),n=yield e.getIndexer(),o=(0,h.parseAddress)(t);return new p.TransactionCollector(n,{lock:o,withData:!0,order:"desc"},r)}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,max:3,maxAge:(0,C.getTimeDurationMs)({minute:5})}),e}var o=r.prototype;return o.init=function(){var e=(0,a.default)((function*(e){yield(0,c.default)((0,d.default)(r.prototype),"init",this).call(this,e),function(e){var t;t="mainnet"===e?M(M({},j.predefined.LINA),{},{SCRIPTS:M(M({},j.predefined.LINA.SCRIPTS),{},{XUDT:{CODE_HASH:"0x50bd8d6680b8b9cf98b73f3c08faf8b2a21914311954118ad6609be6e78a1b95",HASH_TYPE:"data1",TX_HASH:"0xc07844ce21b38e4b071dd0e1ee3b0e27afd8d7532491327f39b786343f558ab7",INDEX:"0x0",DEP_TYPE:"code"}})}):M(M({},j.predefined.AGGRON4),{},{SCRIPTS:M(M({},j.predefined.AGGRON4.SCRIPTS),{},{XUDT:{CODE_HASH:"0x25c29dc317811a6f6f3985a7a9ebc4838bd388d19d0feeecf0bcd60f6c0975bb",HASH_TYPE:"data1",TX_HASH:"0xbf6fb538763efec2a70a6a3dcb7242787087e1030c4e7d86585bc63a9d337f5f",INDEX:"0x0",DEP_TYPE:"code"}})}),(0,j.initializeConfig)(t)}(yield this.getNetworkChainId())}));return function(t){return e.apply(this,arguments)}}(),o.getClient=function(){var e=(0,a.default)((function*(){var e=yield this.getRpcUrl();return this.getClientCache(e)}));return function(){return e.apply(this,arguments)}}(),o.getCurrentConfig=function(){var e=(0,a.default)((function*(){return U(yield this.getNetworkChainId())}));return function(){return e.apply(this,arguments)}}(),o.getNervosClient=function(e){return new v.RPC(e,{fetch:function(e){function t(t,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=(0,a.default)((function*(e,t){return fetch(e,t)}));return function(t,r){return e.apply(this,arguments)}}())})},o.getChainImplInfo=function(){var e=(0,a.default)((function*(){return(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).implOptions}));return function(){return e.apply(this,arguments)}}(),o.getClientEndpointStatus=function(){var e=(0,a.default)((function*(e){var t=yield this.getClientCache(e),r=performance.now(),n=yield t.getTipBlockNumber(),o=parseInt(n);return{responseTime:Math.floor(performance.now()-r),latestBlock:o}}));return function(t){return e.apply(this,arguments)}}(),o.generateTokenKey=function(e,t){return`${e}-${null!=t?t:"NATIVE"}`},o.getBalances=function(){var e=(0,a.default)((function*(e){var t,r=this,n=yield this.getIndexer(),o=(t=function(e){return e.address},e.reduce((function(e,r){var n=t(r);return e[n]||(e[n]=[]),e[n].push(r),e}),{})),u=yield this.getCurrentConfig(),c=new Map;return yield Promise.all(Object.entries(o).map(function(){var e=(0,a.default)((function*(e){var t=(0,i.default)(e,2),o=t[0],s=t[1];yield Promise.all(s.map(function(){var e=(0,a.default)((function*(e){try{var t=e.tokenAddress,i=t?function(e,t){if(e)return{codeHash:e.CODE_HASH,hashType:e.HASH_TYPE,args:ce.bytes.hexify(t)}}(u.SCRIPTS.XUDT,t):void 0;if(t&&!u.SCRIPTS.XUDT)throw new Error("XUDT not supported");c.set(r.generateTokenKey(o,t),yield function(e){return ve.apply(this,arguments)}({indexer:n,address:o,config:u,type:i}))}catch(a){}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}())),e.map((function(e){var t,n=e.address,o=e.tokenAddress,i=r.generateTokenKey(n,o);return null!=(t=c.get(i))?t:new(w())(0)}))}));return function(t){return e.apply(this,arguments)}}(),o.buildEncodedTxFromTransfer=function(){var e=(0,a.default)((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var t,r=e.token,n=e.to,o=e.amount,i=yield this.getIndexer(),a=yield this.getClient(),u=yield this.getCurrentConfig(),c=(yield this.getDbAccount()).address,s=yield this.getNetwork(),l=(0,h.TransactionSkeleton)({cellProvider:{collector:function(e){return i.collector(He({type:"empty",data:"0x"},e))}}}),d=(yield a.getFeeRateStatistics()).median;if(r){var p=yield this.engine.ensureTokenInDB(this.networkId,r);if(!p)throw new I.OneKeyInternalError("Invalid token address");t=new(w())(o).shiftedBy(p.decimals).toFixed(),l=yield function(e,t,r,n,o,i,a,u){return Ae.apply(this,arguments)}(l,c,p,r,n,f.BI.from(t))}else{if(t=new(w())(o).shiftedBy(s.decimals).toFixed(),f.BI.from(t).lt(61e8))throw new I.MinimumTransferAmountError("61");l=yield y.secp256k1Blake160.transferCompatible(l,c,n,f.BI.from(t))}try{l=yield y.common.payFeeByFeeRate(l,[c],d,void 0,{config:u})}catch(E){var v=l.get("outputs").toArray(),g=v[v.length-1];if(g&&f.BI.from(g.cellOutput.capacity).lt((0,h.minimalCellCapacityCompatible)(g))){var m=new(w())((0,h.minimalCellCapacityCompatible)(g).toString()).shiftedBy(s.decimals).toFixed();throw new I.ChangeLessThanMinInputCapacityError(m)}}var x=(l=l.update("witnesses",(function(e){return e.filter((function(e){return"0x"!==e}))}))).get("inputs").toArray().reduce((function(e,t){return e.plus(new(w())(t.cellOutput.capacity,16))}),new(w())(0)),T=l.get("outputs").toArray().reduce((function(e,t){return e.plus(new(w())(t.cellOutput.capacity,16))}),new(w())(0)),b=x.minus(T).toString();if(x.isLessThanOrEqualTo(T)){var O=function(e){var t=$(V(e).txSkeleton);return A.blockchain.Transaction.pack(t).byteLength+4}(l);b=new(w())(d,16).multipliedBy(O).div(1024).toFixed(0),P.default.common.info("fix max send fee,",{limit:b,txSkeleton:l.toJSON()}),l=l.update("outputs",(function(e){return e.update(e.size-1,(function(e){return e?(e.cellOutput.capacity=f.BI.from(e.cellOutput.capacity).sub(b).toHexString(),e):e}))}))}return{transferInfo:e,tx:$(l),feeInfo:{price:"1",limit:b}}}));return function(t){return e.apply(this,arguments)}}(),o.buildUnsignedTxFromEncodedTx=function(){var e=(0,a.default)((function*(e){var t=yield this.getCurrentConfig(),r=yield this.getClient(),n=yield _({client:r,transaction:e.tx}),o=[];for(var i of n.get("inputs").toArray()){var a,u,c,s,l,d=fe(i,t);o.push({address:Q(i.cellOutput.lock,{config:t}),value:d,utxo:{txid:null!=(a=null==(u=i.outPoint)?void 0:u.txHash)?a:"",vout:new(w())(null!=(c=null==(s=i.outPoint)?void 0:s.index)?c:"0x00",16).toNumber(),value:d},tokenAddress:null==(l=i.cellOutput.type)?void 0:l.args})}var f=[];for(var p of n.get("outputs").toArray()){var y,h=fe(p,t);f.push({address:Q(p.cellOutput.lock,{config:t}),value:h,tokenAddress:null==(y=p.cellOutput.type)?void 0:y.args,payload:{data:p.data}})}var v=n.get("inputs").toArray().reduce((function(e,t){return e.plus(new(w())(t.cellOutput.capacity,16))}),new(w())(0)),g=n.get("outputs").toArray().reduce((function(e,t){return e.plus(new(w())(t.cellOutput.capacity,16))}),new(w())(0));if(v.minus(g).isGreaterThan(new(w())(15e7)))throw P.default.common.error("Fee is too high, transaction: ",n),new I.OneKeyInternalError("Fee is too high");var m={inputs:o,outputs:f,payload:{txSkeleton:n},encodedTx:e};return Promise.resolve(m)}));return function(t){return e.apply(this,arguments)}}(),o.decodedTxToLegacy=function(e){return Promise.resolve({})},o.decodeTx=function(){var e=(0,a.default)((function*(e,t){var r,o=yield this.getClient(),i=yield _({client:o,transaction:e.tx}),a=i.get("inputs").toArray(),u=i.get("outputs").toArray(),c=yield this.getCurrentConfig(),s=yield this.engine.getNetwork(this.networkId),l=yield this.getDbAccount(),d=yield this.engine.getNativeTokenInfo(this.networkId),f=null!=(r=u.find((function(e){return Q(e.cellOutput.lock,{config:c})!==l.address})))?r:u[0];if(!f)throw new I.OneKeyInternalError("No to address output found");var p=Q(f.cellOutput.lock,{config:c}),y=[],h={tokenInfo:d,utxoFrom:a.map((function(e){var t,r;return{address:Q(e.cellOutput.lock,{config:c}),balance:de(e).shiftedBy(-s.decimals).toFixed(),balanceValue:null!=(t=null==(r=de(e))?void 0:r.toString())?t:"0",symbol:s.symbol,isMine:!0}})),utxoTo:u.map((function(e){return{address:Q(e.cellOutput.lock,{config:c}),balance:de(e).shiftedBy(-s.decimals).toFixed(),balanceValue:de(e).toString(),symbol:s.symbol,isMine:!1}})),from:l.address,to:p,amount:de(f).shiftedBy(-s.decimals).toFixed(),amountValue:de(f).toString(),extraInfo:null};y.push({type:b.IDecodedTxActionType.NATIVE_TRANSFER,direction:p===l.address?b.IDecodedTxDirection.OUT:b.IDecodedTxDirection.SELF,nativeTransfer:h});var v=a.reduce((function(e,t){var r,n=null==(r=t.cellOutput.type)?void 0:r.args;return n?e.add(n):e}),new Set),g=!1;for(var m of v){var x=yield this.decodeTokenHistory({txSkeleton:i,config:c,tokenAddress:m});y=[].concat((0,n.default)(y),(0,n.default)(x)),x.length>0&&(g=!0)}if(g&&y.length>1){var T,O,E=y[0],C=E.type===b.IDecodedTxActionType.NATIVE_TRANSFER,P=new(w())(null!=(T=null==(O=E.nativeTransfer)?void 0:O.amount)?T:"0").isLessThanOrEqualTo("0");C&&P&&(y=y.slice(1))}var k=a.reduce((function(e,t){return e.plus(fe(t,c).shiftedBy(-s.decimals))}),new(w())(0)),A=u.reduce((function(e,t){return e.plus(fe(t,c).shiftedBy(-s.decimals))}),new(w())(0)),S=k.minus(A).toFixed();return{txid:"",owner:l.address,signer:l.address,nonce:0,actions:y,status:b.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null,totalFeeInNative:S}}));return function(t,r){return e.apply(this,arguments)}}(),o.fetchFeeInfo=function(){var e=(0,a.default)((function*(e){var t,r=yield this.engine.getNetwork(this.networkId),n=e.feeInfo;return{nativeSymbol:r.symbol,nativeDecimals:r.decimals,feeSymbol:r.feeSymbol,feeDecimals:r.feeDecimals,limit:null!=(t=null==n?void 0:n.limit)?t:"1",prices:[(0,O.convertFeeValueToGwei)({value:"1",network:r})],defaultPresetIndex:"0"}}));return function(t){return e.apply(this,arguments)}}(),o.attachFeeInfoToEncodedTx=function(){var e=(0,a.default)((function*(e){var t=e.feeInfoValue,r=t.price,n=t.limit;return Promise.resolve(He(He({},e.encodedTx),{},{feeInfo:{price:r,limit:n}}))}));return function(t){return e.apply(this,arguments)}}(),o.updateEncodedTx=function(){var e=(0,a.default)((function*(e,t,r){return Promise.resolve(e)}));return function(t,r,n){return e.apply(this,arguments)}}(),o.broadcastTransaction=function(){var e=(0,a.default)((function*(e){var t=yield this.getClient();P.default.engine.info("nervos broadcastTransaction start:",{rawTx:e.rawTx});try{var r=function(e){var t=A.blockchain.Transaction.unpack((0,k.addHexPrefix)(e));return{version:f.BI.from(t.version).toHexString(),cellDeps:t.cellDeps.map((function(e){return{depType:e.depType,outPoint:{txHash:e.outPoint.txHash,index:f.BI.from(e.outPoint.index).toHexString()}}})),headerDeps:t.headerDeps,inputs:t.inputs.map((function(e){return{previousOutput:{txHash:e.previousOutput.txHash,index:f.BI.from(e.previousOutput.index).toHexString()},since:f.BI.from(e.since).toHexString()}})),outputs:t.outputs.map((function(e){return{capacity:f.BI.from(e.capacity).toHexString(),lock:e.lock,type:e.type}})),outputsData:t.outputsData,witnesses:t.witnesses}}(e.rawTx),n=yield t.sendTransaction(r,"passthrough");return He(He({},e),{},{txid:n})}catch(u){var o=u||{},i=o.errorCode,a=`${null!=i?i:""} ${o.message}`;throw new I.OneKeyInternalError(a)}}));return function(t){return e.apply(this,arguments)}}(),o.getTokenInfo=function(){var e=(0,a.default)((function*(e){return Se(e,yield this.getCurrentConfig())}));return function(t){return e.apply(this,arguments)}}(),o.validateTokenAddress=function(){var e=(0,a.default)((function*(e){if(!(0,k.isHexString)(e))throw new I.InvalidAddress("Invalid address");return e}));return function(t){return e.apply(this,arguments)}}(),o.fetchTokenInfos=function(){var e=(0,a.default)((function*(e){var t=this;return Promise.all(e.map(function(){var e=(0,a.default)((function*(e){try{return yield t.getTokenInfo(e)}catch(r){}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),o.getTransactionStatuses=function(){var e=(0,a.default)((function*(e){var t=yield this.getClient(),r=new(w())(yield t.getTipBlockNumber(),16),n=new Map;for(var o of e){var i=yield t.getTransaction(o),a=T.TransactionStatus.PENDING;if(i.txStatus.blockHash){var u=yield t.getHeader(i.txStatus.blockHash,"0x1"),c=r.minus(new(w())(u.number,16)).isGreaterThanOrEqualTo(le);"committed"===i.txStatus.status&&c&&(a=T.TransactionStatus.CONFIRM_AND_SUCCESS)}n.set(o,a)}return e.map((function(e){return n.get(e)}))}));return function(t){return e.apply(this,arguments)}}(),o.decodeTokenHistory=function(){var e=(0,a.default)((function*(e){var t,r=this,n=e.txSkeleton,o=e.config,i=e.tokenAddress,a=yield this.engine.ensureTokenInDB(this.networkId,i);if(a&&(t={symbol:a.symbol,name:a.name,decimals:a.decimals}),t||(t=yield Se(i,o)),!t)return[];var u,c,s,l,d,f,p,y,h=yield this.getDbAccount(),v=n.get("inputs").toArray().filter((function(e){var t;return(null==(t=e.cellOutput.type)?void 0:t.args.toLowerCase())===i.toLowerCase()})),g=n.get("outputs").toArray().filter((function(e){var t;return(null==(t=e.cellOutput.type)?void 0:t.args.toLowerCase())===i.toLowerCase()})),m=Ie(Array.from(v),h.address,t,o),x=Ie(Array.from(g),h.address,t,o),I=m.find((function(e){return e.isMine})),T=x.filter((function(e){return!e.isMine})),O=x.filter((function(e){return e.isMine})),E=h.address,C=h.address,P="0",k="0";if(I){u=b.IDecodedTxDirection.OUT;var A=x.find((function(e){return!e.isMine}));C=A?A.address:h.address,P=T.filter((function(e){return e.address===C})).reduce((function(e,t){return e.plus(t.balance)}),new(w())(0)).toFixed(),k=new(w())(P).shiftedBy(-t.decimals).toFixed()}else{u=b.IDecodedTxDirection.IN;var S=m.find((function(e){return!e.isMine}));E=S?S.address:h.address,P=O.reduce((function(e,t){return e.plus(t.balance)}),new(w())(0)).toFixed(),k=new(w())(P).shiftedBy(-t.decimals).toFixed()}T&&T.length?c=(u===b.IDecodedTxDirection.OUT?T:O).map((function(e){var n,o,a,c,s,l;return{type:b.IDecodedTxActionType.TOKEN_TRANSFER,direction:u,tokenTransfer:{tokenInfo:{id:"",networkId:r.networkId,symbol:null!=(n=null==(o=t)?void 0:o.symbol)?n:"",name:null!=(a=null==(c=t)?void 0:c.name)?a:"",decimals:null!=(s=null==(l=t)?void 0:l.decimals)?s:0,tokenIdOnNetwork:i,logoURI:""},from:E,to:e.address,amount:P,amountValue:k,extraInfo:null}}})):c=[{type:b.IDecodedTxActionType.TOKEN_TRANSFER,direction:u,tokenTransfer:{tokenInfo:{id:"",networkId:this.networkId,symbol:null!=(s=null==(l=t)?void 0:l.symbol)?s:"",name:null!=(d=null==(f=t)?void 0:f.name)?d:"",decimals:null!=(p=null==(y=t)?void 0:y.decimals)?p:0,tokenIdOnNetwork:i,logoURI:""},from:E,to:C,amount:P,amountValue:k,extraInfo:null}}];return c}));return function(t){return e.apply(this,arguments)}}(),o.fetchOnChainHistory=function(){var e=(0,a.default)((function*(e){var t=this,r=e.localHistory,o=void 0===r?[]:r,i=yield this.getNetwork(),u=yield this.getDbAccount(),c=yield this.getClient(),s=u.address,l=yield this.getTransactionCollector(s),d=yield function(e){return we.apply(this,arguments)}({limit:20,transactionCollector:l}),f=yield function(e){return me.apply(this,arguments)}({client:c,transferHistoryArray:d}),p=yield this.getCurrentConfig(),y=new(w())(yield c.getTipBlockNumber(),16),h=f.map(function(){var e=(0,a.default)((function*(e){try{var r,a=o.find((function(t){return t.decodedTx.txid===e.txWithStatus.transaction.hash}));if(a&&a.decodedTx.isFinal)return null;var c,s,l=e.txWithStatus,d=l.txStatus.status,f=l.transaction.hash,h=e.txBlockHeader,v=h.timestamp,g=h.number,m=e.txSkeleton,x=m.inputs,I=m.outputs,T=f,O=new(w())(v,16).toString(),E=yield t.engine.getNativeTokenInfo(t.networkId),C=xe(Array.from(x.filter((function(e){return null===e.cellOutput.type}))),u.address,E,p),P=xe(Array.from(I.filter((function(e){return null===e.cellOutput.type}))),u.address,E,p),k=C.find((function(e){return e.isMine})),A=P.filter((function(e){return!e.isMine})),S=P.filter((function(e){return e.isMine})),D=u.address,B=u.address,H="0",N="0";if(k){c=b.IDecodedTxDirection.OUT;var R=P.find((function(e){return!e.isMine}));B=R?R.address:u.address,H=A.filter((function(e){return e.address===B})).reduce((function(e,t){return e.plus(t.balance)}),new(w())(0)).toFixed(),N=new(w())(H).shiftedBy(-i.decimals).toFixed()}else{c=b.IDecodedTxDirection.IN;var F=C.find((function(e){return!e.isMine}));D=F?F.address:u.address,H=S.reduce((function(e,t){return e.plus(t.balance)}),new(w())(0)).toFixed(),N=new(w())(H).shiftedBy(-i.decimals).toFixed()}if(A&&A.length)s=(c===b.IDecodedTxDirection.OUT?A:S).map((function(e){return{type:b.IDecodedTxActionType.NATIVE_TRANSFER,direction:c,nativeTransfer:{tokenInfo:E,utxoFrom:C,utxoTo:P,from:D,to:e.address,amount:H,amountValue:N,extraInfo:null}}}));else s=[{type:b.IDecodedTxActionType.NATIVE_TRANSFER,direction:c,nativeTransfer:{tokenInfo:E,utxoFrom:C,utxoTo:P,from:D,to:B,amount:H,amountValue:N,extraInfo:null}}];var j=x.reduce((function(e,t){var r,n=null==(r=t.cellOutput.type)?void 0:r.args;return n?e.add(n):e}),new Set),K=!1;for(var M of j){var U=yield t.decodeTokenHistory({txSkeleton:e.txSkeleton,config:p,tokenAddress:M});if(0===s.length&&0===U.length)return yield Promise.resolve(null);s=[].concat((0,n.default)(s),(0,n.default)(U)),U.length>0&&(K=!0)}if(K&&s.length>1){var _,L,V=s[0],$=V.type===b.IDecodedTxActionType.NATIVE_TRANSFER,G=new(w())(null!=(_=null==(L=V.nativeTransfer)?void 0:L.amount)?_:"0").isLessThanOrEqualTo("0");$&&G&&(s=s.slice(1))}var W=x.reduce((function(e,t){return e.plus(new(w())(t.cellOutput.capacity,16))}),new(w())(0)),X=I.reduce((function(e,t){return e.plus(new(w())(t.cellOutput.capacity,16))}),new(w())(0)),z=W.minus(X).shiftedBy(-i.decimals).toFixed(),q=y.minus(new(w())(g,16)).isGreaterThanOrEqualTo(le),Y={txid:null!=T?T:"",owner:u.address,signer:u.address,nonce:0,actions:s,status:"committed"===d&&q?b.IDecodedTxStatus.Confirmed:b.IDecodedTxStatus.Pending,networkId:t.networkId,accountId:t.accountId,extraInfo:null,totalFeeInNative:z};return Y.updatedAt="undefined"!==typeof O?parseInt(O):Date.now(),Y.createdAt=null!=(r=null==a?void 0:a.decodedTx.createdAt)?r:Y.updatedAt,Y.isFinal=Y.status===b.IDecodedTxStatus.Confirmed,yield t.buildHistoryTx({decodedTx:Y,historyTxToMerge:a})}catch(J){return console.error(J),Promise.resolve(null)}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(h)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),o.validateAddress=function(){var e=(0,a.default)((function*(e){return function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).config,r=void 0===t?void 0:t;try{return(0,h.parseAddress)(e,{config:r}),!0}catch(n){return!1}}(e,{config:yield this.getCurrentConfig()})?Promise.resolve(e):Promise.reject(new I.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),o.validateWatchingCredential=function(){var e=(0,a.default)((function*(e){var t=this;return this.validateAddress(e).then((function(e){return t.settings.watchingAccountEnabled&&!!e})).catch((function(){return!1}))}));return function(t){return e.apply(this,arguments)}}(),o.isHexPrivateKey=function(e){return/^(0x)?[0-9a-zA-Z]{64}$/.test(e)},o.validateImportedCredential=function(){var e=(0,a.default)((function*(e){return Promise.resolve(this.settings.importedAccountEnabled&&this.isHexPrivateKey(e))}));return function(t){return e.apply(this,arguments)}}(),(0,u.default)(r)}(E.VaultBase)},565147:(e,t,r)=>{r.r(t),r.d(t,{KeyringBase:()=>s,KeyringBaseMock:()=>l});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var s=function(e){(0,i.default)(r,e);var t=c(r);function r(e){var r;return(r=t.call(this,e.options)).vault=e,r}return r.prototype.addressFromBase=function(){var e=(0,n.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,o.default)(r)}(r(114540).VaultContext),l=function(e){(0,i.default)(r,e);var t=c(r);function r(){return t.apply(this,arguments)}return(0,o.default)(r)}(s)},82406:(e,t,r)=>{r.r(t),r.d(t,{KeyringHardwareBase:()=>d});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),c=r(799075),s=r(814817);function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,i.default)(a,e);var t=l(a);function a(){return t.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,n.default)((function*(){var e,t,r,n=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==n?void 0:n.mac)?e:"",deviceId:null!=(t=null==n?void 0:n.deviceId)?t:"",deviceType:null!=(r=null==n?void 0:n.deviceType)?r:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,n.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,s.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,n.default)((function*(){var e,t,n,o,i;return null!=(i=yield null==(e=r.g)||null==(t=e.$backgroundApiProxy)||null==(n=t.backgroundApi)||null==(o=n.serviceHardware)||null==o.getSDKInstance?void 0:o.getSDKInstance())?i:c.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(a)}(r(565147).KeyringBase)},810887:(e,t,r)=>{r.r(t),r.d(t,{KeyringHdBase:()=>y});var n=r(256666),o=r(634795),i=r(887371),a=r(545754),u=r(411987),c=r(695058),s=r(605851),l=r(940915);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var y=function(e){(0,a.default)(r,e);var t=p(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=(0,o.default)((function*(e,t){var r=(yield this.getDbAccount()).path.split("/"),n=t||[r.pop()],o=r.join("/"),i=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof i)throw new l.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,s.batchGetPrivateKeys)(a,i,e,o,n).reduce((function(e,t){var r;return f(f({},e),{},((r={})[t.path]=t.extendedKey.key,r))}),{})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(280306).KeyringSoftwareBase)},255942:(e,t,r)=>{r.r(t),r.d(t,{KeyringImportedBase:()=>l});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),c=r(940915);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var l=function(e){(0,i.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.getPrivateKeys=function(){var e=(0,n.default)((function*(e,t){if("undefined"!==typeof t)throw new c.NotImplemented("Getting private keys from extended private key");var r=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof r)throw new c.OneKeyInternalError("Unable to get credential.");return{"":r}}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(280306).KeyringSoftwareBase)},280306:(e,t,r)=>{r.r(t),r.d(t,{KeyringSoftwareBase:()=>h});var n=r(196234),o=r(256666),i=r(634795),a=r(887371),u=r(545754),c=r(411987),s=r(695058),l=r(292147),d=r(940915);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var o=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var h=function(e){(0,u.default)(r,e);var t=y(r);function r(){return t.apply(this,arguments)}var o=r.prototype;return o.signTransaction=function(){var e=(0,i.default)((function*(e,t){var r=t.password;if("undefined"===typeof r)throw new d.OneKeyInternalError("Software signing requires a password.");var n=yield this.getSigners(r,e.inputs.map((function(e){return e.address})));return l.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,n)),{},{encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),o.signMessage=function(){var e=(0,i.default)((function*(e,t){var r=this,o=t.password;if("undefined"===typeof o)throw new d.OneKeyInternalError("Software signing requires a password.");var i=yield this.getDbAccount(),a=Object.values(yield this.getSigners(o,[i.address])),u=(0,n.default)(a,1)[0];return l.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return r.engine.providerManager.signMessage(r.networkId,e,u)})))}));return function(t,r){return e.apply(this,arguments)}}(),o.getAddress=function(){throw new Error("Method not implemented.")},o.batchGetAddress=function(){throw new Error("Method not implemented.")},o.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(r)}(r(565147).KeyringBase)},701625:(e,t,r)=>{r.r(t),r.d(t,{KeyringWatchingBase:()=>l});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),c=r(940915);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var l=function(e){(0,i.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.signTransaction=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(565147).KeyringBase)},153546:(e,t,r)=>{r.r(t),r.d(t,{convertDeviceError:()=>u});var n=r(703599),o=r(302478),i=r(292147);r(213208);function a(e,t){return"string"!==typeof t?null:e===n.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new o.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new o.BridgeNetworkError({message:t}):null}function u(e){var t,r=e||{},u=r.code,c=r.error,s=r.message,l=null!=(t=null!=c?c:s)?t:"Unknown error";if(a(u,l))return a(u,l);switch(i.default.hardwareSDK.info("Device Utils Convert Device Error:",u,l),u){case n.HardwareErrorCode.UnknownError:return new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceFwException:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof l&&-1!==l.indexOf("ui-device_bootloader_mode")?new o.NotInBootLoaderMode(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceCheckDeviceIdError:return new o.DeviceNotSame(e);case n.HardwareErrorCode.DeviceNotFound:return new o.DeviceNotFind(e);case n.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new o.NotInBootLoaderMode(e);case n.HardwareErrorCode.DeviceInterruptedFromOutside:case n.HardwareErrorCode.DeviceInterruptedFromUser:return new o.UserCancelFromOutside(e);case n.HardwareErrorCode.DeviceNotSupportPassphrase:return new o.NotSupportPassphraseError(e);case n.HardwareErrorCode.IFrameLoadFail:return new o.InitIframeLoadFail(e);case n.HardwareErrorCode.IframeTimeout:return new o.InitIframeTimeout(e);case n.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new o.FirmwareDownloadFailed(e);case n.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new o.FirmwareUpdateManuallyEnterBoot(e);case n.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new o.FirmwareUpdateAutoEnterBootFailure(e);case n.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new o.FirmwareUpdateLimitOneDevice(e);case n.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.NewFirmwareUnRelease:return new o.NewFirmwareUnRelease(e);case n.HardwareErrorCode.NewFirmwareForceUpdate:return new o.NewFirmwareForceUpdate(e);case n.HardwareErrorCode.NetworkError:return new o.NetworkError(e);case n.HardwareErrorCode.BlePermissionError:return new o.NeedBluetoothTurnedOn(e);case n.HardwareErrorCode.BleLocationError:return new o.NeedBluetoothPermissions({message:l});case n.HardwareErrorCode.BleLocationServicesDisabled:return new o.BleLocationServiceError({message:l});case n.HardwareErrorCode.BleDeviceNotBonded:return new o.DeviceNotBonded(e);case n.HardwareErrorCode.BleDeviceBondError:return new o.DeviceBondError(e);case n.HardwareErrorCode.BleWriteCharacteristicError:return new o.BleWriteCharacteristicError(e);case n.HardwareErrorCode.BleScanError:return new o.BleScanError({message:l});case n.HardwareErrorCode.BleAlreadyConnected:return new o.BleAlreadyConnectedError(e);case n.HardwareErrorCode.RuntimeError:return-1!==l.indexOf("EIP712 blind sign is disabled")?new o.OpenBlindSign(e):-1!==l.indexOf("Unknown message")||-1!==l.indexOf("Failure_UnexpectedMessage")?new o.UnknownMethod(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.PinInvalid:return new o.InvalidPIN(e);case n.HardwareErrorCode.DeviceCheckPassphraseStateError:return new o.InvalidPassphrase(e);case n.HardwareErrorCode.DeviceOpenedPassphrase:return new o.DeviceOpenedPassphrase(e);case n.HardwareErrorCode.DeviceNotOpenedPassphrase:return new o.DeviceNotOpenedPassphrase(e);case n.HardwareErrorCode.PinCancelled:case n.HardwareErrorCode.ActionCancelled:return new o.UserCancel(e);case n.HardwareErrorCode.BridgeNotInstalled:case o.CustomOneKeyHardwareError.NeedOneKeyBridge:return new o.NeedOneKeyBridge(e);case n.HardwareErrorCode.BridgeNetworkError:return new o.BridgeNetworkError(e);case n.HardwareErrorCode.BridgeTimeoutError:return new o.BridgeTimeoutError(e);case n.HardwareErrorCode.PollingTimeout:return new o.ConnectTimeoutError(e);case n.HardwareErrorCode.PollingStop:return new o.ConnectPollingStopError(e);case n.HardwareErrorCode.BlindSignDisabled:return new o.OpenBlindSign(e);case n.HardwareErrorCode.FileAlreadyExists:return new o.FileAlreadyExistError(e);case n.HardwareErrorCode.CheckDownloadFileError:return new o.IncompleteFileError(e);case n.HardwareErrorCode.NotInSigningMode:return new o.NotInSigningModeError(e);case n.HardwareErrorCode.DataOverload:return new o.DeviceDataOverload(e);default:return new o.UnknownHardwareError(e)}}}}]);