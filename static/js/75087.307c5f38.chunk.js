"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[75087],{786141:(e,t,n)=>{n.r(t),n.d(t,{VaultBase:()=>S,VaultBaseChainOnly:()=>D});var r=n(72579),i=n.n(r),o=n(256666),a=n(301842),u=n.n(a),s=n(634795),c=n(887371),d=n(545754),l=n(411987),f=n(695058),p=n(206391),h=n.n(p),y=n(636393),v=n(613549),g=n(292147),m=n(213208),w=n(992431),T=n(940915),A=n(278489),I=n(969618),E=n(398514),x=n(114540),b=n(348834).Buffer;function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,f.default)(e);if(t){var i=(0,f.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}if(m.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var D=function(e){(0,d.default)(n,e);var t=C(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.initProvider=function(){var e=(0,s.default)((function*(){var e=(yield this.getNetwork()).impl;u()(I.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){throw new T.NotImplemented},r.getEthersProvider=function(){var e=(0,s.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=(0,s.default)((function*(e){var t=this.createClientFromURL(e),n=performance.now(),r=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-n),latestBlock:r}}));return function(t){return e.apply(this,arguments)}}(),r.checkRpcBatchSupport=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getDisplayAddress=function(){var e=(0,s.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),n=t.normalizedAddress;if(!t.isValid||!n)throw new T.InvalidAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},r.validateWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),n=t.normalizedAddress;if(!t.isValid||"undefined"===typeof n)throw new T.InvalidTokenAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=(0,s.default)((function*(e,t,n){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,n=e.tokenAddress;return{address:t,coin:O({},"string"===typeof n?{tokenAddress:n}:{})}})))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.getFrozenBalance=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),r.isEarliestPendingTx=function(){var e=(0,s.default)((function*(e){e.encodedTx;return!0}));return function(t){return e.apply(this,arguments)}}(),r.fetchBalanceDetails=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},r.getTransactionFeeInNative=function(e){return Promise.resolve("")},r.isContractAddress=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfoMap=function(){var e=(0,s.default)((function*(){var e=yield this.getNetwork();return(0,A.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),r.canAutoCreateNextAccount=function(){var e=(0,s.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),r.filterAccounts=function(){var e=(0,s.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,s.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),r.checkIsUnlimitedAllowance=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsApprovedForAll=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var e=(0,s.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.fetchRpcChainId=function(){var e=(0,s.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),r.getTxWaitingSeconds=function(){var e=(0,s.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),r.getUserNFTAssets=function(){var e=(0,s.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),r.getTransactionDetail=function(){var e=(0,s.default)((function*(e){return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(n)}(x.VaultContext),S=function(e){(0,d.default)(n,e);var t=C(n);function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).uuid=y.default.v4().toString(),e}var r=n.prototype;return r.init=function(){var e=(0,s.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),r.initKeyring=function(){var e=(0,s.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=(0,s.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,n){return e.apply(this,arguments)}}(),r.signAndSendTransaction=function(){var e=(0,s.default)((function*(e,t,n){var r=yield this.signTransaction(e,t);return n?O(O({},r),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(O(O({},r),{},{encodedTx:e.encodedTx}))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.broadcastTransaction=function(){var e=(0,s.default)((function*(e,t){g.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var n=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return g.default.engine.info("broadcastTransaction END:",{txid:n,rawTx:e.rawTx}),O(O({},e),{},{txid:n,encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),r.buildEncodedTxFromBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,s.default)((function*(e,t){throw new T.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.activateAccount=function(){var e=(0,s.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.activateToken=function(){var e=(0,s.default)((function*(e,t){throw new T.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.getTokenAllowance=function(){var e=(0,s.default)((function*(e,t){throw new T.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.batchTokensAllowance=function(){var e=(0,s.default)((function*(e,t){throw new T.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.getOutputAccount=function(){var e=(0,s.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:i()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),r.getAccountBalance=function(){var e=(0,s.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:i}]:[]).concat(e.map((function(e){return{address:i,tokenAddress:e}}))),n,r)}));return function(t){return e.apply(this,arguments)}}(),r.updatePendingTxs=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNonce=function(){var e=(0,s.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),r.fixActionDirection=function(){var e=(0,s.default)((function*(e){var t,n,r,i,o=e.action,a=e.accountAddress;(o.direction=E.IDecodedTxDirection.OTHER,o.type===E.IDecodedTxActionType.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(t=o.nativeTransfer)?void 0:t.from)||"",to:(null==(n=o.nativeTransfer)?void 0:n.to)||"",address:a}));o.type===E.IDecodedTxActionType.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(r=o.tokenTransfer)?void 0:r.from)||"",to:(null==(i=o.tokenTransfer)?void 0:i.to)||"",address:a}));return o}));return function(t){return e.apply(this,arguments)}}(),r.fixDecodedTx=function(){var e=(0,s.default)((function*(e){var t,n;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var r=null==(n=e.encodedTx)?void 0:n.nonce;e.nonce=u()(r)?e.nonce:new(h())(r).toNumber();for(var i=e.owner,o=0;o<e.actions.length;o+=1){var a=e.actions[o];yield this.fixActionDirection({action:a,accountAddress:i})}if(e.outputActions)for(var s=0;s<e.outputActions.length;s+=1){var c=e.outputActions[s];yield this.fixActionDirection({action:c,accountAddress:i})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.fixHistoryTx=function(){var e=(0,s.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.buildHistoryTx=function(){var e=(0,s.default)((function*(e){var t=e.historyTxToMerge,n=(e.encodedTx,e.decodedTx),r=e.signedTx,i=e.isSigner,o=e.isLocalCreated,a=(null==r?void 0:r.txid)||(null==n?void 0:n.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();n.txid=a||n.txid,n.owner=u,i&&(n.signer=u),null!=r&&r.txKey&&(n.extraInfo?n.extraInfo.txKey=r.txKey:n.extraInfo={txKey:r.txKey});var s=O(O({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(o)},t),{},{decodedTx:n});return s=yield this.fixHistoryTx(s),Promise.resolve(s)}));return function(t){return e.apply(this,arguments)}}(),r.checkIsScamHistoryTx=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),r.fetchOnChainHistory=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.fixAddressCase=function(e){return Promise.resolve(e)},r.buildTxActionDirection=function(){var e=(0,s.default)((function*(e){var t=e.from,n=e.to,r=e.address;return t=yield this.fixAddressCase(t||""),n=yield this.fixAddressCase(n),r=yield this.fixAddressCase(r),t===n&&t===r?E.IDecodedTxDirection.SELF:t&&t===r?E.IDecodedTxDirection.OUT:n&&n===r?E.IDecodedTxDirection.IN:E.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),r.getNextNonce=function(){var e=(0,s.default)((function*(e,t){var n,r=null==(n=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:n.nonce;if(u()(r))throw new T.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(e,t.id,void 0,!1);var i=yield w.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),o=yield w.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),a=Math.max(u()(i)?0:i+1,r);if(Number.isNaN(a)&&(a=r),a>r)for(var s=r;s<a;s+=1)if(!o.includes(s)){a=s;break}if(a<r&&(a=r),a-r>=v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new T.PendingQueueTooLong(v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return a}));return function(t,n){return e.apply(this,arguments)}}(),r.validateSendAmount=function(e,t,n){return Promise.resolve(!0)},r.notifyChainChanged=function(e,t){},r.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},r.getPrivateKeyByCredential=function(e){return Promise.resolve(b.from(e.startsWith("0x")?e.slice(2):e,"hex"))},r.getMinDepositAmount=function(){var e=(0,s.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),r.specialCheckEncodedTx=function(){var e=(0,s.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),r.getAllUsedAddress=function(){var e=(0,s.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),r.attachFeeInfoToDAppEncodedTx=function(){var e=(0,s.default)((function*(e){return Promise.resolve(e.encodedTx)}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(n)}(D)},875087:(e,t,n)=>{n.r(t),n.d(t,{default:()=>me});var r=n(196234),i=n(256666),o=n(72579),a=n.n(o),u=n(634795),s=n(887371),c=n(545754),d=n(411987),l=n(695058),f=n(153929),p=n(84658),h=n(206391),y=n.n(h),v=n(776553),g=n(814817),m=n(292147),w=n(396564),T=n(992431),A=n(940915),I=n(740727),E=n(398514),x=n(786141),b=n(789644),P=n.n(b),O=n(112889);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const S=function(){function e(e){var t=this;this.checkAuth=(0,w.memoizee)(function(){var e=(0,u.default)((function*(e){var n=yield t.getAuthorization(e);if(!n)throw new Error("Bad Auth");return t.request.get("/account/auth/check",{params:{testnet:t.testnet},headers:{Authorization:n}}).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),{promise:!0,maxAge:(0,v.getTimeDurationMs)({seconds:30})}),this.specialInvoice=(0,w.memoizee)(function(){var e=(0,u.default)((function*(e,n){return t.request.get("/invoices/invoice",{params:{paymentHash:n,testnet:t.testnet},headers:{Authorization:yield t.getAuthorization(e)}}).then((function(e){return e.data}))}));return function(t,n){return e.apply(this,arguments)}}(),{promise:!0,maxAge:(0,v.getTimeDurationMs)({seconds:1})}),this.getConfig=(0,w.memoizee)(function(){var e=(0,u.default)((function*(e){return t.request.get("/invoices/config",{params:{testnet:t.testnet},headers:{Authorization:yield t.getAuthorization(e)}}).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),{promise:!0,maxAge:(0,v.getTimeDurationMs)({seconds:60})}),this.batchGetLnurl=(0,w.memoizee)(function(){var e=(0,u.default)((function*(e){return t.request.post("/lnurl/batchNewUrl",{addresses:e,tag:"payRequest",testnet:t.testnet}).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),{promise:!0,maxAge:(0,v.getTimeDurationMs)({seconds:60})}),this.testnet=e,this.request=P().create({baseURL:`${(0,O.getFiatEndpoint)()}/lightning`,timeout:2e4}),this.request.interceptors.response.use((function(e){return e}),(function(e){return 401===(e.response?e.response.status:null)?Promise.reject(new A.BadAuthError):Promise.reject(e)}))}var t=e.prototype;return t.getAuthorization=function(){var e=(0,u.default)((function*(e){var t=yield T.default.utxoAccounts.getLndAccessToken(e);return t&&t.length?`Bearer ${t}`:""}));return function(t){return e.apply(this,arguments)}}(),t.refreshAccessToken=function(){var e=(0,u.default)((function*(e){var t=e.hashPubKey,n=e.address,r=e.signature,i=e.timestamp,o=e.randomSeed;try{if(!t||!n||!r)throw new Error("Invalid exchange token params");return yield this.request.post("/account/auth",{hashPubKey:t,address:n,signature:r,timestamp:i,randomSeed:o,testnet:this.testnet}).then((function(e){return e.data}))}catch(a){throw console.log("=====>>>exchange token failed: ",a),a}}));return function(t){return e.apply(this,arguments)}}(),t.checkAccountExist=function(){var e=(0,u.default)((function*(e){return this.request.get("/account/check",{params:{address:e,testnet:this.testnet}}).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),t.createUser=function(){var e=(0,u.default)((function*(e){var t=e.hashPubKey,n=e.address,r=e.signature,i=e.randomSeed;return this.request.post("/account/users",{hashPubKey:t,address:n,signature:r,randomSeed:i,testnet:this.testnet}).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),t.batchGetBalance=function(){var e=(0,u.default)((function*(e){try{return yield this.request.post("/account/balance",{addresses:e,testnet:this.testnet}).then((function(e){return e.data}))}catch(t){return[]}}));return function(t){return e.apply(this,arguments)}}(),t.createInvoice=function(){var e=(0,u.default)((function*(e,t,n){return this.request.post("/invoices/create",{amount:t,description:n||"OneKey Invoice",testnet:this.testnet},{headers:{Authorization:yield this.getAuthorization(e)}}).then((function(e){return e.data}))}));return function(t,n,r){return e.apply(this,arguments)}}(),t.decodedInvoice=function(){var e=(0,u.default)((function*(e){return this.request.get("/invoices/decoded",{params:{invoice:e,testnet:this.testnet}}).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),t.getNextNonce=function(){var e=(0,u.default)((function*(e){return this.request.get("/payments/getNonce",{params:{testnet:this.testnet},headers:{Authorization:yield this.getAuthorization(e)}}).then((function(e){return e.data+1}))}));return function(t){return e.apply(this,arguments)}}(),t.paymentBolt11=function(){var e=(0,u.default)((function*(e,t){var n=this;return this.request.post("/payments/bolt11",D(D({},e),{},{testnet:this.testnet}),{headers:{Authorization:yield this.getAuthorization(t)}}).then((function(e){return e.data})).catch((function(e){n.detectCheckBalanceError(e)}))}));return function(t,n){return e.apply(this,arguments)}}(),t.checkBolt11=function(){var e=(0,u.default)((function*(e){var t=e.address,n=e.nonce;return this.request.get("/payments/checkBolt11",{params:{nonce:n,testnet:this.testnet},headers:{Authorization:yield this.getAuthorization(t)}}).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),t.checkBalanceBeforePayInvoice=function(){var e=(0,u.default)((function*(e){var t=this,n=e.address,r=e.invoice,i=e.amount;return this.request.post("/payments/checkBalanceBeforePayInvoice",{invoice:r,amount:i,testnet:this.testnet},{headers:{Authorization:yield this.getAuthorization(n)}}).then((function(e){return e.data})).catch((function(e){t.detectCheckBalanceError(e)}))}));return function(t){return e.apply(this,arguments)}}(),t.detectCheckBalanceError=function(e){if(P().isAxiosError(e)){var t,n,r=null==(t=e.response)||null==(n=t.data)?void 0:n.message;if(null!=r&&r.includes("not_enough_balance_include_ten_sats"))throw new A.NotEnoughBalanceIncludeTenSatsError;if(null!=r&&r.includes("not_enough_balance_include_one_percent"))throw new A.NotEnoughBalanceIncludeOnePercentError}throw e},t.fetchHistory=function(){var e=(0,u.default)((function*(e){return this.request.get("/invoices/history",{params:{testnet:this.testnet},headers:{Authorization:yield this.getAuthorization(e)}}).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),t.fetchSignTemplate=function(){var e=(0,u.default)((function*(e,t){return this.request.get("/account/getSignTemplate",{params:{address:e,signType:t,testnet:this.testnet},headers:{Authorization:yield this.getAuthorization(e)}}).then((function(e){return e.data}))}));return function(t,n){return e.apply(this,arguments)}}(),t.estimateFee=function(){var e=(0,u.default)((function*(e){var t=e.address,n=e.dest,r=e.amt;return this.request.get("/payments/estimatefee",{params:{dest:n,amt:r,testnet:this.testnet},headers:{Authorization:yield this.getAuthorization(t)}}).then((function(e){return e.data.result}))}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(e)}();var k;!function(e){e.StateSettled="settled",e.StateInitialized="initialized",e.StateOpen="open",e.StateError="error"}(k||(k={}));var B=n(254595),N=n(429666),H=n(785695),R=n.n(H),_=n(153546),F=n(613549),j=n(997293),M=n(398145),K=n(82406),U=n(755074),L=n(480029),z=n(348834).Buffer;function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,d.default)(this,n)}}var W=function(e){(0,c.default)(n,e);var t=q(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getBtcCoinName=function(e){return e?"TEST":"BTC"},r.getBtcCoinType=function(e){return e?F.COINTYPE_TBTC:F.COINTYPE_BTC},r.getLnCoinType=function(e){return e?F.COINTYPE_LIGHTNING_TESTNET:F.COINTYPE_LIGHTNING},r.prepareAccounts=function(){var e=(0,u.default)((function*(e){var t,n=e.indexes,r=e.names,i=(yield this.vault.getNetwork()).isTestnet,o=this.getBtcCoinType(i),a=this.getLnCoinType(i),u=`m/84'/${o}'/${F.INDEX_PLACEHOLDER}'/0/0`;try{var s=yield this.getHardwareInfo(),c=s.connectId,d=s.deviceId,l=yield this.getWalletPassphraseState(),f=yield this.getHardwareSDKInstance(),h=(0,j.slicePathTemplate)(u).pathPrefix,y=this.getBtcCoinName(i);t=yield f.btcGetPublicKey(c,d,$({bundle:n.map((function(e){return{path:`${h}/${e}'`,coin:y.toLowerCase(),showOnOneKey:!1}}))},l))}catch(k){throw console.error(k),new A.OneKeyHardwareError(k)}if(!t.success||!t.payload)throw console.error(t.payload),(0,_.convertDeviceError)(t.payload);if(t.payload.length!==n.length)throw new A.OneKeyInternalError("Unable to get publick key.");var v=yield this.vault.getClient(),g=[],m=yield(0,L.getBtcProvider)(this.engine,i),w=i?"TLightning":"Lightning";for(var T of t.payload){var I=T.path,E=T.xpub,x=m.xpubToAddresses(E,["0/0"],U.AddressEncodings.P2WPKH)["0/0"];if(!(yield v.checkAccountExist(x))){var b=(0,p.bytesToHex)((0,N.ripemd160)(E)),P=yield v.fetchSignTemplate(x,"register");if("register"!==P.type)throw new Error("Wrong signature type");var O=yield this.signature({msgPayload:$($({},P),{},{pubkey:b,address:x}),path:I,isTestnet:i});yield v.createUser({hashPubKey:b,address:x,signature:O,randomSeed:P.randomSeed})}console.log(I,E,x);var C=`m/44'/${a}'/${n[0]}`,D=(r||[])[0]||`${w} #${n[0]+1}`,S={id:`${this.walletId}--${C}`,name:D,type:M.AccountType.VARIANT,path:C,coinType:a,pub:E,address:"",addresses:{normalizedAddress:x,realPath:I,hashAddress:(0,p.bytesToHex)((0,N.ripemd160)(x))}};yield this.vault.exchangeToken("",S),g.push(S)}return g}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=(0,u.default)((function*(e){var t=yield this.getDbAccount(),n=e.encodedTx,r=n.invoice,i=n.expired,o=n.created,a=n.paymentHash,u=yield this.vault.getClient(),s=yield u.fetchSignTemplate(t.addresses.normalizedAddress,"transfer");if("transfer"!==s.type)throw new Error("Wrong transfer signature type");var c=yield this.vault.getNetwork();return{txid:a,rawTx:yield this.signature({msgPayload:$($({},s),{},{paymentHash:a,invoice:r,expired:i,created:Number(o),nonce:s.nonce,randomSeed:s.randomSeed}),path:t.addresses.realPath,isTestnet:c.isTestnet}),nonce:s.nonce,randomSeed:s.randomSeed}}));return function(t){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=(0,u.default)((function*(e){m.default.common.info("LightningNetwork signMessage",e);var t=yield this.vault.getNetwork(),n=this.getBtcCoinName(t.isTestnet),r=yield this.getDbAccount(),i=yield this.getHardwareInfo(),o=i.connectId,a=i.deviceId,s=yield this.getWalletPassphraseState(),c=yield this.getHardwareSDKInstance(),d=yield Promise.all(e.map(function(){var e=(0,u.default)((function*(e){var t=e.message,i=yield c.btcSignMessage(o,a,$($({},s),{},{path:`${r.addresses.realPath}/0/0`,coin:n,messageHex:z.from(t).toString("hex")}));if(!i.success)throw(0,_.convertDeviceError)(i.payload);return{message:t,signature:i.payload.signature}}));return function(t){return e.apply(this,arguments)}}()));return d.map((function(e){return JSON.stringify(e)}))}));return function(t){return e.apply(this,arguments)}}(),r.signature=function(){var e=(0,u.default)((function*(e){var t=e.msgPayload,n=e.path,r=e.isTestnet,i=this.getBtcCoinName(r),o=yield this.getHardwareInfo(),a=o.connectId,u=o.deviceId,s=yield this.getHardwareSDKInstance(),c=yield this.getWalletPassphraseState(),d=R()(t),l=yield s.btcSignMessage(a,u,$($({},c),{},{path:`${n}/0/0`,coin:i,messageHex:z.from(d).toString("hex")}));if(!l.success)throw(0,_.convertDeviceError)(l.payload);return m.default.common.debug(`Lightning Signature, msgPayload: ${R()(t)}, path: ${n}, result: ${l.payload.signature}`),l.payload.signature}));return function(t){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.lnurlAuth=function(){var e=(0,u.default)((function*(e){var t=e.lnurlDetail;if("login"!==t.tag)throw new Error("lnurl-auth: invalid tag");var n=new URL(t.url),r=yield this.getHardwareInfo(),i=r.connectId,o=r.deviceId,a=yield this.getWalletPassphraseState(),u=yield this.getHardwareSDKInstance(),s=yield u.lnurlAuth(i,o,$($({},a),{},{domain:n.hostname,k1:t.k1}));if(!s.success)throw(0,_.convertDeviceError)(s.payload);var c=s.payload,d=c.signature,l=c.publickey;if(!d||!l)throw new A.OneKeyInternalError("Unable to get signature or publickey");var f=n;return f.searchParams.set("sig",null!=d?d:""),f.searchParams.set("key",null!=l?l:""),f.searchParams.set("t",Date.now().toString()),f.toString()}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(n)}(K.KeyringHardwareBase),V=n(36832),Y=n(605851),J=n(887554),Z=n.n(J),Q=n(348834).Buffer,X=new(Z().ec)("secp256k1");const ee=function(){function e(e){if(this.keyHex=e,!e)throw new Error("Invalid key");this.sk=X.keyFromPrivate(Q.from(e,"hex"))}var t=e.prototype;return t.sign=function(e){if(!e)throw new Error("Invalid message");return this.sk.sign(e,{canonical:!0})},t.verify=function(e,t){try{return this.sk.verify(e,t)}catch(n){return console.error(n),!1}},(0,s.default)(e,[{key:"pk",get:function(){return this.sk.getPublic()}},{key:"pkHex",get:function(){return this.pk.encodeCompressed("hex")}}]),e}();var te=n(16280),ne=n(810887),re=n(945375),ie=function(){var e=(0,u.default)((function*(e){var t=e.msgPayload,n=e.engine,r=e.path,i=e.password,o=e.entropy,a=e.isTestnet,u=(yield(0,L.getBtcProvider)(n,a)).signMessage({password:i,entropy:o,path:`${r}/0/0`,message:R()(t)});return m.default.common.debug(`Lightning Signature, msgPayload: ${R()(t)}, path: ${r}, result: ${u.toString("hex")}`),u.toString("hex")}));return function(t){return e.apply(this,arguments)}}();function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ue(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,d.default)(this,n)}}var se=function(e){(0,c.default)(n,e);var t=ue(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getSigners=function(){return Promise.resolve({})},r.prepareAccounts=function(){var e=(0,u.default)((function*(e){var t=e.password,n=e.indexes,r=e.names,i=yield this.engine.dbApi.getCredential(this.walletId,t),o=i.seed,a=i.entropy,u=yield this.vault.getNetwork(),s=yield(0,L.generateNativeSegwitAccounts)({engine:this.engine,seed:o,password:t,indexes:n,names:r,isTestnet:u.isTestnet}),c=yield this.vault.getClient(),d=[];for(var l of s){if(!(yield c.checkAccountExist(l.address))){var h=(0,p.bytesToHex)((0,f.sha256)(l.xpub)),y=yield c.fetchSignTemplate(l.address,"register");if("register"!==y.type)throw new Error("Wrong signature type");var v=yield this.signature({msgPayload:ae(ae({},y),{},{pubkey:h,address:l.address}),engine:this.engine,path:l.path,password:t,entropy:a,isTestnet:u.isTestnet});yield c.createUser({hashPubKey:h,address:l.address,signature:v,randomSeed:y.randomSeed})}var g=u.isTestnet?F.COINTYPE_LIGHTNING_TESTNET:F.COINTYPE_LIGHTNING,m=`m/44'/${g}'/${l.index}`;d.push({id:`${this.walletId}--${m}`,name:l.name,type:M.AccountType.VARIANT,path:m,coinType:g,pub:l.xpub,address:"",addresses:{normalizedAddress:l.address,realPath:l.path,hashAddress:(0,p.bytesToHex)((0,N.ripemd160)(l.address))}})}return d}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=(0,u.default)((function*(e,t){m.default.sendTx.info("signTransaction result",e);var n=t.password,r=yield this.getDbAccount(),i=(yield this.engine.dbApi.getCredential(this.walletId,null!=n?n:"")).entropy,o=e.encodedTx,a=o.invoice,u=o.expired,s=o.created,c=o.paymentHash,d=yield this.vault.getClient(),l=yield d.fetchSignTemplate(r.addresses.normalizedAddress,"transfer");if("transfer"!==l.type)throw new Error("Wrong transfer signature type");var f=yield this.vault.getNetwork();return{txid:c,rawTx:yield this.signature({msgPayload:ae(ae({},l),{},{paymentHash:c,invoice:a,expired:u,created:Number(s),nonce:l.nonce,randomSeed:l.randomSeed}),engine:this.engine,path:r.addresses.realPath,password:null!=n?n:"",entropy:i,isTestnet:f.isTestnet}),nonce:l.nonce,randomSeed:l.randomSeed}}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=(0,u.default)((function*(e,t){var n=this,r=yield this.getDbAccount(),i=t.password,o=void 0===i?"":i,a=(yield this.engine.dbApi.getCredential(this.walletId,o)).entropy,u=yield this.getNetwork(),s=new re.default.LndHub;return(yield Promise.all(e.map((function(e){var t=e.message;return s.signMessage({password:o,engine:n.engine,entropy:a,message:t,path:r.addresses.realPath,isTestnet:u.isTestnet})})))).map((function(e){return JSON.stringify(e)}))}));return function(t,n){return e.apply(this,arguments)}}(),r.signature=function(e){return ie(e)},r.lnurlAuth=function(){var e=(0,u.default)((function*(e){var t=e.lnurlDetail,n=e.password;if("login"!==t.tag)throw new Error("lnurl-auth: invalid tag");var r=(yield this.engine.dbApi.getCredential(this.walletId,n)).entropy,i=(0,Y.mnemonicFromEntropy)(r,n),o=(0,V.mnemonicToSeedSync)(i),a=(0,te.getBitcoinBip32)().fromSeed(o),u=a.derivePath("m/138'/0").privateKey;if(!u)throw new Error("lnurl-auth: invalid hashing key");var s=new URL(t.url),c=(0,B.getPathSuffix)(s.host,(0,p.bytesToHex)(u)),d=a.derivePath("m/138'");for(var l of c)d=d.derive(l);if(!d.privateKey)throw new Error("lnurl-auth: invalid linking private key");var f=(0,p.bytesToHex)(d.privateKey);if(!f)throw new Error("Invalid linkingKey");var h=new ee(f),y=(0,p.hexToBytes)(t.k1),v=h.sign(y).toDER("hex"),g=s;return g.searchParams.set("sig",v),g.searchParams.set("key",h.pkHex),g.searchParams.set("t",Date.now().toString()),g.toString()}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(n)}(ne.KeyringHdBase);function ce(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,d.default)(this,n)}}var de=function(e){(0,c.default)(n,e);var t=ce(n);function n(){return t.apply(this,arguments)}return(0,s.default)(n)}(n(255942).KeyringImportedBase);function le(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,d.default)(this,n)}}var fe,pe=function(e){(0,c.default)(n,e);var t=le(n);function n(){return t.apply(this,arguments)}return(0,s.default)(n)}(n(701625).KeyringWatchingBase),he=n(261542);function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ge(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,d.default)(this,n)}}!function(e){e.NOT_FOUND_ORDER="NOT_FOUND_ORDER",e.SUCCESS="SUCCESS",e.FAILED="FAILED",e.PENDING="PENDING"}(fe||(fe={}));var me=function(e){(0,c.default)(n,e);var t=ge(n);function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).keyringMap={hd:se,hw:W,imported:de,watching:pe,external:pe},e.settings=he.default,e.getClientCache=(0,w.memoizee)((function(e){return new S(e)}),{maxAge:(0,v.getTimeDurationMs)({minute:3})}),e._decodedInvoceCache=(0,w.memoizee)(function(){var t=(0,u.default)((function*(t){return(yield e.getClient()).decodedInvoice(t)}));return function(e){return t.apply(this,arguments)}}(),{maxAge:(0,v.getTimeDurationMs)({seconds:30})}),e}var i=n.prototype;return i.getOutputAccount=function(){var e=(0,u.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:a()(e,"pub",""),addresses:JSON.stringify(a()(e,"addresses",{}))}}));return function(){return e.apply(this,arguments)}}(),i.getClient=function(){var e=(0,u.default)((function*(){var e=yield this.getNetwork();return this.getClientCache(e.isTestnet)}));return function(){return e.apply(this,arguments)}}(),i.exchangeToken=function(){var e=(0,u.default)((function*(e,t){try{var n=t||(yield this.getDbAccount()),r=n.addresses.normalizedAddress,i=(0,p.bytesToHex)((0,f.sha256)(n.pub)),o=yield this.getNetwork(),a=null;if((0,g.isHdWallet)({walletId:this.walletId})){if(!e)throw new Error("No Password");a=(yield this.engine.dbApi.getCredential(this.walletId,null!=e?e:"")).entropy}var u=yield this.getClient(),s=yield u.fetchSignTemplate(r,"auth");if("auth"!==s.type)throw new Error("Invalid auth sign template");var c=Date.now(),d=this.keyring,l=yield d.signature({msgPayload:ve(ve({},s),{},{pubkey:i,address:r,timestamp:c}),engine:this.engine,path:n.addresses.realPath,password:null!=e?e:"",entropy:a,isTestnet:o.isTestnet}),h=yield u.refreshAccessToken({hashPubKey:i,address:r,signature:l,timestamp:c,randomSeed:s.randomSeed});return yield T.default.utxoAccounts.updateLndToken(n.addresses.normalizedAddress,h.access_token,h.refresh_token),h}catch(y){throw m.default.common.info("exchangeToken error",y),y}}));return function(t,n){return e.apply(this,arguments)}}(),i.addressFromBase=function(e){return Promise.resolve("")},i.getFetchBalanceAddress=function(e){return Promise.resolve(e.addresses.normalizedAddress)},i.getCurrentBalanceAddress=function(){var e=(0,u.default)((function*(){return(yield this.getDbAccount()).addresses.normalizedAddress}));return function(){return e.apply(this,arguments)}}(),i.getHashAddress=function(){var e=(0,u.default)((function*(){return(yield this.getDbAccount()).addresses.hashAddress}));return function(){return e.apply(this,arguments)}}(),i.validateSendAmount=function(){var e=(0,u.default)((function*(e){var t=1e6;if(new(y())(e).isGreaterThan(t))throw new A.MaxSendAmountError("msg__the_sending_amount_cannot_exceed_int_sats",{0:t});return Promise.resolve(!0)}));return function(t){return e.apply(this,arguments)}}(),i.validateAddress=function(){var e=(0,u.default)((function*(e){try{var t=(0,B.findLnurl)(e);if(!t){if((0,B.isLightningAddress)(e))return e;throw new Error("not a lnurl")}return t}catch(n){}try{return yield this._decodedInvoceCache(e),e}catch(n){throw new A.InvalidLightningPaymentRequest}}));return function(t){return e.apply(this,arguments)}}(),i.fetchFeeInfo=function(){var e=(0,u.default)((function*(e){var t,n=yield this.engine.getNetwork(this.networkId);return{customDisabled:!0,limit:new(y())(null!=(t=e.fee)?t:"0").toFixed(),prices:["1"],defaultPresetIndex:"0",feeSymbol:n.feeSymbol,feeDecimals:n.feeDecimals,nativeSymbol:n.symbol,nativeDecimals:n.decimals,waitingSeconds:[5],tx:null}}));return function(t){return e.apply(this,arguments)}}(),i.buildEncodedTxFromTransfer=function(){var e=(0,u.default)((function*(e){var t,n,r,i=yield this.getClient(),o=yield this.getCurrentBalanceAddress(),a=yield this._decodedInvoceCache(e.to),u=yield i.getConfig(o),s=a.tags.find((function(e){return"payment_hash"===e.tagName})),c=a.millisatoshis?new(y())(a.millisatoshis).dividedBy(1e3):new(y())(null!=(t=a.satoshis)?t:"0");if(this.isZeroAmountInvoice(a)&&e.amount&&(c=new(y())(e.amount)),!a.paymentRequest)throw new A.InvalidLightningPaymentRequest;var d=a.tags.find((function(e){return"description"===e.tagName})),l=0;try{var f;l=yield i.estimateFee({address:o,dest:null!=(f=a.payeeNodeKey)?f:"",amt:c.toFixed()})}catch(p){console.error("Fetch Fee error: ",p)}return{invoice:a.paymentRequest,paymentHash:null==s?void 0:s.data,amount:c.toFixed(),lightningAddress:e.lightningAddress,expired:`${null!=(n=a.timeExpireDate)?n:""}`,created:`${Math.floor(Date.now()/1e3)}`,description:null==d?void 0:d.data,fee:l,isExceedTransferLimit:new(y())(c).isGreaterThan(u.maxSendAmount),config:u,successAction:null==(r=e.lnurlPaymentInfo)?void 0:r.successAction}}));return function(t){return e.apply(this,arguments)}}(),i.updateEncodedTx=function(e){return Promise.resolve(e)},i.attachFeeInfoToEncodedTx=function(e){return Promise.resolve(e.encodedTx)},i.buildUnsignedTxFromEncodedTx=function(){var e=(0,u.default)((function*(e){return Promise.resolve({inputs:[],outputs:[],payload:{encodedTx:e},encodedTx:e})}));return function(t){return e.apply(this,arguments)}}(),i.decodeTx=function(){var e=(0,u.default)((function*(e,t){var n,r=yield this.getDbAccount(),i=yield this.getHashAddress(),o=yield this.engine.getNativeTokenInfo(this.networkId),a=null;return e.description&&(a={memo:e.description}),{txid:"",owner:r.name,signer:"",nonce:0,actions:[{type:E.IDecodedTxActionType.NATIVE_TRANSFER,nativeTransfer:{tokenInfo:o,from:i,to:null!=(n=e.lightningAddress)?n:"",amount:new(y())(e.amount).toFixed(),amountValue:e.amount,extraInfo:null},direction:E.IDecodedTxDirection.OUT}],status:E.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,encodedTx:e,payload:t,extraInfo:a}}));return function(t,n){return e.apply(this,arguments)}}(),i.decodedTxToLegacy=function(e){return Promise.resolve({})},i.fetchOnChainHistory=function(){var e=(0,u.default)((function*(e){var t=this,n=yield this.getDbAccount(),r=n.addresses.normalizedAddress,i=n.addresses.hashAddress,o=yield this.engine.getNetwork(this.networkId),a=o.decimals,u=(o.symbol,yield this.engine.getNativeTokenInfo(this.networkId)),s=yield this.getClient(),c=(yield s.fetchHistory(r)).map((function(r){try{var o,s,c=r.txid,d=(r.owner,r.signer),l=r.nonce,f=r.actions,p=r.fee,h=r.status,v=null==(o=e.localHistory)?void 0:o.find((function(e){return e.decodedTx.txid===c})),g=new(y())(r.amount).shiftedBy(-a).toFixed(),m=`${r.amount}`,w=f[0],T=w.direction,A=w.type,I=T===E.IDecodedTxDirection.IN?"":i,x="";if(T===E.IDecodedTxDirection.IN)x=i;else if(v&&T===E.IDecodedTxDirection.OUT){var b,P,O,C;x=null!=(b=null==(P=v.decodedTx)||null==(O=P.actions)||null==(C=O[0].nativeTransfer)?void 0:C.to)?b:""}var D={txid:c,owner:n.name,signer:d,nonce:l,actions:[{type:A,direction:T,nativeTransfer:{tokenInfo:u,from:I,to:x,amount:g,amountValue:m,extraInfo:null}}],status:h,networkId:t.networkId,accountId:t.accountId,extraInfo:{preimage:r.payment_preimage,memo:r.description},totalFeeInNative:new(y())(p).shiftedBy(-a).toFixed()};return D.updatedAt=new Date(r.settled_at).getTime(),D.createdAt=null!=(s=null==v?void 0:v.decodedTx.createdAt)?s:new Date(r.settled_at).getTime(),D.isFinal=D.status===E.IDecodedTxStatus.Confirmed||D.status===E.IDecodedTxStatus.Failed,t.buildHistoryTx({decodedTx:D,historyTxToMerge:v})}catch(S){return console.error(S),Promise.resolve(null)}}));return(yield Promise.all(c)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),i.fixActionDirection=function(){var e=(0,u.default)((function*(e){var t=e.action;e.accountAddress;return t}));return function(t){return e.apply(this,arguments)}}(),i.getAccountBalance=function(){var e=(0,u.default)((function*(e,t){var n=e.map((function(e){}));if(!t)return n;var i=yield this.getDbAccount(),o=yield this.getBalances([{address:i.addresses.normalizedAddress}]);return[(0,r.default)(o,1)[0]].concat(n)}));return function(t,n){return e.apply(this,arguments)}}(),i.getBalances=function(){var e=(0,u.default)((function*(e){var t=yield this.getClient(),n=yield t.batchGetBalance(e.map((function(e){return e.address})));return e.map((function(e){var t,r=n.find((function(t){return t.address===e.address}));return new(y())(null!=(t=null==r?void 0:r.balance)?t:0)}))}));return function(t){return e.apply(this,arguments)}}(),i.createInvoice=function(){var e=(0,u.default)((function*(e,t){var n=yield this.getClient(),r=yield this.getCurrentBalanceAddress();return n.createInvoice(r,e,t)}));return function(t,n){return e.apply(this,arguments)}}(),i.broadcastTransaction=function(){var e=(0,u.default)((function*(e,t){var n;m.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});try{var r=yield this.getClient(),i=e.encodedTx,o=i.invoice,a=i.amount,u=i.expired,s=i.created,c=i.paymentHash,d=yield this.getCurrentBalanceAddress();if("number"!==typeof e.nonce||"number"!==typeof e.randomSeed)throw new Error("Invalid nonce or randomSeed");n=yield r.paymentBolt11({invoice:o,paymentHash:c,amount:a,expired:u,created:Number(s),signature:e.rawTx,nonce:e.nonce,randomSeed:e.randomSeed},d),yield this.pollBolt11Status(d,e.nonce)}catch(l){throw m.default.sendTx.info("broadcastTransaction ERROR:",l),l}return m.default.engine.info("broadcastTransaction END:",{txid:e.txid,rawTx:e.rawTx,result:n}),ve(ve(ve({},e),n),{},{encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),i.pollBolt11Status=function(){var e=(0,u.default)((function*(e,t){var n=this;return new Promise(function(){var r=(0,u.default)((function*(r,i){var o=yield n.getClient(),a=setInterval((0,u.default)((function*(){try{var n=yield o.checkBolt11({address:e,nonce:Number(t)});if(n.status===fe.NOT_FOUND_ORDER)return;if(n.status===fe.SUCCESS&&(clearInterval(a),r(I.TransactionStatus.CONFIRM_AND_SUCCESS)),n.status===fe.FAILED){var u;clearInterval(a);var s=null==n||null==(u=n.data)?void 0:u.message;if("invoice is already paid"===(null==s?void 0:s.toLowerCase()))i(new A.InvoiceAlreadPaid);else if("no_route"===s)i(new A.NoRouteFoundError);else if("insufficient_balance"===s)i(new A.ChannelInsufficientLiquidityError);else if("invoice expired"===s)i(new A.InvoiceExpiredError);else{var c;i(new Error(null==(c=n.data)?void 0:c.message))}}}catch(d){clearInterval(a),i(d)}})),1500)}));return function(e,t){return r.apply(this,arguments)}}())}));return function(t,n){return e.apply(this,arguments)}}(),i.getTransactionStatuses=function(){var e=(0,u.default)((function*(e){var t=this,n=yield this.getCurrentBalanceAddress();return Promise.all(e.map(function(){var e=(0,u.default)((function*(e){var r,i=yield t.getClient();try{var o=yield i.specialInvoice(n,e);return(r=o.status)===k.StateOpen||r===k.StateInitialized?I.TransactionStatus.PENDING:r===k.StateSettled?I.TransactionStatus.CONFIRM_AND_SUCCESS:r===k.StateError?I.TransactionStatus.CONFIRM_BUT_FAILED:void 0}catch(u){var a;return"Bad arguments"===(null==u||null==(a=u.response)?void 0:a.data.message)?I.TransactionStatus.CONFIRM_BUT_FAILED:I.TransactionStatus.PENDING}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),i.buildEncodedTxFromApprove=function(e){throw new Error("Method not implemented.")},i.updateEncodedTxTokenApprove=function(e,t){throw new Error("Method not implemented.")},i.getExportedCredential=function(e,t){throw new Error("Method not implemented.")},i.fetchTokenInfos=function(e){throw new Error("Method not implemented.")},i.specialCheckEncodedTx=function(){var e=(0,u.default)((function*(e){var t=e.invoice,n=e.amount,r=(e.fee,yield this._decodedInvoceCache(t)),i=yield this.getNetwork(),o=n;if(this.isZeroAmountInvoice(r)){if(new(y())(e.amount).isLessThan(1))return Promise.resolve({success:!1,key:"msg__the_invoice_amount_cannot_be_0",params:{0:i.symbol}});o=e.amount}var a=yield this.getCurrentBalanceAddress(),u=yield this.getClient();try{yield u.checkBalanceBeforePayInvoice({address:a,invoice:t,amount:o})}catch(f){var s=(f||{}).key;return Promise.resolve({success:!1,key:null!=s?s:"form__amount_invalid",params:{0:i.symbol}})}var c=r.tags.find((function(e){return"payment_hash"===e.tagName}));if(null!=c&&c.data)try{if((yield u.specialInvoice(a,c.data)).is_paid)throw new A.InvoiceAlreadPaid}catch(f){var d=f.key,l=void 0===d?"":d;if("msg__invoice_is_already_paid"===l||"msg__authentication_failed_verify_again"===l)return Promise.resolve({success:!1,key:l})}return Promise.resolve({success:!0})}));return function(t){return e.apply(this,arguments)}}(),i.fetchSpecialInvoice=function(){var e=(0,u.default)((function*(e){var t=yield this.getCurrentBalanceAddress(),n=yield this.getClient();return yield n.specialInvoice(t,e)}));return function(t){return e.apply(this,arguments)}}(),i.checkAuth=function(){var e=(0,u.default)((function*(){var e=yield this.getCurrentBalanceAddress();return(yield this.getClient()).checkAuth(e)}));return function(){return e.apply(this,arguments)}}(),i.isZeroAmountInvoice=function(e){return e.millisatoshis&&+e.millisatoshis<=0||e.satoshis&&+e.satoshis<=0||!e.millisatoshis&&!e.satoshis},i.batchGetLnurl=function(){var e=(0,u.default)((function*(e){return(yield this.getClient()).batchGetLnurl(e)}));return function(t){return e.apply(this,arguments)}}(),i.getLnurlAuthUrl=function(){var e=(0,u.default)((function*(e){var t=e.lnurlDetail,n=e.password;return this.keyring.lnurlAuth({lnurlDetail:t,password:n})}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(n)}(x.VaultBase)},565147:(e,t,n)=>{n.r(t),n.d(t,{KeyringBase:()=>c,KeyringBaseMock:()=>d});var r=n(634795),i=n(887371),o=n(545754),a=n(411987),u=n(695058);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var c=function(e){(0,o.default)(n,e);var t=s(n);function n(e){var n;return(n=t.call(this,e.options)).vault=e,n}return n.prototype.addressFromBase=function(){var e=(0,r.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,i.default)(n)}(n(114540).VaultContext),d=function(e){(0,o.default)(n,e);var t=s(n);function n(){return t.apply(this,arguments)}return(0,i.default)(n)}(c)},82406:(e,t,n)=>{n.r(t),n.d(t,{KeyringHardwareBase:()=>l});var r=n(634795),i=n(887371),o=n(545754),a=n(411987),u=n(695058),s=n(799075),c=n(814817);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var l=function(e){(0,o.default)(a,e);var t=d(a);function a(){return t.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,r.default)((function*(){var e,t,n,r=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==r?void 0:r.mac)?e:"",deviceId:null!=(t=null==r?void 0:r.deviceId)?t:"",deviceType:null!=(n=null==r?void 0:r.deviceType)?n:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,r.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,c.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,r.default)((function*(){var e,t,r,i,o;return null!=(o=yield null==(e=n.g)||null==(t=e.$backgroundApiProxy)||null==(r=t.backgroundApi)||null==(i=r.serviceHardware)||null==i.getSDKInstance?void 0:i.getSDKInstance())?o:s.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(a)}(n(565147).KeyringBase)},810887:(e,t,n)=>{n.r(t),n.d(t,{KeyringHdBase:()=>h});var r=n(256666),i=n(634795),o=n(887371),a=n(545754),u=n(411987),s=n(695058),c=n(605851),d=n(940915);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,u.default)(this,n)}}var h=function(e){(0,a.default)(n,e);var t=p(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=(0,i.default)((function*(e,t){var n=(yield this.getDbAccount()).path.split("/"),r=t||[n.pop()],i=n.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof o)throw new d.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,c.batchGetPrivateKeys)(a,o,e,i,r).reduce((function(e,t){var n;return f(f({},e),{},((n={})[t.path]=t.extendedKey.key,n))}),{})}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(n)}(n(280306).KeyringSoftwareBase)},255942:(e,t,n)=>{n.r(t),n.d(t,{KeyringImportedBase:()=>d});var r=n(634795),i=n(887371),o=n(545754),a=n(411987),u=n(695058),s=n(940915);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var d=function(e){(0,o.default)(n,e);var t=c(n);function n(){return t.apply(this,arguments)}var a=n.prototype;return a.getPrivateKeys=function(){var e=(0,r.default)((function*(e,t){if("undefined"!==typeof t)throw new s.NotImplemented("Getting private keys from extended private key");var n=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof n)throw new s.OneKeyInternalError("Unable to get credential.");return{"":n}}));return function(t,n){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,i.default)(n)}(n(280306).KeyringSoftwareBase)},280306:(e,t,n)=>{n.r(t),n.d(t,{KeyringSoftwareBase:()=>y});var r=n(196234),i=n(256666),o=n(634795),a=n(887371),u=n(545754),s=n(411987),c=n(695058),d=n(292147),l=n(940915);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var i=(0,c.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}var y=function(e){(0,u.default)(n,e);var t=h(n);function n(){return t.apply(this,arguments)}var i=n.prototype;return i.signTransaction=function(){var e=(0,o.default)((function*(e,t){var n=t.password;if("undefined"===typeof n)throw new l.OneKeyInternalError("Software signing requires a password.");var r=yield this.getSigners(n,e.inputs.map((function(e){return e.address})));return d.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,r)),{},{encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),i.signMessage=function(){var e=(0,o.default)((function*(e,t){var n=this,i=t.password;if("undefined"===typeof i)throw new l.OneKeyInternalError("Software signing requires a password.");var o=yield this.getDbAccount(),a=Object.values(yield this.getSigners(i,[o.address])),u=(0,r.default)(a,1)[0];return d.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return n.engine.providerManager.signMessage(n.networkId,e,u)})))}));return function(t,n){return e.apply(this,arguments)}}(),i.getAddress=function(){throw new Error("Method not implemented.")},i.batchGetAddress=function(){throw new Error("Method not implemented.")},i.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(n)}(n(565147).KeyringBase)},701625:(e,t,n)=>{n.r(t),n.d(t,{KeyringWatchingBase:()=>d});var r=n(634795),i=n(887371),o=n(545754),a=n(411987),u=n(695058),s=n(940915);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var d=function(e){(0,o.default)(n,e);var t=c(n);function n(){return t.apply(this,arguments)}var a=n.prototype;return a.signTransaction=function(){var e=(0,r.default)((function*(e,t){throw new s.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,r.default)((function*(e,t){throw new s.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,i.default)(n)}(n(565147).KeyringBase)},153546:(e,t,n)=>{n.r(t),n.d(t,{convertDeviceError:()=>u});var r=n(703599),i=n(302478),o=n(292147);n(213208);function a(e,t){return"string"!==typeof t?null:e===r.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new i.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new i.BridgeNetworkError({message:t}):null}function u(e){var t,n=e||{},u=n.code,s=n.error,c=n.message,d=null!=(t=null!=s?s:c)?t:"Unknown error";if(a(u,d))return a(u,d);switch(o.default.hardwareSDK.info("Device Utils Convert Device Error:",u,d),u){case r.HardwareErrorCode.UnknownError:return new i.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceFwException:return new i.FirmwareVersionTooLow(e);case r.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new i.NotInBootLoaderMode(e):new i.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceCheckDeviceIdError:return new i.DeviceNotSame(e);case r.HardwareErrorCode.DeviceNotFound:return new i.DeviceNotFind(e);case r.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new i.NotInBootLoaderMode(e);case r.HardwareErrorCode.DeviceInterruptedFromOutside:case r.HardwareErrorCode.DeviceInterruptedFromUser:return new i.UserCancelFromOutside(e);case r.HardwareErrorCode.DeviceNotSupportPassphrase:return new i.NotSupportPassphraseError(e);case r.HardwareErrorCode.IFrameLoadFail:return new i.InitIframeLoadFail(e);case r.HardwareErrorCode.IframeTimeout:return new i.InitIframeTimeout(e);case r.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new i.FirmwareDownloadFailed(e);case r.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new i.FirmwareUpdateManuallyEnterBoot(e);case r.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new i.FirmwareUpdateAutoEnterBootFailure(e);case r.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new i.FirmwareUpdateLimitOneDevice(e);case r.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new i.FirmwareVersionTooLow(e);case r.HardwareErrorCode.NewFirmwareUnRelease:return new i.NewFirmwareUnRelease(e);case r.HardwareErrorCode.NewFirmwareForceUpdate:return new i.NewFirmwareForceUpdate(e);case r.HardwareErrorCode.NetworkError:return new i.NetworkError(e);case r.HardwareErrorCode.BlePermissionError:return new i.NeedBluetoothTurnedOn(e);case r.HardwareErrorCode.BleLocationError:return new i.NeedBluetoothPermissions({message:d});case r.HardwareErrorCode.BleLocationServicesDisabled:return new i.BleLocationServiceError({message:d});case r.HardwareErrorCode.BleDeviceNotBonded:return new i.DeviceNotBonded(e);case r.HardwareErrorCode.BleDeviceBondError:return new i.DeviceBondError(e);case r.HardwareErrorCode.BleWriteCharacteristicError:return new i.BleWriteCharacteristicError(e);case r.HardwareErrorCode.BleScanError:return new i.BleScanError({message:d});case r.HardwareErrorCode.BleAlreadyConnected:return new i.BleAlreadyConnectedError(e);case r.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new i.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new i.UnknownMethod(e):new i.UnknownHardwareError(e);case r.HardwareErrorCode.PinInvalid:return new i.InvalidPIN(e);case r.HardwareErrorCode.DeviceCheckPassphraseStateError:return new i.InvalidPassphrase(e);case r.HardwareErrorCode.DeviceOpenedPassphrase:return new i.DeviceOpenedPassphrase(e);case r.HardwareErrorCode.DeviceNotOpenedPassphrase:return new i.DeviceNotOpenedPassphrase(e);case r.HardwareErrorCode.PinCancelled:case r.HardwareErrorCode.ActionCancelled:return new i.UserCancel(e);case r.HardwareErrorCode.BridgeNotInstalled:case i.CustomOneKeyHardwareError.NeedOneKeyBridge:return new i.NeedOneKeyBridge(e);case r.HardwareErrorCode.BridgeNetworkError:return new i.BridgeNetworkError(e);case r.HardwareErrorCode.BridgeTimeoutError:return new i.BridgeTimeoutError(e);case r.HardwareErrorCode.PollingTimeout:return new i.ConnectTimeoutError(e);case r.HardwareErrorCode.PollingStop:return new i.ConnectPollingStopError(e);case r.HardwareErrorCode.BlindSignDisabled:return new i.OpenBlindSign(e);case r.HardwareErrorCode.FileAlreadyExists:return new i.FileAlreadyExistError(e);case r.HardwareErrorCode.CheckDownloadFileError:return new i.IncompleteFileError(e);case r.HardwareErrorCode.NotInSigningMode:return new i.NotInSigningModeError(e);case r.HardwareErrorCode.DataOverload:return new i.DeviceDataOverload(e);default:return new i.UnknownHardwareError(e)}}}}]);